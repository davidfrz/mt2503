/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*******************************************************************************
 *
 * Filename:
 * ---------
 *	afe.h
 *
 * Project:
 * --------
 *   Maui
 *
 * Description:
 * ------------
 *   Audio Front End Header
 *
 * Author:
 * -------
 * -------
 *
 *------------------------------------------------------------------------------
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 *******************************************************************************/
#ifndef AFE_H
#define AFE_H

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter:  INCLUDE FILES
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

#include "kal_general_types.h"
#include "kal_public_api.h"
#include "l1d_reg.h"
#include "reg_base.h"
#include "kal_trace.h"
#include "l1audio_trace.h"
#include "l1sp_trc.h"
#include "audcoeff_default.h"
#include "afe_def.h"
#include "dcl.h"
#include "us_timer.h"


#include "stack_config.h"
#include "speech_def.h"

#if defined(__BT_SUPPORT__)
   #include "bt_api.h"
#endif

#if defined(__GAIN_TABLE_SUPPORT__)
   #include "aud_defs.h"
#endif

#if defined(EXT_DAC_SUPPORT)
// mcu\media\audio\include
   #include "aud_defs.h"  
// mcu\ps\l4\include
   #include "device.h"
#endif

#if defined(MT6255) || defined(MT6261) || defined(MT2501) || defined(MT2502)
// To check ECO version
   #include "init.h"
#endif

#if __AFE_HW_DC_COMPENSATION__

#include "stack_ltlcom.h"
#include "Syscomp_config.h"
#include "task_config.h"

#include "audio_nvram_def.h"
#include "dcl.h"
#include "Drvsignals.h"
#endif

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: Data Types and Structures
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

//=============================================================================================
//                  Section: Enum Multiple Die
//=============================================================================================
typedef enum
{
   AFE_DIE2DIE_NONE,
   AFE_DIE2DIE_DOWNLINK,
   AFE_DIE2DIE_UPLINK
}AFE_DIE2DIE_T;

//=============================================================================================
//                  Section: Enum AFE_STATE_T
//=============================================================================================
typedef enum
{
   AFE_STATE_OFF = 0,
   AFE_STATE_ON,
   AFE_STATE_IDLE_OFF,
   AFE_STATE_CLASS_D_OFF,
   AFE_STATE_MAX
}  AFE_STATE_T;

//=============================================================================================
//                  Section: Enum VCP
//=============================================================================================

typedef enum
{
   CP_STATE_OFF = 0,
   CP_STATE_ON_BYPASS,
   CP_STATE_ON_BOOST,
}  AFE_VCP_T;


//=============================================================================================
//                  Section: Structure DelayCmd
//=============================================================================================
typedef struct {
   volatile uint16*  addr;
   uint16            val;
} DelayCmd;

//=============================================================================================
//                  Section: Structure RegBackup
//=============================================================================================
typedef struct {
   kal_uint16     VMCU_CON;
   kal_uint16     VDB_CON;
   kal_uint16     VLB_CON;
   kal_uint16     AMCU_CON0;
   kal_uint16     AMCU_CON1;
   kal_uint16     EDI_CON;
   kal_uint16     AMCU_CON2;
   kal_uint16     VAGC_CON0;
   kal_uint16     DAC_TEST;
   kal_uint16     VMCU_CON1;
   kal_uint16     VMCU_CON2;
   kal_uint16     VAGC_CON1;
   kal_uint16     VAGC_CON2;
   kal_uint16     VAGC_CON3;
   kal_uint16     VAGC_CON4;
   kal_uint16     VAGC_CON5;
   kal_uint16     VAGC_CON6;
#if defined(MT6256) || defined(MT6255) 
   kal_uint16     VMCU_CON5;
   kal_uint16     AMCU_CON3;
   kal_uint16     VMCU_CON3;
   kal_uint16     AMCU_CON5;
#endif
#if defined(MT6255) 
   kal_uint16     VMCU_CON6;
   kal_uint16     PC_1X_IDX;
#endif   
#if defined(__DUAL_MIC_SUPPORT__)
   kal_uint16     VAGC2_CON0;
   kal_uint16     VAGC2_CON1;
   kal_uint16     VAGC2_CON2;
   kal_uint16     VAGC2_CON3;
   kal_uint16     VAGC2_CON4;
   kal_uint16     VAGC2_CON5;
   kal_uint16     VAGC2_CON6;
#endif
} RegBackup;

//=============================================================================================
//                  Section: Structure AFE_STRUCT_T (afe main structure)
//=============================================================================================
typedef struct {
#if defined(__GAIN_TABLE_SUPPORT__)
   kal_uint32     mic_total_gain;
   kal_uint32     dual_path_loud_spk_gain;
#endif
   /// Speaker usage flag
   /// bit n : aud function n
   /// [Set|Clear] by AFE_Turn[On|Off]Speaker
   kal_uint16     sp_flag;
   /// FIR filter usage flag
   /// bin n: aud function n
   /// [Set|Clear] by AFE_Turn[On|Off]FIR
   kal_uint16     fir_flag;
   /// Microphone usage flag
   /// bin n: aud function n
   /// [Set|Clear] by AFE_Turn[On|Off]Microphone
   kal_uint16     mic_flag;
   /// L1SP_LNA_0, L1SP_LNA_1, or L1SP_LNA_FMRR
   kal_uint8      mic_src;
   kal_uint8      mic_volume;
   kal_bool       mic_mute;
#ifdef DSDA_VIA_PCM_INTERFACE   
   kal_int16      digitOnly_mic_volume;
   kal_int16     digitOnly_sphEnhRef_digital_gain;
#endif
   kal_bool       accessory_flag;
   kal_uint8      sidetone_volume;   
   kal_bool       sidetone_disable;  /// sidetone disable flag
   struct   {
      /// L1SP_SPEAKER1, L1SP_SPEAKER2, or L1SP_LOUDSPEAKER
      /// Set by AFE_SetOutputDevice
#if defined(__GAIN_TABLE_SUPPORT__)
      kal_uint32  total_gain;
#endif
      kal_uint8   out_dev;
      kal_uint8   volume;
      kal_int8    digital_gain_index;
      kal_uint16  digital_gain;
      kal_uint8   digital_gain_level;/// digital gain level
      kal_bool    mute;
#ifdef DSDA_VIA_PCM_INTERFACE
      kal_int16  digitOnly_digital_gain;
#endif
   } aud[L1SP_MAX_AUDIO];
   kal_uint16     aud_id;
   kal_uint8      Pre_OutDev; //0: voice out, 1: audio out
   kal_int16      Pre_aFunc;
   kal_uint8      Pre_InSrc; //0: voice src, 1: audio src, 2: line-in
   /// for controlling external amplifier
   kal_bool       gpio_lock;
   kal_bool       ext_op_on;
   kal_bool       mute;  /// for mute AFE
   kal_bool       refresh;
   kal_bool       loopback; 
   kal_bool       v8k_off_request;
   kal_bool       aClk_off_request;
   kal_bool       agc_reset_flag; //set as TRUE when turn on microphone. After updated AGC set it as false.
   kal_bool       fastramp;
   kal_bool       audioplay;
   kal_bool       agc_flag;
   kal_bool       aClk_on_request; 
   kal_bool       bt_flag;
   kal_bool       dis_idleOff_delay;
   kal_bool       afe_hw_mute;
   kal_bool       afe_event_handler_hw_mute;
   kal_bool       afe_audio_clk_hw_mute;
   kal_bool       afe_init;
   kal_uint32     audio_fs;
   RINGBUFFER_T(DelayCmd,8)  regq;
   kal_uint16     class_d_gain;
   AFE_STATE_T    afe_state; 

#if defined(EXT_DAC_SUPPORT) 
   /// for controlling external DAC 
   kal_bool       ext_dac_i2s_on;
   kal_bool       ext_dac_add_st;
   kal_bool       ext_dac_mute;
   kal_int8       ext_dac_aud_func;  
   kal_uint8      ext_dac_aud_vol; 
   kal_uint16     ext_dac_freq;   
   kal_uint16     ext_dac_level_gain;               
#endif    
   kal_int16      ext_op_delay; 
   kal_bool       toneLoopbackRec;

#if defined(__ACCDET_HYBRID_SOLUTION_SUPPORT__)
   DCL_HANDLE     dcl_aux_handle;
   kal_bool       aux_Audio_on;
#endif

#if HW_MUTE_SUPPORT_PLATFORM
   kal_bool       hw_mute_sleep;
#endif

#if __RELOAD_HW_COEFF__
   //for 65nm clock gating, digital AFE register backup
   RegBackup      regbak;
#endif

#if __AFE_SW_DC_COMPENSATION__ //Scott110704
   kal_int16      i2CompVal;   
   kal_uint16     u2DCGain;
#endif //__AFE_SW_DC_COMPENSATION__

#if defined(MT6236) || defined(MT6236B) || defined(MT6253) || defined(MT6252) || defined(MT6252H)   
   kal_uint8      spk_driver_mode;
 #if defined(__CLASSAB_VOLUME_PROTECTION__)
   kal_uint16     class_ab_gain_low_battery;    
   kal_bool       low_battery;
 #endif //__CLASSAB_VOLUME_PROTECTION__
#endif

#if defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502)
   kal_int16     powerOffWait;
#endif
   
   
#if defined(MT6251) || defined(MT6256) || defined(MT6255) || defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502)
   kal_bool       bPowerDown;
#endif
#if __AFE_HW_DC_COMPENSATION__
   kal_bool       bReceiverOut;
   kal_uint8      spk_amp_mode;
   kal_bool       DC_Calibrated;
   kal_bool       dc_calibrate_finish;
   kal_bool       dc_calibrate_writeback;
   kal_bool       dc_cali_wait;
   kal_bool       dc_cali_new_callback;
   kal_int16      Pre_DC_OFFSET;
   kal_int16      DC_OFFSET;
   kal_uint16     Callback_DCOffset;
   kal_int16      retrieved_dc_data;
   kal_uint16     dc_cali_aud_id;
   kal_uint16     spk_dc_compensate_value;
   kal_int32      Pre_offset_val;
   kal_int32      DC_offset_val;
   kal_uint16     DC_comp_val;
   kal_int16      DC_offset_mV;     // for debug
   kal_int16      Pre_offset_mV;    // for debug
#endif   
#if __AFE_HP_DC_CALIBRATION__
   kal_uint16     hp_dc_compensate_value_l; 
   kal_uint16     hp_dc_compensate_value_r;   
#endif

#if __AFE_KARAOK_SUPPORT__
   kal_bool       KaraokMode;
#endif

#if defined(__AFE_AUDIO_DELAY_OFF__)
   kal_uint32     Audio_gpt;
   kal_bool       Audio_gpt_on;   
   kal_int16      Audio_close_delay;
   kal_int16      AUDIOCLOSEDELAY;
   kal_bool       fgIdleOffTimerSet;
   kal_bool       Audio_gpt_init;
#endif
   kal_bool       Audio_close_delay_expired;

#ifdef __VIBRATION_SPEAKER_SUPPORT__
   kal_bool       vibrate; 
   kal_uint16     vib_ampgain;
#if __AFE_CURRENT_SENSOR_ENABLE__   
   kal_bool       vib_cali_wait;
   kal_bool       vib_cali_done;
   kal_bool       vib_first_cali;
   kal_uint16     retrieved_cf_data; 
   kal_uint16     cali_cf_data; 
   DCL_HANDLE     dcl_cursensor_handle;
#endif    
#endif
   void (*pDC_Calibration_CallBack)(kal_uint16 *pwdc_offset);

#if __AFE_AudVoice_SingleClkSrc__
   kal_bool       audio_clk_ena;
   kal_bool       voice_clk_ena;
#endif
#if __AFE_MULTIEPLE_DIE__
   AFE_DIE2DIE_T  die2die_status;
#endif
#if __AFE_MD2G_PWDN_LOCK__
   kal_uint32     md2glock_num;
   kal_bool       md2glock_checking;
#endif 
   kal_bool       audio_dl_ena;
   kal_bool       voice_dl_ena;
   kal_bool       voice_ul_ena;
   kal_bool       system_poweroff;
#if __CTIRQ_SLEEP_PLATFORM__
   kal_timerid    timer;
#endif
#if __AFE_PA_DELAY_OFF__
   kal_int8       pa_delay;
#endif
#if defined(__CLASSK_CP_SUPPORT__)
   AFE_VCP_T      cp_state;
   kal_bool       cp_th_high;
   kal_uint8      cp_disable;
   kal_uint8      spk_vol;
#endif
#if defined(MT6261) || defined(MT2501) || defined(MT2502)
   kal_bool      hs_on;
   kal_bool      hp_on;
#endif   
} AFE_STRUCT_T;

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: Special Configurations for Specific Usage
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

//=============================================================================================
//                   Section: Debug and Unit Test Configuration
//=============================================================================================
//#define __AFE_DEBUG__
#define UNIT_TEST_AFE2 0
#ifdef __AFE_DEBUG__
   #define afe_prompt_trace  kal_prompt_trace

static kal_char * _aszAfeState[] =
{
   "AFE_STATE_OFF",
   "AFE_STATE_ON",
   "AFE_STATE_IDLE_OFF",
   "AFE_STATE_CLASS_D_OFF"
};

#else
   #define afe_prompt_trace(...) 
#endif

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: Definitions by Features (Common Feature for all chips)
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

//=============================================================================================
//                  Section: Feature Accessory Usage 
//=============================================================================================
#if defined(MT6235) || defined(MT6235B) || defined(MT6268) || defined(MT6253) || defined(MT6236) || defined(MT6236B) || defined(MT6252H) || defined(MT6252)
   #define ACCESSORY_USAGE    0x30
#elif defined(MT6256) || defined(MT6251) || defined(MT6255)
   #define ACCESSORY_USAGE    0x10
#endif

//=============================================================================================
//                  Section: Feature FM Ratio Recording Volume
//=============================================================================================
#if (defined(MT5192FM) && defined(__ATV_RECORD_SUPPORT__))
   #define FM_RADIO_RECORDING_VOLUME   45
#elif defined(MT6235) || defined(MT6235B) || defined(MT6268)
   #define FM_RADIO_RECORDING_VOLUME   4
#elif defined(MT6252) || defined(MT6252H)
   #define FM_RADIO_RECORDING_VOLUME   0x14
#elif defined(MT6255) || defined(MT6250) // MT6260/50 no line in path
   #define FM_RADIO_RECORDING_VOLUME   5
#endif

//=============================================================================================
//                  Section: Feature Mic Settings
//=============================================================================================
#if defined(MT6252H) || defined(MT6252)
   #define MIC_SETTING_MASK      0x307F
   #define MIC_SETTING_FMREC     0x4100
   #define MIC_SETTING_HEADSET   0x4080
   #define MIC_SETTING_NORMAL    0x4000
#elif defined(MT6235) || defined(MT6235B) || defined(MT6268) || defined(MT6253)
   #define MIC_SETTING_MASK      0x307F
   #define MIC_SETTING_FMREC     0x4900
   #define MIC_SETTING_HEADSET   0x4880
   #define MIC_SETTING_NORMAL    0x4800
#elif defined(MT6236) || defined(MT6236B)
   #define MIC_SETTING_MASK      0xF07F
   #define MIC_SETTING_FMREC     0x0100
   #define MIC_SETTING_HEADSET   0x0080
   #define MIC_SETTING_NORMAL    0x0000
#elif defined(MT6251) || defined(MT6256) || defined(MT6255)
   #define MIC_SETTING_MASK      0xFE7F
   #define MIC_SETTING_HEADSET   0x0080
   #define MIC_SETTING_NORMAL    0x0000
#elif defined(MT6250) || defined(MT6260)
   #define MIC_SETTING_MASK      0xFF7F
   #define MIC_SETTING_HEADSET   0x0080
   #define MIC_SETTING_NORMAL    0x0000
#elif defined(MT6261) || defined(MT2501) || defined(MT2502)
   #define MIC_SETTING_MASK      0xFDFF
   #define MIC_SETTING_HEADSET   0x0200
   #define MIC_SETTING_NORMAL    0x0000        
#endif

//=============================================================================================
//                  Section: Feature AAPDN_CON Settings
//=============================================================================================
#if defined(MT6252H) || defined(MT6252)
   #define AAPDN_POWER_DOWN   0x000
   #define AAPDN_BIAS_DAC_ON  0x101C
   #define AAPDN_BIAS_BUF_ON  0x1813
   #define AAPDN_ALL_ON       0x18FF
   #define AAPDN_MASK         0x8FF
#else
   #define AAPDN_POWER_DOWN   0x000
   #define AAPDN_BIAS_DAC_ON  0x01C
   #define AAPDN_BIAS_BUF_ON  0x013
   #define AAPDN_ALL_ON       0x0FF
   #define AAPDN_MASK         0x0FF
#endif

//=============================================================================================
//                  Section: Feature Power Down Control Registers Settings
//=============================================================================================
   #define PDN_CON2_VAFE       0x0100
#if __AFE_AudVoice_SingleClkSrc__
   #define PDN_CON2_AAFE       PDN_CON2_VAFE
#else
   #define PDN_CON2_AAFE       0x1000
#endif
#define CG_CON2_MIXED       0x0200


//=============================================================================================
//                  Section: Feature VAPDN_CON Settings
//=============================================================================================
#if defined(MT6268)
   #define VAPDN_BIAS_DAC_ON      0x0E4
   #define VAPDN_BIAS_LNA_ON      0x0F0
   #define VAPDN_BIAS_LNA_ADC_ON  0x0F8
#elif defined(MT6252H) || defined(MT6252)
   #define VAPDN_BIAS_DAC_ON      (0x024 | RG_VREF24_EN /*| RG_VDEPOP_EN*/) 
   #define VAPDN_BIAS_LNA_ON      (0x030 | RG_VREF24_EN /*| RG_VDEPOP_EN*/)
   #define VAPDN_BIAS_LNA_ADC_ON  (0x038 | RG_VREF24_EN /*| RG_VDEPOP_EN*/)
#else
   #define VAPDN_BIAS_DAC_ON      0x024
   #define VAPDN_BIAS_LNA_ON      0x030
   #define VAPDN_BIAS_LNA_ADC_ON  0x038
#endif


//=============================================================================================
//                  Section: Feature 
//=============================================================================================
#if defined(MT6255) || defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502)
   #define MIN_PGA_GAIN                 (0x8)
   #define MAX_PGA_GAIN                 (MIN_PGA_GAIN+30)
#elif defined(MT6252) || defined(MT6252H)
   #define MAX_PGA_GAIN 13     // 0xD  => 17dB
#endif

//=============================================================================================
//                  Section: Feature Speech tuning tool related (AFE_GetPGAGainInfo)
//=============================================================================================
#if defined(MT6255)
   #define AUDIO_BUFFER_TOTAL_LEVEL 31
   #define AUDIO_BUFFER_MAX_GAIN    8
   #define AUDIO_BUFFER_STEP        1
   #define VOICE_BUFFER_TOTAL_LEVEL 31
   #define VOICE_BUFFER_MAX_GAIN    8
   #define VOICE_BUFFER_STEP        1
   #define MIC_TOTAL_LEVEL          6
   #define MIC_MAX_GAIN             24
   #define MIC_STEP                 6
#elif defined(MT6256)
   #define AUDIO_BUFFER_TOTAL_LEVEL 45
   #define AUDIO_BUFFER_MAX_GAIN    12
   #define AUDIO_BUFFER_STEP        1
   #define VOICE_BUFFER_TOTAL_LEVEL 45
   #define VOICE_BUFFER_MAX_GAIN    12
   #define VOICE_BUFFER_STEP        1
   #define MIC_TOTAL_LEVEL          64
   #define MIC_MAX_GAIN             49
   #define MIC_STEP                 1
#elif defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502) 
   #define AUDIO_BUFFER_TOTAL_LEVEL 21
   #define AUDIO_BUFFER_MAX_GAIN    11
   #define AUDIO_BUFFER_STEP        2
   #define VOICE_BUFFER_TOTAL_LEVEL 16
   #define VOICE_BUFFER_MAX_GAIN    8
   #define VOICE_BUFFER_STEP        2
   #define MIC_TOTAL_LEVEL          64
   #define MIC_MAX_GAIN             43
   #define MIC_STEP                 1
#else
   #define AUDIO_BUFFER_TOTAL_LEVEL 16
   #define AUDIO_BUFFER_MAX_GAIN    23
   #define AUDIO_BUFFER_STEP        3
   #define VOICE_BUFFER_TOTAL_LEVEL 16
   #define VOICE_BUFFER_MAX_GAIN    8
   #define VOICE_BUFFER_STEP        2
   #define MIC_TOTAL_LEVEL          32
   #define MIC_MAX_GAIN             48
   #define MIC_STEP                 2
#endif

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: Definitions by Features (Feature for specific chips)
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

//=============================================================================================
//                  Section: Feature HW Pre-distortion
//=============================================================================================
#if __AFE_HW_PREDIST__
   #define HW_PREDIST_ENBIT          (0x1 << 10)
#endif

//=============================================================================================
//                  Section: Delay Off
//=============================================================================================
#if __AFE_AUDIO_DELAY_OFF__
   #define AUDIO_CLOSE_DELAY 500 //500 ms, unit is 10ms
#endif
//=============================================================================================
//                  Section: Feature Over-Current Detection
//=============================================================================================
#if __AFE_OC_DETECTION__
 #if defined(MT6252) || defined(MT6252H)
   #define SPK_OC_FLAG        (0x1 << 15)  //PMIC_CLASSAB_CON1
   #define SPK_OC_AUTOFF      (0x1 << 6)   //PMIC_CLASSAB_CON1
   #define SPK_CLASSAB_OC_EN  (0x1 << 6)   //PMIC_CLASSAB_CON0
 #elif defined(MT6236) || defined(MT6236B)
   #define SPK_OC_FLAG        (0x1 << 14) //SPK_CON0
   #define SPK_OC_AUTOFF      (0x1 << 12) //SPK_CON0
   #define SPK_CLASSAB_OC_EN  (0x1 << 5)  //SPK_CON3
 #elif defined(MT6256)
   #define SPK_OC_FLAG        (0x1 << 14) //SPK_CON0
   #define SPK_OC_AUTOFF      (0x1 << 12) //SPK_CON0
   #define SPK_CLASSAB_OC_EN  (0x1 << 8)  //SPK_CON7
   #define SPK_CLASSD_OC_EN   (0x1 << 10) //SPK_CON3
 #elif defined(MT6255) || defined(MT6250)  || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502) 
   #define SPK_OC_FLAG        (0x1 << 14) //SPK_CON0
   #define SPK_OC_AUTOFF      (0x1 << 12) //SPK_CON0
   #define SPK_CLASSAB_OC_EN  (0x1 << 8)  //SPK_CON7
 #endif
#endif

//=============================================================================================
//                  Section: Feature DC Compensation 
//=============================================================================================
#if __AFE_SW_DC_COMPENSATION__ 
   #define DC_COMP_DELAY_PROCESS       5
   #define DC_COMP_POST_DELAY_PROCESS  1
 #if defined(MT6252H) || defined(MT6252) 
   #define EFUSE_ADDR 0x80000024
   #define EFUSE_MASK_6db (0x3F << 14)
   #define EFUSE_MASK_12db (0x3F << 8)
   #define EFUSE_MASK_18db (0x3F << 2)
 #else
   #define EFUSE_ADDR 0x801c0020
   #define EFUSE_MASK (0x3F << 14)
 #endif
#endif

#if __AFE_HW_DC_COMPENSATION__ 
   #define RAMP_STEP_SIZE 2
   #define RAMP_DELAY_TIME 50
   #define COMPENSATE_NO  5
#endif

//=============================================================================================
//                  Section: Feature Mic Volume Low Bound
//=============================================================================================
#if __AFE_MIC_VOLUME_LOWER_BOUND__
#if defined(MT6252) || defined(MT6252H)
   #define AFE_MICVOLUME_LOWBOUND 0x10  // minimum is -5dB ==> 0x10
#endif
#endif


//=============================================================================================
//                  Section: Feature Analog Gain Setting Reverse Order
//=============================================================================================
#if __AFE_ANALOG_GAIN_REVERSE_ORDER__
 #if defined(MT6255)
   #define MINIMUM_AGAIN_SETTING 0x1E
 #elif defined(MT6251) || defined(MT6256)
   #define MINIMUM_AGAIN_SETTING 0x2C
 #elif defined(MT6261) || defined(MT2501) || defined(MT2502)
   #define MINIMUM_AGAIN_SETTING 0xE
   #define MINIMUM_VGAIN_SETTING 0x1E
 #endif
#endif

#if __AFE_ANALOG_GAIN_LOWER_BOUND__
 #if defined(MT6256) || defined(MT6255) || defined(MT6251)
   #define AGAIN_LOWBOUND_SETTING               68
 #elif defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502) 
   #define AGAIN_UPBOUND_SETTING               160
   #define AGAIN_LOWBOUND_SETTING              104
   #define VGAIN_UPBOUND_SETTING               240
   #define VGAIN_DUALSPEAKER_LOWBOUND_SETTING  128
   #define VGAIN_LOWBOUND_SETTING_SPKAUD       128
   #define VGAIN_LOWBOUND_SETTING                0
 #endif
#endif


//=============================================================================================
//                  Section: Feature AAC_CON_MASK
// Clear ABUFSEL[L|R] bit-fields & audio buffer [L|R]-channel input selection
//=============================================================================================
#if !__AFE_2ndG_DC_COUPLE__ && !__AFE_2ndG_AC_COUPLE__
   #define AFE_AAC_CON_MASK 0xF81F
#endif

//=============================================================================================
//                  Section: Feature HW AGC Setting
//=============================================================================================    
#if (defined(__HQA_AUDIO__) && !(__HQA_AUDIO_HARDWARE_AGC__) ) || (!__AFE_ENABLE_HW_AGC__)
   #define HARDWARE_AGC_ON 0
   #define SW_AGC_GAIN_DEFAULT          (11)
   #define TRANSPARENT_AGC_GAIN_OFFSET  (39)
#else
   #define HARDWARE_AGC_ON 1
#endif

//#if defined(MT6256_S01) || defined(MT6236) || defined(MT6255)
#if __AFE_ENABLE_HW_AGC__
   #define AGC_CTRL_ENABLE    ((kal_uint16)0x1 << 0)
   #define AGC_COMP_ENABLE    ((kal_uint16)0x1 << 13)
#else
   #define AGC_CTRL_ENABLE    ((kal_uint16)0x0 << 0)
   #define AGC_COMP_ENABLE    ((kal_uint16)0x0 << 13)
#endif

//=============================================================================================
//                  Section: __CLASSAB_VOLUME_PROTECTION__ Setting
//=============================================================================================    
#define MAX_PGA_GAIN_LOW_BAT 8     // 2dB

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: Definitions by Chips Specific Settings
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

//=============================================================================================
//                  Section: Feature VCM Mode (52/53 only)
//=============================================================================================
#if defined(MT6253) || defined(MT6252H) || defined(MT6252)
   #define AFE_VCM_NEW  0
   #define AFE_VCM_OLD  1
#endif


//=============================================================================================
//                  Section: Feature Ext Amp Internal delay (36 only)
//=============================================================================================
#if defined(MT6236) || defined(MT6236B)
   #define EXT_INTERNAL_DELAY_CNT   3
#endif

//=============================================================================================
//                  Section: Feature AFE_VAC_CON1_MASK  (52/35/68/53 only)
//=============================================================================================
#if defined(MT6252H) || defined(MT6252)
    #define AFE_VAC_CON1_MASK 0xFFEB
#elif defined(MT6235) || defined(MT6235B) || defined(MT6268) || defined(MT6253)
    #define AFE_VAC_CON1_MASK 0xFFE3
#endif

//=============================================================================================
//                  Section: Feature Chip Specific Setting of 36/51/55/56
//=============================================================================================
#if defined(MT6236) || defined(MT6236B) || defined(MT6256) || defined(MT6251) || defined(MT6255)
  //#define  AFE_VAG_CON    ((APBADDR)(MIXED_base+0x0100))      /* AFE Voice Analog Gain Control Register        */
    #define VREF24_CALI_MASK               (0x3 << 14)
    #define VREF24_2_40                    (0x0 << 14)
    #define VREF24_2_27                    (0x1 << 14)
    #define VREF24_2_15                    (0x2 << 14)
    #define VREF24_2_03                    (0x3 << 14)
    #define VOICE_UP_LINK_PGA_GAIN_MASK    (0x3f<< 8)
    #define VOICE_DOWN_LINK_PGA_GAIN_MASK  (0xf << 4)
    #define VZERO_DTC_CMP_PWD              (0x1 << 2)
    #define VZERO_DTC_EN                   (0x1 << 1)
    #define VZERO_DTC_CALI                 (0x1 << 0)

//#define  AFE_VAC_CON0   ((APBADDR)(MIXED_base+0x0104))      /* AFE Voice Analog-Circuit Control Register 0   */
    #define VMIC_DCCOUPLE                  (0x1 << 15)
    #define VMIC_SHORT                     (0x1 << 14)
    #define VMIC_VREF_MASK                 (0x3 << 12)
    #define VMIC_VREF_1_9                  (0x0 << 12)         // 1.9V
    #define VMIC_VREF_2_0                  (0x1 << 12)         // 2.0V
    #define VMIC_VREF_2_1                  (0x2 << 12)         // 2.1V
    #define VMIC_VREF_2_2                  (0x3 << 12)         // 2.2V
    #define VCFG_MASK                      (0x1f << 7)
    #define VTX_TESTMODE                   (0x1 << 6)
    #define VDSEND                         (0x1 << 5)
    #define VCM14_EN                       (0x1 << 4)
    #define VREF24_EN                      (0x1 << 3)
    #define REFCALI_MASK                   (0x7 << 0)
    #define REFCALI_XX                     (0x0 << 0)
    
//#define  AFE_AAG_CON    ((APBADDR)(MIXED_base+0x0200))      /* AFE Audio Analog Gain Control Register        */
    #define CLASSD_MODE_MASK               (0x3 << 14)
    #define CLASSD_DIS_CONNECT             (0x0 << 14) 
    #define CLASSD_FM_INPUT                (0x1 << 14) 
    #define CLASSD_RCH_SINGLE_END          (0x2 << 14) 
    #define CLASSD_DIFF_MODE               (0x3 << 14) 

//#define  AFE_AAC_CON    ((APBADDR)(MIXED_base+0x0204))      /* AFE Audio Analog-Circuit Control Register     */
    #define APRO_SC_EN                     (0x1 << 13)
    #define ADEPOP_EN                      (0x1 << 12)
    #define ABUFSEL_RCH_MASK               (0x7 << 8)
    #define ABUFSEL_RCH_AUD_DAC_R          (0x0 << 8)
    #define ABUFSEL_RCH_VOICE_DAC          (0x2 << 8)
    #define ABUFSEL_RCH_FM_S2M             (0x4 << 8) 
    #define ABUFSEL_RCH_FM_MONO_R          (0x5 << 8)     
    #define ABUFSEL_LCH_MASK               (0x7 << 5)
    #define ABUFSEL_LCH_AUD_DAC_L          (0x0 << 8)
    #define ABUFSEL_LCH_VOICE_DAC          (0x2 << 8)
    #define ABUFSEL_LCH_FM_S2M             (0x4 << 8) 
    #define ABUFSEL_LCH_FM_MONO_L          (0x5 << 8)     
    #define DCT_VCM_OP_SEL_PVDD            (0x1 << 4)        // audio playback mode
    #define DCT_VCM_OP_SEL_1_4V            (0x0 << 4)        // voice playback mode
    #define DE_POP_VMC_EN                  (0x1 << 3)
    #define BIAS_CUR_MASK                  (0x7 << 0)      
    #define BIAS_CUR_4_4                   (0x0 << 0)        // 4/4 x lu    
    #define BIAS_CUR_3_4                   (0x1 << 0)        // 3/4 x lu    
    #define BIAS_CUR_2_4                   (0x2 << 0)        // 2/4 x lu    
    #define BIAS_CUR_1_4                   (0x3 << 0)        // 1/4 x lu    
    #define BIAS_CUR_8_4                   (0x4 << 0)        // 8/4 x lu    
    #define BIAS_CUR_7_4                   (0x5 << 0)        // 7/4 x lu     
    #define BIAS_CUR_6_4                   (0x6 << 0)        // 6/4 x lu    
    #define BIAS_CUR_5_4                   (0x7 << 0)        // 5/4 x lu  

//#define  AFE_AAPDN_CON  ((APBADDR)(MIXED_base+0x0208))      /* AFE Audio Analog Power Down Control Register  */
    #define AUD_VCM_ON                     (0x1 << 5)
    #define AUD_BIAS_ON                    (0x1 << 4)
    #define AUD_DCT_RIGHT_CH_ON            (0x1 << 3)
    #define AUD_DCT_LEFT_CH_ON             (0x1 << 2)
    #define AUD_OUT_BUF_LEFT_CH_ON         (0x1 << 1)
    #define AUD_OUT_BUF_RIGHT_CH_ON        (0x1 << 0)

//#define  AFE_AAC_NEW    ((APBADDR)(MIXED_base+0x020C))      /* Enhanced Audio AFE Control and Parameters     */
    #define AUD_HAND_FREE_MODE             (0x1 << 15)
    #define AUD_NORMAL_MODE                (0x0 << 15)
    #define ABUF_INPUT_SHORT_ON            (0x1 << 14)
    #define ABUF_INPUT_SHORT_OFF           (0x0 << 14)
    #define ABUF_BIAS_MASK                 (0xf << 6)
    #define ABUF_BIAS_1_0                  (0x0 << 6)
    #define ABUF_BIAS_1_33                 (0x1 << 6)
    #define ABUF_BIAS_0_33                 (0x2 << 6)    
    #define ABUF_BIAS_0_67                 (0x3 << 6)    
    #define ABUF_BIAS_1_00                 (0x4 << 6)
    #define AMUX_MASK                      (0x3 << 3)
    #define AMUX_FM                        (0x0 << 3)
    #define AMUX_FM_                       (0x1 << 3)
    #define AMUX_L_CH_DAC                  (0x2 << 3)
    #define AMUX_R_CH_OP                   (0x3 << 3)
    #define AVCMGEN_EN_ON                  (0x1 << 1)   
    #define AVCMGEN_EN_OFF                 (0x0 << 1)       
    #define AVCOM_MODE_SEL_NEW             (0x0 << 0)       
    #define AVCOM_MODE_SEL_OLD             (0x1 << 0)       

//#define  AFE_AAC_CON1   ((APBADDR)(MIXED_base+0x0210))      /* AFE Audio Analog-Circuit Control Register 1   */
    #define AREF2VREF                      (0x1 << 15)
    #define AUTODET_IQ_EN                  (0x1 << 14)
    #define ACLK2X_INV_EN                  (0x1 << 9)
    #define ACLK_INV_EN                    (0x1 << 8)
    #define ACLK_SEL_EN_MASK               (0xf << 4)
    #define ABIAS_CUR_DCT_MASK             (0xf << 0)
    #define ABIAS_CUR_DCT_04               (0x4 << 0)
    #define ABIAS_CUR_DCT_05               (0x5 << 0)    
    #define MICSEL                         (0x1 << 3)

#endif  /* defined(MT6236) || defined(MT6236B) || defined(MT6256) || defined(MT6251)  || defined(MT6255)*/

//=============================================================================================
//                  Section: Feature Chip Specific Setting of 52/53
//=============================================================================================
#if defined(MT6253) || defined(MT6252H) || defined(MT6252)
  //#define  AFE_AAC_NEW    ((APBADDR)(MIXED_base+0x020C))      /* Enhanced Audio AFE Control and Parameters     */
    #define AUD_VCM_MODE                (0x1 << 1)
    #define AUD_HAND_FREE_MODE          (0x1 << 8)
    #define AUD_NORMAL_MODE             (0x0 << 8)
    #define ABUF_INPUT_SHORT_ON         (0x1 << 10)
    #define ABUF_INPUT_SHORT_OFF        (0x0 << 10)

 #if  defined(MT6252H) || defined(MT6252)
  //#define  AFE_AAPDN_CON  ((APBADDR)(MIXED_base+0x0208))      /* AFE Audio Analog Power Down Control Register  */
    #define RG_ADACCK_EN                (0x1 << 12)
    #define RG_ABUFHALFV_EN             (0x1 << 11)
    #define RG_ADEPOPX_EN               (0x1 << 10)

  //#define  AFE_VAPDN_CON  ((APBADDR)(MIXED_base+0x010C))      /* AFE Voice Analog Power Down Control Register  */
    #define RG_VREF24_EN                (0x1 << 7)
    #define RG_VDEPOP_EN                (0x1 << 15)
 #endif
 
#endif

//=============================================================================================
//                  Section: Feature Chip Specific Setting of 52/53/36
//=============================================================================================
#if defined(MT6236) || defined(MT6236B) || defined(MT6252) || defined(MT6252H) || defined(MT6253)
   #define CLASS_D_OFF_POST_DELAY_CNT  1
   #define AFE_AUD_CLK_DELAY_TICK      3
   #define CLASS_D_ON_DELAY_TICK       1
   #define CLASS_D_FAST_OFF_DELAY_TICK 1
   #define AFE_AUD_CLK_ON_DELAY_TICK   1
#endif
#if defined(MT6236) || defined(MT6236B)
   #define EXT_INTERNAL_DELAY_MT6236   3
#endif

//=============================================================================================
//                  Section: Feature Gain Table Support
//=============================================================================================
#if defined(MT6255)
   #define AFE_BUFFER_AUD_GAIN_LEVEL   31
   #define AFE_BUFFER_AUD_BASE_GAIN    8
   #define AFE_BUFFER_AUD_GAIN_STEP    -1
   #define AFE_BUFFER_VOICE_GAIN_LEVEL 31
   #define AFE_BUFFER_VOICE_BASE_GAIN  8
   #define AFE_BUFFER_VOICE_GAIN_STEP  -1
   #define AFE_BUFFER_MIC_GAIN_LEVEL   6 /*total 6 levels*/
   #define AFE_BUFFER_MIC_BASE_GAIN    -6
   #define AFE_BUFFER_MIC_GAIN_STEP    6
#elif defined(MT6256)
   #define AFE_BUFFER_AUD_GAIN_LEVEL   45
   #define AFE_BUFFER_AUD_BASE_GAIN    12
   #define AFE_BUFFER_AUD_GAIN_STEP    -1
   #define AFE_BUFFER_VOICE_GAIN_LEVEL 45
   #define AFE_BUFFER_VOICE_BASE_GAIN  12
   #define AFE_BUFFER_VOICE_GAIN_STEP  -1
   #define AFE_BUFFER_MIC_GAIN_LEVEL   64 /*total 64 levels*/
   #define AFE_BUFFER_MIC_BASE_GAIN    -14
   #define AFE_BUFFER_MIC_GAIN_STEP    1
#elif defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502)
   #define AFE_BUFFER_AUD_GAIN_LEVEL   8
   #define AFE_BUFFER_AUD_BASE_GAIN    -3
   #define AFE_BUFFER_AUD_GAIN_STEP    2
   #define AFE_BUFFER_VOICE_GAIN_LEVEL 16
   #define AFE_BUFFER_VOICE_BASE_GAIN  -22
   #define AFE_BUFFER_VOICE_GAIN_STEP  2
   #define AFE_BUFFER_MIC_GAIN_LEVEL   6 /*total 6 levels*/
   #define AFE_BUFFER_MIC_BASE_GAIN    -6
   #define AFE_BUFFER_MIC_GAIN_STEP    6
#endif
//=============================================================================================
//                  Section: Feature Chip Specific Setting of 50
//=============================================================================================
#if defined(MT6250)
   //ABBA_AA_CON0
   #define pad_data_1_ies             (0x1 << 8)
   #define aa_audio_mode              (0x1 << 2)
   #define aa_audio_disable           (0x1 << 1)
   //ABBA_AUDIO_CON6
   #define RG_DEPOP_VCM_EN            (0x1)
   #define RG_ABIRX_ZCD_EN            (0x1 << 1)   //ABIRZ Zero Detection Function Enable
   #define RG_ABIRX_ZCD_HYS_ENB       (0x1 << 4)   //Audio buffer zero-detection hysteresis enable
   #define RG_DEPOP_VCMSEL            (0x1 << 7)   //Depop common mode voltage selection
   #define RG_CHARGEOPTION_DEPOP      (0x1 << 10)  //Depop charge/discharge selection
   #define RG_AVCM_GEN_EN             (0x1 << 11)  //Audio 1.4V halfV buffer enable (enable when using headphone buffer)
   //ABBA_VOICE_CON0
   #define RG_VBIRX_ZCD_EN            (0x1 << 2)   //Enable VBIRX Zero Detection Function
   //ABBA_VOICE_CON3
   #define RG_VCFG_1                  (0x1 << 8)

   #define RG_VBUF_PWDB               (0x1)        //HS buffer enable
   #define RG_VPWDB_ADC               (0x1 << 3)
   #define RG_VPWDB_PGA               (0x1 << 4)
   #define RG_VPWDB_MBIAS             (0x1 << 5)
   #define RG_VREF24_EN               (0x1 << 7)  //Downlink/Uplink Share, should open
   #define RG_VCM14_EN                (0x1 << 8)  //Downlink/Uplink Share, should open
   //ABBA_VOICE_CON4
   #define RG_V2SPK                   (0x1 << 8)   //voice buffer to speaker (1) or receiver (0)
   //ABB_WR_PATH0
   #define f26mclk_en                 (0x1 << 15)
   #define audio_fifo_en              (0x1 << 14)
   #define voice_fifo_en              (0x1 << 13)
   #define audio_pwdb                 (0x1 << 11)
   #define voice_pwdb                 (0x1 << 10)
   //ABB_ABB_RSV_CON1
   #define audio_26m_clk_ctrl         (0x1 <<  1)
   #define audio_fsm_ctrl             (0x1 <<  5)
   //ABBA_AUDIO_CON2
   #define RG_AMUTER                  (0x1 <<  9)
   #define RG_AMUTEL                  (0x1 <<  8)

#elif defined(MT6260)
   //ABBA_AUDIO_CON6
   #define RG_DEPOP_VCM_EN            (0x1)
   #define RG_ABIRX_ZCD_EN            (0x1 << 1)   //ABIRZ Zero Detection Function Enable
   #define RG_ABIRX_ZCD_HYS_ENB       (0x1 << 4)   //Audio buffer zero-detection hysteresis enable
   #define RG_DEPOP_VCMSEL            (0x1 << 7)   //Depop common mode voltage selection
   #define RG_CHARGEOPTION_DEPOP      (0x1 << 10)  //Depop charge/discharge selection
   #define RG_AVCM_GEN_EN             (0x1 << 11)  //Audio 1.4V halfV buffer enable (enable when using headphone buffer)
   //ABBA_VOICE_CON0
   #define RG_VBIRX_ZCD_EN            (0x1 << 2)   //Enable VBIRX Zero Detection Function   
   //ABBA_VOICE_CON1
   #define RG_VCFG_1                  (0x1 << 8) 
   //ABBA_VOICE_CON3
   #define RG_VBUF_PWDB               (0x1)        //HS buffer enable
   #define RG_VPWDB_ADC               (0x1 << 3)
   #define RG_VPWDB_PGA               (0x1 << 4)
   #define RG_VPWDB_MBIAS             (0x1 << 5)
   #define RG_VREF24_EN               (0x1 << 7)  //Downlink/Uplink Share, should open
   #define RG_VCM14_EN                (0x1 << 8)  //Downlink/Uplink Share, should open     
   //ABBA_VOICE_CON4
   #define RG_V2SPK                   (0x1 << 8)   //voice buffer to speaker (1) or receiver (0)
   //ABBA_AUDIO_CON2
   #define RG_AMUTER                  (0x1 << 9)
   #define RG_AMUTEL                  (0x1 << 8)
   #define RG_ADEPOPX_EN              (0x1 << 10)
   //D2D_A_AUD_CON0
   #define a_aud_en                   (0x1 << 15)
   #define a_audio_ies                (0x1 << 11)
   #define a_aud_mode                 (0x1)        //1:audio mode ; 0:speech mode   
   //D2D_D_AUD_CON1
   #define d_audio_ies                (0x1 << 15)
   #define f26m_aud_en                (0x1)   
   //D2D_D_AUD_CON0
   #define audio_fifo_en              (0x1 << 15)
   #define audio_fifo_rst_st          (0x1 << 14)  //audio fifo reset state
   #define d_aud_en                   (0x1 << 9)   //audio FSM enable
   #define d_aud_mode                 (0x1 << 8)   //1:audio mode ; 0:speech mode
   
#elif defined(MT6261) || defined(MT2501) || defined(MT2502)  
   //ABBA_VBITX_CON0
   #define RG_VCFG_1                  (0x1 << 10) 
   #define RG_VPWDB_PGA               (0x1 << 5)   
   //ABBA_VBITX_CON1
   #define RG_VPWDB_ADC               (0x1 << 6)
   #define RG_VREF24_EN               (0x1 << 2)  
   #define RG_VCM14_EN                (0x1 << 1) 
   //ABBA_VBITX_CON4
   #define RG_VPWDB_MBIAS             (0x1 << 1) 
   //ABBA_AUDIODL_CON0   
   #define RG_AUDIBIASPWRUP           (0x1)
   #define RG_AUDHPRPWRUP             (0x1 << 2)
   #define RG_AUDHPLPWRUP             (0x1 << 3)              
   #define RG_AUDHSPWRUP              (0x1 << 4)
   #define RG_AUDDACRPWRUP            (0x1 << 5)
   #define RG_AUDDACLPWRUP            (0x1 << 6)
   //ABBA_AUDIODL_CON4
   #define RG_DEPOP_VCM_EN            (0x1)
   #define RG_DEPOP_CHARGEOPTION      (0x1 << 5)
   #define RG_ADEPOP_EN               (0x1 << 6)
   //ABBA_AUDIODL_CON8 
   #define RG_LCLDO_TBST_EN           (0x1 << 1)  //Audio/Voice TOP bias current from ABB TOP
   //ABBA_AUDIODL_CON10                
   #define RG_AUDHSBIAS               (0x1 << 12)
   //ABBA_AUDIODL_CON12
   #define audzcdenable               (0x1)
   //ABBA_AUDIODL_CON16
   #define RG_AMUTER                  (0x1 << 1)
   #define RG_AMUTEL                  (0x1)   
   //VSBST_CON0 
   #define QI_VSBST_EN                (0x1)   
   #define RG_VSBST_BP                (0x1 << 1) 
   #define NI_VSBST_SSBP              (0x1 << 5) 
   #define VSBST_VIO28_PG_STATUS      (0x1 << 10)
   //VSBST_CON4
   #define QI_VSBST_PG_STATUS         (0x1 << 9)
#endif


/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: DEFINITION OF DATA TYPES
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/

//=============================================================================================
//                  Section: Macros
//=============================================================================================
#define AFE_READ16(Reg)                        (*((volatile kal_uint16*)(Reg)))
#define AFE_WRITE16(Reg, Value)                 (*((volatile kal_uint16*)(Reg)) = (Value))
#define AFE_SET_BIT(Reg, Bit)                  AFE_WRITE16(Reg, AFE_READ16(Reg) | (Bit))
#define AFE_CLR_BIT(Reg, Bit)                  AFE_WRITE16(Reg, AFE_READ16(Reg) & (~(Bit)))

//=============================================================================================
//                  Section: External Variables and Functions
//=============================================================================================
extern AFE_STRUCT_T afe;
extern const uint16 Ext_op_on_delay;
extern const uint16 Ext_op_off_delay;
extern boot_mode_type stack_query_boot_mode(void);

#if defined(EXT_DAC_SUPPORT)  
   extern kal_uint8 aud_get_volume_gain(kal_uint8 mode, kal_uint8 type, kal_uint8 level);
   extern void aud_get_melody_volume_setting(kal_uint8 mode, kal_uint8 *MaxAnalogGain, kal_uint8 *step);
   extern kal_bool audio_tv_cable_in;
#endif 

#if defined( NEW_BLOCK_FILTER_SUPPORT )
   extern volatile kal_uint16 *g_Compen_Blk_Flt;
#endif

#if defined(__BT_SUPPORT__)
   extern const unsigned short default_bt_pcm_out_vol;
#endif
   
extern const unsigned char  L1SP_SPEAKER1;
extern const unsigned char  L1SP_SPEAKER2;
extern const unsigned char  L1SP_LOUD_SPEAKER;

/// the value of the table is in 1.15 fixed-point
/// -64 dB = 20 log x => x = math.pow(10.0, -64.0/20) * 0x8000
extern const kal_uint16 digital_gain_8db_table[8];
/// the value of the table is in 1.14 fixed-point
/// 0.5 dB = 20 log x => x = math.pow(10.0, 0.5/20) * 0x4000
extern const kal_uint16 digital_gain_halfdb_table[15];
extern const kal_uint16 digital_gain_4db_table[17];
/// digital_gain_index: 0:0dB, -1:-0.5dB, ..., -128:-64dB
extern const kal_uint16 digital_gain_table[17];

#if defined(MT6251) || defined(MT6256) || defined(MT6255) || defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502) 
 #if defined(MT6255) || defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502) 
   extern const unsigned short SpkAmpGain; //55--> 0: 6db, 1: 7db, 2: 8db, 3: 9db; 50/60 --> 0: -6db, 1: -3db, 2: 6db, 3: 12db
 #endif
 #if defined(MT6255)
   extern const unsigned short SpkLSBGain; //0: 6db, 1: 2db, 2: -2db, 3: -6db     
 #else
   #define FIXED_LSB_GAIN -3 //-3db
 #endif
   extern const unsigned char Spk2In1;
#endif
#if defined(MT6261) || defined(MT2501) || defined(MT2502)
   extern const unsigned char extPA_underHP;
   extern const unsigned char mic0_type_sel; //2:dcc(ecm), 1: dcc(mems), 0:acc
   extern const unsigned char mic1_type_sel; //1: dcc, 0:acc
#endif
#if defined(MT6250) || defined(MT6260) || defined(MT6261) || defined(MT2501) || defined(MT2502) 
   extern const short CUSTOM_RG_DEPOP_CURSEL;
#endif

/*
============================================================================================================
------------------------------------------------------------------------------------------------------------
||                        Chapter: Function Prototypes
------------------------------------------------------------------------------------------------------------
============================================================================================================
*/
kal_uint32 SaveAndSetIRQMask(void);
void RestoreIRQMask(kal_uint32);

void SearchSpkFlag( kal_int16 *v_lowest, kal_int16 *a_lowest );
void Set_AFE_VAC_CON0_VCALI( void );
void AFE_SetRefresh( void );
void AFE_DELAY(uint16 delay);
void _AfeHardwareMuteCtrl(void);
void _AfeSetHardwareMute(bool mute);
void _AfeAclkSetHardwareMute(bool mute);
void _AfeRampDownAudBuf(kal_uint16 u2RampTickCnt);
void UpdateAGainRampUp( kal_uint8 aud_func );
kal_uint16 AFE_AGainRangeConvert(kal_uint16 org_vol);

void _update_digital_gain(kal_int16 v_lowest, kal_int16 a_lowest);
void AFE_Chip_Event_Handler( void *data );
void AFE_Manager( void );
 
void AFE_AUDIO_BUF_PDN(void);
void AFE_SetRefVol(kal_bool fgEnable);
void _Afe_TurnOff_Spk_8kClk(void);
void AVolumeRampDown(void) ;

void _AfeGetDCCompValue(void);
void AFE_DCCompInit(void);
void UpdateSidetone( kal_int8 vol );

void AFE_Timer_Handler( void *data);
void _AFE_MD2GLockNum_Update(kal_bool inc);

void AFE_Chip_Init( void );

kal_uint16 _converted_digital_gain(kal_int8 digital_gain_index);

void AFE_SwitchExtAmplifier(kal_bool enable);
void AFE_DisableAmp(void);
void AFE_Initialize(void);
void LSBGainRamp(void);
void SetDCCompensation(kal_bool Enable, kal_bool Src);
void DC_Calibration(void); // about 160 ms, 35 ticks
void AFE_DC_Calibration_WriteBack(void);
void _AfeRegisterBackupByChip(void);
void _AfeRegisterStoreByChip(void);

kal_uint16 AFE_lowBatteryGainConvert(kal_uint8 aud_func, kal_uint16 org_vol);

void AFE_SetRefresh( void );
void _AfeRampDownClassD(kal_uint16 u2RampTickCnt);
void _AfeSwitchClassAB(void);
void AFE_TurnOff8K_Direct( void );
void AFE_TurnOffAudioClock( void );
void AFE_TurnOnEDI( kal_uint16 dir, kal_uint16 fmt, kal_uint16 cycle );
void AFE_TurnOffEDI( void );
static void AFE_Event_Handler( void *data );
static void UpdateMicGain( kal_uint8 mic_vol );

void _AFE_SetAudioFlag(void);
void _AFE_ClearAudioFlag(void);
void _AFE_MD2GLockNum_Update(kal_bool inc);

#if defined(__CLASSK_CP_SUPPORT__)
kal_bool Check_CP_available(void);
void _AFE_Switch_ChargePump(kal_bool on, AFE_VCP_T mode);
#endif 

#endif //AFE_H
