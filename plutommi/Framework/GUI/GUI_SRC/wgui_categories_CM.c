/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename: 
 * ---------
 *  wgui_categories_CM.c
 *
 * Project:
 * --------
 *  Maui_Software
 *
 * Description:
 * ------------
 *  Call Management related categories.
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
#include "MMI_features.h"
#include "CustThemesRes.h"
#include "wgui_softkeys.h"
#include "wgui_fixed_menuitems.h"
#include "CallSetSrvGprot.h"
#include "lcd_if.h"
#include "app_mem.h"
#include "gui_font_size.h"
#include "UcmGprot.h"
#include "ProfilesSrvGprot.h"
#include "MiscFunctions.h"

#include "MMIDataType.h"
#include "gdi_datatype.h"
#include "wgui_inputs.h"
#include "gui_data_types.h"
#include "gui_inputs.h"
#include "gui_windows.h"
#include "UcmSrvGprot.h"
#include "wgui_categories_CM.h"
#include "gdi_const.h"
#include "kal_general_types.h"
#include "custom_mmi_default_value.h"
#include "wgui_draw_manager.h"
#include "gui.h"
#include "gdi_include.h"
#include "gui_themes.h"
#include "gui_theme_struct.h"
#include "gui_config.h"
#include "gui_typedef.h"
#include "gui_switch.h"
#include "wgui.h"
#include "wgui_include.h"
#include "gui_buttons.h"
#include "GlobalConstants.h"
#include "mmi_frm_input_gprot.h"
#include "mmi_frm_events_gprot.h"
#include "wgui_categories_util.h"
#include "mmi_rp_app_uiframework_def.h"
#include "CustDataRes.h"
#include "wgui_categories_idlescreen.h"
#include "wgui_categories_enum.h"
#include "wgui_categories_mm.h"
#include "wgui_categories_inputs.h"
#include "wgui_touch_screen.h"
#include "wgui_fixed_menus.h"
#include "gui_fixed_menus.h"
#include "gui_fixed_menuitems.h"
#include "kal_public_api.h"
#include "DebugInitDef_Int.h"
#include "lcd_sw_rnd.h"
#include "gdi_lcd_config.h"
#include "lcd_sw_inc.h"
#include "GpioSrvGprot.h"
#include "wgui_title.h"
#include "string.h"
#include "PixcomFontEngine.h"
#include "wgui_categories_multimedia.h"
#include "mmi_frm_history_gprot.h"
#include "wgui_categories_list.h"
#include "app_datetime.h"
#include "DateTimeType.h"
#include "ImeGprot.h"
#include "gui_touch_feedback.h"
#include "Wgui_categories_popup.h"
#include "Wgui_asyncdynamic_menus.h"
#if defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__) || defined(__MMI_WEARABLE_DEVICE__)
#include "wgui_datetime.h"
#endif /* __MMI_MAINLCD_128X64__ || __MMI_MAINLCD_96X64__*/

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
#include "mdi_datatype.h"
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) */

#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
#include "mdi_audio.h"
#include "mdi_video.h"
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 

#ifdef __MMI_SWFLASH__
#include "mdi_swflash.h"
#include "swflashGprot.h"
#endif /* __MMI_SWFLASH__ */

#include "mdi_include.h"

#if defined( __CAT16_MULTIEDITOR_STYLE__) || defined(__MMI_WEARABLE_DEVICE__)
#include "Imc.h"
#endif /*__CAT16_MULTIEDITOR_STYLE__*/

#if defined(__MMI_WEARABLE_DEVICE__)
#include "DialerCuiGprot.h"
#ifdef __MMI_HF_SUPPORT__ 
#include "UcmBTSrvGprot.h"
#endif /*__MMI_HF_SUPPORT__*/
#endif /*__MMI_WEARABLE_DEVICE__*/

#ifdef __MMI_BTD_BOX_UI_STYLE__
#include "gui_dialer_pad.h"
//#if   defined(__MMI_UI_DIALER_PAD_ONLY_KEY__)
#include "GlobalResDef.h"
//#endif /*__MMI_UI_DIALER_PAD_ONLY_KEY__*/
#endif  //__MMI_BTD_BOX_UI_STYLE__

#define CM_TEXT_SCROLL_GAP    (32)
#define CM_TEXT_SCROLL_SIZE   (3)
#define CM_TEXT_SCROLL_TIME   (100)
#define CM_TEXT_SCROLL_WAIT   (1000)
#define CM_TEXT_SCROLL_X      (0)
#define CM_TEXT_SCROLL_Y      (20)

#if !defined(__MMI_TOUCH_DIAL_SCREEN__)
    #if defined(__MMI_MAINLCD_320X480__) || defined(__MMI_MAINLCD_480X800__)
        #define MMI_CAT16_DIALING_BOX_BG_X      (0)
		#if defined(__WGUI_CATE_FTE_KEY_ONLY__)
		#define MMI_CAT16_DIALING_BOX_BG_Y      (20)
		#else /* __WGUI_CATE_FTE_KEY_ONLY__ */
        #define MMI_CAT16_DIALING_BOX_BG_Y      (52)
		#endif /* __WGUI_CATE_FTE_KEY_ONLY__ */
    #elif defined(__MMI_MAINLCD_240X400__)
        #define MMI_CAT16_DIALING_BOX_BG_X      (0)
        #define MMI_CAT16_DIALING_BOX_BG_Y      (52)
    #elif defined(__MMI_MAINLCD_320X240__)
        #define MMI_CAT16_DIALING_BOX_BG_X      (58)
        #define MMI_CAT16_DIALING_BOX_BG_Y      (36)
	#elif defined(__MMI_MAINLCD_240X240__)
		#define MMI_CAT16_DIALING_BOX_BG_X		(0)
        #define MMI_CAT16_DIALING_BOX_BG_Y      (36)
	#elif defined(__MMI_MAINLCD_320X320__)
		#define MMI_CAT16_DIALING_BOX_BG_X		(0)
        #define MMI_CAT16_DIALING_BOX_BG_Y      (36)		
    #elif defined(__MMI_MAINLCD_240X320__)
        #define MMI_CAT16_DIALING_BOX_BG_X      (0)
        #define MMI_CAT16_DIALING_BOX_BG_Y      (70)
    #elif defined(__MMI_MAINLCD_176X220__)
        #define MMI_CAT16_DIALING_BOX_BG_X      (0)
        #define MMI_CAT16_DIALING_BOX_BG_Y      (54)
	#elif defined(__MMI_MAINLCD_128X64__)
        #define MMI_CAT16_DIALING_BOX_BG_X		(0)
        #define MMI_CAT16_DIALING_BOX_BG_Y		(70)
	#elif defined(__MMI_MAINLCD_128X32__)
        #define MMI_CAT16_DIALING_BOX_BG_X		(0)
        #define MMI_CAT16_DIALING_BOX_BG_Y		(70)
	#elif defined(__MMI_MAINLCD_96X64__)
        #define MMI_CAT16_DIALING_BOX_BG_X		(0)
        #define MMI_CAT16_DIALING_BOX_BG_Y		(70)
    #endif
	#if defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__)
        #if defined(__MMI_MAINLCD_176X220__)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(18)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(23)
            #define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(140)
            #define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(84)
			#define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(14)
			#define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(10)
            #define MMI_CAT16_DIALING_BOX_BG_WIDTH			(150)
            #define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(108)
		#elif defined(__MMI_MAINLCD_320X240__)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(11)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(30)
            #define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(182)
            #define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(84)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(2)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(10)
            #define MMI_CAT16_DIALING_BOX_BG_WIDTH			(200)
            #define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(120)
		#elif defined(__MMI_MAINLCD_240X240__)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(23)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(30)
            #define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(190)
            #define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(84)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(14)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(10)
            #define MMI_CAT16_DIALING_BOX_BG_WIDTH			(210)
            #define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(120)		
		#elif defined(__MMI_MAINLCD_320X320__)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(23)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(30)
            #define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(190)
            #define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(84)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(14)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(10)
            #define MMI_CAT16_DIALING_BOX_BG_WIDTH			(210)
            #define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(120)				
		#elif defined(__MMI_MAINLCD_240X320__)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(23)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(59)
            #define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(190)
            #define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(84)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(14)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(10)
            #define MMI_CAT16_DIALING_BOX_BG_WIDTH			(210)
            #define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(190)
        #elif defined(__MMI_MAINLCD_320X480__)
        	#define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(30)
        	#define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(140)
        	#define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(260)
        	#define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(176)
        	#define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(14)
        	#define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(14)
        	#define MMI_CAT16_DIALING_BOX_BG_WIDTH			(290)
        	#define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(320)
		#else /* __MMI_MAINLCD_176X220__ */
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X	(23)
            #define MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y	(43)
            #define MMI_CAT16_DIALING_INPUT_BOX_WIDTH		(130)
            #define MMI_CAT16_DIALING_INPUT_BOX_HEIGHT		(64)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_X		(14)
            #define MMI_CAT16_DIALING_BOX_BG_OFFSET_Y		(10)
            #define MMI_CAT16_DIALING_BOX_BG_WIDTH			(150)
            #define MMI_CAT16_DIALING_BOX_BG_HEIGHT 		(108)
		#endif /* __MMI_MAINLCD_176X220__ */
	#endif /* __MMI_SLIM_IMG_RES__ || __WGUI_CATE_FTE_KEY_ONLY__ */
#endif /* !defined(__MMI_TOUCH_DIAL_SCREEN__) */

#if defined(__MMI_MAINLCD_320X480__) || defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__)
    #define MMI_CM_MAX_IMG_HEIGHT   230
#elif defined(__MMI_MAINLCD_240X400__)
    #define MMI_CM_MAX_IMG_HEIGHT   230
#elif defined(__MMI_MAINLCD_320X240__)
    #define MMI_CM_MAX_IMG_HEIGHT   122
#elif defined(__MMI_MAINLCD_240X240__)
    #define MMI_CM_MAX_IMG_HEIGHT   122	
#elif defined(__MMI_MAINLCD_320X320__)
    #define MMI_CM_MAX_IMG_HEIGHT   122		
#elif defined(__MMI_MAINLCD_240X320__)
    #define MMI_CM_MAX_IMG_HEIGHT   200
#elif defined( __MMI_MAINLCD_176X220__)
    #define MMI_CM_MAX_IMG_HEIGHT   142
#elif defined(__MMI_MAINLCD_128X160__)
    #define MMI_CM_MAX_IMG_HEIGHT   80
#elif defined(__MMI_MAINLCD_128X128__) && defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
    #define MMI_CM_MAX_IMG_HEIGHT   58
#elif defined(__MMI_MAINLCD_128X64__)
    #define MMI_CM_MAX_IMG_HEIGHT	200
#elif defined(__MMI_MAINLCD_128X32__)
    #define MMI_CM_MAX_IMG_HEIGHT	200
#elif defined(__MMI_MAINLCD_96X64__)
    #define MMI_CM_MAX_IMG_HEIGHT	80
#endif

#if defined(__MMI_MAINLCD_320X480__) || defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_480X800__)
#define MMI_CAT20_STR_LINE_GAP		10
#else
#define MMI_CAT20_STR_LINE_GAP		4
#endif

#if defined(WGUI_CATCALL_STYLE_2)
    #if defined(__MMI_MAINLCD_320X480__) || defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__)
        #if defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON)
            #define WGUI_CAT016_PPBG_X      0
            #define WGUI_CAT016_PPBG_Y      95
            #define WGUI_CAT016_PPBG_W      UI_device_width
            #define WGUI_CAT016_PPBG_H      290
            #define WGUI_CAT016_CONTENT_X   30
            #define WGUI_CAT016_CONTENT_Y   110
            #define WGUI_CAT016_CONTENT_W   260
            #define WGUI_CAT016_CONTENT_H   260
            #define WGUI_CAT016_TEXT_H      24
            #define WGUI_CAT016_TEXT_H_GAP  2
            #define WGUI_CAT016_BUTTON_X    0
            #define WGUI_CAT016_BUTTON_Y    385
            #define WGUI_CAT016_BUTTON_W    UI_device_width
            #define WGUI_CAT016_BUTTON_H    60
        #else /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */
            #define WGUI_CAT016_PPBG_X      0
            #define WGUI_CAT016_PPBG_Y      95
            #define WGUI_CAT016_PPBG_W      UI_device_width
            #define WGUI_CAT016_PPBG_H      350
            #define WGUI_CAT016_CONTENT_X   30
            #define WGUI_CAT016_CONTENT_Y   140
            #define WGUI_CAT016_CONTENT_W   260
            #define WGUI_CAT016_CONTENT_H   260
            #define WGUI_CAT016_TEXT_H      24
            #define WGUI_CAT016_TEXT_H_GAP  2
        #endif /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */
    #endif /* defined(__MMI_MAINLCD_320X480__) */
#endif /* defined(WGUI_CATCALL_STYLE_2) */

#if defined(__MMI_MAINLCD_320X240__) && (defined(__WGUI_CM_FTE_SLIM__) || defined(__WGUI_CATE_FTE_KEY_ONLY__)) 
  #define WGUI_CATCALL_FTE_X_OFFSET (42)
#else /*defined(__MMI_MAINLCD_320X240__) && (defined(__WGUI_CM_FTE_SLIM__) || defined(__WGUI_CATE_FTE_KEY_ONLY__))*/
  #define WGUI_CATCALL_FTE_X_OFFSET (0)
#endif /*defined(__MMI_MAINLCD_320X240__) && (defined(__WGUI_CM_FTE_SLIM__) || defined(__WGUI_CATE_FTE_KEY_ONLY__))*/

#define WGUI_CM_DRAW_BG_AREA(x1, y1, x2, y2, c) \
    do                                          \
    {                                           \
        gdi_layer_push_and_set_clip(x1, y1, x2, y2);     \
        gdi_draw_solid_rect(x1, y1, x2, y2, c); \
        gdi_layer_pop_clip();                   \
    } while (0)

#ifdef __MMI_DIALER_TWO_DT_DIS__
#define WGUI_CATCALL_DRUATION2_GAP                (5)
#define WGUI_CATCALL_DRUATION2_STR1_H             (26)
#define WGUI_CATCALL_DRUATION2_STR1_X             (0)
#define WGUI_CATCALL_DRUATION2_STR1_Y             (WGUI_CAT403_IMG_Y + ((WGUI_CAT403_IMG_H - WGUI_CATCALL_DRUATION2_STR1_H) >> 1) + 2 * MMI_MENUITEM_HEIGHT - WGUI_CATCALL_DRUATION2_GAP)
#define WGUI_CATCALL_DRUATION2_STR1_W             (120)
UI_string_type MMI_message_string3 = NULL;
#endif

/*-------------------------------
External Global variables
-------------------------------*/
extern U16 on_idle_screen;
extern U16 gCurrLangIndex;

extern S32 wgui_image_clip_x1;
extern S32 wgui_image_clip_y1;
extern S32 wgui_image_clip_x2;
extern S32 wgui_image_clip_y2;

extern U8 gMMI_UI_U8_flag_1;
extern U8 gMMI_UI_U8_flag_2;
extern S16 status_icon;

extern PU8 _MMI_animated_icon;

#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
extern mdi_video_info_struct wgui_video_info;
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */

#ifdef __MMI_SWFLASH__
extern mdi_swflash_info_struct wgui_swflash_info;
#endif 

extern gdi_handle wgui_layer_1;
extern gdi_handle wgui_base_layer;

extern S16 MMI_current_input_ext_type;
extern UI_filled_area wgui_pop_up_dialog_background;

/*-------------------------------
External Global Functions
-------------------------------*/
extern void (*_MMI_hide_fixed_list_menu) (void);
#if !defined( __CAT16_MULTIEDITOR_STYLE__) && !defined(__MMI_WEARABLE_DEVICE__)
extern void (*wgui_dialer_inputbox_RSK_function) (void);    /* Store the clipping value of current image */
extern void dialer_inputbox_handle_multitap_complete(S32 type);
extern void close_dialer_inputbox(void);
extern void wgui_setup_dialer_inputbox(
                S32 x,
                S32 y,
                S32 width,
                S32 height,
                U8 *buffer,
                S32 buffer_size,
                U16 category_screen_ID,
                UI_string_type RSK_label,
                PU8 RSK_icon,
                U8 *history_buffer,
                U32 flags);
extern void dialer_inputbox_handle_multitap_star_key_up(void);
extern void get_dialer_inputbox_category_history(U16 history_ID, U8 *history_buffer);

#endif /*__CAT16_MULTIEDITOR_STYLE__*/
extern void leave_idle_screen(void);
extern void draw_wallpaper(void);
extern void idle_screen_hide_status_icons_bar0(void);
extern void idle_screen_hide_status_icons_bar1(void);

extern void wgui_fill_rectangle_clip(S32 x1, S32 y1, S32 x2, S32 y2, color c);

#ifdef __MMI_TOUCH_DIAL_SCREEN__
void setup_dialing_keypad(dialing_keypad_struct *dialing_keypad);
#endif 

extern void set_main_lcd_duration_position(U16 x, U16 y);

extern void dt_update_duration(void);
extern void dt_update_duration_gprs(void);

extern void redraw_call_cost_UI(void);
extern void reset_call_cost_UI(void);

extern void wgui_cat033_hide_lsk(void);
extern void wgui_cat033_hide_rsk(void);

extern S32 UI_sprintf(UI_string_type s, const S8 *format, ...);
extern S32 mmi_is_redrawing_bk_screens(void);

#if defined(__MMI_SWFLASH__) || defined(__MMI_AVATAR__)
extern mdi_result SetupCat34Media(U16 bg_media_id, S8 *bg_media_filename);
#endif


/*-------------------------------
Global variables
-------------------------------*/
scrolling_text CM_scrolling_text;
#if defined (__MMI_MAINLCD_96X64__) || defined (__MMI_WEARABLE_DEVICE__)
scrolling_text gui_scrolling_text_ctxt;
scrolling_text gui_scrolling_text_ctxt_2;
static wgui_cat9023_call_info_struct *g_wgui_cat9023_CM;
U8 CM_caller_buffer[(SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2];
#ifdef __MMI_WEARABLE_DEVICE__
U8 CM_caller_buffer1[(SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2];
#define GDI_COLOR_ACTIVE_BACKGROUND           gdi_act_color_from_rgb(255, 0, 0, 0)//21,21,26
#define GDI_COLOR_HELD_BACKGROUND           gdi_act_color_from_rgb(255, 0, 180, 255)//74,76,89
#else
#define GDI_COLOR_ACTIVE_BACKGROUND           GDI_COLOR_WHITE
#define GDI_COLOR_HELD_BACKGROUND           GDI_COLOR_WHITE
#endif /*__MMI_WEARABLE_DEVICE__*/

#endif /*defined (__MMI_MAINLCD_96X64__) || defined (__MMI_WEARABLE_DEVICE__)*/

#ifdef __MMI_WEARABLE_DEVICE__
U8 g_long_tap = 0;
U8 g_del_long_tap = 0;
UI_character_type g_input_table[] = {'*', 0, '#', 0, '+'};
UI_character_type g_input_number_0 = '0';

U8 g_cat16_style = 0;
U16 *g_cat16_pin_title_str = NULL;
static S32 g_Cat16_PenDown_x = -1;
static U8 g_Cat_is_end_call_key = 0;
static U8 g_in_call_redrawing = 0;
static U8 g_in_call_endbutton_status = 1;
static MMI_BOOL g_in_call_vol_info_show = MMI_FALSE;
static U8 g_in_call_vol_bar_is_show = 0;

#define MMI_CAT16_WEARABLE_DEVICE_MOVE_THRESOLD      (LCD_WIDTH/3 - 10)
#define MMI_CAT16_PIN_STYLE_TITLE_X 		(5)
#define MMI_CAT16_PIN_STYLE_TITLE_Y 		(0)
#define MMI_CAT16_PIN_STYLE_TITLE_WEIGHT 	(UI_device_width)
#if defined(__MMI_MAINLCD_240X240__) 
#define MMI_CAT16_PIN_STYLE_TITLE_HEIGHT 	(20)
#elif defined(__MMI_MAINLCD_240X320__)
#define MMI_CAT16_PIN_STYLE_TITLE_HEIGHT 	(30)
#else /*__MMI_MAINLCD_240X240__*/
#define MMI_CAT16_PIN_STYLE_TITLE_HEIGHT 	(20)
#endif /*__MMI_MAINLCD_240X240__*/
#endif /*__MMI_WEARABLE_DEVICE__*/

S32 CM_text_offset_x = 0;
S32 CM_text_width = 0;
S32 CM_text_height = 0;
S32 CM_x = 0;
S32 CM_y = 0;
S32 CM_n_frame = 0;
S32 CM_total_frames = 0;
U8 CM_Screen_show_date_time_bar = 0;
BOOL CM_need_change_clip = FALSE;
CHAR CM_string_buf[(SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN) * 2];
#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
U8* CM_media_buffer = NULL;
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
BOOL cat_momt_is_aud_enable = FALSE;
BOOL cat_momt_is_play_aud_when_start = FALSE;
BOOL cat_momt_is_aud_muted = FALSE;
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
BOOL cat_momt_is_visual_update = FALSE;
BOOL cat_momt_is_video_open = FALSE;
BOOL cat_momt_is_video_play = FALSE;
S16 cat_momt_repeat_count = 0;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
#if defined(__MMI_SWFLASH__)
BOOL cat_momt_is_swflash_open = FALSE;
BOOL cat_momt_is_swflash_play = FALSE;
#endif /*__MMI_SWFLASH__*/
#if defined(__MMI_AVATAR__)
BOOL cat_momt_is_avatar_play = FALSE;
#endif /*__MMI_AVATAR__*/


BOOL cat_momt_is_show_default = FALSE;


U16 cat_momt_resource_id = 0;
U16 cat_momt_default_image_id = 0;
CHAR* cat_momt_resource_filename = NULL;
#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
U64 cat_momt_video_play_time = 0;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/

#if defined(__MMI_SWFLASH__)
U64 cat_momt_swflash_play_time = 0;
#endif /*defined(__MMI_SWFLASH__)*/
wgui_cate_momt_res_type_enum cat_momt_resource_type = (wgui_cate_momt_res_type_enum)0;

#if defined(__MMI_VIDEO_3D_ANAGLYPH__)
static MMI_BOOL cat_momt_is_3d_type = MMI_FALSE;
static U32 cat_momt_3d_track_index;
#endif /* __MMI_VIDEO_3D_ANAGLYPH__ */

GDI_HANDLE MOMT_animation_handle = GDI_ERROR_HANDLE;
MMI_BOOL isCallDisconnecting = MMI_FALSE;

U16 gCallLine = 0;
#if defined(__MMI_SWFLASH__)
static MMI_BOOL wgui_cat016_is_set_swflash_layer = MMI_FALSE;
#endif /* __MMI_SWFLASH__ */

#if defined(WGUI_CATCALL_STYLE_2)
static MMI_BOOL g_wgui_catcall_display_duration = MMI_FALSE;
static MYTIME *g_wgui_catcall_duration = NULL;
static U8* g_wgui_catcall_calltype = NULL;
#endif /* defined(WGUI_CATCALL_STYLE_2) */

#if defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON)
static UI_string_type g_wgui_catcall_button_str_p = NULL;
static FuncPtr g_wgui_catcall_button_func_p = NULL;
#endif /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */

static U16 *g_wgui_catcall_number_type_icons = NULL;

#ifdef __MMI_WEARABLE_DEVICE__
static wgui_cate_momt_call_type_enum g_cat_momt_call_type;
void wgui_category_9023_draw_category_control_area_for_wearable(dm_coordinates *coordinate);
static MMI_BOOL wgui_cat9023_wearable_pen_up_hdlr(mmi_pen_point_struct point);
static MMI_BOOL wgui_cat9023_wearable_pen_down_hdlr(mmi_pen_point_struct point);
static MMI_BOOL wgui_cat9023_wearable_pen_move_hdlr(mmi_pen_point_struct point);
#endif /*__MMI_WEARABLE_DEVICE__*/
/***************************************************************************** 
* Local Function
*****************************************************************************/
static void ShowMOMTCallScreen(U16, U16, U16, U16, U16, U16, PU8, PU8, U16, U16, U16, CHAR*, wgui_cate_momt_res_type_enum, U16, BOOL, BOOL, BOOL, PU8);
#if defined(WGUI_CATCALL_STYLE_2)
static void ShowMOMTCallScreen_2(U16, U16, U16, U16, U16, U16, PU8, PU8, U16, U16, U16, CHAR*, wgui_cate_momt_res_type_enum, U16, BOOL, BOOL, BOOL, PU8);
extern MMI_BOOL PhnsetGetShowDateTimeStatus(void);
extern void analog_clock_initialize(void);
#endif /* defined(WGUI_CATCALL_STYLE_2) */

#if defined(__MMI_FTE_SUPPORT__)
static void ShowMOMTCallScreen_FTE(U16, U16, U16, U16, U16, U16, PU8, PU8, U16, U16, U16, CHAR*, wgui_cate_momt_res_type_enum, U16, BOOL, BOOL, BOOL, PU8);
#if defined(__MMI_TOUCH_SCREEN__)
static void wgui_cat403_fte_iconbar_setup(void);
#endif /* defined(__MMI_TOUCH_SCREEN__)*/
#endif /* defined(__MMI_FTE_SUPPORT__) */

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
static void MomtSetMute(MMI_BOOL flag);
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/

static void RedrawMOMTCallScreen(void);
static void ExitMOMTCallScreen(void);
static void SetMOMTCallImageClip(S32 image_width, S32 image_height);

#ifdef __MMI_SWFLASH__
static void MOMTPlaySWFlashResultCallback(MDI_RESULT result);
#endif 

static void DrawMOMTCallScreenControllArea(dm_coordinates *coordinate);

#ifdef __MMI_DIALER_TWO_DT_DIS__
static void wgui_cat403_draw_duration_str(void);
#endif

/*****************************************************************************
 * FUNCTION
 *  CM_scrolling_text_timer_callback
 * DESCRIPTION
 *  callback function when scrolling text timer expires
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void CM_scrolling_text_timer_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_handle_scrolling_text(&CM_scrolling_text);
}

/*****************************************************************************
 * FUNCTION
 *  CM_set_wallpaper_on_bottom
 * DESCRIPTION
 *  set the flag of wallpaper on bottom
 * PARAMETERS
 *  state       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void CM_set_wallpaper_on_bottom(MMI_BOOL state)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __GDI_MEMORY_PROFILE_2__
    wgui_set_wallpaper_on_bottom(state);
#endif /*__GDI_MEMORY_PROFILE_2__*/
}

/*****************************************************************************
 * FUNCTION
 *  handle_CM_text_scroll
 * DESCRIPTION
 *  handle the text scrolling of CM screens
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void handle_CM_text_scroll(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    GDI_HANDLE previous_act_lcd = GDI_NULL_HANDLE;
    color bc = gui_color(0, 0, 0);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_lcd_get_active(&previous_act_lcd);

    UI_set_main_LCD_graphics_context();
    gdi_layer_push_clip();
    gui_set_text_color(bc);
    gui_set_font(current_UI_theme->multi_line_input_box_theme->text_font);

    if (mmi_fe_get_r2l_state())
    {
        CM_text_offset_x += CM_TEXT_SCROLL_SIZE;
        if ((CM_TEXT_SCROLL_X + CM_text_offset_x) >= (CM_text_width + CM_TEXT_SCROLL_GAP))
        {
            CM_text_offset_x = CM_TEXT_SCROLL_X;
        }
    }
    else
    {
        CM_text_offset_x -= CM_TEXT_SCROLL_SIZE;
        if ((CM_text_offset_x + CM_text_width + CM_TEXT_SCROLL_GAP) < CM_TEXT_SCROLL_X)
        {
            CM_text_offset_x = CM_TEXT_SCROLL_X;
        }
    }

    gdi_layer_set_clip(0, CM_y, UI_device_width - 1, CM_y + CM_text_height - 1);
    
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, current_MMI_theme->CM_screen_background_filler);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

    if (mmi_fe_get_r2l_state())
    {
        gui_move_text_cursor(CM_text_offset_x + UI_device_width, CM_y);
    }
    else
    {
        gui_move_text_cursor(CM_text_offset_x, CM_y);
    }

    gui_print_text(MMI_message_string);

    if (mmi_fe_get_r2l_state())
    {
        gui_move_text_cursor(CM_text_offset_x - (CM_text_width + CM_TEXT_SCROLL_GAP), CM_y);
    }
    else
    {
        if ((CM_text_offset_x + CM_text_width + CM_TEXT_SCROLL_GAP) < UI_device_width)
        {
            gui_move_text_cursor(CM_text_offset_x + CM_text_width + CM_TEXT_SCROLL_GAP, CM_y);
        }
    }

    gui_print_text(MMI_message_string);

    gui_start_timer(CM_TEXT_SCROLL_TIME, handle_CM_text_scroll);
    gdi_layer_pop_clip();
    gdi_layer_blt_previous(0, CM_y, UI_device_width - 1, CM_y + CM_text_height - 1);

    gdi_lcd_get_active(&previous_act_lcd);
    if (previous_act_lcd == GDI_LCD_MAIN_LCD_HANDLE)
    {
        UI_set_main_LCD_graphics_context();
    }
    else if (previous_act_lcd == GDI_LCD_SUB_LCD_HANDLE)
    {
        UI_set_sub_LCD_graphics_context();
    }
}


/*****************************************************************************
 * FUNCTION
 *  CM_screens_hide_date_time_display
 * DESCRIPTION
 *  Hide date/time function used in CM screens.
 * PARAMETERS
 *  x1      [IN]        Start x position
 *  y1      [IN]        Start y position
 *  x2      [IN]        End of x position
 *  y2      [IN]        End of y position
 * RETURNS
 *  void
 *****************************************************************************/
static void CM_screens_hide_date_time_display(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    #if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)
         //gui_one_layer_draw_filled_bg_area(x1, y1, x2, y2);
		WGUI_CM_DRAW_BG_AREA(x1, y1, x2, y2, GDI_COLOR_WHITE);
    #else /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
    WGUI_CM_DRAW_BG_AREA(x1, y1, x2, y2, GDI_COLOR_TRANSPARENT);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */	
#else
    wgui_fill_rectangle_clip(x1, y1, x2, y2, *current_MMI_theme->datetime_bar_background_color);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
}


/*****************************************************************************
 * FUNCTION
 *  CM_screens_hide_duration_display
 * DESCRIPTION
 *  Hide duration function used in CM screens.
 * PARAMETERS
 *  x1      [IN]        Start x position
 *  y1      [IN]        Start y position
 *  x2      [IN]        End of x position
 *  y2      [IN]        End of y position
 * RETURNS
 *  void
 *****************************************************************************/
static void CM_screens_hide_duration_display(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    #if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)
        gui_one_layer_draw_filled_bg_area(x1, y1, x2, y2);
    #else /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
    WGUI_CM_DRAW_BG_AREA(x1, y1, x2, y2, GDI_COLOR_TRANSPARENT);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#else
    wgui_fill_rectangle_clip(x1, y1, x2, y2, *current_MMI_theme->datetime_bar_duration_background_color);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
}


/*****************************************************************************
 * FUNCTION
 *  CM_screens_draw_date_time_bar
 * DESCRIPTION
 *  Function used in CM screens to draw date-time bar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void CM_screens_draw_date_time_bar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__  
    #if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)	
    gui_one_layer_draw_filled_bg_area(
        0,
        main_LCD_dt_object.date.y,
        UI_device_width - 1,
        main_LCD_dt_object.time.y + main_LCD_dt_object.time.height - 1);
    #else /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
    WGUI_CM_DRAW_BG_AREA(
        0,
        main_LCD_dt_object.date.y,
        UI_device_width - 1,
        main_LCD_dt_object.time.y + main_LCD_dt_object.time.height - 1,
        GDI_COLOR_TRANSPARENT);  
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    wgui_fill_rectangle_clip(
        0,
        main_LCD_dt_object.date.y,
        UI_device_width - 1,
        main_LCD_dt_object.time.y + main_LCD_dt_object.time.height - 1,
        *current_MMI_theme->datetime_bar_background_color);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
}


/*****************************************************************************
 * FUNCTION
 *  CM_screens_draw_duration_bar
 * DESCRIPTION
 *  Function used in CM screens to draw duration bar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void CM_screens_draw_duration_bar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    #ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 	
    WGUI_CM_DRAW_BG_AREA(
        0,
        main_LCD_dt_object.duration.y,
        UI_device_width - 1,
        main_LCD_dt_object.duration.y + main_LCD_dt_object.duration.height - 1,
        GDI_COLOR_TRANSPARENT);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    wgui_fill_rectangle_clip(
        0,
        main_LCD_dt_object.duration.y,
        UI_device_width - 1,
        main_LCD_dt_object.duration.y + main_LCD_dt_object.duration.height - 1,
        *current_MMI_theme->datetime_bar_duration_background_color);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
}


/*****************************************************************************
 * FUNCTION
 *  CM_draw_scrolling_text_background
 * DESCRIPTION
 *  Ffunction used in CM screens to draw scrolling text background
 * PARAMETERS
 *  x1      [IN]        Start x position
 *  y1      [IN]        Start y position
 *  x2      [IN]        End of x position
 *  y2      [IN]        End of y position
 * RETURNS
 *  void
 *****************************************************************************/
static void CM_draw_scrolling_text_background(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MAINLCD_96X64__
    gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_BLACK);
#else /*__MMI_MAINLCD_96X64__*/

#if defined(__MMI_WEARABLE_DEVICE__)	
	gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, gdi_act_color_from_rgb(255, 0, 0, 0));
#elif defined(__MMI_WALLPAPER_ON_BOTTOM__)
    #ifdef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__
    gui_one_layer_draw_filled_bg_area(
         CM_scrolling_text.x, 
         CM_scrolling_text.y, 
         CM_scrolling_text.x + CM_scrolling_text.width - 1, 
         CM_scrolling_text.y + CM_scrolling_text.height - 1);
    #else /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
    gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, current_MMI_theme->CM_screen_background_filler);    
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
#endif /*__MMI_MAINLCD_96X64__*/
}

#if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__) && (defined(__MMI_MAINLCD_240X320__)||defined(__MMI_MAINLCD_176X220__)||defined(__MMI_MAINLCD_128X160__))
void CM_draw_dialing_screen_edit_bg(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();
    gui_draw_filled_area(
        MMI_multiline_inputbox.x,
        MMI_multiline_inputbox.y,
        MMI_multiline_inputbox.x + MMI_multiline_inputbox.width - 1,
        MMI_multiline_inputbox.y + MMI_multiline_inputbox.height - 1,
        &wgui_pop_up_dialog_background); 
    gdi_layer_unlock_frame_buffer();
}
#endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */

static void dialing_screen_hide_softkey(icontext_button *btn)
{
    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	gdi_layer_push_and_set_clip(btn->x, btn->y, btn->x + btn->width + 2, btn->y + btn->height + 2);
#if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__) && (!defined ( __MMI_MAINLCD_128X128__ ) && !defined ( __MMI_MAINLCD_128X160__ ))
    gui_one_layer_draw_filled_bg_area(btn->x, btn->y, btn->x + btn->width + 2, btn->y + btn->height + 2);
#else
	gdi_draw_solid_rect(btn->x, btn->y, btn->x + btn->width + 2, btn->y + btn->height + 2, GDI_COLOR_TRANSPARENT);
#endif
	gdi_layer_pop_clip();
}
/*****************************************************************************
 * FUNCTION
 *  dialing_screen_hide_left_softkey
 * DESCRIPTION
 *  Left softkey hide function of dialing screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void dialing_screen_hide_left_softkey(void)
{
    dialing_screen_hide_softkey(&MMI_left_softkey);
}


/*****************************************************************************
 * FUNCTION
 *  dialing_screen_hide_right_softkey
 * DESCRIPTION
 *  Right softkey hide function of dialing screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void dialing_screen_hide_right_softkey(void)
{
    dialing_screen_hide_softkey(&MMI_right_softkey);
}


/*****************************************************************************
 * FUNCTION
 *  dialing_screen_hide_center_softkey
 * DESCRIPTION
 *  Center softkey hide function of dialing screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void dialing_screen_hide_center_softkey(void)
{
    dialing_screen_hide_softkey(&MMI_center_softkey);
}

#ifdef __MMI_WEARABLE_DEVICE__ 
void (*sw_dialing_keypad_call_handler) (void) = NULL;
/*****************************************************************************
 * FUNCTION
 *  SetDialingKeypadCallHandler_SW
 * DESCRIPTION
 *  Set handler for call function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void SetDialingKeypadCallHandler_SW(void (*handler) (void))
{
	/*----------------------------------------------------------------*/
	/* Local Variables                                                */
	/*----------------------------------------------------------------*/

	/*----------------------------------------------------------------*/
	/* Code Body                                                      */
	/*----------------------------------------------------------------*/
	sw_dialing_keypad_call_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *	SetDialingPinOkHandler
 * DESCRIPTION
 *	Set handler for ok function in pin input style
 * PARAMETERS
 *	void
 * RETURNS
 *	void
 *****************************************************************************/
void SetDialingPinOkHandler(void (*handler) (void))
{
	/*----------------------------------------------------------------*/
	/* Local Variables												  */
	/*----------------------------------------------------------------*/

	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
	sw_dialing_keypad_call_handler = handler;
}

#if defined(__MMI_ONE_KEY_SOS_SUPPORT__) || defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TELEPHONY_SUPPORT__)
static void (*sw_dialing_keypad_long_press_handler)(S32) = NULL;
/*****************************************************************************
 * FUNCTION
 *  SetDialingKeypadHandler_SW
 * DESCRIPTION
 *  Set handler for call function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void SetDialingKeypadLongPressHandler_SW(void (*handler) (S32))
{
	/*----------------------------------------------------------------*/
	/* Local Variables                                                */
	/*----------------------------------------------------------------*/

	/*----------------------------------------------------------------*/
	/* Code Body                                                      */
	/*----------------------------------------------------------------*/
	sw_dialing_keypad_long_press_handler = handler;
}
#endif /* defined(__MMI_ONE_KEY_SOS_SUPPORT__) || defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TELEPHONY_SUPPORT__) */

#endif /*__MMI_WEARABLE_DEVICE__*/

#ifdef __MMI_TOUCH_DIAL_SCREEN__

#ifdef __MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__

#if defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)
static MMI_BOOL dialing_keypad_is_emergency = MMI_FALSE;
#endif 

static void (*dialing_keypad_call_handler) (void) = NULL;

#if defined(__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__)	\
	&& (!(defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)))
static void (*dialing_keypad_call2_handler) (void) = NULL;
#endif /* __DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__ */

#ifdef __MMI_CAT_VIDEO_CALL__  
static void (*dialing_keypad_video_handler) (void) = NULL; 
#endif /* __MMI_CAT_VIDEO_CALL__   */

static void (*dialing_keypad_phonebook_handler) (void) = NULL; 


/* For detail description, please refer to wgui_categories_CM.h */
void SetDialingKeypadEmergencyFunckey(MMI_BOOL IsEmergency)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)
    dialing_keypad_is_emergency = IsEmergency;
#endif 
}

void SetDialingKeypadCallHandler(void (*handler) (void))
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dialing_keypad_call_handler = handler;
}


/* For detail description, please refer to wgui_categories_CM.h */
void SetDialingKeypadCall2Handler(void (*handler) (void))
{
#if defined(__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__)	\
	&& (!(defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)))
    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dialing_keypad_call2_handler = handler;
#endif /* __DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__ */
    
}


/* For detail description, please refer to wgui_categories_CM.h */
void SetDialingKeypadPhonebookHandler(void (*handler) (void))
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dialing_keypad_phonebook_handler = handler;
}

/* For detail description, please refer to wgui_categories_CM.h */
void SetDialingKeypadVideoHandler(void (*handler) (void))
{
#ifdef __MMI_CAT_VIDEO_CALL__  
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dialing_keypad_video_handler = handler;
#endif /* __MMI_CAT_VIDEO_CALL__ */
}

#endif /* __MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__ */ 


/*****************************************************************************
 * FUNCTION
 *  PlayDialKeyPadTone
 * DESCRIPTION
 *  Play key tone for dial keypad keys.
 * PARAMETERS
 *  key_type        [IN]        key type
 * RETURNS
 *  void
 *****************************************************************************/
static void PlayDialKeyPadTone(S16 key_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 key_id = dialing_keypad.key_type;
    U8 key_code;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WEARABLE_DEVICE__
	return;
#else  /*__MMI_WEARABLE_DEVICE__*/
    key_code = KEY_0;

    if (key_id >= MMI_DIALING_KEY_START && key_id < MMI_DIALING_KEY_STAR)
    {
        key_code = KEY_0 + key_id;
    }
    /* 0 */
    else if (key_id == MMI_DIALING_KEY_ZERO)
    {
        key_code = KEY_0;
    }
    /* star key */
    else if (key_id == MMI_DIALING_KEY_STAR)
    {
        key_code = KEY_STAR;
    }
    /* pound key */
    else if (key_id == MMI_DIALING_KEY_HASH)
    {
        key_code = KEY_POUND;
    }

    mmi_frm_key_tone_player(key_code, (U8)key_type);
#endif /*__MMI_WEARABLE_DEVICE__*/
}

static MMI_BOOL g_wgui_cat016_highlight_has_change = MMI_FALSE;
/*****************************************************************************
 * FUNCTION
 *  ExecuteDialKeyPadKeyHandler
 * DESCRIPTION
 *  Excute key handler for dial keypad keys.
 * PARAMETERS
 *  key_type        [IN]        key type
 * RETURNS
 *  void
 *****************************************************************************/

static void ExecuteDialKeyPadKeyHandler(S16 key_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 key_id = dialing_keypad.key_type;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WEARABLE_DEVICE__
	if(g_cat16_style == WGUI_CAT16_PIN_STYLE)
	{
		PlayDialKeyPadTone(key_type);
		if (key_id >= MMI_DIALING_KEY_START && key_id < MMI_DIALING_KEY_STAR)
	    {
			mmi_frm_send_key_event(KEY_0 + (U8)key_id, (U8)key_type);		
	    }
	    /* 0 */
	    else if (key_id == MMI_DIALING_KEY_ZERO)
	    {
	        mmi_frm_send_key_event(KEY_0, (U8)key_type);
	    }
		/* star key */
	    else if (key_id == MMI_DIALING_KEY_STAR)
	    {
	    }
	    /* pound key */
	    else if (key_id == MMI_DIALING_KEY_HASH )
	    {
	        if(key_type != KEY_EVENT_UP)
			{
				if((key_type == KEY_EVENT_LONG_PRESS || key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change)
				{

					if(g_del_long_tap < 2)
					{

					#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
						if(wgui_inputs_sl_is_empty())
						{
							wgui_inputs_sl_delete_character();
							g_del_long_tap = 1;
						}
						else
						{
							wgui_inputs_sl_delete_all_characters();
							g_del_long_tap = 1;
						}
					#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
						if(wgui_inputs_ml_is_empty())
						{
							wgui_inputs_ml_delete_character();
							g_del_long_tap = 1;
						}
						else
						{
							wgui_inputs_ml_delete_all_characters();	
							g_del_long_tap = 1;
						}
					#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

					}

				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					if(wgui_inputs_sl_is_empty())
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					if(wgui_inputs_ml_is_empty())
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
						g_del_long_tap += 1;
					else
						g_del_long_tap = 0;

				}
				else if(!g_wgui_cat016_highlight_has_change)
				{
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					if(wgui_inputs_sl_is_empty())
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					if(wgui_inputs_ml_is_empty())
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					{
						g_del_long_tap = 2;
					}
					else
					{
						g_del_long_tap = 0;
					}
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					wgui_inputs_sl_delete_character();
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					wgui_inputs_ml_delete_character();
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

				}
			}
			else
			{
				g_del_long_tap = 0;
			}
	    }

	}
	else if(g_cat16_style == WGUI_CAT16_DTMF_STYLE)
    {
		PlayDialKeyPadTone(key_type);
    	
		if(key_type == KEY_EVENT_DOWN)
		{
			g_long_tap = 0;
			return;
		}
		
	    if (key_id >= MMI_DIALING_KEY_START && key_id < MMI_DIALING_KEY_STAR)
	    {
			if(key_type == KEY_EVENT_UP && !g_long_tap && !g_wgui_cat016_highlight_has_change)
			{
				g_long_tap = 0;
			#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
				wgui_inputs_sl_direct_input(KEY_0 + g_input_number_0 + key_id);
			#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				wgui_inputs_ml_direct_input(KEY_0 + g_input_number_0 + key_id);
			#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				mmi_frm_send_key_event(KEY_0 + (U8)key_id, (U8)key_type);
			}
			else if((key_type == KEY_EVENT_LONG_PRESS || key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change)
			{
			#ifdef __WGUI_CAT16_DTMF_LONGPRESS_ENABLE__
				g_long_tap = 1;
				mmi_frm_send_key_event(KEY_0 + (U8)key_id, (U8)key_type);
			#else /*__WGUI_CAT16_DTMF_LONGPRESS_ENABLE__*/
				g_long_tap = 0;
			#endif /*__WGUI_CAT16_DTMF_LONGPRESS_ENABLE__*/
		
			}
	    }
	    /* 0 */
	    else if (key_id == MMI_DIALING_KEY_ZERO)
	    {
	    	if(key_type == KEY_EVENT_UP && !g_long_tap & !g_wgui_cat016_highlight_has_change)
			{
				g_long_tap = 0;
			#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
				wgui_inputs_sl_direct_input(KEY_0 + g_input_number_0);
			#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				wgui_inputs_ml_direct_input(KEY_0 + g_input_number_0);
			#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				mmi_frm_send_key_event(KEY_0, (U8)key_type);

			}		
			else if((key_type == KEY_EVENT_LONG_PRESS || key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change)
			{
			
			#ifdef __WGUI_CAT16_DTMF_LONGPRESS_ENABLE__
				g_long_tap = 1;
				mmi_frm_send_key_event(KEY_0, (U8)key_type);				
			#else /*__WGUI_CAT16_DTMF_LONGPRESS_ENABLE__*/
				g_long_tap = 0;
			#endif /*__WGUI_CAT16_DTMF_LONGPRESS_ENABLE__*/
			}
	    }	
	    /* star key */
	    else if (key_id == MMI_DIALING_KEY_STAR || key_id == MMI_DIALING_KEY_HASH)
	    {
	    	U8 key_code;
			if (key_id == MMI_DIALING_KEY_STAR)
			{
				key_code = KEY_STAR;
		    }
		    /* pound key */
		    else if (key_id == MMI_DIALING_KEY_HASH)
		    {
		     	key_code = KEY_POUND;
		    }
			if(key_type == KEY_EVENT_UP && !g_long_tap && !g_wgui_cat016_highlight_has_change) 
			{
				g_long_tap = 0;
			#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
				wgui_inputs_sl_direct_input(g_input_table[key_id-MMI_DIALING_KEY_STAR]);
			#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				wgui_inputs_ml_direct_input(g_input_table[key_id-MMI_DIALING_KEY_STAR]);
			#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				mmi_frm_send_key_event(key_code, (U8)key_type);

			}				
			else if	((key_type == KEY_EVENT_LONG_PRESS || key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change)
			{		
			#ifdef __WGUI_CAT16_DTMF_LONGPRESS_ENABLE__
				g_long_tap = 1;
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
				wgui_inputs_sl_direct_input(g_input_table[key_id-MMI_DIALING_KEY_STAR]);
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				wgui_inputs_ml_direct_input(g_input_table[key_id-MMI_DIALING_KEY_STAR]);
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				mmi_frm_send_key_event(key_code, (U8)key_type);
			#else /*__WGUI_CAT16_DTMF_LONGPRESS_ENABLE__*/
				g_long_tap = 0;
			#endif /*__WGUI_CAT16_DTMF_LONGPRESS_ENABLE__*/
			}		
		}
	  
	}
	else
	{
	    if (key_id >= MMI_DIALING_KEY_START && key_id < MMI_DIALING_KEY_STAR
			|| key_id == MMI_DIALING_KEY_ZERO)
	    {
	        PlayDialKeyPadTone(key_type);
			if(key_id == 7 || key_id == 9 || key_id == MMI_DIALING_KEY_ZERO)
			{
				if(key_type == KEY_EVENT_DOWN)
				{	
					g_long_tap = 0;	
					
				}	
				else if((key_type == KEY_EVENT_LONG_PRESS) && !g_wgui_cat016_highlight_has_change)
				{	
					
					g_long_tap = 1;
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					wgui_inputs_sl_direct_input(g_input_table[key_id-7]);
				#else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					wgui_inputs_ml_direct_input(g_input_table[key_id-7]);
				#endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				#if defined(__MMI_ONE_KEY_SOS_SUPPORT__) || defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TELEPHONY_SUPPORT__)
					if (sw_dialing_keypad_long_press_handler != NULL)
					{
						sw_dialing_keypad_long_press_handler(key_id);
					}
				#endif /*defined(__MMI_ONE_KEY_SOS_SUPPORT__) || defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TELEPHONY_SUPPORT__)*/
				}
				else if((key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change && !g_long_tap)
				{
					g_long_tap = 1;
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					wgui_inputs_sl_direct_input(g_input_table[key_id-7]);
				#else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					wgui_inputs_ml_direct_input(g_input_table[key_id-7]);
				#endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
				}			
				else if(key_type == KEY_EVENT_UP)
				{
					if(g_long_tap)//'0' + (*digit) - KEY_0
					{
						if(key_id == 7)
						{	
							mmi_frm_send_key_event(KEY_STAR, KEY_EVENT_UP);
						}
						if(key_id == 9)					
						{  
							mmi_frm_send_key_event(KEY_POUND, KEY_EVENT_UP);
						}
						g_long_tap = 0;					
					}
					else
					{	
						if(key_id == MMI_DIALING_KEY_ZERO)
							key_id = 0;
						
						if(!g_wgui_cat016_highlight_has_change)
						{
						#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
							wgui_inputs_sl_direct_input(KEY_0 + (U8)key_id + g_input_number_0);
						#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
							wgui_inputs_ml_direct_input(KEY_0 + (U8)key_id + g_input_number_0);
						#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
							mmi_frm_send_key_event(KEY_0 + (U8)key_id, KEY_EVENT_UP);
						}
					}
				}
			}
			else
			{   
				if(key_type == KEY_EVENT_DOWN)
				{
					g_long_tap = 0;
				}
				else if((key_type == KEY_EVENT_LONG_PRESS || key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change)
				{
				
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					wgui_inputs_sl_direct_input(KEY_0 + (U8)key_id + g_input_number_0);
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					wgui_inputs_ml_direct_input(KEY_0 + (U8)key_id + g_input_number_0);
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					g_long_tap = 1;
				#if defined(__MMI_ONE_KEY_SOS_SUPPORT__) || defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TELEPHONY_SUPPORT__)
					if (sw_dialing_keypad_long_press_handler != NULL)
					{
						sw_dialing_keypad_long_press_handler(key_id);
					}
				#endif /*defined(__MMI_ONE_KEY_SOS_SUPPORT__) || defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TELEPHONY_SUPPORT__)*/
				}
			    else if(key_type == KEY_EVENT_UP)
			    {
			    
					if(!g_long_tap && !g_wgui_cat016_highlight_has_change)
					{
					
					#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
						wgui_inputs_sl_direct_input(KEY_0 + (U8)key_id + g_input_number_0);
					#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
						wgui_inputs_ml_direct_input(KEY_0 + (U8)key_id + g_input_number_0);				
					#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
						mmi_frm_send_key_event(KEY_0 + (U8)key_id, (U8)key_type);
					}
					else if(g_long_tap)
					{		
						g_long_tap = 0;
						mmi_frm_send_key_event(KEY_0 + (U8)key_id, (U8)key_type);
					}
			    }
								
			}
			
	    }
	    /* star key */
	    else if (key_id == MMI_DIALING_KEY_STAR)
	    {
	    }
	    /* pound key */
	    else if (key_id == MMI_DIALING_KEY_HASH )
	    {
			if(key_type != KEY_EVENT_UP)
			{
				if((key_type == KEY_EVENT_LONG_PRESS || key_type == KEY_EVENT_REPEAT) && !g_wgui_cat016_highlight_has_change)
				{

					if(g_del_long_tap < 2)
					{

					#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
						if(wgui_inputs_sl_is_empty())
						{
							wgui_inputs_sl_delete_character();
							g_del_long_tap = 1;
						}
						else
						{
							wgui_inputs_sl_delete_all_characters();
							g_del_long_tap = 1;
						}
					#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
						if(wgui_inputs_ml_is_empty())
						{
							wgui_inputs_ml_delete_character();
							g_del_long_tap = 1;
						}
						else
						{
							wgui_inputs_ml_delete_all_characters();	
							g_del_long_tap = 1;
						}
					#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

					}

				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					if(wgui_inputs_sl_is_empty())
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					if(wgui_inputs_ml_is_empty())
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
						g_del_long_tap += 1;
					else
						g_del_long_tap = 0;

				}
				else if(!g_wgui_cat016_highlight_has_change)
				{
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					if(wgui_inputs_sl_is_empty())
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					if(wgui_inputs_ml_is_empty())
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					{
						g_del_long_tap = 2;
					}
					else
					{
						g_del_long_tap = 0;
					}
				#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
					wgui_inputs_sl_delete_character();
				#else  /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
					wgui_inputs_ml_delete_character();
				#endif	/*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

				}
			}
			else
			{
				g_del_long_tap = 0;
			}			

	    }


	}
#else /*__MMI_WEARABLE_DEVICE__*/
    /* 1-9 */
    if (key_id >= MMI_DIALING_KEY_START && key_id < MMI_DIALING_KEY_STAR)
    {
        PlayDialKeyPadTone(key_type);
		mmi_frm_send_key_event(KEY_0 + (U8)key_id, (U8)key_type);		
    }
    /* 0 */
    else if (key_id == MMI_DIALING_KEY_ZERO)
    {
        PlayDialKeyPadTone(key_type);
        mmi_frm_send_key_event(KEY_0, (U8)key_type);
    }	
    /* star key */
    else if (key_id == MMI_DIALING_KEY_STAR)
    {
        PlayDialKeyPadTone(key_type);
        mmi_frm_send_key_event(KEY_STAR, (U8)key_type);
    }
    /* pound key */
    else if (key_id == MMI_DIALING_KEY_HASH )
    {
        PlayDialKeyPadTone(key_type);
        mmi_frm_send_key_event(KEY_POUND, (U8)key_type);
    }
#endif /*__MMI_WEARABLE_DEVICE__*/
}

/*****************************************************************************
 * FUNCTION
 *  Cate16CategoryControlAreaPenDownHandler
 * DESCRIPTION
 *  Pen down events handler function for category16 control area.
 * PARAMETERS
 *  point                       [IN]        pen down position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL Cate16CategoryControlAreaPenDownHandler(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret = MMI_FALSE;
    gui_pen_event_param_struct dialing_key_param;
    gui_dialing_key_pen_enum dialing_key_menu_event;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Get dialing screen  event type according to current state of dialing screen */
    ret = (MMI_BOOL)gui_dialing_screen_translate_pen_event(
            &dialing_keypad,
            point.x,
            point.y,
            MMI_PEN_EVENT_DOWN,
            &dialing_key_menu_event,
            &dialing_key_param);

    if (ret)
    {
        g_wgui_cat016_highlight_has_change = MMI_FALSE;
	#ifdef __MMI_WEARABLE_DEVICE__
		g_Cat16_PenDown_x = 1;
		
	#endif /*__MMI_WEARABLE_DEVICE__*/
        gdi_lcd_repaint_all();
        ExecuteDialKeyPadKeyHandler(KEY_EVENT_DOWN);
		return ret;
    }
  	
#if defined( __CAT16_MULTIEDITOR_STYLE__) || defined(__MMI_WEARABLE_DEVICE__)  
	{
		mmi_imc_editor_pen_event_struct pen_event;
		U32 is_in_edit_area = 0;
		mmi_imc_message_struct imc_msg;
	
		pen_event.mmi_pen_event = MMI_PEN_EVENT_DOWN;
		pen_event.pos.x = point.x;
		pen_event.pos.y = point.y;
	
		imc_msg.message_id	  = MMI_IMC_MESSAGE_PEN_EVENT;
		imc_msg.param_0 	  = (U32)&pen_event;
		imc_msg.param_1 	  = (U32)&is_in_edit_area;
	
		ret= (MMI_BOOL)mmi_imc_send_message(&imc_msg); 
	#ifdef __MMI_WEARABLE_DEVICE__
		g_Cat16_PenDown_x = -1;
	#endif /*__MMI_WEARABLE_DEVICE__*/
		if(ret)
		{  
#if defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TOUCH_SCREEN__) && defined(__MMI_EDITOR_SSP_SUPPORT__)
			gui_input_box_ssp_pen_down_hdlr(point);
		  
#else /*__MMI_WEARABLE_DEVICE__*/
	
			MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_DISABLE_DRAW;
	
			gui_show_multi_line_input_box_ext(&MMI_multiline_inputbox, point.x, point.y); 
	
			MMI_multiline_inputbox.flags &= ~UI_MULTI_LINE_INPUT_BOX_DISABLE_DRAW;
			wgui_inputs_ml_redraw(); 
#endif  /*__MMI_WEARABLE_DEVICE__*/
			
		}
#endif /*defined( __CAT16_MULTIEDITOR_STYLE__) || defined(__MMI_WEARABLE_DEVICE__)*/
		return ret;
	}

}


/*****************************************************************************
 * FUNCTION
 *  Cate16CategoryControlAreaPenUpHandler
 * DESCRIPTION
 *  Pen up events handler function for category16 control area.
 * PARAMETERS
 *  point                       [IN]        pen up position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL Cate16CategoryControlAreaPenUpHandler(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret = MMI_FALSE;
    gui_pen_event_param_struct dialing_key_param;
    gui_dialing_key_pen_enum dialing_key_menu_event;
    U16 scr_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Get dialing screen  event type according to current state of dialing screen */
    scr_id = GetActiveScreenId();
#if defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TOUCH_SCREEN__) && defined(__MMI_EDITOR_SSP_SUPPORT__)
	gui_input_box_ssp_pen_up_hdlr(point);

	if(g_Cat16_PenDown_x >= 0)
	{	
		g_Cat16_PenDown_x = -1;
	}
#endif /*__MMI_WEARABLE_DEVICE__*/

    ret = (MMI_BOOL)gui_dialing_screen_translate_pen_event(
            &dialing_keypad,
            point.x,
            point.y,
            MMI_PEN_EVENT_UP,
            &dialing_key_menu_event,
            &dialing_key_param);
#ifdef __MMI_WEARABLE_DEVICE__
	if (PEN_CHECK_BOUND(point.x, point.y, dialing_keypad.selected_key_x, dialing_keypad.selected_key_y, 
					dialing_keypad.key_width, dialing_keypad.key_height))
#endif /*__MMI_WEARABLE_DEVICE__*/
	{
	 	ExecuteDialKeyPadKeyHandler(KEY_EVENT_UP);
	}
    if (scr_id == GetActiveScreenId() && ret)
    {
        gdi_lcd_repaint_all();
#ifdef __MMI_WEARABLE_DEVICE__
		if ( dialing_keypad.key_type == MMI_DIALING_KEY_STAR
			   && sw_dialing_keypad_call_handler != NULL 
			   && g_wgui_cat016_highlight_has_change == MMI_FALSE
			   && (g_cat16_style == WGUI_CAT16_NORMAL_STYLE || g_cat16_style == WGUI_CAT16_PIN_STYLE))
		{
			sw_dialing_keypad_call_handler();
		}
#endif /*__MMI_WEARABLE_DEVICE__*/
#if defined (__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__)
        if (dialing_key_menu_event == GUI_DIALING_KEYPAD_PEN_INSERT_PHB)
        {
            if (dialing_keypad_phonebook_handler != NULL && g_wgui_cat016_highlight_has_change ==MMI_FALSE)
            {
                dialing_keypad_phonebook_handler();
            }
        }
#if defined(__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__)	\
	&& (!(defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)))
	    else if(dialing_key_menu_event == GUI_DIALING_KEYPAD_PEN_INSERT_CALL_SLAVE)
	    {
	        if (dialing_keypad_call2_handler != NULL && g_wgui_cat016_highlight_has_change ==MMI_FALSE)
	      	{
			    dialing_keypad_call2_handler();
	      	}
	    }
#endif/*__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__*/
        else if (dialing_key_menu_event == GUI_DIALING_KEYPAD_PEN_INSERT_CALL)
        {
            if (dialing_keypad_call_handler != NULL && g_wgui_cat016_highlight_has_change ==MMI_FALSE)
            {
                dialing_keypad_call_handler();
            }
        }
#ifdef __MMI_CAT_VIDEO_CALL__        
        else if (dialing_key_menu_event == GUI_DIALING_KEYPAD_PEN_INSERT_VIDEO)
        {
            if (dialing_keypad_video_handler != NULL && g_wgui_cat016_highlight_has_change ==MMI_FALSE)
            {
                dialing_keypad_video_handler();
            }
        }
#endif /* __MMI_CAT_VIDEO_CALL__ */   

#endif /* defined (__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__) */ 
    }

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  Cate16CategoryControlAreaPenMoveHandler
 * DESCRIPTION
 *  Pen move events handler function for category16 control area.
 * PARAMETERS
 *  point                       [IN]        pen move position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL Cate16CategoryControlAreaPenMoveHandler(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 x1, x2, y1, y2;
    gui_dialing_key_pen_enum menu_event;
    gui_pen_event_param_struct dialing_key_param;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TOUCH_SCREEN__)
#if defined(__MMI_EDITOR_SSP_SUPPORT__)
    gui_input_box_ssp_pen_move_hdlr(point);	

	if(!PEN_CHECK_BOUND(point.x, point.y, MMI_DIALING_BOX_X, MMI_DIALING_BOX_Y,
				MMI_DIALING_BOX_WIDTH,MMI_DIALING_BOX_HEIGHT))
	{
		gui_input_box_ssp_pen_up_hdlr(point);
	}
#endif /*__MMI_EDITOR_SSP_SUPPORT__*/ 
			
#endif /*defined(__MMI_WEARABLE_DEVICE__) && defined(__MMI_TOUCH_SCREEN__)*/
    /* Get dialing screen  event type according to current state of dialing screen */

    gui_dialing_screen_translate_pen_event(
        &dialing_keypad,
        point.x,
        point.y,
        MMI_PEN_EVENT_MOVE,
        &menu_event,
        &dialing_key_param);
    if (menu_event == GUI_DIALING_KEYPAD_HIGHLIGHT_CHANGED || menu_event == GUI_DIALING_KEYPAD_PEN_INSERT_STAR)
    {
        x1 = dialing_keypad.selected_key_x;
        y1 = dialing_keypad.selected_key_y;

#if defined (__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__)
        if (dialing_keypad.key_type >= MMI_DIALING_KEY_FUNC)
        {
            x2 = x1 + dialing_keypad.func_key_width - 1;
            y2 = y1 + dialing_keypad.func_key_height - 1;
		#if defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__) || defined(__MMI_BT_DIALER_SUPPORT__)
			if (dialing_keypad.key_type == MMI_DIALING_KEY_FUNC)
			{
			    x2 = x1 + dialing_keypad.call_key_width - 1;
			}
		#endif /* defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__) || defined(__MMI_BT_DIALER_SUPPORT__)*/
        }
        else
#endif /* defined (__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__) */ 
        {
            x2 = x1 + dialing_keypad.key_width - 1;
            y2 = y1 + dialing_keypad.key_height - 1;
        }

        gdi_layer_push_and_set_clip(x1, y1, x2, y2);

#ifdef __GDI_MEMORY_PROFILE_2__
        gdi_draw_solid_rect(x1, y1, x2, y2, GDI_COLOR_TRANSPARENT);
#else 
        gdi_image_cache_bmp_draw(x1, y1, &(dialing_keypad.selected_key_bitmap));
#endif 
        gdi_layer_pop_clip();

#if !defined(__MMI_MULTITAP_KEY_0__) && !defined(__MMI_WEARABLE_DEVICE__)
        if (menu_event == GUI_DIALING_KEYPAD_PEN_INSERT_STAR)
        {
  #ifdef __MMI_WEARABLE_DEVICE_
     #ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__ 
  			wgui_inputs_sl_multitap_input_complete();
	 #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
	 		wgui_inputs_ml_multitap_input_complete();
	 #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
  #else /*__MMI_WEARABLE_DEVICE__*/
    #ifdef __CAT16_MULTIEDITOR_STYLE__
		    wgui_inputs_ml_multitap_input_complete();
	#else /*__CAT16_MULTIEDITOR_STYLE__*/
            dialer_inputbox_handle_multitap_star_key_up();
    #endif /*__CAT16_MULTIEDITOR_STYLE__*/
  #endif /*__MMI_WEARABLE_DEVICE__*/
        }
#endif

#ifdef __MMI_WEARABLE_DEVICE__
		g_wgui_cat016_highlight_has_change = MMI_TRUE; 

#endif /*__MMI_WEARABLE_DEVICE__*/
        ExecuteDialKeyPadKeyHandler(KEY_EVENT_UP);
#ifndef __MMI_WEARABLE_DEVICE__ 
		g_wgui_cat016_highlight_has_change = MMI_TRUE;
#endif /*__MMI_WEARABLE_DEVICE__*/
    }
    else
    {
        if (g_wgui_cat016_highlight_has_change == MMI_TRUE)
        {
            x1 = dialing_keypad.selected_key_x;
            y1 = dialing_keypad.selected_key_y;
            
#if defined (__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__)
            if (dialing_keypad.key_type >= MMI_DIALING_KEY_FUNC)
            {
                x2 = x1 + dialing_keypad.func_key_width - 1;
                y2 = y1 + dialing_keypad.func_key_height - 1;
			#if defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)|| defined(__MMI_BT_DIALER_SUPPORT__)
				if (dialing_keypad.key_type == MMI_DIALING_KEY_FUNC)
				{
				    x2 = x1 + dialing_keypad.call_key_width - 1;
				}
			#endif /* defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__) || defined(__MMI_BT_DIALER_SUPPORT__) */
            }
            else
#endif /* defined (__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__) */ 
            {
                x2 = x1 + dialing_keypad.key_width - 1;
                y2 = y1 + dialing_keypad.key_height - 1;
            }
            
            gdi_layer_push_and_set_clip(x1, y1, x2, y2);
            
#ifdef __GDI_MEMORY_PROFILE_2__
            gdi_draw_solid_rect(x1, y1, x2, y2, GDI_COLOR_TRANSPARENT);
#else 
            gdi_image_cache_bmp_draw(x1, y1, &(dialing_keypad.selected_key_bitmap));
#endif 
            gdi_layer_pop_clip();
        }
    }

    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  Cate16CategoryControlAreaPenRepeatHandler
 * DESCRIPTION
 *  Pen repeat events handler function for category16 control area.
 * PARAMETERS
 *  point                       [IN]        pen repeat position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL Cate16CategoryControlAreaPenRepeatHandler(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret;
    gui_pen_event_param_struct dialing_key_param;
    gui_dialing_key_pen_enum dialing_key_menu_event;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Get dialing screen  event type according to current state of dialing screen */
    ret = (MMI_BOOL)gui_dialing_screen_translate_pen_event(
            &dialing_keypad,
            point.x,
            point.y,
            MMI_PEN_EVENT_REPEAT,
            &dialing_key_menu_event,
            &dialing_key_param);

    if (ret)
    {
        gdi_lcd_repaint_all();
        ExecuteDialKeyPadKeyHandler(KEY_EVENT_REPEAT);
    }

    return ret;
}


/*****************************************************************************
 * FUNCTION
 *  Cate16CategoryControlAreaPenLongTapHandler
 * DESCRIPTION
 *  Pen long tap events handler function for category16 control area.
 * PARAMETERS
 *  point                       [IN]        pen long tap position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL Cate16CategoryControlAreaPenLongTapHandler(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    gui_pen_event_param_struct dialing_key_param;
    gui_dialing_key_pen_enum dialing_key_menu_event;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Get dialing screen  event type according to current state of dialing screen */
    gui_dialing_screen_translate_pen_event(
        &dialing_keypad,
        point.x,
        point.y,
        MMI_PEN_EVENT_LONG_TAP,
        &dialing_key_menu_event,
        &dialing_key_param);
    ExecuteDialKeyPadKeyHandler(KEY_EVENT_LONG_PRESS);

    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  Cate16CategoryControlAreaPenAbortHandler
 * DESCRIPTION
 *  Pen Abort events handler function for category16 control area.
 * PARAMETERS
 *  point                       [IN]        pen abort position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL Cate16CategoryControlAreaPenAbortHandler(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PlayDialKeyPadTone(KEY_EVENT_UP);
    return MMI_TRUE;
}
#endif /* __MMI_TOUCH_DIAL_SCREEN__ */ 
#ifdef __MMI_WEARABLE_DEVICE__
/*****************************************************************************
 * FUNCTION
 *  wgui_cat016_move_to_right_flag
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
MMI_BOOL wgui_cat016_move_to_right_flag(void)
{
	/*----------------------------------------------------------------*/
	/* Local Variables                                                */
	/*----------------------------------------------------------------*/

	/*----------------------------------------------------------------*/
	/* Code Body                                                      */
	/*----------------------------------------------------------------*/

#ifdef __MMI_TOUCH_DIAL_SCREEN__
	if(g_Cat16_PenDown_x >= 0 && g_wgui_cat016_highlight_has_change)
		return MMI_TRUE;
#endif
	return MMI_FALSE;
}

#endif /*__MMI_WEARABLE_DEVICE__*/




#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
/*****************************************************************************
 * FUNCTION
 *  MomtSetMute
 * DESCRIPTION
 *  Set mute.
 * PARAMETERS
 *  flag                       [IN]        flag if audio is mute or not.
 * RETURNS
 *  void
 *****************************************************************************/
static void MomtSetMute(MMI_BOOL flag)
{		
    mdi_audio_set_mute(MDI_VOLUME_MEDIA, flag);
    cat_momt_is_aud_muted = flag;
}
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/

#ifdef __MMI_TOUCH_DIAL_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea_big_touch
 * DESCRIPTION
 *  Draws the category16 category control area for touch
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCate16CategoryControlArea_touch(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* draw background image */
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
#ifdef __MMI_WEARABLE_DEVICE__
	gdi_draw_solid_rect(0, 0, UI_device_width, MMI_DIALING_BOX_Y + MMI_DIALING_BOX_HEIGHT, gdi_act_color_from_rgb(255, 0, 0, 0));//25,26,31
	gdi_draw_solid_rect(0, MMI_DIALING_BOX_Y + MMI_DIALING_BOX_HEIGHT, UI_device_width, MMI_DIALING_KEYPAD_Y, gdi_act_color_from_rgb(255, 0, 180, 255));//19,19,23
	//gdi_draw_solid_rect(0, 0, UI_device_width, MMI_DIALING_KEYPAD_Y, gdi_act_color_from_rgb(255, 0, 0, 0));//25,26,31
#elif (defined(__MMI_MAINLCD_320X480__)||defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__)) && !defined(__MMI_FTE_SUPPORT__)
    gdi_image_draw(0, 0, current_MMI_theme->dialing_screen_bg_image);
#elif defined(__MMI_FTE_SUPPORT__)
    //gdi_image_draw_resized_id(0, 0, UI_device_width, UI_device_height, IMG_DIALING_SCREEN);
    gui_draw_filled_area(0, 0, UI_device_width, UI_device_height, current_MMI_theme->sub_menu_bkg_filler);
#else /* __MMI_FTE_SUPPORT__ */
    #ifdef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
    gdi_image_draw_id(
        MMI_DIALING_KEYPAD_LAYER_X,
        MMI_DIALING_KEYPAD_LAYER_Y,
        IMG_DIALING_SCREEN);
    #else
    gdi_image_draw_id(0, 0, IMG_DIALING_SCREEN);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#endif /* __MMI_WEARABLE_DEVICE__ */

#ifdef __MMI_WEARABLE_DEVICE__
	if(g_cat16_style == WGUI_CAT16_PIN_STYLE)
	{
		S32 width, height;
		gui_set_text_color(gui_color(255, 255, 255));
		gui_set_font(&MMI_medium_font);

		gui_move_text_cursor(MMI_CAT16_PIN_STYLE_TITLE_X, MMI_CAT16_PIN_STYLE_TITLE_X);
		gui_print_text(g_cat16_pin_title_str);
	}

#endif /*__MMI_WEARABLE_DEVICE__*/
#ifdef __MMI_BTD_BOX_UI_STYLE__
    gui_dialer_pad_show();
#elif (defined(__MMI_MAINLCD_320X480__)||defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__)) || defined(__MMI_FTE_SUPPORT__)
    gui_show_dialing_keypad(&dialing_keypad);

#ifndef __MMI_WEARABLE_DEVICE__
#ifdef __MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__
    if (dialing_keypad_phonebook_handler == NULL)
    {
        gui_show_dialing_key(MMI_DIALING_KEY_PHB, FALSE);
    }

  #if defined(__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__)	\
  	&& (!(defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)))
    if (dialing_keypad_call2_handler == NULL)
    {
        gui_show_dialing_key(MMI_DIALING_KEY_CALL_SLAVE, FALSE);
    }
  #endif /* __DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__ */

    if (dialing_keypad_call_handler == NULL)
    {
        gui_show_dialing_key(MMI_DIALING_KEY_CALL, FALSE);
    }
    
  #ifdef __MMI_CAT_VIDEO_CALL__
    if (dialing_keypad_video_handler == NULL)
    {
        gui_show_dialing_key(MMI_DIALING_KEY_VIDEO, FALSE);
    }        
  #endif /* __MMI_CAT_VIDEO_CALL__ */

#endif /* __MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__ */ 
#endif /* __MMI_WEARABLE_DEVICE__ */ 
#endif /* __MMI_BTD_BOX_UI_STYLE__ */ 

    gdi_layer_pop_clip();
}


#else /* __MMI_TOUCH_DIAL_SCREEN__ */
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea_small_key
 * DESCRIPTION
 *  This function is used to draw the category controlled area of category16 screen
 *  for 128x128 128x160 without touch
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate16CategoryControlArea_small_key(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();
    gdi_layer_reset_clip();
#if defined(__MMI_MAINLCD_96X64__)   
    gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));
    gui_fill_rectangle(0, MMI_status_bar_height + 2, UI_device_width - 1, UI_device_height - 1, gui_color(255, 255, 255));
#else /*__MMI_MAINLCD_96X64__*/
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, current_MMI_theme->CM_screen_background_filler);
#endif /*__MMI_MAINLCD_96X64__*/
    wgui_status_icon_bar_update();

#if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
#ifndef __MMI_CM_SCREEN_HIDE_DATE_TIME__
    CM_screens_draw_date_time_bar();
    show_main_LCD_dt_display();
#endif /* __MMI_CM_SCREEN_HIDE_DATE_TIME__ */ 
#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
#ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputs_ml_show();	
#else
    show_dialer_inputbox();
#endif
    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
#endif  /* __MMI_TOUCH_DIAL_SCREEN__ */

#if ((!defined ( __MMI_MAINLCD_128X128__ ) && !defined(__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && (defined (__GDI_MEMORY_PROFILE_2__) || defined (__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)))  
#ifndef __MMI_TOUCH_DIAL_SCREEN__

#if !(defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__))
static void wgui_cat16_draw_id(S32 x, S32 y, S32 w, S32 h, U16 id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_and_set_clip(x, y, x + w, y + h);
    gdi_image_draw_id(x, y, id);
    gdi_layer_pop_clip();
}
#endif /*defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__)*/
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryDialingBoxBg 
 * DESCRIPTION
 *  Draw the background image of the dialing input box
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCate16CategoryDialingBoxBg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if !(defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__))
    S32 x, y, w, h;
#endif /* !(__MMI_SLIM_IMG_RES__ || __WGUI_CATE_FTE_KEY_ONLY__)*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	gdi_set_alpha_blending_source_layer(dm_get_layer_handle(0));
#if !(defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__))
    /* up */
    gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_UP, &w, &h);
    x = MMI_CAT16_DIALING_BOX_BG_X;
    y = MMI_CAT16_DIALING_BOX_BG_Y;
    wgui_cat16_draw_id(x, y, w, h, IMG_DIALING_SCREEN_BG_UP);

    /* left */
    y += h;
    gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_LEFT, &w, &h);
    wgui_cat16_draw_id(x, y, w, h, IMG_DIALING_SCREEN_BG_LEFT);
    
    /* right */
    gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_UP, &w, &h);
    x = MMI_CAT16_DIALING_BOX_BG_X + w;
    gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_RIGHT, &w, &h);
    x -= w;
    wgui_cat16_draw_id(x, y, w, h, IMG_DIALING_SCREEN_BG_RIGHT);
    
    /* right */
    y += h;
    x = MMI_CAT16_DIALING_BOX_BG_X;
    gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_DOWN, &w, &h);
    wgui_cat16_draw_id(x, y, w, h, IMG_DIALING_SCREEN_BG_DOWN);
#else /* !(__MMI_SLIM_IMG_RES__ || __WGUI_CATE_FTE_KEY_ONLY__) */
  #if defined(__WGUI_CATE_FTE_KEY_ONLY__)
	gdi_image_draw_resized_id(
		MMI_CAT16_DIALING_BOX_BG_X + MMI_CAT16_DIALING_BOX_BG_OFFSET_X, 
		MMI_CAT16_DIALING_BOX_BG_Y + MMI_CAT16_DIALING_BOX_BG_OFFSET_Y, 
		MMI_CAT16_DIALING_BOX_BG_WIDTH, 
		MMI_CAT16_DIALING_BOX_BG_HEIGHT, 
		IMG_DIALING_SCREEN_BG_SLIM);
  #else  /*__WGUI_CATE_FTE_KEY_ONLY__*/  
    wgui_draw_pop_up_screen_background(
        MMI_CAT16_DIALING_BOX_BG_X + MMI_CAT16_DIALING_BOX_BG_OFFSET_X,
        MMI_CAT16_DIALING_BOX_BG_Y + MMI_CAT16_DIALING_BOX_BG_OFFSET_Y,
        MMI_CAT16_DIALING_BOX_BG_X + MMI_CAT16_DIALING_BOX_BG_OFFSET_X + MMI_CAT16_DIALING_BOX_BG_WIDTH,
        MMI_CAT16_DIALING_BOX_BG_Y + MMI_CAT16_DIALING_BOX_BG_OFFSET_Y + MMI_CAT16_DIALING_BOX_BG_HEIGHT,
        &wgui_pop_up_dialog_background);//,
//        MMI_TRUE);
//huking
  #endif /*__WGUI_CATE_FTE_KEY_ONLY__*/

#endif /* !(__MMI_SLIM_IMG_RES__ || __WGUI_CATE_FTE_KEY_ONLY__) */

#ifdef __MMI_BTD_BOX_UI_STYLE__
    #if defined(__MMI_FTE_SUPPORT__)
    //gdi_image_draw_resized_id(0, 0, UI_device_width, UI_device_height, IMG_DIALING_SCREEN);
    gui_draw_filled_area(0, 0, UI_device_width, UI_device_height, current_MMI_theme->sub_menu_bkg_filler);
    #else /* __MMI_FTE_SUPPORT__ */
    gdi_image_draw_id(0, 0, IMG_DIALING_SCREEN);
    #endif /* __MMI_FTE_SUPPORT__ */
#endif /*__MMI_BTD_BOX_UI_STYLE__ */    
}


/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea_big_key
 * DESCRIPTION
 *  Draws the category16 category control area for 176x220 up without touch
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCate16CategoryControlArea_big_key(dm_coordinates *coordinate)
    {
    /*-----------------------------------------------------------------*/
    /* Local Variables                                                                           */
    /*-----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

#ifdef __MMI_BTD_BOX_UI_STYLE__

#if defined(__MMI_FTE_SUPPORT__)
    //gdi_image_draw_resized_id(0, 0, UI_device_width, UI_device_height, IMG_DIALING_SCREEN);
    gui_draw_filled_area(0, 0, UI_device_width, UI_device_height, current_MMI_theme->sub_menu_bkg_filler);
#else /* __MMI_FTE_SUPPORT__ */
    gdi_image_draw_id(0, 0, IMG_DIALING_SCREEN);
#endif /* __MMI_FTE_SUPPORT__ */

	#ifdef __CAT16_MULTIEDITOR_STYLE__
	gui_dialer_pad_show();
	wgui_inputs_ml_show();	
	#endif/* __CAT16_MULTIEDITOR_STYLE__*/	
   
#else  //__MMI_BTD_BOX_UI_STYLE__
#if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__) && !defined(__MMI_MAINLCD_176X220__) && !defined(__MMI_MAINLCD_240X320__)
    gdi_layer_clear(GDI_COLOR_TRANSPARENT);
#endif

#if !defined(__WGUI_CATE_FTE_KEY_ONLY__)
    //DrawCate16CategoryDialingBoxBg();
#endif /* __WGUI_CATE_FTE_KEY_ONLY__ */
#ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputs_ml_show();	
#else /*__CAT16_MULTIEDITOR_STYLE__*/
    show_dialer_inputbox();
#endif /*__CAT16_MULTIEDITOR_STYLE__*/
    
#endif /*__MMI_BTD_BOX_UI_STYLE__ */    

    gdi_layer_unlock_frame_buffer();

    gdi_layer_blt(wgui_layer_1, wgui_base_layer, 0, 0, 0, 0, UI_device_width - 1, UI_device_height - 1);
}


/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryBeforeBLTCallback
 * DESCRIPTION
 * Before blt callback function of the wallpaper animation 
 * PARAMETERS
 *  return_code [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate16CategoryBeforeBLTCallback(GDI_RESULT return_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    gdi_layer_push_and_set_active(GDI_LAYER_MAIN_BASE_LAYER_HANDLE);

#if !defined(__WGUI_CATE_FTE_KEY_ONLY__)
   // DrawCate16CategoryDialingBoxBg();
#endif /* __WGUI_CATE_FTE_KEY_ONLY__ */

    wgui_status_icon_bar_set_alpha_blend_layer(
        WGUI_STATUS_ICON_BAR_H_BAR,
        dm_get_layer_handle(0));
    wgui_status_icon_bar_update();

    gdi_layer_pop_and_restore_active();

    gdi_layer_unlock_frame_buffer();
}

#ifdef __MMI_ALPHA_BLENDING__
/*****************************************************************************
 * FUNCTION
 *  cat16_swflash_callback
 * DESCRIPTION
 * swflash callback 
 * PARAMETERS
 *  offset_x   [IN]
 *  offset_y   [IN]
 *  width      [IN]
 *  height     [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void cat16_swflash_callback(S32 offset_x, S32 offset_y, S32 width, S32 height)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawCate16CategoryBeforeBLTCallback(0);
}
#endif /* __MMI_ALPHA_BLENDING__ */


/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea
 * DESCRIPTION
 *  Draws the category16 category control area
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCate16CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawCate16CategoryControlArea_big_key(coordinate);
}


#else /* !__MMI_TOUCH_DIAL_SCREEN__ */
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea
 * DESCRIPTION
 *  Draws the category16 category control area
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCate16CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawCate16CategoryControlArea_touch(coordinate);
}
#endif /* !__MMI_TOUCH_DIAL_SCREEN__ */


/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea2
 * DESCRIPTION
 *  Draws the category16 category control area2
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCate16CategoryControlArea2(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    GDI_HANDLE act_layer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_get_active(&act_layer);

#ifdef __MMI_SWFLASH__
    if (GetCat34MediaType()== MMI_IDLE_BG_MEDIA_SWFLASH)
    {
        SetSWFlashPlayerLayer(act_layer);
        DrawCateSWFlashCategoryControlArea(coordinate);

        /* wgui_cat016_is_set_swflash_layer = MMI_TRUE means it has already set swflash layer and must reset when exit*/
        wgui_cat016_is_set_swflash_layer = MMI_TRUE;
    }
    else
#endif /* __MMI_SWFLASH__ */ 
#ifdef __MMI_AVATAR__
    if (GetCat34MediaType()== MMI_IDLE_BG_MEDIA_AVATAR)
    {
        SetSWFlashPlayerLayer(act_layer);
        DrawCateAvatarCategoryControlArea(coordinate);
    }
    else
#endif
    {
#ifndef __MMI_TOUCH_DIAL_SCREEN__
        gdi_anim_set_blt_before_callback(DrawCate16CategoryBeforeBLTCallback);
#endif

        /* in order to display PNG wallpaper with alpha color,
         * we have to clear current layer first and set it as source layer */
        gdi_layer_clear(gdi_layer_get_background());
        gdi_set_alpha_blending_source_layer(act_layer);

        gdi_layer_set_source_key(FALSE, GDI_COLOR_TRANSPARENT);
        draw_wallpaper();
#if defined(ENABLE_ANIMATED_WALLPAPERS) && defined(__GDI_MEMORY_PROFILE_2__) && ( !defined(__MMI_TOUCH_DIAL_SCREEN__) || defined(__MMI_UI_DISABLE_FANCY_EFFECT__))//071007 dialing performance
        if (animation_handle != GDI_ERROR_HANDLE)
        {
            gdi_image_stop_animation(animation_handle);
            animation_handle = GDI_ERROR_HANDLE;
        }
#endif /*defined(ENABLE_ANIMATED_WALLPAPERS) && defined(__GDI_MEMORY_PROFILE_2__) && ( !defined(__MMI_TOUCH_DIAL_SCREEN__) || defined(__MMI_UI_DISABLE_FANCY_EFFECT__)*/
#if !defined(__MMI_TOUCH_DIAL_SCREEN__)
        DrawCate16CategoryDialingBoxBg();
#endif /* !__MMI_TOUCH_DIAL_SCREEN__ */
    }
}

#elif (defined ( __MMI_MAINLCD_128X160__ ) && defined (__GDI_MEMORY_PROFILE_2__) || defined (__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__))
#ifndef __MMI_TOUCH_DIAL_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea
 * DESCRIPTION
 *  Draws the category16 category control area
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate16CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawCate16CategoryControlArea_small_key(coordinate);
}


#else /* #ifndef __MMI_TOUCH_DIAL_SCREEN__ */
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea
 * DESCRIPTION
 *  Draws the category16 category control area
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate16CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawCate16CategoryControlArea_touch(coordinate);
}
#endif /* #ifndef __MMI_TOUCH_DIAL_SCREEN__ */


#else /* (!defined ( __MMI_MAINLCD_128X128__ ) && !defined(__MMI_MAINLCD_128X160__)&& !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && defined (__GDI_MEMORY_PROFILE_2__) */ 
/*****************************************************************************
 * FUNCTION
 *  DrawCate16CategoryControlArea
 * DESCRIPTION
 *  This function is used to draw the category controlled area of category16 screen
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate16CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawCate16CategoryControlArea_small_key(coordinate);
}
#endif /* (!defined ( __MMI_MAINLCD_128X128__ ) && !defined(__MMI_MAINLCD_128X160__)&& !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && defined (__GDI_MEMORY_PROFILE_2__) */ 


static MMI_BOOL IsSetCursorToFirst = MMI_FALSE;
/*****************************************************************************
 * FUNCTION
 *  SetDialingInputCursorToFirst
 * DESCRIPTION
 *  set dialer input region cursor to before first char.
 * PARAMETERS
 *  Value			[IN]		true/false
 * RETURNS
 *  void
 *****************************************************************************/
void SetDialingInputCursorToFirst(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if 0
/* under construction !*/
#endif
}


/*****************************************************************************
 * FUNCTION
 *  RegisterCategory16NavigationKeys
 * DESCRIPTION
 *  Register the keys ofdialing scrren.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RegisterCategory16NavigationKeys(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    register_left_softkey_handler();
    register_right_softkey_handler();
#if (!defined( __MMI_ANIMATED_DIAL__))
    register_dialer_inputbox_keys();
#endif
}


/*****************************************************************************
 * FUNCTION
 *  SetCategory16RightSoftkeyFunction
 * DESCRIPTION
 *  set the RSK function of dialing scrren.
 * PARAMETERS
 *  f       [IN]        Function pointer
 *  k       [IN]        Event type
 * RETURNS
 *  void
 *****************************************************************************/
void SetCategory16RightSoftkeyFunction(void (*f) (void), MMI_key_event_type k)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_ANIMATED_DIAL__
    UI_UNUSED_PARAMETER(k);
    wgui_anim_dial_register_RSK_function(f);
#elif defined(__MMI_MOTION_DIAL__)
    UI_UNUSED_PARAMETER(k);
    wgui_cat633_register_RSK_function(f);
#else /* __MMI_ANIMATED_DIAL__ */
    UI_UNUSED_PARAMETER(k);

  #ifdef __MMI_WEARABLE_DEVICE__
   #ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
   wgui_singleline_inputbox_RSK_function = f;
   #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
   wgui_inputbox_RSK_function = f;
   #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
  #else /*__MMI_WEARABLE_DEVICE__*/
	#ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputbox_RSK_function = f;
	#else /*__CAT16_MULTIEDITOR_STYLE__*/
    wgui_dialer_inputbox_RSK_function = f;
	#endif /*__CAT16_MULTIEDITOR_STYLE__*/
  #endif /*__MMI_WEARABLE_DEVICE__*/
#endif /* __MMI_ANIMATED_DIAL__ */
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory16History
 * DESCRIPTION
 *  Get the category16 screen history
 * PARAMETERS
 *  history_buffer      [IN/OUT]        History_buffer
 * RETURNS
 *  U8*
 *****************************************************************************/
U8 *GetCategory16History(U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WEARABLE_DEVICE__
	#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
	wgui_inputs_sl_get_category_history(MMI_CATEGORY16_ID, history_buffer);
	#else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
	wgui_inputs_ml_get_category_history(MMI_CATEGORY16_ID, history_buffer);
	#endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
#else
	#if defined(__CAT16_MULTIEDITOR_STYLE__)
    wgui_inputs_ml_get_category_history(MMI_CATEGORY16_ID, history_buffer);
	#else /*__MMI_WEARABLE_DEVICE__*/
    get_dialer_inputbox_category_history(MMI_CATEGORY16_ID, history_buffer);
	#endif
#endif /*__MMI_WEARABLE_DEVICE__*/
    return (history_buffer);
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory16HistorySize
 * DESCRIPTION
 *  Get the category16 screen history size
 * PARAMETERS
 *  void
 * RETURNS
 *  S32 size of category 16 history
 *****************************************************************************/
S32 GetCategory16HistorySize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WEARABLE_DEVICE__
  #ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
	return sizeof(singleline_inputbox_category_history);
  #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
	return sizeof(multiline_inputbox_category_history);
  #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
#else /*__CAT16_MULTIEDITOR_STYLE__*/
  #if defined(__CAT16_MULTIEDITOR_STYLE__)
	return sizeof(multiline_inputbox_category_history);
  #else /*__CAT16_MULTIEDITOR_STYLE__*/
    return sizeof(dialer_inputbox_category_history);
  #endif /*__CAT16_MULTIEDITOR_STYLE__*/
#endif /*__CAT16_MULTIEDITOR_STYLE__*/
}

#ifdef __MMI_FTE_SUPPORT__
extern S32 UI_cursor_x1;                   /* cursor x1 postioon */
extern S32 UI_cursor_y1;                   /* cursor y1 position */
extern S32 UI_cursor_x2;                   /* cursor x2 postion */
extern S32 UI_cursor_y2;                   /* cursor y2position */
#endif /*__MMI_FTE_SUPPORT__*/
/*****************************************************************************
 * FUNCTION
 *  ExitCategory16Screen
 * DESCRIPTION
 *  Exits the category16 screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitCategory16Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
#if defined(__MMI_UI_DIALER_PAD_ONLY_KEY__) 
	gui_dialer_pad_horizontal_cancel_pop_up_timer();
#endif
#if (defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X320__)|| defined (__MMI_MAINLCD_240X240__) || defined (__MMI_MAINLCD_320X240__)) && defined(__MMI_TOUCH_DIAL_SCREEN__)
    reset_small_screen();
#endif /*defined (__MMI_MAINLCD_240X320__)*/
    gdi_layer_lock_frame_buffer();
    //wgui_status_icon_bar_move(WGUI_STATUS_ICON_BAR_H_BAR,0,0);
	IsSetCursorToFirst = MMI_FALSE;
#ifdef __MMI_WEARABLE_DEVICE__
  #ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
	//wgui_inputs_sl_multitap_input_complete();
	wgui_inputs_sl_close();
  #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
    wgui_inputs_ml_multitap_input_complete();
	wgui_inputs_ml_close();
  #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
 	g_long_tap = 0;
    g_Cat16_PenDown_x = -1;

#else /*__MMI_WEARABLE_DEVICE__*/
	#if defined(__CAT16_MULTIEDITOR_STYLE__)
    #if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__) && (defined(__MMI_MAINLCD_240X320__)||defined(__MMI_MAINLCD_176X220__)||defined(__MMI_MAINLCD_128X160__))
        gui_one_layer_regist_draw_filled_bg_area_func(CM_draw_dialing_screen_edit_bg);
	wgui_inputs_ml_multitap_input_complete();
	wgui_inputs_ml_close();
        gui_one_layer_draw_filled_bg_area_with_image();
    #else
	wgui_inputs_ml_multitap_input_complete();
	wgui_inputs_ml_close();
    #endif
#else /*__CAT16_MULTIEDITOR_STYLE__*/
    dialer_inputbox_handle_multitap_complete(WGUI_DIALER_BOX_ACTIVE_MULTITAP_ANY);
    close_dialer_inputbox();
	#endif /*__CAT16_MULTIEDITOR_STYLE__*/
#endif /*__MMI_WEARABLE_DEVICE__*/

  #ifdef __MMI_FTE_SUPPORT__
    UI_cursor_x1 = 0;
    UI_cursor_y1 = 0;
    UI_cursor_x2 = 0;
    UI_cursor_y2 = 0;
  #endif /*__MMI_FTE_SUPPORT__*/

    close_main_LCD_dt_display();
//#if  !defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)
//	#if ((!defined ( __MMI_MAINLCD_128X128__ ) && !defined(__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && defined(__GDI_MEMORY_PROFILE_2__))
//#else  /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__*/
	#if ((!defined ( __MMI_MAINLCD_128X128__ ) && !defined(__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && (defined(__GDI_MEMORY_PROFILE_2__) || defined (__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)))
//#endif /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__*/
    on_idle_screen = 0;
    set_on_idlescreen(0);
    leave_idle_screen();
    enactive_main_lcd_update_date_time();
    enable_softkey_background();
#endif /* ((!defined ( __MMI_MAINLCD_128X128__ ) && !defined(__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && defined(__GDI_MEMORY_PROFILE_2__)) */

#if ((defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X320__) || defined (__MMI_MAINLCD_240X240__) || defined (__MMI_MAINLCD_320X240__)) && defined(__MMI_TOUCH_DIAL_SCREEN__))
    gdi_layer_flatten_previous_to_base();
#endif /* ((defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X240__)) && defined(__MMI_TOUCH_DIAL_SCREEN__)) */
    gdi_layer_unlock_frame_buffer();

#if defined(__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__)
#if defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)
    dialing_keypad_is_emergency = MMI_FALSE;
#endif 

    dialing_keypad_call_handler = NULL;
#if defined(__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__)	\
	&& (!(defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__)))
    dialing_keypad_call2_handler = NULL;
#endif /* defined(__DUALMODE_TOUCH_DIAL_SCREEN_WITH_SLAVE_FUNCTION__) */
    dialing_keypad_phonebook_handler = NULL;
#ifdef __MMI_CAT_VIDEO_CALL__
    dialing_keypad_video_handler = NULL;
#endif /* __MMI_CAT_VIDEO_CALL__ */

#endif /* defined(__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__) */ 

#ifdef __MMI_SWFLASH__
    if ( GetCat34MediaType() == MMI_IDLE_BG_MEDIA_SWFLASH || wgui_cat016_is_set_swflash_layer == MMI_TRUE )
    {
        /* wgui_cat016_is_set_swflash_layer = MMI_TRUE means it has already set swflash layer and must reset when exit*/
        ExitCategorySWFlashScreen();
    }
	wgui_cat016_is_set_swflash_layer = MMI_FALSE;  /* reset paramter */
#endif /* __MMI_SWFLASH__ */ 
#ifdef __MMI_AVATAR__
    if ( GetCat34MediaType() == MMI_IDLE_BG_MEDIA_AVATAR )
    {
        ExitCategoryAvatarScreen();
    }
#endif /* __MMI_AVATAR__ */ 
}

#if defined(__MMI_UI_DIALER_PAD_ONLY_KEY__)

extern void cui_dialer_do_center_key_dial(void);

void dialer_input_dialer_pad_char()
{   
    U8 key_code = gui_dialer_pad_get_highlight();
    if((key_code != KEY_STAR)||((mmi_frm_is_scenario_started(MMI_SCENARIO_ID_IN_CALL))&&(key_code == KEY_STAR)))
    {
        mmi_frm_send_key_event(key_code, (U8)KEY_EVENT_DOWN);
        //gui_start_timer(100, dialer_input_picker_char_key_down);
        //key_flage = 1;
        mmi_frm_send_key_event(key_code, (U8)KEY_EVENT_UP);
    }
}

static mmi_ret wgui_cat16_BT_box_key_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_frm_key_evt_struct *key_evt = (mmi_frm_key_evt_struct *)evt;
    U8 key_code = key_evt->key_code;
    S32 i;
    U8 key_bt_code = gui_dialer_pad_get_highlight();
    U16 keyCode = 0,keyType = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(gui_dialer_pad_get_style() == GUI_DIALER_PAD_STYLE_VK_KEY)
    {
        if(!mmi_frm_is_scenario_started(MMI_SCENARIO_ID_IN_CALL)) 
        {
            if(key_bt_code == KEY_STAR)
            {
                if(key_evt->key_code == KEY_LSK)
                {
                    key_evt->key_code = KEY_STAR;
                    GetkeyInfo(&keyCode, &keyType);
                    keyCode = KEY_STAR;
                    mmi_frm_set_key_info(key_evt->key_code,keyType);

                    if(key_evt->key_type == KEY_EVENT_DOWN)
                    {
                    left_softkey_down();
                    }
                    else if(key_evt->key_type == KEY_EVENT_UP)
                    {
                    left_softkey_up();
                    }
                }
            }
        }
	    if(key_evt->evt_id == EVT_ID_PRE_KEY)
		{
		    if(!mmi_frm_is_scenario_started(MMI_SCENARIO_ID_IN_CALL))
                {
                SetLeftSoftkeyFunction(cui_dialer_do_center_key_dial, KEY_LONG_PRESS);
                }  
                SetLeftSoftkeyFunction(dialer_input_dialer_pad_char, KEY_EVENT_UP);
                gui_dialer_pad_register_key_hdlr();
        }
    }
	
    return MMI_RET_OK;
}
#endif

#if defined(__MMI_UI_DIALER_PAD__) && defined(__MMI_TOUCH_SCREEN__)

static mmi_ret wgui_cat16_BT_box_vk_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_frm_key_evt_struct *key_evt = (mmi_frm_key_evt_struct *)evt;
    U8 key_code = key_evt->key_code;
    U16 keyCode = 0,keyType = 0;	 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(gui_dialer_pad_get_style() == GUI_DIALER_PAD_STYLE_VK)
    {
            if(key_evt->evt_id == EVT_ID_PRE_KEY)//EVT_ID_POST_KEY)
            {
                if(key_evt->key_code == KEY_STAR)
                {
                    key_evt->key_code = KEY_F1;

                    GetkeyInfo(&keyCode, &keyType);
                    keyCode = KEY_F1;
                    mmi_frm_set_key_info(key_evt->key_code,keyType);
                }
            }
            else if(key_evt->evt_id == EVT_ID_POST_KEY)
            {
                if(key_evt->key_code == KEY_F1)
                {
                    key_evt->key_code = KEY_STAR;

                    GetkeyInfo(&keyCode, &keyType);
                    keyCode = KEY_STAR;
                    mmi_frm_set_key_info(key_evt->key_code,keyType);
                }
            }

    }
    return MMI_RET_OK;
}
#endif


/*****************************************************************************
 * FUNCTION
 *  ShowCategory16ScreenInternal
 * DESCRIPTION
 *  show original style category16 screen
 * PARAMETERS
 * left_softkey          [IN] Left softkey label
 * right_softkey         [IN] Right softkey label
 * Buffer                [IN] Message string
 * BufferLength          [IN] Length of buffer
 * history_buffer        [IN] History buffer
 * RETURNS
 *  void
 *****************************************************************************/
static void ShowCategory16ScreenInternal(
        UI_string_type left_softkey,
        UI_string_type right_softkey,
        U8 *Buffer,
        U32 BufferLength,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 s32flags;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if ((defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X320__) || defined (__MMI_MAINLCD_240X240__) || defined (__MMI_MAINLCD_320X240__)) && defined (__MMI_TOUCH_DIAL_SCREEN__) && !defined(__MMI_FTE_SUPPORT__))
    set_small_screen();
#endif /* ((defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X240__)) && defined (__MMI_TOUCH_DIAL_SCREEN__)) */

    gdi_layer_lock_frame_buffer();
    in_idle_screen();
#ifndef __MMI_WEARABLE_DEVICE__
	dm_add_softkey_str((UI_string_type)left_softkey, (UI_string_type)right_softkey);
#endif /*__MMI_WEARABLE_DEVICE__*/
#if defined(__MMI_SWFLASH__) || defined(__MMI_AVATAR__)
    SetupCat34Media(0xFFFF, NULL);
#endif

#if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
#if (((!defined ( __MMI_MAINLCD_128X128__ ) && !defined (__MMI_MAINLCD_128X160__)) && (defined (__GDI_MEMORY_PROFILE_2__) || defined (__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__))) && !defined(__MMI_UI_DALMATIAN_IDLESCREEN__))

    on_idle_screen = 1;
    set_on_idlescreen(1);
  #ifndef __MMI_TOUCH_DIAL_SCREEN__
    wgui_status_icon_bar_register_hide_callback(
        WGUI_STATUS_ICON_BAR_H_BAR, 
        idle_screen_hide_status_icons_bar0);
#ifdef WGUI_STATUS_ICON_SHOW_V_BAR
    wgui_status_icon_bar_register_hide_callback(
        WGUI_STATUS_ICON_BAR_V_BAR, 
        MMI_dummy_function);
#endif /*WGUI_STATUS_ICON_SHOW_V_BAR*/
  #endif /* __MMI_TOUCH_DIAL_SCREEN__ */ 
  #if defined(__OP01__)
    wgui_status_icon_bar_move(
        WGUI_STATUS_ICON_BAR_H_BAR,
        0,
        MMI_STATUS_BAR_IDLE_Y);
  #else /* defined(__OP01__) */
   #if !defined(__MMI_MAINLCD_176X220__) && !defined(__MMI_WEARABLE_DEVICE__)
    wgui_status_icon_bar_move(
        WGUI_STATUS_ICON_BAR_H_BAR,
        0,
        MMI_STATUS_BAR_IDLE_Y);
    #endif /* !defined(__MMI_MAINLCD_176X220__) */
   #endif
#ifndef __MMI_WEARABLE_DEVICE__
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
#endif

   #ifdef WGUI_STATUS_ICON_SHOW_V_BAR
    wgui_status_icon_bar_reset_display(WGUI_STATUS_ICON_BAR_V_BAR);
   #endif /*WGUI_STATUS_ICON_SHOW_V_BAR*/

#else /* (((!defined ( __MMI_MAINLCD_128X128__ ) && !defined (__MMI_MAINLCD_128X160__)) && defined (__GDI_MEMORY_PROFILE_2__)) && !defined(__MMI_UI_DALMATIAN_IDLESCREEN__)) */ 

  #ifndef __MMI_TOUCH_DIAL_SCREEN__
    set_main_LCD_dt_date_hide_function(CM_screens_hide_date_time_display);
    set_main_LCD_dt_time_hide_function(CM_screens_hide_date_time_display);
    set_dt_display(DT_MO_CALL_SCREEN);
  #endif /* __MMI_TOUCH_DIAL_SCREEN__ */ 

  #if (!defined(__MMI_MAINLCD_128X160__) || !defined(__MMI_TOUCH_DIAL_SCREEN__))
    ShowStatusIconsTitle();
  #endif

#endif /* (((!defined ( __MMI_MAINLCD_128X128__ ) && !defined (__MMI_MAINLCD_128X160__)) && defined (__GDI_MEMORY_PROFILE_2__)) && !defined(__MMI_UI_DALMATIAN_IDLESCREEN__)) */ 
#else /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
#ifdef __MMI_WEARABLE_DEVICE__
	wgui_status_icon_bar_reset_display(WGUI_STATUS_ICON_BAR_H_BAR);
#endif
#if ((!defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) && (defined(__GDI_MEMORY_PROFILE_2__) || defined (__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__))) && !defined(__MMI_UI_DALMATIAN_IDLESCREEN__))

#ifdef __MMI_TOUCH_DIAL_SCREEN__
  
    /* initialize dialing_keypad */
    wgui_inputs_dialer_setup_dialing_keypad(&dialing_keypad);
  #if defined(__MMI_TOUCH_DIAL_SCREEN_WITH_FUNCTION__) && (defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__) || defined(__MMI_DIALER_DYNAMIC_CALL_UI__))
    gui_set_dialing_emergency_func_key(dialing_keypad_is_emergency);
  #endif 

  #ifdef __MMI_TOUCH_SCREEN__
    entry_full_screen();
  #endif 
  #if defined(__MMI_MAINLCD_240X320__) && defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)
    wgui_status_icon_bar_register_hide_callback(
        WGUI_STATUS_ICON_BAR_H_BAR, 
        idle_screen_hide_status_icons_bar0);
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
  #endif
  #if defined (__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__)|| defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__) || defined(__MMI_FTE_SUPPORT__)
 
#ifdef __MMI_WEARABLE_DEVICE__ 
	{
		S32 x, y, w, h;
		U32 input_type;
	#if 1
		if(g_cat16_style == WGUI_CAT16_PIN_STYLE)
		{
			x = MMI_CAT16_PIN_STYLE_TITLE_X; 
			y = MMI_DIALING_BOX_Y + MMI_CAT16_PIN_STYLE_TITLE_HEIGHT;
			w = MMI_DIALING_BOX_WIDTH - MMI_CAT16_PIN_STYLE_TITLE_X; 
			h = MMI_DIALING_BOX_HEIGHT - MMI_CAT16_PIN_STYLE_TITLE_HEIGHT;
			input_type = IMM_INPUT_TYPE_NUMERIC_PASSWORD;

		}
		else
	#endif
		{
			x = MMI_DIALING_BOX_X; 
			y = MMI_DIALING_BOX_Y;
			w = MMI_DIALING_BOX_WIDTH; 
			h = MMI_DIALING_BOX_HEIGHT;
			input_type = IMM_INPUT_TYPE_KEYPAD_NUMERIC;
		}
	
	  #ifdef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
		wgui_inputs_ml_setup(
			x, 
			y,
			w, 
			h,
			(UI_buffer_type) Buffer,
			BufferLength,
			MMI_CATEGORY16_ID,
			right_softkey,
			0,
			IMM_INPUT_TYPE_NUMERIC,
			history_buffer,
			0);

	 #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
		wgui_inputs_sl_setup(
			x, 
			y,
			w, 
			h,
			(UI_buffer_type) Buffer,
			BufferLength,
			MMI_CATEGORY16_ID,
			0,
			0,
			IMM_INPUT_TYPE_KEYPAD_NUMERIC,
			history_buffer,
			0);
	  #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
	}
#else /*__MMI_WEARABLE_DEVICE__*/
	#ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputs_ml_setup(
		MMI_DIALING_BOX_X, 
		MMI_DIALING_BOX_Y,
		MMI_DIALING_BOX_WIDTH, 
		MMI_DIALING_BOX_HEIGHT,
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);
    #else /*__CAT16_MULTIEDITOR_STYLE__*/
    wgui_inputs_dialer_setup(
        MMI_DIALING_BOX_X,
        MMI_DIALING_BOX_Y,
        MMI_DIALING_BOX_WIDTH,
        MMI_DIALING_BOX_HEIGHT,
        (UI_buffer_type) Buffer,
        BufferLength,
        MMI_CATEGORY16_ID,
        right_softkey,
        0,
        history_buffer,
        0);
    #endif/*__CAT16_MULTIEDITOR_STYLE__*/
#endif /*__MMI_WEARABLE_DEVICE__*/
  #elif (defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X320__) || defined (__MMI_MAINLCD_240X240__) || defined (__MMI_MAINLCD_320X240__))
#ifdef __MMI_WEARABLE_DEVICE__ 
  #ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
	wgui_inputs_sl_setup(
		MMI_DIALING_KEYPAD_LAYER_X, 
		MMI_DIALING_KEYPAD_LAYER_Y - MMI_DIALING_BOX_HEIGHT,
		MMI_DIALING_KEYPAD_LAYER_WIDTH, 
		MMI_DIALING_BOX_HEIGHT,
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);
  #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
  	wgui_inputs_ml_setup(
		MMI_DIALING_KEYPAD_LAYER_X, 
		MMI_DIALING_KEYPAD_LAYER_Y - MMI_DIALING_BOX_HEIGHT,
		MMI_DIALING_KEYPAD_LAYER_WIDTH, 
		MMI_DIALING_BOX_HEIGHT,
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);
  #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
#else /*__MMI_WEARABLE_DEVICE__*/

	#ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputs_ml_setup(
		MMI_DIALING_KEYPAD_LAYER_X, 
		MMI_DIALING_KEYPAD_LAYER_Y - MMI_DIALING_BOX_HEIGHT,
		MMI_DIALING_KEYPAD_LAYER_WIDTH, 
		MMI_DIALING_BOX_HEIGHT,
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);
    #else /*__CAT16_MULTIEDITOR_STYLE__*/
    wgui_inputs_dialer_setup(
        MMI_DIALING_KEYPAD_LAYER_X,
        MMI_DIALING_KEYPAD_LAYER_Y - MMI_DIALING_BOX_HEIGHT,
        MMI_DIALING_KEYPAD_LAYER_WIDTH,
        MMI_DIALING_BOX_HEIGHT,
        (UI_buffer_type) Buffer,
        BufferLength,
        MMI_CATEGORY16_ID,
        right_softkey,
        0,
        history_buffer,
        0);
    #endif/*__CAT16_MULTIEDITOR_STYLE__*/
#endif /*__MMI_WEARABLE_DEVICE__*/

  #elif defined (__MMI_MAINLCD_176X220__)
    #ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputs_ml_setup(
		0, 
		MMI_status_bar_height,
		UI_device_width, 
		29,
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);
    #else/*__CAT16_MULTIEDITOR_STYLE__*/
    wgui_inputs_dialer_setup(
        0,
        MMI_status_bar_height,
        UI_device_width,
        29,
        (UI_buffer_type) Buffer,
        BufferLength,
        MMI_CATEGORY16_ID,
        right_softkey,
        0,
        history_buffer,
        0);
    #endif/*__CAT16_MULTIEDITOR_STYLE__*/
  #else /* defined (__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__) || defined(__MMI_FTE_SUPPORT__) */
    #ifdef __CAT16_MULTIEDITOR_STYLE__
	wgui_inputs_ml_setup(
		0, 
		0,
		UI_device_width, 
		MMI_DIALING_BOX_HEIGHT,
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);
    #else /*__CAT16_MULTIEDITOR_STYLE__ */
    wgui_inputs_dialer_setup(
        0,
        0,
        UI_device_width,
        MMI_DIALING_BOX_HEIGHT,
        (UI_buffer_type) Buffer,
        BufferLength,
        MMI_CATEGORY16_ID,
        right_softkey,
        0,
        history_buffer,
        0);
    #endif/*__CAT16_MULTIEDITOR_STYLE__*/
  #endif /* defined (__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__) || defined(__MMI_FTE_SUPPORT__) */

  #if defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__)|| defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__) || defined(__MMI_FTE_SUPPORT__)
	CM_set_wallpaper_on_bottom(MMI_TRUE);
    //wgui_softkey_set_filler_disabled(MMI_TRUE);
  #endif /* defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__) || defined(__MMI_FTE_SUPPORT__) */

#else /* __MMI_TOUCH_DIAL_SCREEN__ */ 

  #ifdef __MMI_BTD_BOX_UI_STYLE__
	#ifndef __MMI_TOUCH_SCREEN__
    wgui_inputs_dialer_setup_dialing_keypad_with_key();
	#endif  /*__MMI_TOUCH_SCREEN__*/
  #endif /*__MMI_BTD_BOX_UI_STYLE__ */

  #if (!defined ( __MMI_MAINLCD_128X128__ ) && !defined ( __MMI_MAINLCD_128X160__ ))

    #if defined(__MMI_OP12_CAT533_SUPPORT__) /* for Vodafone */
    CM_set_wallpaper_on_bottom(MMI_TRUE);
    #else
	#if !defined(__WGUI_CATE_FTE_KEY_ONLY__)
    CM_set_wallpaper_on_bottom(MMI_TRUE);
    disable_softkey_background();
    register_hide_left_softkey(dialing_screen_hide_left_softkey);
    register_hide_right_softkey(dialing_screen_hide_right_softkey);
	register_hide_softkey(dialing_screen_hide_center_softkey, MMI_CENTER_SOFTKEY);
	#else /* __WGUI_CATE_FTE_KEY_ONLY__ */
    CM_set_wallpaper_on_bottom(MMI_TRUE);
	#endif /* __WGUI_CATE_FTE_KEY_ONLY__ */
    #endif /* !defined(__MMI_OP12_CAT533_SUPPORT__) */ 

    { /* setup dialer inputbox */
        S32 x, y, w, h;

	#if !(defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__))
	    S32 img_w, img_h;
	
        gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_UP, &img_w, &img_h);
        y = MMI_CAT16_DIALING_BOX_BG_Y + img_h;
        w = img_w;
        
        gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_LEFT, &img_w, &img_h);
        x = MMI_CAT16_DIALING_BOX_BG_X + img_w;
        h = img_h;
        w -= img_w;

        gdi_image_get_dimension_id(IMG_DIALING_SCREEN_BG_RIGHT, &img_w, &img_h);
        w -= img_w;
	#else /* !(__MMI_SLIM_IMG_RES__ || __WGUI_CATE_FTE_KEY_ONLY__) */
	    x = MMI_CAT16_DIALING_BOX_BG_X + MMI_CAT16_DIALING_INPUT_BOX_OFFSET_X;
        y = MMI_CAT16_DIALING_BOX_BG_Y + MMI_CAT16_DIALING_INPUT_BOX_OFFSET_Y;
	    w = MMI_CAT16_DIALING_INPUT_BOX_WIDTH;
		h = MMI_CAT16_DIALING_INPUT_BOX_HEIGHT;
	#endif /* !(__MMI_SLIM_IMG_RES__ || __WGUI_CATE_FTE_KEY_ONLY__) */

	#ifdef __MMI_BTD_BOX_UI_STYLE__
	    x = MMI_DIALING_BOX_X;
        y = MMI_DIALING_BOX_Y;
	    w = MMI_DIALING_BOX_WIDTH;
		h = MMI_DIALING_BOX_HEIGHT;	   
    #endif
	
    #ifdef __CAT16_MULTIEDITOR_STYLE__
		wgui_inputs_ml_setup(
			x, y, w, h,
			(UI_buffer_type) Buffer,
			BufferLength,
			MMI_CATEGORY16_ID,
			right_softkey,
			0,
			IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
			history_buffer,
			0);
	}
    #else /*__CAT16_MULTIEDITOR_STYLE__*/
        wgui_inputs_dialer_setup(
            x, y, w, h,
            (UI_buffer_type) Buffer,
            BufferLength,
            MMI_CATEGORY16_ID,
            right_softkey,
            0,
            history_buffer,
            0);
    }
    wgui_dialer_inputbox_set_border(MMI_TRUE, UI_COLOR_BLACK);
    #endif /*__CAT16_MULTIEDITOR_STYLE__*/
  #else /* (!defined ( __MMI_MAINLCD_128X128__ ) && !defined ( __MMI_MAINLCD_128X160__ )) */
    CM_set_wallpaper_on_bottom(MMI_TRUE);
    #ifdef __CAT16_MULTIEDITOR_STYLE__	
	wgui_inputs_ml_setup(
		0, 
		main_LCD_dt_object.time.y + main_LCD_dt_object.time.height,
		UI_device_width, 
		UI_device_height - (MMI_button_bar_height + main_LCD_dt_object.time.y + main_LCD_dt_object.time.height),
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);		
    #else /* __CAT16_MULTIEDITOR_STYLE__ */
    wgui_inputs_dialer_setup(
        0,
        main_LCD_dt_object.time.y + main_LCD_dt_object.time.height,
        UI_device_width,
        UI_device_height - (MMI_button_bar_height + main_LCD_dt_object.time.y + main_LCD_dt_object.time.height),
        (UI_buffer_type) Buffer,
        BufferLength,
        MMI_CATEGORY16_ID,
        right_softkey,
        0,
        history_buffer,
        0);
    #endif /* __CAT16_MULTIEDITOR_STYLE__*/ 
  #endif /* (!defined ( __MMI_MAINLCD_128X128__ ) && !defined ( __MMI_MAINLCD_128X160__ )) */
#endif /* __MMI_TOUCH_DIAL_SCREEN__ */ 

#else /* ((!defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) && defined (__GDI_MEMORY_PROFILE_2__)) && !defined(__MMI_UI_DALMATIAN_IDLESCREEN__)) */
  #ifdef __CAT16_MULTIEDITOR_STYLE__	
	wgui_inputs_ml_setup(
		1, 
	#if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
	    main_LCD_dt_object.time.y + main_LCD_dt_object.time.height,
	#else /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
		MMI_status_bar_height + 3,
	#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
	    UI_device_width - 2, 
	#if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
	    UI_device_height - (MMI_button_bar_height + main_LCD_dt_object.time.y + main_LCD_dt_object.time.height),
	#else /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
		UI_device_height - MMI_status_bar_height - MMI_button_bar_height - 4,
	#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
		(UI_buffer_type) Buffer,
		BufferLength,
		MMI_CATEGORY16_ID,
		right_softkey,
		0,
		IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING,
		history_buffer,
		0);		
  #else/*__CAT16_MULTIEDITOR_STYLE__*/
    wgui_inputs_dialer_setup(
        1,
    #if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
        main_LCD_dt_object.time.y + main_LCD_dt_object.time.height,
    #else /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
		MMI_status_bar_height + 3,
	#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
        UI_device_width - 2,
    #if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
        UI_device_height - (MMI_button_bar_height + main_LCD_dt_object.time.y + main_LCD_dt_object.time.height),
    #else /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
	    UI_device_height - MMI_status_bar_height - MMI_button_bar_height - 4,
	#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
        (UI_buffer_type) Buffer,
        BufferLength,
        MMI_CATEGORY16_ID,
        right_softkey,
        0,
        history_buffer,
        0);
  #endif /*__CAT16_MULTIEDITOR_STYLE__*/
#endif /* ((!defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_96X64__) && defined (__GDI_MEMORY_PROFILE_2__)) && !defined(__MMI_UI_DALMATIAN_IDLESCREEN__)) */ 
#ifdef __MMI_WEARABLE_DEVICE__
  #ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
	MMI_singleline_inputbox.ext_flags |= GUI_SINGLE_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND;
	MMI_singleline_inputbox.flags |= UI_SINGLE_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW \
	                                 | UI_SINGLE_LINE_INPUT_BOX_NO_BORDER;
	 
	if(g_cat16_style == WGUI_CAT16_PIN_STYLE)
	{
		MMI_singleline_inputbox.flags |=  UI_SINGLE_LINE_INPUT_BOX_MASK_CHARACTERS;
		MMI_singleline_inputbox.normal_text_color = gui_color(255,255,255);
		MMI_singleline_inputbox.text_font = &MMI_large_font;
	}
	else
	{
		
		MMI_singleline_inputbox.flags |= UI_SINGLE_LINE_INPUT_BOX_RIGHT_JUSTIFY;
		MMI_singleline_inputbox.normal_text_color = gui_color(214,214,214);	
    	MMI_singleline_inputbox.text_font = gui_font_get_type(GUI_FONT_SIZE_DIALER_LARGE);

	}
  #else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

  	MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND \
								  | UI_MULTI_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW;  
  	MMI_multiline_inputbox.is_hide_floating_counter = MMI_TRUE;
	
  	if(g_cat16_style == WGUI_CAT16_PIN_STYLE)
	{ 
  		MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_RIGHT_JUSTIFY;
	    MMI_multiline_inputbox.normal_text_color = gui_color(255,255,255);
		MMI_multiline_inputbox.text_font = &MMI_medium_font;
		wgui_inputs_ml_set_mask(1);
  	}
	else
	{
   
	    MMI_multiline_inputbox.normal_text_color = gui_color(214,214,214);
		MMI_multiline_inputbox.text_font = gui_font_get_type(GUI_FONT_SIZE_DIALER_LARGE);
	}
    gui_inputs_set_transparent_background(MMI_TRUE);
	#ifdef __MMI_EDITOR_MULTILINE_DIALER_STYLE_SUPPORT__
	/* Set dialer style */
	
	wgui_inputs_ml_set_style((UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR|UI_MULTI_LINE_INPUT_BOX_AUTO_DISABLE_SCROLLBAR),
				(GUI_MULTI_LINE_INPUT_BOX_NONE_BORDER|GUI_MULTI_LINE_INPUT_BOX_SINGLINE_STYLE));
    #endif/*__MMI_EDITOR_MULTILINE_DIALER_STYLE_SUPPORT__*/
	if(g_cat16_style == WGUI_CAT16_DTMF_STYLE)
	{
		MMI_multiline_inputbox.ext_flags |= GUI_MULTI_LINE_INPUT_BOX_DIALER_STYLE;
	}
  #endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/
	mmi_imc_set_is_disable_candidate_box(KAL_TRUE);
  #ifdef __MMI_IME_INDICATOR_ON_STATUS_ICON_BAR__
    mmi_imui_close_ime_indicator();
  #endif /*__MMI_IME_INDICATOR_ON_STATUS_ICON_BAR__*/
  #ifdef __MMI_TOUCH_DIAL_SCREEN__
	mmi_imc_disable_virtual_keyboard();
    mmi_imc_disable_handwriting();
    #if defined(__MMI_COSMOS_KEYPAD_SUPPORT_VK__)
	mmi_imc_set_slider_status(OPEN);
    #endif /*__MMI_COSMOS_KEYPAD_SUPPORT_VK__*/
  #endif /* __MMI_TOUCH_DIAL_SCREEN__ */
	mmi_imc_set_fixed_input_box();
	
#else /*__MMI_WEARABLE_DEVICE__*/

#ifdef __CAT16_MULTIEDITOR_STYLE__
  #ifdef __MMI_FTE_SUPPORT__
	MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND;
    MMI_multiline_inputbox.is_hide_floating_counter = MMI_TRUE;
    MMI_multiline_inputbox.normal_text_color = gui_color(255,255,255);
    gui_inputs_set_transparent_background(MMI_TRUE);  
  #endif /*__MMI_FTE_SUPPORT__*/
  #ifdef __MMI_EDITOR_MULTILINE_DIALER_STYLE_SUPPORT__
	/* Set dialer style */
	wgui_inputs_ml_set_style((UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR|UI_MULTI_LINE_INPUT_BOX_PLUS_CHARACTER_HANDLING|UI_MULTI_LINE_INPUT_BOX_AUTO_DISABLE_SCROLLBAR),
				(GUI_MULTI_LINE_INPUT_BOX_DIALER_STYLE|GUI_MULTI_LINE_INPUT_BOX_NONE_BORDER));
  #endif/*__MMI_EDITOR_MULTILINE_DIALER_STYLE_SUPPORT__*/
	mmi_imc_set_is_disable_candidate_box(KAL_TRUE);
  #ifdef __MMI_IME_INDICATOR_ON_STATUS_ICON_BAR__
    mmi_imui_close_ime_indicator();
  #endif /*__MMI_IME_INDICATOR_ON_STATUS_ICON_BAR__*/
  #ifdef __MMI_TOUCH_DIAL_SCREEN__
	mmi_imc_disable_virtual_keyboard();
    mmi_imc_disable_handwriting();
    #if defined(__MMI_COSMOS_KEYPAD_SUPPORT_VK__)
	mmi_imc_set_slider_status(OPEN);
    #endif /*__MMI_COSMOS_KEYPAD_SUPPORT_VK__*/
  #endif /* __MMI_TOUCH_DIAL_SCREEN__ */
	mmi_imc_set_fixed_input_box();
#endif /*__CAT16_MULTIEDITOR_STYLE__*/

#if defined(__MMI_WALLPAPER_ON_BOTTOM__) && !defined(__MMI_TOUCH_DIAL_SCREEN__) && !defined ( __MMI_MAINLCD_128X160__ ) && !defined(__MMI_MAINLCD_128X128__)  && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
  #ifdef __CAT16_MULTIEDITOR_STYLE__
  #ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
	 MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND;
  #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
  #else /*__CAT16_MULTIEDITOR_STYLE__*/
    MMI_dialer_inputbox.background_filler = NULL;
  #endif /*__CAT16_MULTIEDITOR_STYLE__*/
#endif /*defined(__MMI_WALLPAPER_ON_BOTTOM__) && !defined(__MMI_TOUCH_DIAL_SCREEN__) && !defined ( __MMI_MAINLCD_128X160__ )*/

    if (IsSetCursorToFirst)
    {
    #ifndef __CAT16_MULTIEDITOR_STYLE__
       wgui_inputs_dialer_set_cursor_to_first();
    #else /*__CAT16_MULTIEDITOR_STYLE__*/
       wgui_inputs_ml_move_cursor_to_start();
	#endif /*__CAT16_MULTIEDITOR_STYLE__*/
    }
#endif /*__MMI_WEARABLE_DEVICE__*/

    gdi_layer_unlock_frame_buffer();

    gdi_layer_restore_base_active();
    gdi_layer_set_source_key(TRUE, GDI_COLOR_TRANSPARENT);

#if ((defined(__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X320__) || defined (__MMI_MAINLCD_240X240__) || defined(__MMI_MAINLCD_320X240__)) && defined(__MMI_TOUCH_DIAL_SCREEN__) && !defined(__MMI_FTE_SUPPORT__))
    CM_set_wallpaper_on_bottom(MMI_TRUE);
    #if defined(__MMI_MAINLCD_240X320__) && defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)
    gdi_layer_push_and_set_clip(0, MMI_STATUS_BAR_HEIGHT, MAIN_LCD_DEVICE_WIDTH - 1, MAIN_LCD_DEVICE_HEIGHT - 1);
    #else
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
    #endif
    gui_greyscale_rectangle(0, 0, MAIN_LCD_DEVICE_WIDTH - 1, MAIN_LCD_DEVICE_HEIGHT - 1, MMI_BG_GREYSCALE_VALUE, MMI_BG_GREYSCALE_BLACK_VALUE);
    #ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
    gdi_draw_solid_rect(
        MMI_DIALING_KEYPAD_LAYER_X,
        MMI_DIALING_KEYPAD_LAYER_Y,
        MMI_DIALING_KEYPAD_LAYER_X + MMI_DIALING_KEYPAD_LAYER_WIDTH - 1,
        MMI_DIALING_KEYPAD_LAYER_Y + MMI_DIALING_KEYPAD_LAYER_HEIGHT - 1,
        GDI_COLOR_TRANSPARENT);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
    gdi_layer_pop_clip();
#else /* ( (defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X240__)) && defined (__MMI_TOUCH_DIAL_SCREEN__) ) */ 
    gdi_layer_clear(GDI_COLOR_TRANSPARENT);
#endif /* ( (defined (__MMI_MAINLCD_240X320__) || defined (__MMI_MAINLCD_320X240__)) && defined (__MMI_TOUCH_DIAL_SCREEN__) ) */ 

    dm_register_category_controlled_callback(DrawCate16CategoryControlArea);
#if ((!defined( __MMI_MAINLCD_128X128__ ) && !defined (__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && (defined(__GDI_MEMORY_PROFILE_2__) || defined (__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__)))
    dm_register_category_controlled2_callback(DrawCate16CategoryControlArea2);
#endif /* ((!defined( __MMI_MAINLCD_128X128__ ) && !defined (__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)) && defined(__GDI_MEMORY_PROFILE_2__)) */

#if !defined(__MMI_TOUCH_DIAL_SCREEN__)
	s32flags = DM_SPECIFIC_HIDE_STATUS_BAR;
#else /* !defined(__MMI_TOUCH_DIAL_SCREEN__) */
  #if defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__)|| defined(__MMI_MAINLCD_360X640__) || defined(__MMI_MAINLCD_480X800__) || defined(__MMI_FTE_SUPPORT__)
	s32flags = DM_SET_AS_ABM_LAYER;
  #else /* defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__) || defined(__MMI_FTE_SUPPORT__) */
	s32flags = 0;
  #endif /* defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__) || defined(__MMI_FTE_SUPPORT__) */
#endif /* !defined(__MMI_TOUCH_DIAL_SCREEN__) */
#ifdef __MMI_WEARABLE_DEVICE__
	s32flags |= DM_NO_SOFTKEY | DM_NO_STATUS_BAR;
#endif /*__MMI_WEARABLE_DEVICE__*/

#if defined(__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__) && (defined(__MMI_MAINLCD_240X320__)||defined(__MMI_MAINLCD_176X220__)||defined(__MMI_MAINLCD_128X160__))
    gui_one_layer_regist_draw_filled_bg_area_func(CM_draw_dialing_screen_edit_bg);
#endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */

    wgui_cat_setup_category(MMI_CATEGORY16_ID, s32flags, ExitCategory16Screen, GetCategory16History, GetCategory16HistorySize);    

#if defined(__MMI_TOUCH_DIAL_SCREEN__)
    wgui_register_category_screen_control_area_pen_handlers(Cate16CategoryControlAreaPenDownHandler, MMI_PEN_EVENT_DOWN);
    wgui_register_category_screen_control_area_pen_handlers(Cate16CategoryControlAreaPenUpHandler, MMI_PEN_EVENT_UP);
    wgui_register_category_screen_control_area_pen_handlers(Cate16CategoryControlAreaPenMoveHandler, MMI_PEN_EVENT_MOVE);
    wgui_register_category_screen_control_area_pen_handlers(Cate16CategoryControlAreaPenRepeatHandler, MMI_PEN_EVENT_REPEAT);
    wgui_register_category_screen_control_area_pen_handlers(Cate16CategoryControlAreaPenLongTapHandler, MMI_PEN_EVENT_LONG_TAP);
    wgui_register_category_screen_control_area_pen_handlers(Cate16CategoryControlAreaPenAbortHandler, MMI_PEN_EVENT_ABORT);
  #if defined(__CAT16_MULTIEDITOR_STYLE__) || defined(__MMI_WEARABLE_DEVICE__)
    mmi_pen_register_abort_handler(wgui_general_pen_abort_hdlr);
    mmi_pen_register_down_handler(wgui_general_pen_down_hdlr);
    mmi_pen_register_long_tap_handler(wgui_general_pen_long_tap_hdlr);
    mmi_pen_register_move_handler(wgui_general_pen_move_hdlr);
    mmi_pen_register_up_handler(wgui_general_pen_up_hdlr);
    mmi_pen_register_repeat_handler(wgui_general_pen_repeat_hdlr);
  #endif /*__CAT16_MULTIEDITOR_STYLE__*/
#endif /* defined(__MMI_TOUCH_DIAL_SCREEN__) */ 

#if defined(__MMI_UI_DIALER_PAD_ONLY_KEY__)
    if(gui_dialer_pad_get_style() == GUI_DIALER_PAD_STYLE_VK_KEY)
    {
        SetLeftSoftkeyFunction(dialer_input_dialer_pad_char, KEY_EVENT_UP);
        MMI_CAT_SET_KEY_PROC(wgui_cat16_BT_box_key_proc, NULL);
        set_left_softkey_label((UI_string_type)GetString(STR_GLOBAL_OK));
        if(!mmi_frm_is_scenario_started(MMI_SCENARIO_ID_IN_CALL))
        {  
        	gui_multi_line_input_box_set_default_text(&MMI_multiline_inputbox, (UI_string_type)GetString(STR_DIALER_PAD_LONG_PRESS_TO_DIAL));
        } 

        if(2 == MMI_multiline_inputbox.text_length)
        {   
             wgui_inputs_ml_disable();
             MMI_multiline_inputbox.text_font = gui_font_get_type(GUI_FONT_SIZE_LIST);
        }
}
#endif

#if  defined(__MMI_UI_DIALER_PAD__) && defined(__MMI_TOUCH_SCREEN__)
    if(gui_dialer_pad_get_style() == GUI_DIALER_PAD_STYLE_VK)
    {
        MMI_CAT_SET_KEY_PROC(wgui_cat16_BT_box_vk_proc, NULL);
    }
#endif

    dm_redraw_category_screen();

#if defined(__MMI_SWFLASH__) || defined(__MMI_AVATAR__)
    HandleCat34MediaPlayFailed();
#endif /* defined(__MMI_SWFLASH__) || defined(__MMI_AVATAR__) */


#ifdef __MMI_WEARABLE_DEVICE__ 

	if(g_cat16_style == WGUI_CAT16_PIN_STYLE)
	{  
		S32 width, height;

		gdi_layer_push_and_set_clip(0, 0, UI_device_width,  MMI_DIALING_KEYPAD_Y);
		gdi_draw_solid_rect(0, 0, UI_device_width,  MMI_DIALING_KEYPAD_Y -1 , gdi_act_color_from_rgb(255, 0, 0, 0));//25,26,31
		gdi_layer_pop_clip();

		gui_push_text_clip();
		gui_set_text_color(gui_color(255, 255, 255));
		gui_set_font(&MMI_medium_font);
		
		gui_move_text_cursor(MMI_CAT16_PIN_STYLE_TITLE_X, MMI_CAT16_PIN_STYLE_TITLE_X);
		gui_print_text(g_cat16_pin_title_str);
		gui_pop_text_clip();
	
#ifndef __MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__
		
		wgui_inputs_sl_move(MMI_CAT16_PIN_STYLE_TITLE_X , MMI_DIALING_BOX_Y + MMI_CAT16_PIN_STYLE_TITLE_HEIGHT + 1);
		wgui_inputs_sl_resize(MMI_DIALING_BOX_WIDTH - MMI_CAT16_PIN_STYLE_TITLE_X, MMI_DIALING_BOX_HEIGHT - MMI_CAT16_PIN_STYLE_TITLE_HEIGHT);
		wgui_inputs_sl_redraw();

#else /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

		wgui_inputs_ml_move(MMI_CAT16_PIN_STYLE_TITLE_X , MMI_DIALING_BOX_Y + MMI_CAT16_PIN_STYLE_TITLE_HEIGHT + 1);
		wgui_inputs_ml_resize(MMI_DIALING_BOX_WIDTH - MMI_CAT16_PIN_STYLE_TITLE_X, MMI_DIALING_BOX_HEIGHT - MMI_CAT16_PIN_STYLE_TITLE_HEIGHT);
		wgui_inputs_ml_redraw();
		
#endif /*__MMI_MULTILINE_INPUT_BOX_SINGLINE_STYLE_WITH_FTE__*/

	}


#endif/*__MMI_WEARABLE_DEVICE__*/


}


/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory16Screen_int(
        U16 left_softkey,
        U16 right_softkey,
        U8 *Buffer,
        U32 BufferLength,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_WEARABLE_DEVICE__
#ifdef __MMI_ANIMATED_DIAL__
    ShowCategory631Screen(
        left_softkey,
        0,
        right_softkey,
        0,
        Buffer,
        BufferLength,
        history_buffer);
    return;
#elif defined (__MMI_MOTION_DIAL__)
    ShowCategory633Screen(
        (UI_string_type)GetString(left_softkey), 
        0,       
        (UI_string_type)GetString(right_softkey),
        0, 
        Buffer,
        BufferLength,
        history_buffer);
#else /* __MMI_ANIMATED_DIAL__ */
    ShowCategory16ScreenInternal(
	    (UI_string_type)GetString(left_softkey), 
	    (UI_string_type)GetString(right_softkey),
	    Buffer,
	    BufferLength,
	    history_buffer);
#endif /* __MMI_ANIMATED_DIAL__ */
#else /*__MMI_WEARABLE_DEVICE__*/
	g_cat16_style = WGUI_CAT16_NORMAL_STYLE;
	ShowCategory16ScreenInternal(
		(UI_string_type)GetString(left_softkey), 
		(UI_string_type)GetString(right_softkey),
		Buffer,
		BufferLength,
		history_buffer);

#endif /*__MMI_WEARABLE_DEVICE__*/
}

#ifdef __MMI_WEARABLE_DEVICE__

/*****************************************************************************
 * FUNCTION
 *  ShowCategory16Screen_for_dtmf
 * DESCRIPTION
 *  show DMTF style category16 screen
 * PARAMETERS
 * left_softkey          [IN] Left softkey label
 * left_softkey_icon     [IN] Left softkey icon
 * right_softkey         [IN] Right softkey label
 * right_softkey_icon    [IN] Right softkey icon
 * Buffer                [IN] input buffer
 * BufferLength          [IN] Length of buffer
 * history_buffer        [IN] History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void ShowCategory16Screen_for_dtmf(
        U16 left_softkey,
        U16 left_softkey_icon,
        U16 right_softkey,
        U16 right_softkey_icon,
        U8 *Buffer,
        U32 BufferLength,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	g_cat16_style = WGUI_CAT16_DTMF_STYLE;
	ShowCategory16ScreenInternal(
		(UI_string_type)GetString(left_softkey), 
		(UI_string_type)GetString(right_softkey),
		Buffer,
		BufferLength,
		history_buffer);
}

/*****************************************************************************
 * FUNCTION
 *  ShowCategory16Screen_for_pin
 * DESCRIPTION
 *  show DMTF style category16 screen
 * PARAMETERS
 * left_softkey          [IN] Left softkey label
 * right_softkey         [IN] Right softkey label
 * Buffer                [IN] input buffer
 * BufferLength          [IN] Length of buffer
 * history_buffer        [IN] History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void ShowCategory16Screen_for_pin(
		U16 *title_str,
        U16 left_softkey,
        U16 right_softkey,
        U8 *Buffer,
        U32 BufferLength,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	g_cat16_style = WGUI_CAT16_PIN_STYLE;
	g_cat16_pin_title_str = title_str;
	ShowCategory16ScreenInternal(
		(UI_string_type)GetString(left_softkey), 
		(UI_string_type)GetString(right_softkey),
		Buffer,
		BufferLength,
		history_buffer);
}

#endif /*__MMI_WEARABLE_DEVICE__*/

/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory17Screen_int(
        U16 title_id,
        U16 left_softkey,
        U16 right_softkey,
        U16 NotificationStringId,
        PU8 NameOrNumber,
        PU8 IP_Number,
        U16 CallLine,
        U16 default_image_id,
        U16 resource_id,
        CHAR* resource_filename,
        wgui_cate_momt_res_type_enum resource_type,
        U16 repeat_count,
        BOOL is_visaul_update,
        BOOL is_aud_enable,
        BOOL is_play_aud_when_start,
        PU8 history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_set_curr_scr_blt_mode(MMI_FRM_SCR_BLT_IMMEDIATE);
#if defined(__MMI_FTE_SUPPORT__)
    ShowMOMTCallScreen_FTE(
#elif defined(WGUI_CATCALL_STYLE_2)
    ShowMOMTCallScreen_2(
#else /* defined(WGUI_CATCALL_STYLE_2) */
    ShowMOMTCallScreen(
#endif /* defined(WGUI_CATCALL_STYLE_2) */
            title_id,
            left_softkey,
            0,
            right_softkey,
            0,
            NotificationStringId,
            NameOrNumber,
            IP_Number,
            CallLine,
            default_image_id,
            resource_id,
            resource_filename,
            resource_type,
            repeat_count,
            is_visaul_update,
            is_aud_enable,
            is_play_aud_when_start,
            history_buffer);
}


/* For detail description, please refer to wgui_categories_CM.h */
MMI_BOOL wgui_cat017_is_media_played(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
    {
        if (cat_momt_is_video_open && cat_momt_is_video_play)
        {
            return MMI_TRUE;
        }
    }
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_SWFLASH__)
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID))
        {
            if (cat_momt_is_swflash_open && cat_momt_is_swflash_play)
            {
                return MMI_TRUE;
            }
        }
#endif /* defined(__MMI_SWFLASH__) */

    return MMI_FALSE;
}


/* For detail description, please refer to wgui_categories_CM.h */
void StopCategory17Video(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
    if (cat_momt_is_video_open && cat_momt_is_video_play)
    {
        /* stop video playing */
        mdi_video_ply_stop();
        cat_momt_is_video_play = FALSE;
    }
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 
}


/* For detail description, please refer to wgui_categories_CM.h */
void DisableCategory17Audio(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!cat_momt_is_show_default)
    {
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
        {
        #ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
            if (cat_momt_is_video_open && cat_momt_is_video_play)
            {
				MomtSetMute(MMI_TRUE);
            }
        #endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 
        }
        else if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE) ||
                 (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID))
        {
        #ifdef __MMI_SWFLASH__
            if (cat_momt_is_swflash_open && cat_momt_is_swflash_play)
            {
                MomtSetMute(MMI_TRUE);
            }
        #endif /* __MMI_SWFLASH__ */ 
        }

    }

}


/* For detail description, please refer to wgui_categories_CM.h */
void EnableCategory17Audio(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!cat_momt_is_show_default)
    {
    	#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
        {
        
            if (cat_momt_is_video_open && cat_momt_is_video_play)
            {
				MomtSetMute(MMI_FALSE);
            }
        
        }
		#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 
		#ifdef __MMI_SWFLASH__
        else if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE) ||
                 (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID))
        {
        
            if (cat_momt_is_swflash_open && cat_momt_is_swflash_play)
            {
               MomtSetMute(MMI_FALSE);
            }
        
        }
		 #endif /* __MMI_SWFLASH__ */
    }
}


/* For detail description, please refer to wgui_categories_CM.h */
MMI_BOOL IsCategory17VideoValid(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
    if (cat_momt_is_video_open && cat_momt_is_video_play)
    {
        return MMI_TRUE;
    }
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 

    return MMI_FALSE;
}


/* For detail description, please refer to wgui_categories_CM.h */
MMI_BOOL IsCategory17AvatarValid(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_AVATAR__
    if (cat_momt_is_avatar_play)
    {
        return MMI_TRUE;
    }
#endif /* __MMI_AVATAR__ */ 

    return MMI_FALSE;
}


/* For detail description, please refer to wgui_categories_CM.h */
MMI_BOOL IsCategory17SWFlashValid(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_SWFLASH__
    if (cat_momt_is_swflash_open && cat_momt_is_swflash_play)
    {
        return MMI_TRUE;
    }
#endif /* __MMI_SWFLASH__ */ 

    return MMI_FALSE;
}


/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory18Screen(
        U16 title_id,
        U16 left_softkey,
        U16 left_softkey_icon,
        U16 right_softkey,
        U16 right_softkey_icon,
        U16 NotificationStringId,
        PU8 NameOrNumber,
        PU8 IP_Number,
        U16 CallLine,
        U16 image_id,
        CHAR* image_filename,
        MMI_BOOL isDisconnecting,
        PU8 history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 id = 0;
    CHAR* filename = NULL;
    wgui_cate_momt_res_type_enum type = WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    isCallDisconnecting = isDisconnecting;

    if (image_filename)
    {
        //id = 0;
        filename = image_filename;
        type = WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE;
    }
    else
    {
        id = image_id;
        //filename = NULL;
        //type = WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID;
    }

#if defined(__MMI_FTE_SUPPORT__)
    ShowMOMTCallScreen_FTE(
#elif defined(WGUI_CATCALL_STYLE_2)
    ShowMOMTCallScreen_2(
#else
    ShowMOMTCallScreen(
#endif
        title_id,
        left_softkey,
        left_softkey_icon,
        right_softkey,
        right_softkey_icon,
        NotificationStringId,
        NameOrNumber,
        IP_Number,
        CallLine,
        image_id,
        id,
        filename,
        type,
        0,
        FALSE,
        FALSE,
        FALSE,
        history_buffer);
}


MMI_BOOL CM_call_cost_show = MMI_FALSE;
/*****************************************************************************
 * FUNCTION
 *  Cat19_hide_fixed_list
 * DESCRIPTION
 *  hide the fixed list of category 19
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void Cat19_hide_fixed_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (MMI_fixed_list_menu.normal_filler->gc)
    {
        S32 x1 = MMI_fixed_list_menu.x + 2;
        S32 y1 = MMI_fixed_list_menu.y + 2;
        S32 x2 = x1 + MMI_fixed_list_menu.width - 8;
        S32 y2 = y1 + MMI_fixed_list_menu.height - 7;

        gdi_layer_push_clip();
        gdi_layer_reset_clip();
        gui_gradient_fill_rectangle(x1, y1, x2, y2, MMI_fixed_list_menu.normal_filler->gc, UI_GRADIENT_COLOR_VERTICAL);
        gdi_layer_pop_clip();
    }
    else
    {
        gdi_layer_push_clip();
        gdi_layer_set_clip(
            MMI_fixed_list_menu.x,
            MMI_fixed_list_menu.y,
            MMI_fixed_list_menu.x + MMI_fixed_list_menu.width - 1,
            MMI_fixed_list_menu.y + MMI_fixed_list_menu.height - 1);
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
        gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, current_MMI_theme->CM_screen_background_filler);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
        gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
        gdi_layer_pop_clip();
    }
}


/*****************************************************************************
 * FUNCTION
 *  RedrawCategory19Screen
 * DESCRIPTION
 *  Redraw function of category19
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawCategory19Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    UI_filled_area *f = current_MMI_theme->CM_screen_background_filler;
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
    U8 aoc_flag;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_clip();
    gdi_layer_reset_clip();

#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, f);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

#ifndef __MMI_CM_SCREEN_HIDE_DATE_TIME__
    CM_screens_draw_date_time_bar();
    show_main_LCD_dt_display();
#endif /* __MMI_CM_SCREEN_HIDE_DATE_TIME__ */ 

#ifdef __MMI_CALLSET_CTD_CONFIGURABLE__
    if (!(MMI_FALSE == srv_callset_call_time_display_get_mode()))
#endif
    {
        CM_screens_draw_duration_bar();
    }

    show_main_LCD_dt_display();

    /* call cost*/
#ifdef __MMI_TELEPHONY_SUPPORT__
    aoc_flag = (U8) mmi_ucm_get_show_aoc();
    if (aoc_flag)
    {
        CM_call_cost_show = MMI_TRUE;
        redraw_call_cost_UI();
    }
    else
    {
        CM_call_cost_show = MMI_FALSE;
        reset_call_cost_UI();
    }
#endif /* __MMI_TELEPHONY_SUPPORT__ */
    show_fixed_list();

    gdi_layer_pop_clip();
}


/*****************************************************************************
 * FUNCTION
 *  DrawCate19CategoryControlArea
 * DESCRIPTION
 *  Show control area of category19
 * PARAMETERS
 *  coordinate      [IN]     area to redraw
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate19CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    RedrawCategory19Screen();
}


/*****************************************************************************
 * FUNCTION
 *  Cat19_list_highlight_handler
 * DESCRIPTION
 *  highlight handler for category19
 * PARAMETERS
 *  item_index      [IN]        Index of item highlighted.
 * RETURNS
 *  void
 *****************************************************************************/
void Cat19_list_highlight_handler(S32 item_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_title_set_menu_shortcut_number(item_index + 1);
//huking	
///TODO: maybe no need, can be removed directly!!!	
#ifdef __MMI_SMS_APP_EMS_SUPPORT__	
    MMI_highlighted_item_text = get_item_text(item_index);
#endif/*__MMI_SMS_APP_EMS_SUPPORT__*/
	MMI_user_highlight_handler_Ext((U8)eListhighlight, item_index);
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory19HistorySize
 * DESCRIPTION
 *  Gets the size of the history buffer for the Active calls screen
 * PARAMETERS
 *  void
 * RETURNS
 *  size of history buffer in U8s
 *****************************************************************************/
static S32 GetCategory19HistorySize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (sizeof(list_menu_category_history));
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory19History
 * DESCRIPTION
 *  Gets the history buffer for the Active_calls screen
 * PARAMETERS
 *  history_buffer      [IN]        Is the buffer into which the history data is stored (pre-allocated)
 * RETURNS
 *  pointer to the history buffer
 *****************************************************************************/
static U8 *GetCategory19History(U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    get_list_menu_category_history(MMI_CATEGORY19_ID, history_buffer);
    return (history_buffer);
}


/*****************************************************************************
 * FUNCTION
 *  ExitCategory19Screen
 * DESCRIPTION
 *  Exits the Active_call screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void ExitCategory19Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();
    close_main_LCD_dt_display();
    wgui_status_icon_bar_reset();
    reset_softkeys();
    //reset_menu_shortcut_handler();
    MMI_fixed_list_menu.flags &= ~(UI_LIST_MENU_DISABLE_BACKGROUND | UI_LIST_MENU_DISABLE_SCROLLBAR);
    _MMI_hide_fixed_list_menu = UI_dummy_function;
    reset_fixed_list();
    gdi_layer_unlock_frame_buffer();
#if defined (__MMI_TOUCH_SCREEN__) && !defined(__MMI_WGUI_DISABLE_CSK__)
    ResetCenterSoftkey();
#endif /*defined (__MMI_TOUCH_SCREEN__) && !defined(__MMI_WGUI_DISABLE_CSK__)*/
}


/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory19Screen(
        U16 left_softkey,
        U16 left_softkey_icon,
        U16 right_softkey,
        U16 right_softkey_icon,
        S32 number_of_calls,
        U8 **CallList,
        U16 *CallLines,
        U16 *CallStates,
        MYTIME *CurrCallTime,
        S32 highlighted_item,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i, text_width, icon_position;
    S32 w, h, temp_w, temp_h;
    U8 *img = NULL;
    U8 calllines_no_display = 1;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    entry_full_screen();
    gdi_layer_lock_frame_buffer();
	dm_add_softkey_id((MMI_STR_ID)left_softkey, (MMI_STR_ID)right_softkey);
#if (defined __MMI_TOUCH_SCREEN__) && !defined(__MMI_WGUI_DISABLE_CSK__)
    EnableCenterSoftkey(0, IMG_CSK_DIAL_ICON);
#endif /*defined (__MMI_TOUCH_SCREEN__) && !defined(__MMI_WGUI_DISABLE_CSK__)*/

    set_main_LCD_dt_date_hide_function(CM_screens_hide_date_time_display);
    set_main_LCD_dt_time_hide_function(CM_screens_hide_date_time_display);
#ifdef __MMI_CALLSET_CTD_CONFIGURABLE__
    if (!(MMI_FALSE == srv_callset_call_time_display_get_mode()))
#endif
    {
        set_main_LCD_dt_duration_hide_function(CM_screens_hide_duration_display);
    }

    //set_dt_duration(CurrCallTime);
    set_duration_start_time(CurrCallTime);
    set_dt_display(DT_ACTIVE_CALL_SCREEN);

    ShowStatusIconsTitle();

    for (i = 0; i < number_of_calls; i++)
    {
        if (CallLines[i] != 0)
        {
            calllines_no_display = 0;
            break;
        }
    }
    if (calllines_no_display)
    {
        wgui_fixed_list_create_multi_icontext_menu(
            1,
            1, 
            number_of_calls, 
            highlighted_item, 
            MMI_MENUITEM_HEIGHT, 
            0,
            MMI_CATEGORY19_ID,
            history_buffer);
    }
    else
    {
        wgui_fixed_list_create_multi_icontext_menu(
            2,
            1, 
            number_of_calls, 
            highlighted_item, 
            MMI_MENUITEM_HEIGHT, 
            0,
            MMI_CATEGORY19_ID,
            history_buffer);
    }

    img = (U8*) GetImage(CallStates[0]);
    gui_measure_image(img, &w, &h);
    for (i = 1; i < number_of_calls; i++)
    {
        img = (U8*) GetImage(CallStates[i]);
        gui_measure_image(img, &temp_w, &temp_h);
        if (temp_w > w)
        {
            w = temp_w;
        }
        if (temp_h > h)
        {
            h = temp_h;
        }
    }

    if (w > MMI_MENUITEM_HEIGHT)
    {
        w = MMI_MENUITEM_HEIGHT;
    }
    if (h > MMI_MENUITEM_HEIGHT)
    {
        h = MMI_MENUITEM_HEIGHT;
    }

    if (calllines_no_display)
    {
        text_width = UI_device_width - w - GUI_TEXT_MENUITEM_TEXT_X - 2;
        set_fixed_icontext_list_text_coordinates(0, GUI_TEXT_MENUITEM_TEXT_X, 0, text_width, MMI_MENUITEM_HEIGHT);

        icon_position = GUI_TEXT_MENUITEM_TEXT_X + text_width;
        set_fixed_icontext_list_icon_coordinates(0, icon_position, 0, w, h);
    }
    else
    {
        icon_position = GUI_ICONTEXT_MENUITEM_ICON_X;
        set_fixed_icontext_list_icon_coordinates(0, icon_position, 0, w, h);

        text_width = UI_device_width - GUI_ICONTEXT_MENUITEM_TEXT_X - w - 2;
        set_fixed_icontext_list_text_coordinates(0, GUI_ICONTEXT_MENUITEM_TEXT_X, 0, text_width, MMI_MENUITEM_HEIGHT);

        icon_position = UI_device_width - 1 - w;
        set_fixed_icontext_list_icon_coordinates(1, icon_position, 0, w, h);
    }

    wgui_fixed_list_override_icontext_shortcut_handler(Cat19_list_highlight_handler);

    MMI_fixed_icontext_list_menuitem.flags &= ~UI_MENUITEM_MARQUEE_SCROLL;
    MMI_fixed_icontext_list_menuitem.flags |= UI_MENUITEM_TRUNCATE_CONTENT;

    wgui_fixed_list_begin_add_multi_icontext_one_item();

    if (calllines_no_display)
    {
        for (i = 0; i < number_of_calls; i++)
        {
            U8* icons[1];
			U8* items[1];
            items[0] = CallList[i];
            icons[0] = get_image(CallStates[i]);
            wgui_fixed_list_add_multi_icontext_one_item(i, items, icons, NULL);
        }
    }
    else
    {
        for (i = 0; i < number_of_calls; i++)
        {
            U8 *icons[2];
			U8 *items[1];
            items[0] = CallList[i];
            icons[0] = get_image(CallLines[i]);
            icons[1] = get_image(CallStates[i]);
            wgui_fixed_list_add_multi_icontext_one_item(i, items, icons, NULL);
        }
    }

    wgui_fixed_list_end_add_multi_icontext_one_item();

#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    MMI_fixed_list_menu.flags |= (UI_LIST_MENU_DISABLE_BACKGROUND | UI_LIST_MENU_DISABLE_SCROLLBAR);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    MMI_fixed_list_menu.flags |= (UI_LIST_MENU_DISABLE_SCROLLBAR);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
    register_hide_fixed_list(Cat19_hide_fixed_list);

    wgui_fixed_list_resize_multi_icontext_menu(
        UI_device_width,
        UI_device_height - MMI_button_bar_height - (main_LCD_dt_object.duration.y + main_LCD_dt_object.duration.height));

    wgui_fixed_list_move_multi_icontext_menu(0, UI_device_height - MMI_button_bar_height - MMI_fixed_list_menu.height);

    gdi_layer_unlock_frame_buffer();

	wgui_cat_setup_category(MMI_CATEGORY19_ID, 0, ExitCategory19Screen, GetCategory19History, GetCategory19HistorySize);
    dm_register_category_controlled_callback(DrawCate19CategoryControlArea);
    dm_redraw_category_screen();
}


/*****************************************************************************
 * FUNCTION
 *  DrawCMImageBackground
 * DESCRIPTION
 *  This function is used to draw the background of the calling image in MO/MT
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawCMImageBackground(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    gui_draw_filled_area(
        0,
        UI_device_height - MMI_BUTTON_BAR_HEIGHT - MMI_CM_MAX_IMG_HEIGHT,
        UI_device_width - 1,
        UI_device_height - MMI_BUTTON_BAR_HEIGHT - 1,
        current_MMI_theme->CM_screen_background_filler);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
}


#if defined(__MMI_CATEGORY_CM_SCANLINE__)
extern UI_filled_area* dm_get_current_scr_bg_filler(void);
/*****************************************************************************
 * FUNCTION
 *  DrawMOMTBackground_scanline
 * DESCRIPTION
 *  This function is used to draw the background of the calling image in MO/MT for scanline
 * PARAMETERS
 *  x1	[IN]
 *  y1	[IN]
 *  x2	[IN]
 *  y2	[IN]
 *  flag	[IN]		whether set clip region
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawMOMTBackground_scanline(S32 x1, S32 y1, S32 x2, S32 y2, MMI_BOOL flag)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (flag == MMI_TRUE)
    {
        gdi_layer_push_clip();
        gdi_layer_set_clip(x1, y1, x2, y2);
        gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, gdi_layer_get_background());
        gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, dm_get_current_scr_bg_filler());
        gdi_layer_pop_clip();
    }
    else
    {
        gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, gdi_layer_get_background());
        gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, dm_get_current_scr_bg_filler());
    }
}


GDI_HANDLE MOMTStatusIconLayer = GDI_NULL_HANDLE;
/*****************************************************************************
 * FUNCTION
 *  DrawMOMTStatusIconBg_scanline
 * DESCRIPTION
 *  This function is used to draw the background of StatusIcon in MO/MT for scanline
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawMOMTStatusIconBg_scanline(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_multi_layer_enable();
	CM_set_wallpaper_on_bottom(MMI_TRUE);
    
    /* create layer */
    dm_create_layer(0, 0, UI_device_width, UI_device_height/2, &MOMTStatusIconLayer, DM_LAYER_BOTTOM);
    MMI_ASSERT(MOMTStatusIconLayer);
    
    /* draw layer */
    gdi_set_alpha_blending_source_layer(MOMTStatusIconLayer);
    gdi_layer_push_and_set_active(MOMTStatusIconLayer);
    gdi_layer_set_source_key(TRUE, GDI_COLOR_TRANSPARENT);
    gdi_layer_clear(GDI_COLOR_TRANSPARENT);
    DrawMOMTBackground_scanline(0, 0, 0, 0, MMI_FALSE);
    gdi_layer_pop_and_restore_active();	

    wgui_status_icon_bar_set_alpha_blend_layer(
		WGUI_STATUS_ICON_BAR_H_BAR, 
		MOMTStatusIconLayer);
}


/*****************************************************************************
 * FUNCTION
 *  MOMT_hide_left_softkey_scanline
 * DESCRIPTION
 *  Left softkey hide function of MOMT for scanline.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void MOMT_hide_left_softkey_scanline(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawMOMTBackground_scanline(
        MMI_left_softkey.x,
        MMI_left_softkey.y,
        MMI_left_softkey.x + MMI_left_softkey.width + 2,
        MMI_left_softkey.y + MMI_left_softkey.height + 2,
        MMI_TRUE);
}


/*****************************************************************************
 * FUNCTION
 *  MOMT_hide_right_softkey_scanline
 * DESCRIPTION
 *  Right softkey hide function of MOMT for scanline.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void MOMT_hide_right_softkey_scanline(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawMOMTBackground_scanline(
        MMI_right_softkey.x,
        MMI_right_softkey.y,
        MMI_right_softkey.x + MMI_right_softkey.width + 2,
        MMI_right_softkey.y + MMI_right_softkey.height + 2,
        MMI_TRUE);
}


/*****************************************************************************
 * FUNCTION
 *  MOMT_hide_center_softkey_scanline
 * DESCRIPTION
 *  Center softkey hide function of MOMT for scanline.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void MOMT_hide_center_softkey_scanline(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DrawMOMTBackground_scanline(
        MMI_center_softkey.x,
        MMI_center_softkey.y,
        MMI_center_softkey.x + MMI_center_softkey.width + 2,
        MMI_center_softkey.y + MMI_center_softkey.height + 2,
        MMI_TRUE);
}

#endif /* __MMI_CATEGORY_CM_SCANLINE__ */


#if defined(WGUI_CATCALL_STYLE_2)
/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory20Screen_int(
        U16 left_softkey,
        U16 right_softkey,
        U8 *CallType,
        U8 *NameOrNumber,
        MYTIME *CallDuration,
        U16 CallLine,
        U16 CallState,
        WGUI_CATCALL_CALLER_MEDIA_INFO *CallerMedia,
        MMI_BOOL isDisconnecting,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 resource_id = 0;
    CHAR* resource_filename = NULL;
    wgui_cate_momt_res_type_enum resource_type = WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CALLSET_CTD_CONFIGURABLE__
    if (srv_callset_call_time_display_get_mode())
#endif
    {
        g_wgui_catcall_display_duration = MMI_TRUE;
        g_wgui_catcall_duration = CallDuration;
    }

    g_wgui_catcall_calltype = CallType;

    if (CallerMedia)
    {
        MMI_ASSERT((CallerMedia->resource_type == WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID) ||
                   (CallerMedia->resource_type == WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE));
        resource_id = CallerMedia->resource_id;
        resource_filename = CallerMedia->resource_filename;
        resource_type = CallerMedia->resource_type;
    }

    ShowMOMTCallScreen_2(0,
        left_softkey, 0,
        right_softkey, 0,
        0, NameOrNumber, NULL,
        CallLine,
        CallState, resource_id, resource_filename,
        resource_type,
        0, FALSE, FALSE, FALSE,
        history_buffer);
}
#endif /* defined(WGUI_CATCALL_STYLE_2) */


#if !defined(WGUI_CATCALL_STYLE_2)
/*****************************************************************************
 * FUNCTION
 *  RedrawCategory20Screen
 * DESCRIPTION
 *  Redraws the single Active call screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawCategory20Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    UI_filled_area *f = current_MMI_theme->CM_screen_background_filler;
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
    U8 aoc_flag;
    S32 icon_w = 0, icon_h = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();
    gui_hide_animations();

    gdi_layer_reset_clip();

#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, f);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
    DrawCMImageBackground();
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

    show_title_status_icon();
    wgui_status_icon_bar_update();

#ifdef __MMI_MAINLCD_128X128__
#ifndef __MMI_CM_SCREEN_HIDE_DATE_TIME__
    CM_screens_draw_date_time_bar();
    show_main_LCD_dt_display();
#endif /* __MMI_CM_SCREEN_HIDE_DATE_TIME__ */ 
#else /* __MMI_MAINLCD_128X128__ */ 
	if (mmi_fe_get_r2l_state())
	{
		UI_character_type s[64];
		S32 w;

		gui_set_font(main_LCD_dt_object.duration.font);
		UI_sprintf((UI_string_type)s, "%02d:%02d:%02d", 8, 8, 8);
		w = gui_get_string_width(s);

		set_main_lcd_duration_position((U16)(UI_device_width - w - 1), (U16) MMI_status_bar_height + MMI_CAT20_STR_LINE_GAP);
	}
	else
	{
		set_main_lcd_duration_position(0, (U16) MMI_status_bar_height + MMI_CAT20_STR_LINE_GAP);
	}
#endif /* __MMI_MAINLCD_128X128__ */ 
#ifdef __MMI_CALLSET_CTD_CONFIGURABLE__
    if (!(MMI_FALSE == srv_callset_call_time_display_get_mode()))
#endif
    {
        CM_screens_draw_duration_bar();
    }
#ifdef __MMI_TELEPHONY_SUPPORT__
    aoc_flag = (U8) mmi_ucm_get_show_aoc();
    if (aoc_flag)
    {
        CM_call_cost_show = MMI_TRUE;
        redraw_call_cost_UI();
    }
    else
    {
        CM_call_cost_show = MMI_FALSE;
        reset_call_cost_UI();
    }
#endif /* __MMI_TELEPHONY_SUPPORT__ */
#ifdef __MMI_MAINLCD_128X128__
    show_main_LCD_dt_display();
#else /* __MMI_MAINLCD_128X128__ */ 
    #ifdef __MMI_CALLSET_CTD_CONFIGURABLE__
    if (!(MMI_FALSE == srv_callset_call_time_display_get_mode()))
#endif
    {
        dt_update_duration();
    }
#endif /* __MMI_MAINLCD_128X128__ */ 

    if (gCallLine != 0)
    {
#ifdef __MMI_MAINLCD_128X128__
        S32 sw = 0, sh = 0;
#endif
        S32 tx = 0, ty = 0;

        gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
#ifdef __MMI_MAINLCD_128X128__
        gui_set_font((UI_font_type)gui_font_get_type(GUI_FONT_SIZE_TITLE));
        gui_measure_string(MMI_message_string, &sw, &sh);
        tx = (UI_device_width >> 1) - ((sw + icon_w + 1) >> 1);
        if (tx < 1)
        {
            tx = 1;
        }
        ty = UI_device_height - MMI_button_bar_height - sh - 2;
#else /* __MMI_MAINLCD_128X128__ */ 
        tx = 1;
        ty = MMI_status_bar_height + main_LCD_dt_object.duration.height + MMI_CAT20_STR_LINE_GAP*2 + 1;
#endif /* __MMI_MAINLCD_128X128__ */

        gdi_layer_push_clip();
        gdi_layer_reset_clip();
        gdi_image_draw_id(tx, ty, gCallLine);
        gdi_layer_pop_clip();
    }
    if (MMI_message_string)
    {
        gui_show_scrolling_text(&CM_scrolling_text);
    }

    gdi_layer_push_clip();
    gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);
    gdi_image_draw_animation(wgui_image_clip_x1, wgui_image_clip_y1, _MMI_animated_icon, &MOMT_animation_handle);
    gdi_layer_pop_clip();

    if (isCallDisconnecting)
    {
        MOMTHideAnimation();
    }

    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}


/*****************************************************************************
 * FUNCTION
 *  DrawCate20CategoryControlArea
 * DESCRIPTION
 *  This function is used to draw the category controlled area of category20 screen
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void DrawCate20CategoryControlArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    RedrawCategory20Screen();
}


/*****************************************************************************
 * FUNCTION
 *  ExitCategory20Screen
 * DESCRIPTION
 *  Exits the single Active_call screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void ExitCategory20Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();
    gui_cancel_timer(CM_scrolling_text_timer_callback);
    gui_cancel_timer(handle_CM_text_scroll);
    gui_hide_animations();

    MOMT_animation_handle = GDI_ERROR_HANDLE;
    isCallDisconnecting = MMI_FALSE;

    close_main_LCD_dt_display();
    wgui_status_icon_bar_reset();
    reset_softkeys();
    reset_singleline_inputbox();

#ifndef __MMI_MAINLCD_128X128__
    enactive_main_lcd_update_date_time();
#endif 

    gdi_layer_unlock_frame_buffer();
#if (defined __MMI_TOUCH_SCREEN__) && !defined(__MMI_WGUI_DISABLE_CSK__)
    ResetCenterSoftkey();
#endif /*defined (__MMI_TOUCH_SCREEN__) && !defined(__MMI_WGUI_DISABLE_CSK__)*/
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory20HistorySize
 * DESCRIPTION
 *  Gets the size of the history buffer of category 20
 * PARAMETERS
 *  void
 * RETURNS
 *  S32         size of history
 *****************************************************************************/
static S32 GetCategory20HistorySize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (2);
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory20History
 * DESCRIPTION
 *  Gets category history buffer
 * PARAMETERS
 *  history_buffer      [IN]        History buffer
 * RETURNS
 *  U8*         history buffer
 *****************************************************************************/
static U8 *GetCategory20History(U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (history_buffer != NULL)
    {
        history_buffer[0] = (U8) MMI_CATEGORY20_ID;
        history_buffer[1] = (U8) 0x80;
    }
    return (history_buffer);
}


/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory20Screen_int(
        U16 left_softkey,
        U16 right_softkey,
        U8 *CallType,
        U8 *NameOrNumber,
        MYTIME *CallDuration,
        U16 CallLine,
        U16 CallState,
        WGUI_CATCALL_CALLER_MEDIA_INFO *CallerMedia,
        MMI_BOOL isDisconnecting,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MAINLCD_128X128__
    S32 h;
    S32 ty2 = 0;
    S32 content_height;
#endif 
    S32 y = 0;
    S32 sh = 0;
    S32 sw = 0;
    S32 tw = 0;
    S32 tx = 0;
    S32 ty = 0;
    S32 iwidth = 0;
    S32 iheight = 0;
    PU8 img = get_image(CallState);
    S32 x_shift = 1;
    S32 icon_w = 0, icon_h = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(history_buffer);

    gdi_layer_lock_frame_buffer();

    change_left_softkey(left_softkey, 0);
    change_right_softkey(right_softkey, 0);
    SetupCategoryKeyHandlers();

    isCallDisconnecting = isDisconnecting;

    set_main_LCD_dt_date_hide_function(CM_screens_hide_date_time_display);
    set_main_LCD_dt_time_hide_function(CM_screens_hide_date_time_display);
#ifdef __MMI_CALLSET_CTD_CONFIGURABLE__
    if (!(MMI_FALSE == srv_callset_call_time_display_get_mode()))
#endif
    {
        set_main_LCD_dt_duration_hide_function(CM_screens_hide_duration_display);
    }

    //set_dt_duration(CallDuration);
    set_duration_start_time(CallDuration);
    set_dt_display(DT_ACTIVE_CALL_SCREEN);
    ShowStatusIconsTitle();

    gdi_image_get_dimension((U8*) img, &iwidth, &iheight);

    gCallLine = CallLine;
    if (gCallLine != 0)
    {
        gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
        x_shift = icon_w + 2;
    }

    if (NameOrNumber)
    {
        MMI_message_string = (UI_string_type) NameOrNumber;
    }
    else
    {
        MMI_message_string = NULL;
    }
    gui_set_font((UI_font_type)gui_font_get_type(GUI_FONT_SIZE_TITLE));
    gui_measure_string((UI_string_type) NameOrNumber, &sw, &sh);
#ifdef __MMI_MAINLCD_128X128__
    if (gCallLine != 0)
    {
        tx = (UI_device_width >> 1) - ((sw + icon_w + 1) >> 1) + icon_w + 1;
    }
    else
#endif /* __MMI_MAINLCD_128X128__ */ 
    {
    tx = (UI_device_width >> 1) - (sw >> 1);
    }
    if (tx < x_shift)
    {
        tx = x_shift;
    }

#ifdef __MMI_MAINLCD_128X128__
    ty = UI_device_height - MMI_button_bar_height - sh - 2;
    tw = sw;

    if (gCallLine == 0)
    {
    if (tw > (UI_device_width - 2))
    {
        tw = UI_device_width - 2;
    }
    }
    else
    {
        if (tw > (UI_device_width - 3 - icon_w))
        {
            tw = UI_device_width - 3 - icon_w;
        }
    }

#ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
    gui_create_scrolling_text(
        &CM_scrolling_text,
        tx,
        ty,
        tw,
        sh,
        (UI_string_type) NameOrNumber,
        CM_scrolling_text_timer_callback,
        CM_draw_scrolling_text_background,
        *current_MMI_theme->CM_screen_text_color,
        gui_color(255, 255, 255));
#else /* __MMI_DOWNLOADABLE_THEMES_SUPPORT__ */ 
    gui_create_scrolling_text(
        &CM_scrolling_text,
        tx,
        ty,
        tw,
        sh,
        (UI_string_type) NameOrNumber,
        CM_scrolling_text_timer_callback,
        CM_draw_scrolling_text_background,
        gui_color(0, 0, 0),
        gui_color(255, 255, 255));
#endif /* __MMI_DOWNLOADABLE_THEMES_SUPPORT__ */ 
    gui_change_scrolling_text_font(&CM_scrolling_text, (UI_font_type)gui_font_get_type(GUI_FONT_SIZE_TITLE));
    CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;

    h = sh + iheight + 4;
    ty2 = main_LCD_dt_object.duration.y + main_LCD_dt_object.duration.height + 2;
    content_height = UI_device_height - MMI_button_bar_height - ty2;
    y = ty2 + (content_height >> 1) - (h >> 1);
#else /* __MMI_MAINLCD_128X128__ */ 
    ty = MMI_status_bar_height + main_LCD_dt_object.duration.height + MMI_CAT20_STR_LINE_GAP*2 + 1;
    tw = sw;
    if (gCallLine == 0)
    {
        tw = UI_device_width - 2;
    }
    else
    {
        tw = UI_device_width - 3 - icon_w;
    }
    /* PMT DLT_FIXES - TK 20060321 START */
#ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
    gui_create_scrolling_text(
        &CM_scrolling_text,
        0 + x_shift,
        ty,
        tw,
        sh,
        (UI_string_type) NameOrNumber,
        CM_scrolling_text_timer_callback,
        CM_draw_scrolling_text_background,
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
        *current_MMI_theme->CM_screen_text_color,
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
        *current_MMI_theme->list_normal_text_color,
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
        gui_color(255, 255, 255));
#else /* __MMI_DOWNLOADABLE_THEMES_SUPPORT__ */ 
    gui_create_scrolling_text(
        &CM_scrolling_text,
        0 + x_shift,
        ty,
        tw,
        sh,
        (UI_string_type) NameOrNumber,
        CM_scrolling_text_timer_callback,
        CM_draw_scrolling_text_background,
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
        gui_color(0, 0, 0),
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
        *current_MMI_theme->list_normal_text_color,
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
        gui_color(255, 255, 255));
#endif /* __MMI_DOWNLOADABLE_THEMES_SUPPORT__ */ 
    gui_change_scrolling_text_font(&CM_scrolling_text, (UI_font_type)gui_font_get_type(GUI_FONT_SIZE_TITLE));
    CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;

    y = UI_device_height - MMI_button_bar_height - iheight - ((MMI_CM_MAX_IMG_HEIGHT - iheight) >> 1);
#endif /* __MMI_MAINLCD_128X128__ */ 

    wgui_image_clip_x1 = (UI_device_width - iwidth) >> 1;
    wgui_image_clip_x2 = (UI_device_width + iwidth) >> 1;
    wgui_image_clip_y1 = y;
    wgui_image_clip_y2 = y + iheight - 1;

    _MMI_animated_icon = img;

    gdi_layer_unlock_frame_buffer();

#ifndef __MMI_MAINLCD_128X128__
    deactive_main_lcd_update_date_time();
#endif 

    wgui_cat_setup_category(
        MMI_CATEGORY20_ID, 
        DM_CLEAR_SCREEN_BACKGROUND, 
        ExitCategory20Screen, 
        GetCategory20History, 
        GetCategory20HistorySize);
    dm_register_category_controlled_callback(DrawCate20CategoryControlArea);
    dm_redraw_category_screen();
}
#endif /* !defined(WGUI_CATCALL_STYLE_2) */


/* For detail description, please refer to wgui_categories_CM.h */
void wgui_cat020_update_duration(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(WGUI_CATCALL_STYLE_2)
    if (g_wgui_catcall_display_duration)
#else /* defined(WGUI_CATCALL_STYLE_2) */
    if (g_dm_data.s32CatId == MMI_CATEGORY20_ID)
#endif /* defined(WGUI_CATCALL_STYLE_2) */
    {
        dt_update_duration();
    }
}


#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
/*****************************************************************************
 * FUNCTION
 *  MOMT_allocate_media_layer 
 * DESCRIPTION
 *  allocate screen-based memory & create layer for MOMT screen with media content
 * PARAMETERS
 *  x   [IN]    x
 *  y   [IN]    y
 *  w   [IN]    width
 *  h   [IN]    height
 * RETURNS
 *  void
 *****************************************************************************/
static void MOMT_allocate_media_layer(S32 x, S32 y, S32 w, S32 h)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    GDI_RESULT ret;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    CM_media_buffer = (U8*)applib_mem_screen_alloc_framebuffer(SCRMEM_CATMOMT_POOL_SIZE);
    MMI_ASSERT(CM_media_buffer);
    
    ret = gdi_layer_create_using_outside_memory(
            x, y, w, h,
            &wgui_layer_1,
            CM_media_buffer,
            SCRMEM_CATMOMT_POOL_SIZE);
    MMI_ASSERT(ret == GDI_SUCCEED);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
    gdi_layer_create(
            x, y, w, h,
            &wgui_layer_1);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

#ifdef __MDI_DISPLAY_YUYV422_SUPPORT__
    gdi_layer_push_and_set_active(wgui_layer_1);
    gdi_layer_set_color_format(GDI_COLOR_FORMAT_UYVY422);
    gdi_layer_pop_and_restore_active();
#endif /* __MDI_DISPLAY_YUYV422_SUPPORT__ */ 
}
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) */


#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
/*****************************************************************************
 * FUNCTION
 *  MOMT_set_blt_layer 
 * DESCRIPTION
 *  set blt layer for MOMT call screen with media content
 * PARAMETERS
 *  x   [IN]    x
 *  y   [IN]    y
 *  w   [IN]    width
 *  h   [IN]    height
 * RETURNS
 *  void
 *****************************************************************************/
static void MOMT_set_blt_layer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    gdi_layer_set_blt_layer(wgui_base_layer, wgui_layer_1, 0, 0);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    gdi_layer_set_blt_layer(MOMTStatusIconLayer, wgui_base_layer, wgui_layer_1, 0);
#else /* __MMI_CATEGORY_CM_SCANLINE__ */
    gdi_layer_set_blt_layer(dm_get_scr_bg_layer(), wgui_base_layer, wgui_layer_1, 0);
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
}
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) */


#if defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__)
/*****************************************************************************
 * FUNCTION
 *  ShowMOMTCallScreen_3
 * DESCRIPTION
 *  Show MO MT call cateogry for 128x64 mainlcd size.
 * PARAMETERS
 *  left_softkey                [IN]        Lsk string id
 *  left_softkey_icon           [IN]        Lsk image id
 *  right_softkey               [IN]        Rsk string id
 *  right_softkey_icon          [IN]        Rsk image id
 *  NotificationStringId        [IN]        Notification string, notification string
 *  NameOrNumber                [IN]        Name or number text, name or number text
 *  IP_Number                   [IN]        String of IP number
 *  history_buffer              [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
static void ShowMOMTCallScreen_3(
                U16 left_softkey,
                U16 left_softkey_icon,
                U16 right_softkey,
                U16 right_softkey_icon,
                U16 NotificationStringId,
                PU8 NameOrNumber,
                PU8 IP_Number,
                PU8 history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    dm_data_struct dm_data;
    S32 text_width, text_height, tx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    gdi_layer_lock_frame_buffer();
    
    change_left_softkey(left_softkey, left_softkey_icon);
    change_right_softkey(right_softkey, right_softkey_icon);
    SetupCategoryKeyHandlers();

    ShowStatusIconsTitle();
	
    /****************************************************************************
    * Message String                                                               
    ***************************************************************************/
    /* set medium font for all string size */
    gui_set_font(&MMI_medium_font); 
	
	/* "Calling..." String */
	MMI_message_string2 = NULL; /* No "Calling..." String, for MT Call */
    if (NotificationStringId != 0)
    {
        MMI_message_string2 = get_string(NotificationStringId); /* With "Calling..." String, for MO Call */
        gui_measure_string(MMI_message_string2, &text_width, &text_height);
    
    }
	else
	{
	    text_height = Get_CharHeightOfAllLang(MEDIUM_FONT);
	}
	
    CM_y = text_height + 5 + MMI_STATUS_BAR_HEIGHT; /* y pos for  MMI_message_string */

	/* call number and support IP dialing */
    text_width = 0;
    text_height = 0;
    MMI_message_string = NULL; 
    if (NameOrNumber)
    {
        memset((CHAR*) CM_string_buf, 0, (SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN) * 2);
        gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) IP_Number);
        gui_strcat((UI_string_type) CM_string_buf, (UI_string_type) NameOrNumber);
        MMI_message_string = (UI_string_type) CM_string_buf;
        gui_measure_string(MMI_message_string, &text_width, &text_height);
    }
    
    /********************************************************************************
    *  Create scrolling text
    ********************************************************************************/
    if (text_width > UI_device_width - 2)
    {
        text_width = UI_device_width - 2;
    }
    
    tx = ((UI_device_width - text_width) >> 1);
    
    gui_create_scrolling_text(
        &CM_scrolling_text,
        tx,
        CM_y,
        text_width,
        text_height,
        MMI_message_string,
        CM_scrolling_text_timer_callback, 
        CM_draw_scrolling_text_background,
#ifdef __MMI_MAINLCD_96X64__
        gui_color(255, 255, 255),
#else /*__MMI_MAINLCD_96X64__*/
        gui_color(0, 0, 0),
#endif /*__MMI_MAINLCD_96X64__*/
        gui_color(255, 255, 255));
        
    CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
    
    gdi_layer_unlock_frame_buffer();
    
    ExitCategoryFunction = ExitMOMTCallScreen;
    dm_setup_category_functions(dm_redraw_category_screen, dummy_get_history, dummy_get_history_size);
    dm_data.s32ScrId = (S32) GetActiveScreenId();
    dm_data.s32CatId = MMI_CATEGORY18_ID;
    dm_data.s32flags = DM_CLEAR_SCREEN_BACKGROUND;
    dm_setup_data(&dm_data);
    dm_register_category_controlled_callback(DrawMOMTCallScreenControllArea);
    dm_redraw_category_screen();
}
#endif /* defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__)*/

#if defined( __CATE_CM_VIDEO_PLAY_SUPPORT__)
/*****************************************************************************
 * FUNCTION
 *  GetMOMTVideoInfo
 * DESCRIPTION
 *  Get Vedio inforamtion  for  MO MT call cateogryscreen
 * PARAMETERS
 *  type                  [IN]        MOMT call screen resource type
 *  image_width           [IN]        image width
 *  image_height          [IN]        image height
 * RETURNS
 *  S32       if success or not.
 *****************************************************************************/
static S32 GetMOMTVideoInfo(wgui_cate_momt_res_type_enum type, S32 *image_width, S32 *image_height)
{
    
    S32 mdi_ret;

	memset((CHAR*)&wgui_video_info, 0, sizeof(mdi_video_info_struct));
	if(type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE )
 	{
 		mdi_ret = mdi_video_ply_open_clip_file(0, cat_momt_resource_filename, &wgui_video_info);
	}
	else if(type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID)
	{
		mdi_ret = mdi_video_ply_open_clip_id(0, cat_momt_resource_id, &wgui_video_info);
    }   
	cat_momt_is_video_open = (mdi_ret >= 0) ? TRUE : FALSE;
    if (mdi_ret >= 0)
    {
    	srv_prof_volume_level vol_level;
        srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_RING_VOL_LEVEL, (void*)&vol_level);
        mdi_audio_set_volume(MDI_VOLUME_MEDIA, (U8)vol_level);

		if (wgui_video_info.width == 0 && wgui_video_info.height == 0)
		{
			wgui_video_info.width = UI_device_width;
			wgui_video_info.height = UI_device_height;
		}
		*image_width = wgui_video_info.width;
		*image_height = wgui_video_info.height;

		#if defined(__MMI_VIDEO_3D_ANAGLYPH__)
		if(type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE )
		{
			S32 index;

			cat_momt_is_3d_type = MMI_FALSE;
			for(index = 0; index < wgui_video_info.track_num; index++)
			{
				if(wgui_video_info.track_info[index].track_type == MDI_VIDEO_TRACK_3D)
				{
					cat_momt_3d_track_index = wgui_video_info.track_info[index].track_index;
					cat_momt_is_3d_type = MMI_TRUE;
					break;
				}
			}
		}
		#endif /* __MMI_VIDEO_3D_ANAGLYPH__*/
                //mdi_video_ply_close_clip_file(); /* not close file to improve performance */
	}
    else
    {
                /* faild, need to play default image */
		S32 img_ret;
        cat_momt_is_show_default = TRUE;
        img_ret = gdi_image_get_dimension_id(cat_momt_default_image_id, image_width, image_height);
        MMI_ASSERT(img_ret >= 0);
    }
	return mdi_ret;

}
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
/*****************************************************************************
* [MO/MT Cateogry Screen]
*
* This category is for MT/MO call screen.
*
*  (128x128)
*  **********************
*  *                    *  
*  * 200x/xx/xx         *
*  *  ****************  *
*  *  *              *  *
*  *  *              *  *
*  *  *           ------------ image or video
*  *  ****************  *
*  *                    *
*  * LSK            RSK *
*  **********************
*
*
*  (128x160) (176x220)
*  **********************
*  * ##################------ status bar
*  * Calling...         *
*  *  ****************  *
*  *  *              *  *
*  *  *              *  *
*  *  *           ----------- image or video
*  *  *              *  *
*  *  *              *  *
*  *  ****************  *
*  *     09xxxxxxxx---------- phone number or name
*  * LSK            RSK *
*  **********************
*
*****************************************************************************/
/*****************************************************************************
 * FUNCTION
 *  ShowMOMTCallScreen
 * DESCRIPTION
 *  Show MO MT call cateogry.
 * PARAMETERS
 *  title_id                    [IN]        
 *  left_softkey                [IN]        Lsk string id
 *  left_softkey_icon           [IN]        Lsk image id
 *  right_softkey               [IN]        Rsk string id
 *  right_softkey_icon          [IN]        Rsk image id
 *  NotificationStringId        [IN]        Notification string, notification string
 *  NameOrNumber                [IN]        Name or number text, name or number text
 *  IP_Number                   [IN]        String of IP number
 *  CallLine                    [IN]        Image ID of line indicator(Zero for not displaying line indicators)
 *  default_image_id            [IN]        Image ID of default displayed image
 *  resource_id                 [IN]        Image ID of displayed resource (if any)
 *  resource_filename           [IN]        Resource to be displayed (file)
 *  resource_type               [IN]        Resource type
 *  repeat_count                [IN]        Repeat count, used for video only, 0 means infiniate loop
 *  is_visaul_update            [IN]        Update video's visual
 *  is_aud_enable               [IN]        Audio of animation
 *  is_play_aud_when_start      [IN]        Play video at start
 *  history_buffer              [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
static void ShowMOMTCallScreen(
                U16 title_id,
                U16 left_softkey,
                U16 left_softkey_icon,
                U16 right_softkey,
                U16 right_softkey_icon,
                U16 NotificationStringId,
                PU8 NameOrNumber,
                PU8 IP_Number,
                U16 CallLine,
                U16 default_image_id,
                U16 resource_id,
                CHAR* resource_filename,
                wgui_cate_momt_res_type_enum resource_type,
                U16 repeat_count,            /* video/swflash only. 0 means infinite loop */
                BOOL is_visaul_update,       /* video/swflash only. update to LCM */
                BOOL is_aud_enable,          /* video/swflash only. play video's audio */
                BOOL is_play_aud_when_start, /* video/swflash only. play audio when start */
                PU8 history_buffer)
{
#if defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ShowMOMTCallScreen_3(
        left_softkey,
        left_softkey_icon,
        right_softkey,
        right_softkey_icon,
        NotificationStringId,
        NameOrNumber,
        IP_Number,
        history_buffer);        
#else /* defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__) */
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 s32flags;
    S32 text_width;
    S32 text_height;
    S32 image_width, image_height;
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) ||defined(__CATE_CM_PHB_CALLER_RES__)
    GDI_RESULT img_ret;
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) ||defined(__CATE_CM_PHB_CALLER_RES__)*/ 
    S32 x_shift = 0, max_icon_h = 0;

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
    S32 resized_width, resized_height;
    S32 resized_offset_x, resized_offset_y; 
    srv_prof_volume_level vol_level;
    MDI_RESULT mdi_ret = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* init var */
    cat_momt_is_aud_enable = is_aud_enable;
    cat_momt_is_play_aud_when_start = is_play_aud_when_start;
    cat_momt_is_aud_muted = FALSE;
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)||defined(__MMI_SWFLASH__)*/
#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
    cat_momt_is_visual_update = is_visaul_update;
    cat_momt_is_video_open = FALSE;
    cat_momt_is_video_play = FALSE;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
#ifdef __MMI_SWFLASH__
    cat_momt_is_swflash_open = FALSE;
    cat_momt_is_swflash_play = FALSE;
#endif /* __MMI_SWFLASH__ */
#ifdef __MMI_AVATAR__
    cat_momt_is_avatar_play = FALSE;
#endif /*__MMI_AVATAR__*/
   
    cat_momt_is_show_default = FALSE;

#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
    MMI_ASSERT(CM_media_buffer == NULL);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    /* hook: because JPG (background image) cannot co-exist with video playing, force to display first */
#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    DrawMOMTStatusIconBg_scanline();
#else /* __MMI_CATEGORY_CM_SCANLINE__ */
    dm_setup_and_draw_scr_bg(NULL);
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    cat_momt_repeat_count = repeat_count;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
    cat_momt_resource_filename = (CHAR*) resource_filename;
    cat_momt_resource_id = resource_id;
    cat_momt_default_image_id = default_image_id;
    cat_momt_resource_type = resource_type;

    switch(cat_momt_resource_type)
    {
    #ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__    
        case WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE:
        case WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID:
            
            /* if is newly entry, do not need resume, play from start */
            if (history_buffer == NULL)
            {
                cat_momt_video_play_time = 0;
            }
            
            /* stop MMI LCM sleep */
            srv_backlight_turn_on(SRV_BACKLIGHT_PERMANENT);
            
            /* we need play video on an extra layer, so will use multi-layer */
            gdi_layer_multi_layer_enable();
            gdi_layer_get_base_handle(&wgui_base_layer);
            wgui_layer_1 = GDI_LAYER_EMPTY_HANDLE;

            break;
    #endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */

    #ifdef __MMI_SWFLASH__
        case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE:
        case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID:
            
            /* if is newly entry, do not need resume, play from start */
            if (history_buffer == NULL)
            {
                cat_momt_swflash_play_time = 0;
            }
            
            /* stop MMI LCM sleep */
            srv_backlight_turn_on(SRV_BACKLIGHT_PERMANENT);
            
            /* we need play swflash on an extra layer, so will use multi-layer */
            gdi_layer_multi_layer_enable();
            gdi_layer_get_base_handle(&wgui_base_layer);
            wgui_layer_1 = GDI_LAYER_EMPTY_HANDLE;
            
            break;            
    #endif /* __MMI_SWFLASH__ */

    #ifdef __MMI_AVATAR__
        case WGUI_CATE_MOMT_RES_TYPE_AVATAR_FILE:            
    #endif /* __MMI_AVATAR__ */ 
        case WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE:
        case WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID:
            break;

        default: 
            MMI_ASSERT(0); /* should not run to here */
    }

    gdi_layer_lock_frame_buffer();

    change_left_softkey(left_softkey, left_softkey_icon);
    change_right_softkey(right_softkey, right_softkey_icon);
    SetupCategoryKeyHandlers();

    set_main_LCD_dt_date_hide_function(CM_screens_hide_date_time_display);
    set_main_LCD_dt_time_hide_function(CM_screens_hide_date_time_display);
    set_dt_display(DT_MT_CALL_SCREEN);

//huking
#ifndef __MMI_TITLE_BAR_NO_ICON_SHCT__
    MMI_title_icon = NULL;
    wgui_title_disable_menu_shortcut_display(MMI_TRUE);
#endif /*__MMI_TITLE_BAR_NO_ICON_SHCT__*/

    /* draw title */
    if (title_id == 0)
    {
        status_icon = 1;
        ShowStatusIconsTitle();
    }
    else if (!((title_id == 0xffff)))
    {
        status_icon = 2;
        MMI_title_string = (UI_string_type) get_string(title_id);
    }
    else
    {
        status_icon = 0;
    }

   /****************************************************************************
   * Message String                                                               
   * gMMI_UI_U8_flag_1 = 0 (No "Calling..." String, for MT Call)
   * gMMI_UI_U8_flag_1 = 1 (With "Calling..." String, for MO Call)
   ****************************************************************************/

    /* support IP dialing */
    if (NameOrNumber)
    {
        memset((CHAR*) CM_string_buf, 0, (SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN) * 2);
        gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) IP_Number);
        gui_strcat((UI_string_type) CM_string_buf, (UI_string_type) NameOrNumber);
        MMI_message_string = (UI_string_type) CM_string_buf;
    }
    else
    {
        MMI_message_string = NULL;
    }

    gui_set_font(&MMI_medium_font);
    gui_measure_string(MMI_message_string, &text_width, &text_height);

    if (NotificationStringId != 0)
    {
        MMI_message_string2 = get_string(NotificationStringId);
        gMMI_UI_U8_flag_1 = 1;  /* With "Calling" string,MO calling */
    }
    else
    {
        gMMI_UI_U8_flag_1 = 0;  /* Without "Calling" string, MT calling */
    }

   /****************************************************************************
   *  Get Image, Video or SWFlash info
   *****************************************************************************/

    /* prepare image, video or swflash */
    switch (cat_momt_resource_type)
    {

    #ifdef __MMI_AVATAR__
        case WGUI_CATE_MOMT_RES_TYPE_AVATAR_FILE:
        {
            gdi_image_get_dimension_mem(GDI_IMAGE_TYPE_AVATAR,(PU8) cat_momt_resource_filename,0,&image_width,&image_height);        
        }
            break;

    #endif /* __MMI_AVATAR__*/
        case WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID:
        {
            gdi_image_get_dimension_id(cat_momt_resource_id, &image_width, &image_height);
        }
            break;
    #ifdef __CATE_CM_PHB_CALLER_RES__
        case WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE:
        {
            img_ret = gdi_image_get_dimension_file((CHAR*) resource_filename, &image_width, &image_height);

            if (img_ret < 0)
            {
                /* faild, need to play default image */
                cat_momt_is_show_default = TRUE;
                img_ret = gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);
                MMI_ASSERT(img_ret >= 0);
            }
        }
            break;
    #endif /*__CATE_CM_PHB_CALLER_RES__*/
    #ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
        case WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE:			
        case WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID:
        {
            /* open with audio is on */
			mdi_ret = GetMOMTVideoInfo(cat_momt_resource_type,&image_width, &image_height);			
        }
        break;
    #endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 

    #ifdef __MMI_SWFLASH__
        case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE:
        {
            if (cat_momt_is_aud_enable)
            {            
                mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, SWFLASH_PLAYER, &wgui_swflash_info);
            }
            else
            {
                mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, SWFLASH_SCREEN, &wgui_swflash_info);
            }
            
            cat_momt_is_swflash_open = (mdi_ret >= 0) ? TRUE : FALSE;

            if (mdi_ret >= 0)
            {
                srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_RING_VOL_LEVEL, (void*)&vol_level);
                mdi_audio_set_volume(MDI_VOLUME_MEDIA, (U8)vol_level);

                image_width = wgui_swflash_info.width;
                image_height = wgui_swflash_info.height;

                mdi_swflash_close_file();
            }
            else
            {
                /* faild, need to play default image */
                cat_momt_is_show_default = TRUE;
                img_ret = gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);
                MMI_ASSERT(img_ret >= 0);
            }

        }
            break;

        case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID:
        {
            if (cat_momt_is_aud_enable)
            {
                mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, SWFLASH_PLAYER, &wgui_swflash_info);
            }
            else
            {
                mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, SWFLASH_SCREEN, &wgui_swflash_info);
            }

            cat_momt_is_swflash_open = (mdi_ret >= 0) ? TRUE : FALSE;

            if (mdi_ret >= 0)
            {
                srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_RING_VOL_LEVEL, (void*)&vol_level);
                mdi_audio_set_volume(MDI_VOLUME_MEDIA, (U8)vol_level);

                image_width = wgui_swflash_info.width;
                image_height = wgui_swflash_info.height;

                mdi_swflash_close_id();
            }
            else
            {
                /* faild, need to play default image */
                cat_momt_is_show_default = TRUE;
                img_ret = gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);
                MMI_ASSERT(img_ret >= 0);
            }
        }
            break;
    #endif /* __MMI_SWFLASH__ */ 

        default:
        {
            /* wrong resouce type */
            MMI_ASSERT(0);
        }
    }

   /********************************************************************************
   *  Calculate drawable region for Image and Video
   ********************************************************************************/
    SetMOMTCallImageClip(image_width, image_height);

   /********************************************************************************
   *  Create Video or SWFlash Layer 
   ********************************************************************************/
    if (!cat_momt_is_show_default)
    {
    #ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
        /* video is successfully opened, create video playback layer */
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
        {
            if (mdi_ret >= 0)
            {
                if (CM_need_change_clip)
                {
                    /* video larger than drawable region, need resize */

                    /* calc draw size */
                    gdi_image_util_fit_bbox(
                        wgui_image_clip_x2 - wgui_image_clip_x1 + 1,
                        wgui_image_clip_y2 - wgui_image_clip_y1 + 1,
                        wgui_video_info.width,
                        wgui_video_info.height,
                        &resized_offset_x,
                        &resized_offset_y,
                        &resized_width,
                        &resized_height);
                }
                else
                {
                    /* video smaller than region - align at center */
                    resized_offset_x = ((wgui_image_clip_x2 - wgui_image_clip_x1 + 1) - wgui_video_info.width) >> 1;
                #if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
                    resized_offset_y = ((wgui_image_clip_y2 - wgui_image_clip_y1 + 1) - wgui_video_info.height) >> 1;
                #else /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/
                    resized_offset_y = ((wgui_image_clip_y2 - wgui_image_clip_y1 + 1) - wgui_video_info.height);
                #endif /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/

                    resized_width = wgui_video_info.width;
                    resized_height = wgui_video_info.height;
                }

                MMI_ASSERT(wgui_layer_1 == GDI_LAYER_EMPTY_HANDLE);

                {
                    S32 x, y, w, h;
                    x = wgui_image_clip_x1 + resized_offset_x;
                    y = wgui_image_clip_y1 + resized_offset_y;
                    w = resized_width;
                    h = resized_height;
                    
                    wgui_catvdo_refine_video_coordinate(&x, &y, &w, &h);

                    MOMT_allocate_media_layer(x, y, w, h);
                }
            }
        }
    #endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 

    #ifdef __MMI_SWFLASH__
        /* SWFlash is successfully opened, create video playback layer */
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID))
        {
            if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID)
            {
                if (cat_momt_is_aud_enable)
                {
                    mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, SWFLASH_PLAYER, &wgui_swflash_info);
                }
                else
                {
                    mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, SWFLASH_SCREEN, &wgui_swflash_info);
                }
            }
            else
            {
                if (cat_momt_is_aud_enable)
                {            
                    mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, SWFLASH_PLAYER, &wgui_swflash_info);
                }
                else
                {
                    mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, SWFLASH_SCREEN, &wgui_swflash_info);
                }
            }

            if (mdi_ret >= 0)
            {
                if (CM_need_change_clip)
                {
                    /* swflash larger than drawable region, need resize */

                    /* calc draw size */
                    gdi_image_util_fit_bbox(
                        wgui_image_clip_x2 - wgui_image_clip_x1 + 1,
                        wgui_image_clip_y2 - wgui_image_clip_y1 + 1,
                        wgui_swflash_info.width,
                        wgui_swflash_info.height,
                        &resized_offset_x,
                        &resized_offset_y,
                        &resized_width,
                        &resized_height);
                }
                else
                {
                    /* video smaller than region - align at center */
                    resized_offset_x = ((wgui_image_clip_x2 - wgui_image_clip_x1 + 1) - wgui_swflash_info.width) >> 1;
                #if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
                    resized_offset_y = ((wgui_image_clip_y2 - wgui_image_clip_y1 + 1) - wgui_swflash_info.height) >> 1;
                #else /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/
                    resized_offset_y = ((wgui_image_clip_y2 - wgui_image_clip_y1 + 1) - wgui_swflash_info.height);
                #endif /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/

                    resized_width = wgui_swflash_info.width;
                    resized_height = wgui_swflash_info.height;
                }

                MMI_ASSERT(wgui_layer_1 == GDI_LAYER_EMPTY_HANDLE);

                MOMT_allocate_media_layer(
                        wgui_image_clip_x1 + resized_offset_x,
                        wgui_image_clip_y1 + resized_offset_y,
                        resized_width,
                        resized_height);

                if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID)
                {
                    mdi_swflash_close_id();
                }
                else
                {
                    mdi_swflash_close_file();
                }
            }
        }
    #endif /* __MMI_SWFLASH__ */ /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */
    }

   /********************************************************************************
   *  Create scrolling text
   ********************************************************************************/
    {
        S32 icon_w = 0, icon_h = 0;
        S32 max_text_width;

        gCallLine = CallLine;

        x_shift = 0;

        if (gCallLine)
        {
            gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
            x_shift += icon_w + 1;
            max_icon_h = icon_h;
        }

        if (g_wgui_catcall_number_type_icons)
        {
            gdi_image_get_dimension_id(g_wgui_catcall_number_type_icons[0], &icon_w, &icon_h);
            x_shift += icon_w + 1;
            max_icon_h = (icon_h > max_icon_h) ? (icon_h) : (max_icon_h);
        }

        max_text_width = UI_device_width - 2 - x_shift;
#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
        if (text_width > max_text_width)
#endif /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
        {
            text_width = max_text_width;
        }
    }

#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
    {
        S32 tx = 0, ty = CM_y;

        CM_x = (UI_device_width - text_width - x_shift) >> 1;
        tx = CM_x + x_shift;

        if (max_icon_h > text_height)
        {
            ty = CM_y + ((max_icon_h - text_height) >> 1);
		}

        gui_create_scrolling_text(
            &CM_scrolling_text,
            tx,
            ty,
            text_width,
            text_height,
            MMI_message_string,
            CM_scrolling_text_timer_callback, CM_draw_scrolling_text_background,
        #ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
            *current_MMI_theme->CM_screen_text_color,
        #else 
            gui_color(0, 0, 0),
        #endif 
            gui_color(255, 255, 255));
    }
#else /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
    {
		S32 ty = CM_y;

        CM_x = 1;
		if (max_icon_h > text_height)
        {
            ty = CM_y + ((max_icon_h - text_height) >> 1);
		}

        gui_create_scrolling_text(
            &CM_scrolling_text, x_shift, ty + 1,
            text_width, text_height,
            MMI_message_string,
            CM_scrolling_text_timer_callback, CM_draw_scrolling_text_background,
        #ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
            *current_MMI_theme->CM_screen_text_color,
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
            *current_MMI_theme->list_normal_text_color,
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
        #else
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
            gui_color(0, 0, 0),
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
            *current_MMI_theme->list_normal_text_color,
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
        #endif 
            gui_color(255, 255, 255));
    }
#endif /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */

    CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;

    gdi_layer_unlock_frame_buffer();

    s32flags = DM_CLEAR_SCREEN_BACKGROUND;
#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
	if (!cat_momt_is_show_default)
	{
		if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID) ||
			(cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE))
		{
			if (cat_momt_is_video_open)
			{
				s32flags |= DM_NO_BLT;
			}
		}
	}
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */

	wgui_cat_setup_category(MMI_CATEGORY18_ID, s32flags, ExitMOMTCallScreen, dummy_get_history,	dummy_get_history_size);
    dm_register_category_controlled_callback(DrawMOMTCallScreenControllArea);
    dm_redraw_category_screen();

    /* if the screen is from the pop-up go-back, do not play video */
    if (mmi_is_redrawing_bk_screens())
    {
        return;
    }

#ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__
    if (!cat_momt_is_show_default)
    {
        /* start play video */
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE))
        {
            mdi_ret = mdi_video_ply_seek(0);

            if (mdi_ret >= 0)
            {
                /* if aud is on but not play when start, mute it */
                if (cat_momt_is_aud_enable && !cat_momt_is_play_aud_when_start)
                {
					MomtSetMute(MMI_TRUE);
                }
            }

            if (mdi_ret >= 0)
            {
                MOMT_set_blt_layer();

                /* dm_redraw_category_screen will not blt when call video,
                 * blt here for the first frame of the video */
                gdi_lcd_repaint_all();

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) && defined(__DRM_SUPPORT__)
                wgui_catvdo_configure_drm_play();
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) && defined(__DRM_SUPPORT__) */

                mdi_ret = mdi_video_ply_play(
                            wgui_layer_1,
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
                            GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1,
                            GDI_LAYER_ENABLE_LAYER_1,
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
                            GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1 | GDI_LAYER_ENABLE_LAYER_2,
                            GDI_LAYER_ENABLE_LAYER_2,
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
                            (U16) cat_momt_repeat_count,    /* this to recrod repeat count */
                            cat_momt_is_visual_update,      /* update to LCM or not */
                            cat_momt_is_aud_enable,         /* play aud or not */
                            MDI_DEVICE_SPEAKER_BOTH,        /* speaker & earphone */
                            MDI_VIDEO_LCD_ROTATE_0,         /* rotate */
                            100,                            /* 1x play speed */
                            NULL, 0);                       /* do not hook callback */
            }

            cat_momt_is_video_play = (mdi_ret >= 0) ? TRUE : FALSE;

            /* play failed */
            if (mdi_ret < 0)
            {
                /* faild, need to play default image */
                cat_momt_is_show_default = TRUE;
                img_ret = gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);
                MMI_ASSERT(img_ret >= 0);
            }
        }
    }
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 

#ifdef __MMI_SWFLASH__
    if (!cat_momt_is_show_default)
    {
        if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID) ||
            (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE))
        {
            MOMT_set_blt_layer();
            
            gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
        }
     }
#endif /* __MMI_SWFLASH__ */
#endif /* __MMI_MAINLCD_128X64__ */
}


/* For detail description, please refer to wgui_categories_CM.h */
void MOMTHideAnimation(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (MOMT_animation_handle != GDI_ERROR_HANDLE)
    {
        gdi_image_stop_animation(MOMT_animation_handle);
        MOMT_animation_handle = GDI_ERROR_HANDLE;
    }
    gui_cross_hatch_fill_rectangle(
        wgui_image_clip_x1,
        wgui_image_clip_y1,
        wgui_image_clip_x2,
        wgui_image_clip_y2,
        UI_COLOR_BLACK);
}


#if defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__)
/*****************************************************************************
 * FUNCTION
 *  RedrawMOMTCallScreen_3
 * DESCRIPTION
 *  Redraw MOMT Call Screen for 128x64 mainlcd size
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void RedrawMOMTCallScreen_3(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    UI_set_main_LCD_graphics_context();

    gdi_layer_reset_clip();
#ifdef __MMI_MAINLCD_96X64__   
    gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));
#else /*__MMI_MAINLCD_96X64__*/
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, current_MMI_theme->CM_screen_background_filler);
#endif /*__MMI_MAINLCD_96X64__*/

    wgui_status_icon_bar_update();
 
    if (MMI_message_string2 != NULL)
    {
        S32 x, w, str_w, str_h;
        gui_set_font(&MMI_medium_font);
#ifdef __MMI_MAINLCD_96X64__
        gui_set_text_color(gui_color(255, 255, 255));
#else /*__MMI_MAINLCD_96X64__*/
        gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
#endif /*__MMI_MAINLCD_96X64__*/
        gui_push_clip();
        gui_reset_clip();
        x = (mmi_fe_get_r2l_state()) ? (UI_device_width - 2) : (1);
        w = UI_device_width - 2;

        gui_measure_string(MMI_message_string2, &str_w, &str_h);
        if (str_w < w)
        {
            x += (mmi_fe_get_r2l_state()) ? (-((w - str_w) >> 1)) : ((w - str_w) >> 1);
            w = str_w;
        }

        gui_print_truncated_text(x, CM_y - str_h - 2, w, MMI_message_string2);

        gui_pop_clip();
    }

    if (MMI_message_string)
    {
        gui_show_scrolling_text(&CM_scrolling_text);
    }

    show_softkey_background();
    show_left_softkey();
    show_right_softkey();

    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
#endif /* defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__) */

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
/*****************************************************************************
 * FUNCTION
 *  wgui_cat_is_video_from_err
 * DESCRIPTION
 *  check whether is video from error ret of get video frame function 
 * PARAMETERS
 *  vRet			[IN]		result from get video frame function 
 *  res_type		[IN]		res type of wgui_cate_momt_res_type_enum
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL wgui_cat_is_video_from_err(S32 vRet, wgui_cate_momt_res_type_enum res_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables												  */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body													  */
    /*----------------------------------------------------------------*/
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
	if ((res_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID)
		|| (res_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE))
	{
		if (vRet == MDI_RES_VDOPLY_ERR_GET_FRAME_FAILED)
		{
			return MMI_TRUE;
		}
	}
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */
	return MMI_FALSE;
}
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/

/*****************************************************************************
 * FUNCTION
 *  RedrawMOMTCallScreen
 * DESCRIPTION
 *  Redraw MOMT Call Screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void RedrawMOMTCallScreen(void)
{
#if defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__)
    RedrawMOMTCallScreen_3();
#else /* defined(__MMI_MAINLCD_128X64__) || defined(__MMI_MAINLCD_96X64__) */
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    UI_filled_area *bg_filler;
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
    S32 image_width;
    S32 image_height;
    S32 image_offset_x;
    S32 image_offset_y;
    S32 resized_width, resized_height;
#if defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)
    GDI_RESULT image_ret;
#endif /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
    MDI_RESULT mdi_ret;
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/

#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    gdi_handle base_layer_handle, old_layer_handle;
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
	GDI_RESULT ret;
	MMI_BOOL is_am;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    UI_set_main_LCD_graphics_context();

#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    /* fill with theme background color */
    bg_filler = current_MMI_theme->CM_screen_background_filler;
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

    gdi_layer_reset_clip();
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
    gui_draw_filled_area(0, 0, UI_device_width - 1, UI_device_height - 1, bg_filler);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
#if (defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__)) && defined(__MMI_MAINLCD_240X320__)
    #ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
    gdi_draw_solid_rect(
    	0,
    	UI_device_height - MMI_BUTTON_BAR_HEIGHT - MMI_CM_MAX_IMG_HEIGHT,
    	UI_device_width - 1,
    	UI_device_height - MMI_BUTTON_BAR_HEIGHT - 1,
        GDI_COLOR_WHITE);
	#endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#else
    #ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
    gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    DrawMOMTBackground_scanline(0, 0, UI_device_width - 1, UI_device_height - 1, MMI_TRUE);
#else /* __MMI_CATEGORY_CM_SCANLINE__ */
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
    if (!((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE)
        || (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID)
        || (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE)
        || (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID)))
    {
        DrawCMImageBackground();
    }
#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ || __MMI_SWFLASH__ */
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
#endif /* __MMI_SLIM_IMG_RES__ */
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

    if (status_icon == 1)
    {
        show_title_status_icon();
        wgui_status_icon_bar_update();
    }
    else if (status_icon == 2)
    {
        draw_title();
        show_title_status_icon();
    }

#ifndef __MMI_CM_SCREEN_HIDE_DATE_TIME__
    if (UI_device_height == 128 && CM_Screen_show_date_time_bar == 1)
    {
        CM_screens_draw_date_time_bar();
        show_main_LCD_dt_display();
    }
#endif /* __MMI_CM_SCREEN_HIDE_DATE_TIME__ */ 

    image_offset_x = 0;
    image_offset_y = 0;
	resized_width = 0;
	resized_height = 0;
#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    gdi_layer_get_base_handle(&base_layer_handle);
    old_layer_handle = gdi_set_alpha_blending_source_layer(base_layer_handle);
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
    if (!cat_momt_is_show_default)
    {

        if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID) /* iamge from id */
        {
		#ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
			ret = gdi_image_is_animation(get_image(cat_momt_default_image_id), &is_am);
			if(!(ret >= 0 && is_am == MMI_TRUE))
			{
				gdi_layer_push_and_set_clip(0, MMI_status_bar_height, UI_device_width - 1, UI_device_height - 1);
				gdi_draw_solid_rect(0, MMI_status_bar_height, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
				gdi_layer_pop_clip();	
			}
		#endif /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__*/
            gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);
			if (CM_need_change_clip)
			{
                 gdi_image_get_dimension(get_image(cat_momt_resource_id), &image_width, &image_height);

				 gdi_image_util_fit_bbox(
                        wgui_image_clip_x2 - wgui_image_clip_x1 + 1,
                        wgui_image_clip_y2 - wgui_image_clip_y1 + 1,
                        image_width,
                        image_height,
                        &image_offset_x,
                        &image_offset_y,
                        &resized_width,
                        &resized_height);
			}
			gdi_anim_draw_resized(
				wgui_image_clip_x1 + image_offset_x,
				wgui_image_clip_y1 + image_offset_y,
				resized_width,
				resized_height,
				(U8*) GetImage(cat_momt_resource_id),
				&MOMT_animation_handle);
        }
		#if defined(__MMI_AVATAR__)
        else if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_AVATAR_FILE)
        {
            image_ret = gdi_image_get_dimension_mem(GDI_IMAGE_TYPE_AVATAR,(PU8) cat_momt_resource_filename,0,&image_width,&image_height);        

            if (image_ret >= 0)
            {
                if (CM_need_change_clip)
                {
                    wgui_image_clip_x1 = 0;
                    wgui_image_clip_x2 = UI_device_width - 1;
                    gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);

                    /* image larger than drawable region */
                    gdi_image_util_fit_bbox(
                        UI_device_width,
                        wgui_image_clip_y2 - wgui_image_clip_y1 + 1,
                        image_width,
                        image_height,
                        &image_offset_x,
                        &image_offset_y,
                        &resized_width,
                        &resized_height);

                    image_ret = gdi_anim_draw_mem_resized(
                                    wgui_image_clip_x1 + image_offset_x,
                                    wgui_image_clip_y1 + image_offset_y,
                                    resized_width,
                                    resized_height,
                                    (CHAR*) cat_momt_resource_filename,
                                    GDI_IMAGE_TYPE_AVATAR,
                                    0, 
                                    &MOMT_animation_handle);
                }
                else
                {
                    gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);

                    image_ret = gdi_anim_draw_mem(
                                    wgui_image_clip_x1,
                                    wgui_image_clip_y1,
                                    (CHAR*) cat_momt_resource_filename,
                                    GDI_IMAGE_TYPE_AVATAR,
                                    0, 
                                    &MOMT_animation_handle);
                }
                if (image_ret >= 0)
                    cat_momt_is_avatar_play = TRUE;
            }

            if (image_ret < 0)
            {
                /* faild, need to play default image */
                cat_momt_is_show_default = TRUE;
            }
        }
		#endif /* __MMI_AVATAR__ */
        #ifdef __CATE_CM_PHB_CALLER_RES__
        else if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE)  /* image from file */
        {
            image_ret = gdi_image_get_dimension_file((CHAR*) cat_momt_resource_filename, &image_width, &image_height);

            if (image_ret >= 0)
            {
                if (CM_need_change_clip)
                {
                    wgui_image_clip_x1 = 0;
                    wgui_image_clip_x2 = UI_device_width - 1;
                    gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);

                    /* image larger than drawable region */
                    gdi_image_util_fit_bbox(
                        UI_device_width,
                        wgui_image_clip_y2 - wgui_image_clip_y1 + 1,
                        image_width,
                        image_height,
                        &image_offset_x,
                        &image_offset_y,
                        &resized_width,
                        &resized_height);
                }
                else
                {
                    gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);

					image_offset_x = (wgui_image_clip_x2 - wgui_image_clip_x1 + 1 - image_width) >> 2;
					image_offset_y = (wgui_image_clip_y2 - wgui_image_clip_y1 + 1 - image_height) >> 2;
                }
				image_ret = gdi_anim_draw_file_resized(
								wgui_image_clip_x1 + image_offset_x,
								wgui_image_clip_y1 + image_offset_y,
								resized_width,
								resized_height,
								(CHAR*) cat_momt_resource_filename,
								&MOMT_animation_handle);
            }

            if (image_ret < 0)
            {
                /* faild, need to play default image */
                cat_momt_is_show_default = TRUE;
            }
        }
        #endif /*__CATE_CM_PHB_CALLER_RES__*/
		#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
        else if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
                 (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
        {
            if (cat_momt_is_video_open) /* open file successfully */
            {
                //MDI_RESULT vdo_open_ret;

                //if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID)
                //{
                //    vdo_open_ret = mdi_video_ply_open_clip_id(cat_momt_resource_id, &wgui_video_info);
                //}
                //else
                //{
                //    vdo_open_ret = mdi_video_ply_open_clip_file(cat_momt_resource_filename, &wgui_video_info);
                //}
			#if defined(__MMI_VIDEO_3D_ANAGLYPH__)
				/* set 3d type */
			    if (cat_momt_is_3d_type)
			    {
			        mdi_video_ply_set_track_index(cat_momt_3d_track_index);
			    }
			#endif /* __MMI_VIDEO_3D_ANAGLYPH__ */
                /* seek to first frame */
                mdi_ret = mdi_video_ply_seek_and_get_frame(0, wgui_layer_1);

                if (mdi_ret < 0)
                {
                    /* faild, need to play default image */
					if (!wgui_cat_is_video_from_err(mdi_ret, cat_momt_resource_type))
					{
					    cat_momt_is_show_default = TRUE;
					}
                }

                //if (vdo_open_ret >= 0)
                //{
                //    if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID)
                //    {
                //        mdi_video_ply_close_clip_id();
                //    }
                //    else
                //    {
                //        mdi_video_ply_close_clip_file();
                //    }
                //}
            }
            else
            {
                MMI_ASSERT(0);
            }
        }
		#endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */
		#if defined(__MMI_SWFLASH__)
        else if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE) ||
                 (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID))
        {
            if (cat_momt_is_swflash_open)    /* open file successfully */
            {
                MOMT_set_blt_layer();

                if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID)
                {
                    if (cat_momt_is_aud_enable)
                    {
                        mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, SWFLASH_PLAYER, &wgui_swflash_info);
                    }
                    else
                    {
                        mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, SWFLASH_SCREEN, &wgui_swflash_info);
                    }
                }
                else
                {
                    if (cat_momt_is_aud_enable)
                    {            
                        mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, SWFLASH_PLAYER, &wgui_swflash_info);
                    }
                    else
                    {
                        mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, SWFLASH_SCREEN, &wgui_swflash_info);
                    }
                }

                if (mdi_ret >= 0)
                {
                    mdi_ret = mdi_swflash_play(
                                wgui_layer_1,                       /* layer */
                                0,                                  /* repeat_count */
                                MDI_DEVICE_SPEAKER_BOTH,            /* audio_path */
                                MOMTPlaySWFlashResultCallback);     /* play_result_callback */
                }

                cat_momt_is_swflash_play = (mdi_ret >= 0) ? TRUE : FALSE;

                if (mdi_ret >= 0)
                {
                    /* if aud is on but not play when start, mute it */
                    if (cat_momt_is_aud_enable && !cat_momt_is_play_aud_when_start)
                    {
                        MomtSetMute(TRUE);
                    }
                }

                if (mdi_ret < 0)
                {
                    /* faild, need to play default image */
                    cat_momt_is_show_default = TRUE;
                }
            }
            else
            {
                MMI_ASSERT(0);
            }

        }
		#endif /* __MMI_SWFLASH__ */
        else
        {
            MMI_ASSERT(0);
        }
    }   /* not show default image */

    /* show default image if needed */
    if (cat_momt_is_show_default)
    {
        gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);

#ifndef __MMI_WALLPAPER_ON_BOTTOM__
        gui_draw_filled_area(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2, bg_filler);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
  #if (defined(__MMI_SLIM_IMG_RES__) || defined(__WGUI_CATE_FTE_KEY_ONLY__)) && defined(__MMI_MAINLCD_240X320__)
    #ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
		ret = gdi_image_is_animation(get_image(cat_momt_default_image_id), &is_am);
		if(ret >= 0 && is_am == MMI_TRUE)
	        gdi_draw_solid_rect(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2, GDI_COLOR_WHITE);
		else			
		{
			gdi_layer_push_and_set_clip(0, 0, UI_device_width - 1, UI_device_height - 1);
	        gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
			gdi_layer_pop_clip();
		}
    #endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */
  #else /*__MMI_SLIM_IMG_RES__*/
	#ifndef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ 
		gdi_draw_solid_rect(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2, GDI_COLOR_TRANSPARENT);
	#endif /* __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__ */

  #endif /*__MMI_SLIM_IMG_RES__*/
#if defined(__MMI_CATEGORY_CM_SCANLINE__)
        DrawMOMTBackground_scanline(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2, MMI_TRUE);
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

        SetMOMTCallImageClip(image_width, image_height);
        gdi_layer_set_clip(wgui_image_clip_x1, wgui_image_clip_y1, wgui_image_clip_x2, wgui_image_clip_y2);

        if (CM_need_change_clip)
        {
            gdi_image_util_fit_bbox(
                wgui_image_clip_x2 - wgui_image_clip_x1 + 1,
                wgui_image_clip_y2 - wgui_image_clip_y1 + 1,
                image_width,
                image_height,
                &image_offset_x,
                &image_offset_y,
                &resized_width,
                &resized_height);
        }
		
        gdi_anim_draw_resized(
            wgui_image_clip_x1 + image_offset_x,
            wgui_image_clip_y1 + image_offset_y,
            resized_width,
            resized_height,
            (U8*) GetImage(cat_momt_default_image_id),
            &MOMT_animation_handle);
        
    }

#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    gdi_set_alpha_blending_source_layer(old_layer_handle);
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */

    if (gMMI_UI_U8_flag_1 == 1)
    {
        S32 x, w;

        gui_set_font(&MMI_medium_font);
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
        gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
        gui_set_text_color(*current_MMI_theme->list_normal_text_color);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

        gui_push_clip();
        gui_reset_clip();
        x = (mmi_fe_get_r2l_state()) ? (UI_device_width - 2) : (1);
        w = UI_device_width - 2;
#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
        {
            S32 str_w, str_h, h;

            gui_measure_string(MMI_message_string2, &str_w, &str_h);
            if (str_w < w)
            {
                x += (mmi_fe_get_r2l_state()) ? (-((w - str_w) >> 1)) : ((w - str_w) >> 1);
                w = str_w;
            }

            h = Get_CharDisplayHeightOfAllLangAndType(UI_font->size);
            gui_print_truncated_text(x, CM_y - h, w, MMI_message_string2);
        }
#else /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/
        gui_print_truncated_text(x, MMI_status_bar_height, w, MMI_message_string2);
#endif /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/
        gui_pop_clip();
    }

    if (gCallLine || g_wgui_catcall_number_type_icons)
    {
        S32 icon_w = 0, icon_h = 0;
        GDI_HANDLE active_layer;
        gdi_layer_push_clip();
        gdi_layer_reset_clip();
#ifdef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__
		gdi_layer_clear(GDI_COLOR_TRANSPARENT);
        gdi_layer_get_active(&active_layer);
        gdi_push_and_set_alpha_blending_source_layer(active_layer);
#endif /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__*/
        if (gCallLine)
        {
            gdi_image_draw_id(CM_x, CM_y, gCallLine);
			gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
            icon_w += 1;
        }
        if (g_wgui_catcall_number_type_icons)
        {
            gdi_image_draw_id(CM_x + icon_w, CM_y, g_wgui_catcall_number_type_icons[0]);
        }
#ifdef __MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__
	    gdi_pop_and_restore_alpha_blending_source_layer();
#endif /*__MMI_IMAGE_CACHE_FOR_ONE_GDI_LAYER__*/
        gdi_layer_pop_clip();
    }

    if (MMI_message_string)
    {
        gui_show_scrolling_text(&CM_scrolling_text);
    }

#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    disable_softkey_background();
    register_hide_left_softkey(MOMT_hide_left_softkey_scanline);
    register_hide_right_softkey(MOMT_hide_right_softkey_scanline);
    register_hide_softkey(MOMT_hide_center_softkey_scanline, MMI_CENTER_SOFTKEY);
#else /* __MMI_CATEGORY_CM_SCANLINE__ */
    show_softkey_background();
    show_left_softkey();
    show_right_softkey();
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */

    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
#endif /* __MMI_MAINLCD_128X64__ */
}


/*****************************************************************************
 * FUNCTION
 *  SetMOMTCallImageClip
 * DESCRIPTION
 *  Set image clips for  MO MT call cateogryscreen
 * PARAMETERS
 *  image_width         [IN]        Image width
 *  image_height        [IN]        Image height
 * RETURNS
 *  void
 *****************************************************************************/
static void SetMOMTCallImageClip(S32 image_width, S32 image_height)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 font_height;
#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
    S32 text_y;
    S32 string_width;
    S32 string_height;
    S32 y;
#endif /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CM_need_change_clip = FALSE;

    gui_set_font(&MMI_medium_font);
#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
    gui_measure_string(MMI_message_string, &string_width, &string_height);
#endif /*defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)*/

    font_height = Get_CharDisplayHeightOfAllLangAndType(UI_font->size);

#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
    {
        text_y = MMI_status_bar_height + main_LCD_dt_object.date.height + main_LCD_dt_object.time.height + 2;

        y = UI_device_height - MMI_button_bar_height - font_height - string_height - 1;

        CM_y = UI_device_height - MMI_button_bar_height - string_height;

        /* calcaute drawable region for image and video */
        wgui_image_clip_x1 = 0;
        wgui_image_clip_x2 = UI_device_width - 1;
        wgui_image_clip_y1 = text_y + 2;

        if (gMMI_UI_U8_flag_1 == 1) /* with Calling string, MO */
        {
            wgui_image_clip_y2 = y - 1;
        }
        else    /* without Calling string, MT */
        {
            wgui_image_clip_y2 = CM_y - 1 - 2;
        }

        if (image_width <= UI_device_width)
        {
            wgui_image_clip_x1 = (UI_device_width - image_width) >> 1;
            wgui_image_clip_x2 = wgui_image_clip_x1 + image_width - 1;
        }
        else
        {
            CM_need_change_clip = TRUE;
        }

        if (wgui_image_clip_y2 - wgui_image_clip_y1 + 1 < image_height)
        {
            /* no enough space to display image */
            CM_Screen_show_date_time_bar = 0;
			wgui_image_clip_y1 = ((wgui_image_clip_y2 + 1 - MMI_status_bar_height - image_height) >> 1) + MMI_status_bar_height - 1;
            deactive_main_lcd_update_date_time();
            if (wgui_image_clip_y2 - wgui_image_clip_y1 + 1 < image_height)
            {
                CM_need_change_clip = TRUE;
            }
        }
        else
        {
            CM_Screen_show_date_time_bar = 1;
        }

    }
#else /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
    {
        deactive_main_lcd_update_date_time();

        CM_y = MMI_status_bar_height + font_height;

        /* calcaute drawable region for image and video */
        wgui_image_clip_x1 = 0;
        wgui_image_clip_x2 = UI_device_width - 1;

#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) 
        /* put the image at the bottom */
        if (image_height < UI_device_height - MMI_button_bar_height - (CM_y + 1 + string_height))
        {
            wgui_image_clip_y1 = UI_device_height - MMI_button_bar_height - image_height;
            wgui_image_clip_y2 = wgui_image_clip_y1 + image_height - 1;
        }
#else /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
        if (image_height <= MMI_CM_MAX_IMG_HEIGHT)
        {
            /* put the image at the center */
            wgui_image_clip_y1 = UI_device_height - MMI_button_bar_height - image_height - ((MMI_CM_MAX_IMG_HEIGHT - image_height) >> 1);
            wgui_image_clip_y2 = wgui_image_clip_y1 + image_height - 1;
        }
#endif /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
        else
        {
#if defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__)
            /* put the image at the bottom */
            wgui_image_clip_y1 = CM_y + 1 + string_height + 1;  /* one pixel for gap */
#else /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
            wgui_image_clip_y1 = UI_device_height - MMI_button_bar_height - MMI_CM_MAX_IMG_HEIGHT;
#endif /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
            /* indicate the input image is higher than displayable area */
            wgui_image_clip_y2 = UI_device_height - MMI_button_bar_height - 1;
            CM_need_change_clip = TRUE;
        }
        if (image_width <= UI_device_width)
        {
            wgui_image_clip_x1 = (UI_device_width - image_width) >> 1;
            wgui_image_clip_x2 = wgui_image_clip_x1 + image_width - 1;
        }
        else
        {
            /* indicate the input image is wider than displayable area */
            CM_need_change_clip = TRUE;
        }
    }
#endif /* defined(__MMI_MAINLCD_128X128__) && !defined(__WGUI_CATE_CM_MOMT_COMMON_STYLE__) */
}


/*****************************************************************************
 * FUNCTION
 *  DrawMOMTCallScreenControllArea
 * DESCRIPTION
 *  draw MOMT screen control area
 * PARAMETERS
 *  coordinate      [IN]        Coordinae of redraw area
 * RETURNS
 *  void
 *****************************************************************************/
void DrawMOMTCallScreenControllArea(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    RedrawMOMTCallScreen();
}


/*****************************************************************************
 * FUNCTION
 *  MOMTPlaySWFlashResultCallback
 * DESCRIPTION
 *  play swflash result callback function
 * PARAMETERS
 *  result      [IN]        Play vido result
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_SWFLASH__
static void MOMTPlaySWFlashResultCallback(MDI_RESULT result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
}
#endif /* __MMI_SWFLASH__ */ 


/*****************************************************************************
 * FUNCTION
 *  ExitMOMTCallScreen
 * DESCRIPTION
 *  Exit MO MT call screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void ExitMOMTCallScreen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_set_main_LCD_graphics_context();

    MOMT_animation_handle = GDI_ERROR_HANDLE;
    //isCallDisconnecting = MMI_FALSE;

    gui_cancel_timer(CM_scrolling_text_timer_callback);
    close_main_LCD_dt_display();

#if defined(__MMI_CATEGORY_CM_SCANLINE__)
    enable_softkey_background();
#endif /* __MMI_CATEGORY_CM_SCANLINE__ */
#if !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__)
    enactive_main_lcd_update_date_time();

    if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
    {
    #ifdef __CATE_CM_VIDEO_PLAY_SUPPORT__

        if (cat_momt_is_video_open)
        {
            /* stop video playing */
            if (cat_momt_is_video_play)
            {
                MDI_RESULT ret;
                
                ret = mdi_video_ply_stop();
                cat_momt_is_video_play = FALSE;

                /* get current play time */
                mdi_video_ply_get_cur_play_time(&cat_momt_video_play_time);

                if (ret == MDI_RES_VDOPLY_ALREADY_FINISHED)
                {
                    /* if driver return the video has alreay finished, we have to set seek time to 0 so that next time play at start */
                    cat_momt_video_play_time = 0;
                }
                else
                {
                    mdi_video_ply_seek_and_get_frame(0, wgui_layer_1);
                }
            }

            if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE)
            {
                mdi_video_ply_close_clip_file();
            }
            else
            {
                mdi_video_ply_close_clip_id();
            }

            /* unmute */
            if (cat_momt_is_aud_muted)
            {
				MomtSetMute(MMI_FALSE);
            }

            cat_momt_is_video_open = FALSE;
        }

        if (wgui_layer_1 != GDI_LAYER_EMPTY_HANDLE)
        {
            /* flatten layers */
            gdi_layer_flatten_previous_to_base();

            gdi_layer_free(wgui_layer_1);
            wgui_layer_1 = GDI_LAYER_EMPTY_HANDLE;
        }

        gdi_layer_set_blt_layer(wgui_base_layer, 0, 0, 0);
        gdi_layer_multi_layer_disable();

        /* allows MMI LCD sleep */
        srv_backlight_turn_off();
    #else /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 
        MMI_ASSERT(0);  /* try to play video when no video function support */
    #endif /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */ 
    }
    else if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE) ||
             (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID))
    {
    #ifdef __MMI_SWFLASH__
        if (cat_momt_is_swflash_open)
        {
            /* stop swflash playing */
            if (cat_momt_is_swflash_play)
            {
                mdi_swflash_stop();
                cat_momt_is_swflash_play = FALSE;
            }

            if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE)
            {
                mdi_swflash_close_file();
            }
            else
            {
                mdi_swflash_close_id();
            }

            /* unmute */
            if (cat_momt_is_aud_muted)
            {
                MomtSetMute(FALSE);
            }

            cat_momt_is_swflash_open = FALSE;
        }

        if (wgui_layer_1 != GDI_LAYER_EMPTY_HANDLE)
        {
            /* flatten layers */
            gdi_layer_flatten_previous_to_base();

            gdi_layer_free(wgui_layer_1);
            wgui_layer_1 = GDI_LAYER_EMPTY_HANDLE;
        }

        gdi_layer_set_blt_layer(wgui_base_layer, 0, 0, 0);
        gdi_layer_multi_layer_disable();

        /* allows MMI LCD sleep */
        srv_backlight_turn_off();
    #else /* __MMI_SWFLASH__ */ 
        MMI_ASSERT(0);  /* try to play video when no video function support */
    #endif /* __MMI_SWFLASH__ */ /* __CATE_CM_VIDEO_PLAY_SUPPORT__ */
    }

#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
    if (CM_media_buffer != NULL)
    {
        applib_mem_screen_free(CM_media_buffer);
        CM_media_buffer = NULL;
    }
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

    g_wgui_catcall_number_type_icons = NULL;
#endif /* !defined(__MMI_MAINLCD_128X64__) && !defined(__MMI_MAINLCD_96X64__) */
}


/* For detail description, please refer to wgui_categories_CM.h */
void wgui_catcall_set_number_type_icons(U16 *icons)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_wgui_catcall_number_type_icons = icons;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_set_button
 * DESCRIPTION
 *  for application to set the string and function of calling button
 * PARAMETERS
 *  str     [IN]    string pointer
 *  func    [IN]    function pointer
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_catcall_set_button(UI_string_type str, FuncPtr func)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON)
    g_wgui_catcall_button_str_p = str;
    g_wgui_catcall_button_func_p = func;
#endif /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */
}


#if defined(WGUI_CATCALL_STYLE_2) || defined(__MMI_FTE_SUPPORT__)
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_allocate_layer
 * DESCRIPTION
 *  allocate layer for video or swflash playing
 * PARAMETERS
 *  x       [IN]        x
 *  y       [IN]        y
 *  w       [IN]        w
 *  h       [IN]        h
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_allocate_layer(S32 x, S32 y, S32 w, S32 h)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    GDI_HANDLE *layer;
    GDI_RESULT ret;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
    CM_media_buffer = (U8*)applib_mem_screen_alloc_framebuffer(SCRMEM_CATMOMT_POOL_SIZE);
    MMI_ASSERT(CM_media_buffer);

    ret = dm_create_layer_using_outside_memory(
            x, y, w, h,
            &layer,
            CM_media_buffer,
            SCRMEM_CATMOMT_POOL_SIZE,
            DM_LAYER_TOP);
    MMI_ASSERT(ret == GDI_SUCCEED);
    wgui_layer_1 = *layer;

    /* for gui_free_multilayer_screen */
    gdi_layer_get_base_handle(&wgui_base_layer);
#else /* defined(__MMI_WALLPAPER_ON_BOTTOM__) */
    ret = dm_create_layer(x, y, w, h, &layer, DM_LAYER_TOP);
    MMI_ASSERT(ret == GDI_SUCCEED);
#endif /* defined(__MMI_WALLPAPER_ON_BOTTOM__) */
#ifdef __MDI_DISPLAY_YUYV422_SUPPORT__
    gdi_layer_push_and_set_active(*layer);
    gdi_layer_set_color_format(GDI_COLOR_FORMAT_UYVY422);
    gdi_layer_pop_and_restore_active();
#endif /* __MDI_DISPLAY_YUYV422_SUPPORT__ */ 
}
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) */


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_draw_caller_icon
 * DESCRIPTION
 *  draw caller image / video
 * PARAMETERS
 *  x       [IN]        x
 *  y       [IN]        y
 *  w       [IN]        w
 *  h       [IN]        h
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_draw_caller_icon(S32 x, S32 y, S32 w, S32 h)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL show_default = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_and_set_clip(x, y, x + w - 1, y + h - 1);

    /* draw image */
    if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_AVATAR_FILE))
    {
        GDI_RESULT ret = -1;
        S32 img_obj = -1;

        do
        {   /* create image component */
            switch(cat_momt_resource_type)
            {
#if defined(__CATE_CM_PHB_CALLER_RES__)
                case WGUI_CATE_MOMT_RES_TYPE_IMAGE_ID:
                    ret = wgui_image_create_from_res(
                             &img_obj,
                             x, y, w, h,
                            (U8*)GetImage(cat_momt_resource_id),
                            0, GDI_NULL_HANDLE);
                    break;

                case WGUI_CATE_MOMT_RES_TYPE_IMAGE_FILE:
                    ret = wgui_image_create_from_file(
                            &img_obj,
                            x, y, w, h,
                            (U8*)cat_momt_resource_filename,
                            0, GDI_NULL_HANDLE);
                    break;
#endif /*__CATE_CM_PHB_CALLER_RES__*/
#if defined(__MMI_AVATAR__)
                case WGUI_CATE_MOMT_RES_TYPE_AVATAR_FILE:
                    ret = wgui_image_create_from_mem(
                            &img_obj,
                            x, y, w, h,
                            GDI_IMAGE_TYPE_AVATAR,
                            (U8*)cat_momt_resource_filename,
                            0, GDI_NULL_HANDLE);
                    break;
#endif /* defined(__MMI_AVATAR__) */

                default:
                    ret = -1;
                    break;

            }
            if (ret < 0 || img_obj < 0)    break;

#if defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)
            /* show image component */
            ret = wgui_image_show(img_obj);
            if (ret < 0 || img_obj < 0)    break;
#endif /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/
        } while (0);

        if (ret < 0)
        {
            show_default = MMI_TRUE;
#if defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)
            if (img_obj >= 0)
            {
                wgui_image_close(img_obj);
            }
#endif /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/
        }
    }
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
    /* draw video */
    if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE))
    {
        MDI_RESULT mdi_ret = -1;
        S32 mw = 0, mh = 0;
#if defined(__MMI_SWFLASH__)
        U32 play_mode = (cat_momt_is_aud_enable) ? (SWFLASH_PLAYER) : (SWFLASH_SCREEN);
#endif /* defined(__MMI_SWFLASH__) */

        do
        {
            /* open video / swflash */
            switch(cat_momt_resource_type)
            {
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
                case WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID:
                    mdi_ret = mdi_video_ply_open_clip_id(0, cat_momt_resource_id, &wgui_video_info);
                    cat_momt_is_video_open = (mdi_ret >= 0) ? TRUE : FALSE;
                    break;

                case WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE:
                    mdi_ret = mdi_video_ply_open_clip_file(0, cat_momt_resource_filename, &wgui_video_info);
                    cat_momt_is_video_open = (mdi_ret >= 0) ? TRUE : FALSE;
                    break;
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_SWFLASH__)
                case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID:
                    mdi_ret = mdi_swflash_open_id(cat_momt_resource_id, play_mode, &wgui_swflash_info);
                    cat_momt_is_swflash_open = (mdi_ret >= 0) ? TRUE : FALSE;
                    break;

                case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE:
                    mdi_ret = mdi_swflash_open_file(cat_momt_resource_filename, play_mode, &wgui_swflash_info);
                    cat_momt_is_swflash_open = (mdi_ret >= 0) ? TRUE : FALSE;
                    break;
#endif /* defined(__MMI_SWFLASH__) */

                default:
                    mdi_ret = -1;
                    break;
            }
            if (mdi_ret < 0)    break;

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    #if defined(__MDI_DISPLAY_FIT_INSIDE_SUPPORT__)
	        mw = w;
	        mh = h;
	#else /* __MDI_DISPLAY_FIT_INSIDE_SUPPORT__ */
            mw = (cat_momt_is_video_open) ? (wgui_video_info.width) : (mw);
            mh = (cat_momt_is_video_open) ? (wgui_video_info.height) : (mh);
	#endif /* __MDI_DISPLAY_FIT_INSIDE_SUPPORT__ */
	
    #if defined(__MMI_VIDEO_3D_ANAGLYPH__)
		{
			S32 index;
	
			cat_momt_is_3d_type = MMI_FALSE;
			for(index = 0; index < wgui_video_info.track_num; index++)
			{
				if(wgui_video_info.track_info[index].track_type == MDI_VIDEO_TRACK_3D)
				{
					cat_momt_3d_track_index = wgui_video_info.track_info[index].track_index;
					cat_momt_is_3d_type = MMI_TRUE;
					break;
				}
			}
		}
    #endif /* __MMI_VIDEO_3D_ANAGLYPH__*/
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_SWFLASH__)
            mw = (cat_momt_is_swflash_open) ? (wgui_swflash_info.width) : (mw);
            mh = (cat_momt_is_swflash_open) ? (wgui_swflash_info.height) : (mh);
#endif /* defined(__MMI_SWFLASH__) */

            {   /* create layer */
                S32 rx = 0, ry = 0, rw = 0, rh = 0;
                S32 lx = 0, ly = 0, lw = 0, lh = 0;

                if ((mw > w) || (mh > h))
                {
                    gdi_image_util_fit_bbox(
                        w, h, mw, mh,
                        &rx, &ry, &rw, &rh);
                }
                else
                {
                    rx = (w - mw) >> 1;
                    ry = (h - mh) >> 1;
                    rw = mw;
                    rh = mh;
                }
                
                lx = x + rx;
                ly = y + ry;
                lw = rw;
                lh = rh;

                if (cat_momt_is_video_open)
                {
                    wgui_catvdo_refine_video_coordinate(&lx, &ly, &lw, &lh);
                }

                wgui_catcall_allocate_layer(lx, ly, lw, lh);
            }

            /* play video / swflash */
            switch(cat_momt_resource_type)
            {
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
                case WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID:
                case WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE:
				#if defined(__MMI_VIDEO_3D_ANAGLYPH__)
					{
						if (cat_momt_is_3d_type)
						{
						    mdi_video_ply_set_track_index(cat_momt_3d_track_index);
						}
					}
				#endif /* __MMI_VIDEO_3D_ANAGLYPH__ */
                    mdi_ret = mdi_video_ply_seek_and_get_frame(0, wgui_layer_1);
                    break;
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_SWFLASH__)
                case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID:
                case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE:
                    mdi_ret = mdi_swflash_play(
                                wgui_layer_1,                       /* layer */
                                0,                                  /* repeat_count */
                                MDI_DEVICE_SPEAKER_BOTH,            /* audio_path */
                                MOMTPlaySWFlashResultCallback);     /* play_result_callback */
                    cat_momt_is_swflash_play = (mdi_ret >= 0) ? TRUE : FALSE;
                    break;
#endif /* defined(__MMI_SWFLASH__) */

                default:
                    mdi_ret = -1;
                    break;
            }
			if (mdi_ret < 0)
			{
			    if (!wgui_cat_is_video_from_err(mdi_ret, cat_momt_resource_type))
			    {
			        break;
			    }
			}

            /* if aud is on but not play when start, mute it */
            if (cat_momt_is_aud_enable && !cat_momt_is_play_aud_when_start)
            {
               MomtSetMute(MMI_TRUE);
            }
            else
            {
                srv_prof_volume_level vol_level;

                srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_RING_VOL_LEVEL, (void*)&vol_level);
                mdi_audio_set_volume(MDI_VOLUME_MEDIA, (U8)vol_level);
            }
        } while (0);

        show_default = (mdi_ret >= 0) ? (MMI_FALSE) : (MMI_TRUE);
    }
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/
    /* draw default icon */
    if (show_default == MMI_TRUE)
    {
#if defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)
        GDI_RESULT ret = -1;
        S32 img_obj = -1;
#endif /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/

        /* backward compatible */
        cat_momt_is_show_default = TRUE;

        /* clear background */
        gdi_draw_solid_rect(x, y, x + w - 1, y + h - 1, GDI_COLOR_TRANSPARENT);

        do
        {  
#if defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)
            /* create image component */
            ret = wgui_image_create_from_res(
                     &img_obj,
                     x, y, w, h,
                     (U8*)GetImage(cat_momt_default_image_id),
                     0, GDI_NULL_HANDLE);
            if (ret < 0 || img_obj < 0)    break;

            /* show image component */
            ret = wgui_image_show(img_obj);
            if (ret < 0 || img_obj < 0)    break;
#else /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/
            gdi_image_draw_resized_id(x, y, w, h, (cat_momt_resource_id > 0 ? cat_momt_resource_id : cat_momt_default_image_id));
#endif /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/
        } while (0);
    }

    gdi_layer_pop_clip();
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_exit
 * DESCRIPTION
 *  exit category 18
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_exit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(cat_momt_resource_type)
    {
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
        case WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID:
        case WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE:
            srv_gpio_play_pattern((srv_gpio_pattern_id_enum)srv_led_pattern_get_bg_pattern(), SRV_GPIO_PATN_PLAY_START);
            srv_backlight_turn_off();    
            if (cat_momt_is_video_play)
            {
                mdi_video_ply_stop();
                cat_momt_is_video_play = FALSE;
                /* get current play time */
                mdi_video_ply_get_cur_play_time(&cat_momt_video_play_time);
                mdi_video_ply_seek_and_get_frame(0, wgui_layer_1);
            }
            if (cat_momt_is_video_open)
            {
                if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID)
                {
                    mdi_video_ply_close_clip_id();
                }
                else
                {
                    mdi_video_ply_close_clip_file();
                }
                cat_momt_is_video_open = FALSE;
            }
            break;
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_SWFLASH__)
        case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID:
        case WGUI_CATE_MOMT_RES_TYPE_SWFLASH_FILE:
            if (cat_momt_is_swflash_play)
            {
                mdi_swflash_stop();
                cat_momt_is_video_play = FALSE;
            }
            if (cat_momt_is_swflash_open)
            {
                if (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_SWFLASH_ID)
                {
                    mdi_swflash_close_id();
                }
                else
                {
                    mdi_swflash_close_file();
                }
                cat_momt_is_swflash_open = FALSE;
            }
            break;
#endif /* defined(__MMI_SWFLASH__) */

        default:
            break;
    }
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
    /* unmute */
    if (cat_momt_is_aud_muted)
    {
        MomtSetMute(MMI_FALSE);
    }
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/
    gui_cancel_timer(CM_scrolling_text_timer_callback);
    close_main_LCD_dt_display();
    wgui_clock_close_all();
#if defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)
    wgui_image_close_all();
#endif /*defined(__CATE_CM_PHB_CALLER_RES__) || defined(__MMI_AVATAR__)*/

#ifdef __GDI_MEMORY_PROFILE_2__
    wgui_cat033_reset_text_abm_layer();
#endif

#if defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON)
    g_wgui_catcall_button_str_p = NULL;
    g_wgui_catcall_button_func_p = NULL;
#endif /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */

#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
    if (CM_media_buffer != NULL)
    {
        applib_mem_screen_free(CM_media_buffer);
        CM_media_buffer = NULL;
    }
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

#if defined(WGUI_CATCALL_STYLE_2)
    g_wgui_catcall_display_duration = MMI_FALSE;
    g_wgui_catcall_duration = NULL;
    g_wgui_catcall_calltype = NULL;
#endif /* defined(WGUI_CATCALL_STYLE_2) */
    
    /* trick: in order to update duration only, disable updating date and time */
    enactive_main_lcd_update_date_time();

    g_wgui_catcall_number_type_icons = NULL;
}
#endif /* defined(WGUI_CATCALL_STYLE_2) || defined(__MMI_FTE_SUPPORT__) */


#if defined(WGUI_CATCALL_STYLE_2)
/*****************************************************************************
 * FUNCTION
 *  wgui_cat_dummy_hide_function
 * DESCRIPTION
 *  dummy hide function
 * PARAMETERS
 *  x1      [IN]        Start x position
 *  y1      [IN]        Start y position
 *  x2      [IN]        End x position
 *  y2      [IN]        End y position
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat_dummy_hide_function(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(x1);
    UI_UNUSED_PARAMETER(y1);
    UI_UNUSED_PARAMETER(x2);
    UI_UNUSED_PARAMETER(y2);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_draw_ctrl_area1
 * DESCRIPTION
 *  draw control area 1, including bg image, pop-up bg, techno bar, info, icon.
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_draw_ctrl_area1(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    GDI_HANDLE act_layer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* background image */
    act_layer = dm_get_layer_handle(0);
    MMI_ASSERT(act_layer != GDI_NULL_HANDLE);
    gdi_layer_push_and_set_active(act_layer);
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
    gdi_layer_clear(gdi_layer_get_background());
#if defined(__MMI_SWFLASH__)
    if (GetCat34MediaType()== MMI_IDLE_BG_MEDIA_SWFLASH)
    {
        SetSWFlashPlayerLayer(act_layer);
        DrawCateSWFlashCategoryControlArea(coordinate);
        ExitCategorySWFlashScreen();
    }
    else
#endif /* defined(__MMI_SWFLASH__) */ 
#if defined(__MMI_AVATAR__)
    if (GetCat34MediaType()== MMI_IDLE_BG_MEDIA_AVATAR)
    {
        SetSWFlashPlayerLayer(act_layer);
        DrawCateAvatarCategoryControlArea(coordinate);
        gdi_anim_stop_all_by_layer(act_layer);
    }
    else
#endif /* defined(__MMI_AVATAR__) */
    {
        draw_wallpaper();
        if (animation_handle != GDI_ERROR_HANDLE)
        {
            gdi_image_stop_animation(animation_handle);
            animation_handle = GDI_ERROR_HANDLE;
        }
    }
    gdi_layer_pop_clip();
    gdi_layer_pop_and_restore_active();

    /* draw pop-up background */
    gdi_layer_push_and_set_active(act_layer);
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
    {
        GDI_RESULT ret = GDI_SUCCEED;
        S32 img_obj = -1;

        do
        {   /* create image component */
            ret = wgui_image_create_from_res(
                     &img_obj,
                     WGUI_CAT016_PPBG_X, WGUI_CAT016_PPBG_Y, WGUI_CAT016_PPBG_W, WGUI_CAT016_PPBG_H,
                     current_MMI_theme->CM_screen_popup_bkg_image,
                     0, GDI_NULL_HANDLE);
            if (ret < 0)    break;

            /* do not hide background */
            wgui_image_register_hide_function(img_obj, wgui_cat_dummy_hide_function);

            /* show image component */
            ret = wgui_image_show(img_obj);
            if (ret < 0 || img_obj < 0)    break;
        } while (0);

        if (img_obj >= 0)
        {
            wgui_image_close(img_obj);
        }
    }
    gdi_layer_pop_clip();
    gdi_layer_pop_and_restore_active();

#if defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
    wgui_cat033_set_text_abm_layer(dm_get_layer_handle(0));

    /* draw techno bar */
    if (PhnsetGetShowDateTimeStatus() == MMI_TRUE)
    {
        U32 wgui_cat016_clock = WGUI_CLOCK_INVALID_INDEX;

        /* background image: using idle screen function to redraw techno bar background image */
        wgui_cat033_draw_region_with_technobar(0, MMI_status_bar_height, UI_device_width - 1, MMI_status_bar_height + MMI_IDLESCREEN_BAR_HEIGHT - 1);

        /* show clock */
        {   /* tricky solution:
               Cannot set two datetime components at the same time.
               By the way, in order not to calculate the clock position,
               use datetime compoent first to get the x, y, w, h.
               After that, create clock componet, using the x, y, w, h before. */
            extern U8 g_clock_type;
            applib_time_struct curr_time;
            S32 x, y, w, h;
            gui_clock_type_enum clock_type;

            switch (g_clock_type)
            {
                #ifdef __MMI_ANALOG_CLOCK__
                case ANALOG:
                    analog_clock_initialize();
                    x = ANALOG_CLOCK_DIAL_X + 12 + 1;
                    y = ANALOG_CLOCK_DIAL_Y + 12 + 1;
                    w = ANALOG_CLOCK_DIAL_WIDTH - 24;
                    h = ANALOG_CLOCK_DIAL_HEIGHT - 24;
                    clock_type = GUI_CLOCK_MAINLCD_TYPE_ANALOG;
                    break;
                #endif

                case DIGITAL:
                default:
                    set_dt_display(DT_IDLE_SCREEN_NO_DAY);
                    x = main_LCD_dt_object.time.x;
                    y = main_LCD_dt_object.time.y;
                    w = main_LCD_dt_object.time.width;
                    h = main_LCD_dt_object.time.height;
#if defined(__MMI_DIGITAL_CLOCK_IMAGE_NUMBER__)
                    clock_type = GUI_CLOCK_MAINLCD_TYPE_DIGITAL_TIME_IMAGE;
#else /* defined(__MMI_DIGITAL_CLOCK_IMAGE_NUMBER__) */
                    clock_type = GUI_CLOCK_MAINLCD_TYPE_DIGITAL_TIME;
#endif /* defined(__MMI_DIGITAL_CLOCK_IMAGE_NUMBER__) */
                    close_main_LCD_dt_display();
                    break;
            }
            
            wgui_clock_create(&wgui_cat016_clock, x, y, w, h, clock_type);
            wgui_clock_set_on_idle(wgui_cat016_clock, MMI_TRUE);
            wgui_clock_set_time_text_font(wgui_cat016_clock, main_LCD_dt_object.time.font);
            wgui_clock_set_time_text_color(wgui_cat016_clock, main_LCD_dt_object.time.text_color);
            wgui_clock_set_time_text_border_color(wgui_cat016_clock, main_LCD_dt_object.time.text_border_color);
            GetDateTime(&curr_time);
            wgui_clock_set_time(wgui_cat016_clock, curr_time);
            wgui_clock_show_main_lcd();
        }
    }

    /* show operator name */
    wgui_cat033_show_techo_date_and_static_network_name();
#endif /* defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__) */

    /* draw message */
    gui_push_clip();
    gui_set_clip(WGUI_CAT016_CONTENT_X, WGUI_CAT016_CONTENT_Y, WGUI_CAT016_CONTENT_X + WGUI_CAT016_CONTENT_W - 1, WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - 1);
    {
        S32 x = 0, y = 0, str_w = 0, str_h = 0, icon_w = 0, icon_h = 0, x_shift = 0;
		S32 duration_w = 0;

        /* call type */
        if (g_wgui_catcall_calltype)
        {
            gui_set_font(&MMI_small_font);
            gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
            gui_measure_string((UI_string_type)g_wgui_catcall_calltype, &str_w, &str_h);
            x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CAT016_CONTENT_X - 1) : (WGUI_CAT016_CONTENT_X);
            y = WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - (WGUI_CAT016_TEXT_H * 3) - (WGUI_CAT016_TEXT_H_GAP << 1);
            y += ((WGUI_CAT016_TEXT_H - str_h) >> 1);
            str_w = (str_w > WGUI_CAT016_CONTENT_W) ? (WGUI_CAT016_CONTENT_W) : (str_w);
            gui_print_truncated_text(x, y, str_w, (UI_string_type)g_wgui_catcall_calltype);
        }

        /* duration */
        if (g_wgui_catcall_display_duration)
        {
            set_main_LCD_dt_duration_hide_function(CM_screens_hide_duration_display);
            set_duration_start_time(g_wgui_catcall_duration);
            set_dt_display(DT_ACTIVE_CALL_SCREEN);

            /* trick: in order to update duration only, disable updating date and time */
            deactive_main_lcd_update_date_time();
            
            wgui_datetime_measure_duration(&duration_w);
			x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CAT016_CONTENT_X - duration_w) : (WGUI_CAT016_CONTENT_X);
            y = WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - (WGUI_CAT016_TEXT_H << 1) - WGUI_CAT016_TEXT_H_GAP;
            set_main_lcd_duration_position((U16)x, (U16)y);
            main_LCD_dt_object.duration.text_color = *current_MMI_theme->CM_screen_text_color;

            gui_push_clip();
            dt_update_duration();
            gui_pop_clip();
        }

        /* call cost */
    #ifdef __MMI_TELEPHONY_SUPPORT__
        if (mmi_ucm_get_show_aoc())
        {
            CM_call_cost_show = MMI_TRUE;
            redraw_call_cost_UI();
        }
        else
        {
            CM_call_cost_show = MMI_FALSE;
            reset_call_cost_UI();
        }
    #endif /* __MMI_TELEPHONY_SUPPORT__ */
        /* calling... */
        if (MMI_message_string2)
        {
            gui_set_font(&MMI_medium_font);
            gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
            gui_measure_string(MMI_message_string2, &str_w, &str_h);
            x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CAT016_CONTENT_X - 1) : (WGUI_CAT016_CONTENT_X);
            y = WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - (WGUI_CAT016_TEXT_H << 1) - WGUI_CAT016_TEXT_H_GAP;
            str_w = (str_w > WGUI_CAT016_CONTENT_W) ? (WGUI_CAT016_CONTENT_W) : (str_w);
            gui_print_truncated_text(x, y, str_w, MMI_message_string2);
        }

        /* indicator icon */
        if (gCallLine != 0)
        {
            gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
            x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CAT016_CONTENT_X - 1 - icon_w) : (WGUI_CAT016_CONTENT_X);
            y = WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - WGUI_CAT016_TEXT_H;
            gdi_image_draw_id(x, y, gCallLine);

            x_shift += icon_w + 2;
        }

        /* call number type icon */
        if (g_wgui_catcall_number_type_icons)
        {
            gdi_image_get_dimension_id(g_wgui_catcall_number_type_icons[0], &icon_w, &icon_h);
            x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CAT016_CONTENT_X - 1 - x_shift - icon_w) : (WGUI_CAT016_CONTENT_X + x_shift);
            y = WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - WGUI_CAT016_TEXT_H;
            gdi_image_draw_id(x, y, g_wgui_catcall_number_type_icons[0]);

            x_shift += icon_w + 2;
        }

        /* 0912345678 */
        if (MMI_message_string)
        {
            x = (mmi_fe_get_r2l_state()) ? (WGUI_CAT016_CONTENT_X) : (WGUI_CAT016_CONTENT_X + x_shift);
            y = WGUI_CAT016_CONTENT_Y + WGUI_CAT016_CONTENT_H - WGUI_CAT016_TEXT_H;
            str_w = WGUI_CAT016_CONTENT_W - x_shift;
            str_h = WGUI_CAT016_TEXT_H;
            gui_set_font(&MMI_medium_font);
            gui_create_scrolling_text(
                &CM_scrolling_text,
                x, y, str_w, str_h,
                MMI_message_string,
                CM_scrolling_text_timer_callback,
                CM_draw_scrolling_text_background,
                *current_MMI_theme->CM_screen_text_color,
                gui_color(255, 255, 255));
            CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
            gui_show_scrolling_text(&CM_scrolling_text);
        }
    }
    gui_pop_clip();

    /* draw caller image/video */
    {
        S32 x, y, w, h;

        /* calculate image/video position */
        x = WGUI_CAT016_CONTENT_X;
        y = WGUI_CAT016_CONTENT_Y;
        w = WGUI_CAT016_CONTENT_W;
        h = WGUI_CAT016_CONTENT_H - ((WGUI_CAT016_TEXT_H + WGUI_CAT016_TEXT_H_GAP) * 3);

        wgui_catcall_draw_caller_icon(x, y, w, h);
    }
}


#if defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON)
static S32 g_wgui_catcall_button_x = 0;
static S32 g_wgui_catcall_button_y = 0;
static S32 g_wgui_catcall_button_w = 0;
static S32 g_wgui_catcall_button_h = 0;


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_draw_button
 * DESCRIPTION
 *  draw button
 * PARAMETERS
 *  pen_type    [IN] pen_type
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_draw_button(mmi_pen_event_type_enum pen_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 x, y, w, h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    x = WGUI_CAT016_BUTTON_X;
    y = WGUI_CAT016_BUTTON_Y;
    w = WGUI_CAT016_BUTTON_W;
    h = WGUI_CAT016_BUTTON_H;

    gdi_layer_lock_frame_buffer();
    gdi_layer_push_clip();
    gdi_layer_set_clip(x, y, x + w - 1, y + h - 1);

    /* clear background */
    gdi_draw_solid_rect(x, y, x + w - 1, y + h - 1, GDI_COLOR_TRANSPARENT);

    /* draw button image */
    {    
        GDI_RESULT ret = GDI_SUCCEED;
        S32 img_obj = -1;
        U16 img_id;
        S32 img_w, img_h;

        img_id = (pen_type == MMI_PEN_EVENT_DOWN) ? (IMG_CALLING_BUTTON_DOWN) : (IMG_CALLING_BUTTON_UP);
        img_id = (g_wgui_catcall_button_func_p) ? (img_id) : (IMG_CALLING_BUTTON_DISABLE);

        do
        {   /* create image component */
            ret = wgui_image_create_from_res(
                     &img_obj,
                     x, y, w, h,
                     (U8*)GetImage(img_id),
                     0, GDI_NULL_HANDLE);
            if (ret < 0)    break;

            /* show image component */
            ret = wgui_image_show(img_obj);
            if (ret < 0 || img_obj < 0)    break;

            /* get button position */
            wgui_image_get_position(img_obj, &g_wgui_catcall_button_x, &g_wgui_catcall_button_y);
            wgui_image_get_dimension(img_obj, &img_w, &img_h, &g_wgui_catcall_button_w, &g_wgui_catcall_button_h);
        } while (0);

        if (img_obj >= 0)
        {
            wgui_image_close(img_obj);
        }
    }

    /* draw info */
    if (g_wgui_catcall_button_str_p)
    {
        S32 str_x = 0, str_y = 0, str_w = 0, str_h = 0;

        /* set font */
        gui_set_font(&MMI_medium_font);
        gui_set_text_color(gui_color(255, 255, 255));

        /* center alignment text */
        gui_measure_string(g_wgui_catcall_button_str_p, &str_w, &str_h);
        str_x = (w > str_w) ? ((w - str_w) >> 1) : (0);
        str_x = (mmi_fe_get_r2l_state()) ? (str_x + str_w - 1) : (str_x);
        str_x += x;
        str_x += (pen_type == MMI_PEN_EVENT_DOWN) ? (1) : (0);
        str_y = (h > str_h) ? ((h - str_h) >> 1) : (0);
        str_y += y;
        str_y += (pen_type == MMI_PEN_EVENT_DOWN) ? (1) : (0);

        /* print text */
        gui_print_truncated_text(str_x, str_y, w, g_wgui_catcall_button_str_p);
    }

    gdi_layer_pop_clip();
    gdi_layer_unlock_frame_buffer();
    gdi_lcd_repaint_all();
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_draw_ctrl_area2
 * DESCRIPTION
 *  draw control area 2, including the button
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_draw_ctrl_area2(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_catcall_draw_button(MMI_PEN_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_button_pen_hdlr
 * DESCRIPTION
 *  pen handler for button
 * PARAMETERS
 *  point   [IN]    pen position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL wgui_catcall_button_pen_hdlr(mmi_pen_event_type_enum type, mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    static mmi_pen_event_type_enum pen_state = MMI_PEN_EVENT_UP;
    S32 x = 0, y = 0, w = 0, h = 0;
    MMI_BOOL ret = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/   
    x = g_wgui_catcall_button_x;
    y = g_wgui_catcall_button_y;
    w = g_wgui_catcall_button_w;
    h = g_wgui_catcall_button_h;

    if (PEN_CHECK_BOUND(point.x, point.y, x, y, w, h))
    {
        switch(pen_state)
        {
            case MMI_PEN_EVENT_UP:
                if (type == MMI_PEN_EVENT_DOWN)
                {
                    pen_state = MMI_PEN_EVENT_DOWN;
                    wgui_catcall_draw_button(MMI_PEN_EVENT_DOWN);
                }
                break;

            case MMI_PEN_EVENT_DOWN:
                if ((type == MMI_PEN_EVENT_UP) || (type == MMI_PEN_EVENT_ABORT))
                {
                    pen_state = MMI_PEN_EVENT_UP;
                    wgui_catcall_draw_button(MMI_PEN_EVENT_UP);

                    if ((type == MMI_PEN_EVENT_UP) && g_wgui_catcall_button_func_p)
                    {
                        g_wgui_catcall_button_func_p();
                    }
                }
                break;

            default:
                break;
        }
        ret = MMI_TRUE;
    }
    else
    {
        switch(pen_state)
        {
            case MMI_PEN_EVENT_DOWN:
                pen_state = MMI_PEN_EVENT_UP;
                wgui_catcall_draw_button(MMI_PEN_EVENT_UP);
                ret = MMI_TRUE;
                break;

            default:
                break;
        }
    }

    return ret;
}


static MMI_BOOL wgui_catcall_button_pen_down_hdlr(mmi_pen_point_struct point)
{
    return wgui_catcall_button_pen_hdlr(MMI_PEN_EVENT_DOWN, point);
}

static MMI_BOOL wgui_catcall_button_pen_up_hdlr(mmi_pen_point_struct point)
{
    return wgui_catcall_button_pen_hdlr(MMI_PEN_EVENT_UP, point);
}

static MMI_BOOL wgui_catcall_button_pen_move_hdlr(mmi_pen_point_struct point)
{
    return wgui_catcall_button_pen_hdlr(MMI_PEN_EVENT_MOVE, point);
}

static MMI_BOOL wgui_catcall_button_pen_abort_hdlr(mmi_pen_point_struct point)
{
    return wgui_catcall_button_pen_hdlr(MMI_PEN_EVENT_ABORT, point);
}
#endif /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */


/*****************************************************************************
 * FUNCTION
 *  ShowMOMTCallScreen_2
 * DESCRIPTION
 *  show MOMT call screen style 2
 * PARAMETERS
 *  as follows
 * RETURNS
 *  void
 *****************************************************************************/
static void ShowMOMTCallScreen_2(
                U16 title_id,               /* useless */
                U16 left_softkey,           /* left softkey string */
                U16 left_softkey_icon,      /* left softkey icon */
                U16 right_softkey,          /* right softkey string */
                U16 right_softkey_icon,     /* right softkey icon */
                U16 NotificationStringId,   /* notification string, e.g. calling... */
                PU8 NameOrNumber,           /* name or number */
                PU8 IP_Number,              /* IP number */
                U16 CallLine,               /* call line indicator icon */
                U16 default_image_id,       /* default image icon */
                U16 resource_id,            /* from resource */
                CHAR* resource_filename,      /* from file */
                wgui_cate_momt_res_type_enum resource_type, /* resource type */
                U16 repeat_count,           /* video/swflash only. 0 means infinite loop */
                BOOL is_visaul_update,      /* video/swflash only. update to LCM */
                BOOL is_aud_enable,         /* video/swflash only. play video's audio */
                BOOL is_play_aud_when_start,/* video/swflash only. play audio when start */
                PU8 history_buffer)         /* histor buffer */
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 s32flags;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    /* reset global variables */
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)
    cat_momt_is_aud_enable = is_aud_enable;
    cat_momt_is_play_aud_when_start = is_play_aud_when_start;
    cat_momt_is_aud_muted = FALSE;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__ || __MMI_SWFLASH__*/

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) 
    cat_momt_is_visual_update = is_visaul_update;
    cat_momt_is_video_open = FALSE;
    cat_momt_is_video_play = FALSE;
    cat_momt_repeat_count = repeat_count;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
#if defined(__MMI_SWFLASH__)
    cat_momt_is_swflash_open = FALSE;
    cat_momt_is_swflash_play = FALSE;
#endif /*__MMI_SWFLASH__*/
#if defined(__MMI_AVATAR__)
    cat_momt_is_avatar_play = FALSE;
#endif /*__MMI_AVATAR__*/

    cat_momt_is_show_default = FALSE;

    
    cat_momt_resource_filename = (CHAR*) resource_filename;
    cat_momt_resource_id = resource_id;
    cat_momt_default_image_id = default_image_id;
    cat_momt_resource_type = resource_type;

    gCallLine = CallLine;

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
    {
        srv_backlight_turn_on(SRV_BACKLIGHT_PERMANENT);
        srv_gpio_play_pattern((srv_gpio_pattern_id_enum)srv_led_pattern_get_bg_pattern(), SRV_GPIO_PATN_PLAY_STOP);   
        cat_momt_video_play_time = (history_buffer) ? (cat_momt_video_play_time) : (0);
    }
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
    MMI_ASSERT(CM_media_buffer == NULL);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

    CM_set_wallpaper_on_bottom(MMI_TRUE);

    /* softkey */
	dm_add_softkey_id((MMI_STR_ID)left_softkey, (MMI_STR_ID)right_softkey);

    /* status icon */
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
    wgui_status_icon_bar_register_hide_callback(
        WGUI_STATUS_ICON_BAR_H_BAR, 
        hide_status_icons_bar0_by_transparent);

    /* set message string */
    if (NameOrNumber)
    {
        memset((CHAR*)CM_string_buf, 0, (SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN)*2);
        gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) IP_Number);
        gui_strcat((UI_string_type) CM_string_buf, (UI_string_type) NameOrNumber);
        MMI_message_string = (UI_string_type) CM_string_buf;
    }
    else
    {
        MMI_message_string = NULL;
    }
    MMI_message_string2 = (NotificationStringId) ? (get_string(NotificationStringId)) : (NULL);

    gdi_layer_unlock_frame_buffer();

    /* control area */
    dm_register_category_controlled_callback(wgui_catcall_draw_ctrl_area1);
#if defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON)
    dm_register_category_controlled2_callback(wgui_catcall_draw_ctrl_area2);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_button_pen_down_hdlr, MMI_PEN_EVENT_DOWN);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_button_pen_up_hdlr, MMI_PEN_EVENT_UP);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_button_pen_move_hdlr, MMI_PEN_EVENT_MOVE);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_button_pen_abort_hdlr, MMI_PEN_EVENT_ABORT);
#endif /* defined(WGUI_CATCALL_STYLE_2_WITH_BUTTON) */

    s32flags = DM_CLEAR_SCREEN_BACKGROUND | DM_SET_AS_ABM_LAYER | DM_SPECIFIC_HIDE_STATUS_BAR;
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    s32flags |= (cat_momt_is_video_open) ? (DM_NO_BLT) : (0);
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
    wgui_cat_setup_category(
        MMI_CATEGORY18_ID,
        s32flags,
        wgui_catcall_exit,
        dummy_get_history,
        dummy_get_history_size);
    dm_redraw_category_screen();

    /* if the screen is from the pop-up go-back, do not play video */
    if (mmi_is_redrawing_bk_screens())
    {
        return;
    }

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    if(cat_momt_is_video_open)
    {
        MDI_RESULT mdi_ret;

        mdi_ret = mdi_video_ply_play(
                    wgui_layer_1,
#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
                    GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1 | GDI_LAYER_ENABLE_LAYER_2,
                    GDI_LAYER_ENABLE_LAYER_2,
#else /* defined(__MMI_WALLPAPER_ON_BOTTOM__) */
                    GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1,
                    GDI_LAYER_ENABLE_LAYER_1,
#endif /* defined(__MMI_WALLPAPER_ON_BOTTOM__) */
                    (U16) cat_momt_repeat_count,    /* this to recrod repeat count */
                    cat_momt_is_visual_update,      /* update to LCM or not */
                    cat_momt_is_aud_enable,         /* play aud or not */
                    MDI_DEVICE_SPEAKER_BOTH,        /* speaker & earphone */
                    MDI_VIDEO_LCD_ROTATE_0,         /* rotate */
                    100,                            /* 1x play speed */
                    NULL, 0);
        cat_momt_is_video_play = (mdi_ret >= 0) ? TRUE : FALSE;

        gdi_lcd_repaint_all();
    }
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */
}
#endif /* defined(WGUI_CATCALL_STYLE_2) */

#ifndef __MMI_UCM_PLUTO_BW__
/*****************************************************************************
 * FUNCTION
 *  Cat403ListHighliteHandler
 * DESCRIPTION
 *  set category 403 highlight handler
 * PARAMETERS
 *  index       [IN]        index of list item
 * RETURNS
 *  void
 *****************************************************************************/
void Cat403ListHighliteHandler(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	MMI_user_highlight_handler_Ext((U8)eListhighlight, index);
}


#ifndef __MMI_CATE_CM_TAB_BAR_SLIM__
/* For detail description, please refer to wgui_categories_CM.h */
void SetCategory403TabSelectCallback(void (*select_callback) (int index))
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_TAB_BAR_SUPPORT_TAB_PAGE__
    wgui_set_horizontal_tab_bar_select_callback_ex(select_callback);
#else
    wgui_set_horizontal_tab_bar_select_callback(select_callback);
#endif
}


/* For detail description, please refer to wgui_categories_CM.h */
void Category403BlinkTab(S8 tab)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_horizontal_tab_bar_start_blinking(tab);
}


/* For detail description, please refer to wgui_categories_CM.h */
void Category403UnBlinkTab(S8 tab)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_horizontal_tab_bar_stop_blinking(tab);
}


/* For detail description, please refer to wgui_categories_CM.h */
void UpdateCategory403TabBar(UI_string_type title, S8 n_tabs, S8 highlighted_tab, tab_bar_item_type *tab_items)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    wgui_close_horizontal_tab_bar();

    /* Setup horizontal tab bar */
    for (i = 0; i < n_tabs; i++)
    {
        MMI_tab_bar_items[i] = tab_items[i];
    }
    wgui_create_horizontal_tab_bar(TRUE, title, n_tabs, highlighted_tab, MMI_TRUE);

    gdi_layer_unlock_frame_buffer();

    wgui_show_horizontal_tab_bar();
}
 #endif

/*****************************************************************************
 * FUNCTION
 *  ExitCategory403Screen
 * DESCRIPTION
 *  Exit category 403 screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void ExitCategory403Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    close_main_LCD_dt_display();
    wgui_status_icon_bar_reset();
    reset_softkeys();
    reset_fixed_list();
    reset_pop_up_descriptions();
#ifndef __MMI_CATE_CM_TAB_BAR_SLIM__
    wgui_close_horizontal_tab_bar();
#endif
}


#ifdef __MMI_CATE_CM_TAB_BAR_SLIM__
#define tab_bar_item_type cm_tab_bar_item_type
#define CM_TAB_BAR_ITEM_GAP            (1)
static wgui_cat403_call_tab_info_struct g_wgui_cat403_CM_tab_info;

static void wgui_cat403_draw_tab_bar_ctrl_area1(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 icon_w = 0, icon_h = 0;
    S32 i = 0, x1, y1, x2, y2;
    GDI_HANDLE act_layer;
    S32 width, height;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    UI_set_main_LCD_graphics_context();
    gdi_layer_reset_clip();
    wgui_status_icon_bar_update();

    /* SIM Voice... */
    if (g_wgui_cat403_CM_tab_info.title)
    {
        S32 x, w, str_w, str_h;
        MMI_message_string2 =  (UI_string_type)g_wgui_cat403_CM_tab_info.title;
        gui_set_font(&MMI_medium_font);
#ifndef __MMI_WALLPAPER_ON_BOTTOM__
        gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
#else /* __MMI_WALLPAPER_ON_BOTTOM__ */
        gui_set_text_color(*current_MMI_theme->list_normal_text_color);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */

        gui_push_clip();
        gui_reset_clip();
        x = (mmi_fe_get_r2l_state()) ? (UI_device_width - 2) : (1);
        w = UI_device_width - 2;
        
        gui_measure_string(MMI_message_string2, &str_w, &str_h);
        if (str_w < w)
        {
            x += (mmi_fe_get_r2l_state()) ? (-((w - str_w) >> 1)) : ((w - str_w) >> 1);
            w = str_w;
}
        gui_fill_rectangle(0, MMI_HORIZONTAL_TAB_BAR_Y +  MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT +1,
            UI_device_width-2, MMI_HORIZONTAL_TAB_BAR_Y + MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT + MMI_HORIZONTAL_TAB_BAR_HINT_AREA_HEIGHT - 1,gui_color(174, 238, 180));
            //gui_draw_filled_area(0, MMI_HORIZONTAL_TAB_BAR_Y +  MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT,
            //UI_device_width-2, MMI_HORIZONTAL_TAB_BAR_Y + MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT + MMI_HORIZONTAL_TAB_BAR_HINT_AREA_HEIGHT - 1, current_MMI_theme->tab_highlight_tab_filler);
        gui_print_truncated_text(x, MMI_HORIZONTAL_TAB_BAR_Y + MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT + (MMI_HORIZONTAL_TAB_BAR_HINT_AREA_HEIGHT- str_h)/2, w, MMI_message_string2);
        gui_pop_clip();
    }

    gui_measure_image(g_wgui_cat403_CM_tab_info.tab_items[i].icon, &icon_w, &icon_h);
    gdi_layer_push_and_set_clip(0,MMI_HORIZONTAL_TAB_BAR_Y,UI_device_width - 1,MMI_HORIZONTAL_TAB_BAR_Y + MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT);

    /* set current layer as source layer */
    gdi_layer_get_active(&act_layer);
    gdi_push_and_set_alpha_blending_source_layer(act_layer);

    for (i = 0; i < g_wgui_cat403_CM_tab_info.n_tabs; i++)
    {
        S32 HORIZONTAL_TAB_BAR_TAB_x = 0,HORIZONTAL_TAB_BAR_TAB_y,HORIZONTAL_TAB_BAR_TAB_width ,HORIZONTAL_TAB_BAR_TAB_gap,HORIZONTAL_TAB_BAR_TAB_height;
        HORIZONTAL_TAB_BAR_TAB_gap = CM_TAB_BAR_ITEM_GAP;
        HORIZONTAL_TAB_BAR_TAB_y =  MMI_HORIZONTAL_TAB_BAR_Y;
        HORIZONTAL_TAB_BAR_TAB_height = MMI_HORIZONTAL_TAB_BAR_TAB_AREA_HEIGHT;
        HORIZONTAL_TAB_BAR_TAB_width = MMI_HORIZONTAL_TAB_BAR_TAB_WIDTH;
        y1 = HORIZONTAL_TAB_BAR_TAB_y;
        y2 = y1+ HORIZONTAL_TAB_BAR_TAB_height - 1;
        /* calculate position */
        x1 = HORIZONTAL_TAB_BAR_TAB_x  + (HORIZONTAL_TAB_BAR_TAB_width + HORIZONTAL_TAB_BAR_TAB_gap)*i;;
        x2 = x1 + HORIZONTAL_TAB_BAR_TAB_width - 1;

        gdi_layer_push_and_set_clip(x1, y1, x2, y2);
        gui_measure_image(g_wgui_cat403_CM_tab_info.tab_items[i].icon, &width, &height);	
       if(g_wgui_cat403_CM_tab_info.highlighted_tab == i)
        {
            gui_fill_rectangle(x1, y1, x2, y2,gui_color(174, 238, 180) );
                //gui_draw_filled_area(x1, y1, x2, y2, current_MMI_theme->tab_highlight_tab_filler);
        }
        else
        {
            gui_fill_rectangle(x1, y1, x2, y2,gui_color(64, 0, 64) );
                //gui_draw_filled_area(x1, y1, x2, y2, current_MMI_theme->tab_blink_tab_filler);
        }
        gui_show_image(x1 + ((HORIZONTAL_TAB_BAR_TAB_width - width) >> 1), y1 + ((HORIZONTAL_TAB_BAR_TAB_height - height) >> 1), 
            g_wgui_cat403_CM_tab_info.tab_items[i].icon);
        gdi_layer_pop_clip();
    }
    gdi_pop_and_restore_alpha_blending_source_layer();
    gdi_layer_pop_clip();
    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
#endif

/* For detail description, please refer to wgui_categories_CM.h */
#define WGUI_CAT403_TAB_BAR_WITH	(MMI_HORIZONTAL_TAB_BAR_FOCUSED_TAB_WIDTH * 2)
#ifdef __MMI_CATE_CM_TAB_BAR_SLIM__
void ShowCategory4031Screen_int(
        U8 *title,
        U16 title_icon,
        U16 left_softkey,
        U16 right_softkey,
        S8 n_tabs,
        S8 highlighted_tab,
        cm_tab_bar_item_type *tab_items,
        MYTIME *CallDuration,
        U16 duration_icon,
        U8 **list_of_items,
        U16 *list_of_icons,
        S32 number_of_items,
        U16 highlighted_item,
        U8 *history_buffer)
#else 
void ShowCategory403Screen_int(
        U8 *title,
        U16 title_icon,
        U16 left_softkey,
        U16 right_softkey,
        S8 n_tabs,
        S8 highlighted_tab,
        tab_bar_item_type *tab_items,
        MYTIME *CallDuration,
        U16 duration_icon,
        #ifdef __MMI_DIALER_TWO_DT_DIS__
        MYTIME *CallDuration2,
        U16 duration2_icon,
        U16 duration2_str_id,         
        #endif
        U8 **list_of_items,
        U16 *list_of_icons,
        S32 number_of_items,
        U16 highlighted_item,
        U8 *history_buffer)
#endif

{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i = 0;
    S32 duration_width, duration_height;
    U16 duration_x;
#ifdef __MMI_DIALER_TWO_DT_DIS__
    S32 duration2_width, duration2_height;
    U16 duration2_x;
    UI_string_type duration2_str = NULL;
    MMI_message_string3 = NULL;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    change_left_softkey(left_softkey, 0);
    change_right_softkey(right_softkey, 0);
    SetupCategoryKeyHandlers();

    /* get duration string size */
    set_time_display(0, 0, 0, 0, 0);
#if defined(__MMI_MAINLCD_128X64__)
    main_LCD_time_object.duration.font = &MMI_small_font;
#endif /*__MMI_MAINLCD_128X64__ */
    main_LCD_measure_time_duration_string(&duration_width, &duration_height);

#ifdef __MMI_CATE_CM_TAB_BAR_SLIM__
    memset(&g_wgui_cat403_CM_tab_info, 0, sizeof(g_wgui_cat403_CM_tab_info));
    g_wgui_cat403_CM_tab_info.title = title;
    g_wgui_cat403_CM_tab_info.n_tabs = n_tabs;
    g_wgui_cat403_CM_tab_info.highlighted_tab = highlighted_tab;
    for (i = 0; i < n_tabs; i++)
    {
        g_wgui_cat403_CM_tab_info.tab_items[i] = tab_items[i];
    }
#endif

#ifndef __MMI_CATE_CM_TAB_BAR_SLIM__
    for (i = 0; i < n_tabs; i++)
    {
        MMI_tab_bar_items[i] = tab_items[i];
    }

#if defined(__MMI_MAINLCD_320X240__) && defined(__MMI_FTE_SUPPORT__)
    wgui_create_horizontal_tab_bar(FALSE, (UI_string_type)title, n_tabs, highlighted_tab, MMI_FALSE);
    wgui_setup_horizontal_tab_bar_no_title_shortcut();
#elif !defined(__MMI_MAINLCD_128X64__)
    wgui_create_horizontal_tab_bar(TRUE, (UI_string_type) title, n_tabs, highlighted_tab, MMI_FALSE);

	#ifndef __MMI_TITLE_BAR_NO_ICON_SHCT__
	gui_title_set_no_icon_shct(&MMI_horizontal_tab_bar.title, MMI_TRUE);
    #endif /*__MMI_TITLE_BAR_NO_ICON_SHCT__*/
#else /* __MMI_MAINLCD_128X64__ */
    wgui_create_horizontal_tab_bar(FALSE, (UI_string_type)NULL, n_tabs, highlighted_tab, MMI_FALSE);
	wgui_setup_horizontal_tab_bar_no_title_shortcut();
#endif /* __MMI_MAINLCD_128X64__ */
#endif

    //set_dt_duration(CallDuration);
    set_duration_start_time(CallDuration);
    
    set_main_LCD_dt_duration_hide_function(CM_screens_hide_duration_display);
    //set_dt_display(DT_VOIP_CALL_SCREEN);
    set_dt_display(DT_TABBED_CALL_SCREEN);
#if defined(__MMI_MAINLCD_128X64__)
    duration_icon = 0;
#endif /* __MMI_MAINLCD_128X64__ */
    if (duration_icon != 0)
    {
        dm_add_image(get_image(duration_icon), NULL, NULL);
    }    

    /* List */
    wgui_fixed_list_create_icontext_menu(
        number_of_items,
        highlighted_item,
    #if defined(__MMI_MAINLCD_128X64__)
        WGUI_LIST_MENU_DISABLE_SHORTCUT,
	#else /* __MMI_MAINLCD_128X64__ */
        0,
    #endif /* __MMI_MAINLCD_128X64__ */
        MMI_CATEGORY403_ID,
        history_buffer);
    resize_fixed_icontext_menuitems(0, MMI_MENUITEM_HEIGHT);

    wgui_fixed_list_override_icontext_highlight_handler(Cat403ListHighliteHandler);

    wgui_fixed_list_begin_add_icontext_one_item();
    for (i = 0; i < number_of_items; i++)
    {
        if (list_of_icons == NULL)
        {
            set_fixed_icontext_positions(GUI_TEXT_MENUITEM_TEXT_X, 0, 1, 0);
            wgui_fixed_list_add_icontext_one_item(i, list_of_items[i], 0, NULL);
        }
        else
        {
            set_fixed_icontext_positions(GUI_ICONTEXT_MENUITEM_TEXT_X, 0, GUI_ICONTEXT_MENUITEM_ICON_X, 0);
            wgui_fixed_list_add_icontext_one_item(i, list_of_items[i], wgui_get_list_menu_icon(i, list_of_icons[i]), NULL);
        }
    }
    wgui_fixed_list_end_add_icontext_one_item();
#if !defined(__MMI_MAINLCD_128X64__)
    if (duration_icon != 0)
    {
        duration_x = (mmi_fe_get_r2l_state()) ? ((U16)(MMI_fixed_icontext_menuitem.width - GUI_ICONTEXT_MENUITEM_TEXT_X - duration_width)) : ((U16)(GUI_ICONTEXT_MENUITEM_TEXT_X));
    }
    else
    {
        duration_x = (mmi_fe_get_r2l_state()) ? ((U16)(MMI_fixed_icontext_menuitem.width - GUI_TEXT_MENUITEM_TEXT_X - duration_width)) : ((U16)(GUI_TEXT_MENUITEM_TEXT_X));
    }
#else /* __MMI_MAINLCD_128X64__ */
		wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
		duration_x = WGUI_CAT403_TAB_BAR_WITH;
#endif /* __MMI_MAINLCD_128X64__ */

#if defined(__MMI_MAINLCD_240X400__)
    set_main_lcd_duration_position(duration_x, WGUI_CAT403_IMG_Y + ((WGUI_CAT403_IMG_H - duration_height) >> 1));
    MMI_fixed_list_menu.flags |= UI_LIST_MENU_DISABLE_EXT_GRID_LINE;
#else /* __MMI_MAINLCD_240X400__ */
    set_main_lcd_duration_position(duration_x, WGUI_CAT403_IMG_Y + ((WGUI_CAT403_IMG_H - duration_height) >> 1) + 1);
#endif /* __MMI_MAINLCD_240X400__ */

#ifdef __MMI_DIALER_TWO_DT_DIS__ 
if(CallDuration2!=NULL)
{
    /* Recording... */
    MMI_message_string3 = (duration2_str_id) ? (get_string(duration2_str_id)) : (NULL);
    /* get duration2 string size */
    set_time_display_2(0, 0, 0, 0, 0);
#if defined(__MMI_MAINLCD_128X64__)
    main_LCD_time_object.duration2.font = &MMI_small_font;
#endif /*__MMI_MAINLCD_128X64__ */
    main_LCD_measure_time_duration2_string(&duration2_width, &duration2_height);

    //set_dt_duration(CallDuration);
    set_duration2_start_time(CallDuration2);

    set_main_LCD_dt_duration2_hide_function(CM_screens_hide_duration_display);
    //set_dt_display(DT_VOIP_CALL_SCREEN);
    set_dt_display(DT_TABBED_CALL_SCREEN_2);
#if defined(__MMI_MAINLCD_128X64__)
    duration2_icon = 0;
#endif /* __MMI_MAINLCD_128X64__ */
    if (duration2_icon != 0)
    {
        dm_add_image(get_image(duration2_icon), NULL, NULL);
    }  

#if !defined(__MMI_MAINLCD_128X64__)
    if (duration2_icon != 0)
    {
        duration2_x = (mmi_fe_get_r2l_state()) ? ((U16)(MMI_fixed_icontext_menuitem.width - GUI_ICONTEXT_MENUITEM_TEXT_X - duration2_width)) : ((U16)(GUI_ICONTEXT_MENUITEM_TEXT_X));
    }
    else
    {
        duration2_x = (mmi_fe_get_r2l_state()) ? ((U16)(MMI_fixed_icontext_menuitem.width - GUI_TEXT_MENUITEM_TEXT_X - duration2_width)) : ((U16)(GUI_TEXT_MENUITEM_TEXT_X));
    }
#else /* __MMI_MAINLCD_128X64__ */
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
    duration2_x = WGUI_CAT403_TAB_BAR_WITH;
#endif /* __MMI_MAINLCD_128X64__ */

#if defined(__MMI_MAINLCD_240X400__)
    set_main_lcd_duration2_position(duration2_x, WGUI_CAT403_IMG_Y + ((WGUI_CAT403_IMG_H - duration2_height) >> 1));
    MMI_fixed_list_menu.flags |= UI_LIST_MENU_DISABLE_EXT_GRID_LINE;
#else /* __MMI_MAINLCD_240X400__ */
    set_main_lcd_duration2_position(duration2_x, WGUI_CATCALL_DRUATION2_STR1_Y + WGUI_CATCALL_DRUATION2_STR1_H);
#endif /* __MMI_MAINLCD_240X400__ */
}
#endif

#if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__)
    wgui_cat403_fte_iconbar_setup();
#endif /* __MMI_FTE_SUPPORT__ && __MMI_TOUCH_SCREEN__*/
#ifdef __MMI_CATE_CM_TAB_BAR_SLIM__
    dm_register_category_controlled_callback(wgui_cat403_draw_tab_bar_ctrl_area1);
#endif
    gdi_layer_unlock_frame_buffer();
#if defined(__MMI_MAINLCD_128X64__)
    wgui_cat_setup_category_default_history(MMI_CATEGORY403_ID, DM_CLEAR_SCREEN_BACKGROUND | DM_SPECIFIC_HIDE_STATUS_BAR, ExitCategory403Screen);
#else /* __MMI_MAINLCD_128X64__ */
    wgui_cat_setup_category_default_history(MMI_CATEGORY403_ID, DM_CLEAR_SCREEN_BACKGROUND, ExitCategory403Screen);
#endif /* __MMI_MAINLCD_128X64__ */
    dm_redraw_category_screen();

#ifdef __MMI_DIALER_TWO_DT_DIS__ 
    gdi_layer_lock_frame_buffer();
    if(CallDuration2!=NULL)
    {
    dt_show_two_duration(main_LCD_dt_object.duration,main_LCD_dt_object.duration2);
    }
    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
#endif

}
#endif


/* For detail description, please refer to wgui_categories_cm.h */
void wgui_cat403_set_duration(MYTIME *CallDuration)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    set_duration_start_time(CallDuration);
    dt_update_duration();
}


/* For detail description, please refer to wgui_categories_CM.h */
void wgui_cat403_update_duration(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_CM_SCREEN_HIDE_DATE_TIME__
    if (g_dm_data.s32CatId == MMI_CATEGORY403_ID
#ifdef __MMI_MAINLCD_96X64__
         || g_dm_data.s32CatId == MMI_CAT9023_ID
#endif /*__MMI_MAINLCD_96X64__*/
        )

    {
        //dt_update_duration_gprs();
        dt_update_duration();
        #ifdef __MMI_DIALER_TWO_DT_DIS__ 
        if(mdi_audio_is_recording())
        {
        dt_update_duration2();
        }
        #endif
    }
#endif /* __MMI_CM_SCREEN_HIDE_DATE_TIME__ */
}

UI_filled_area cat404_fibox =
{
    UI_FILLED_AREA_TYPE_COLOR,
    UI_IMAGE_ID_NULL,
    NULL,
    {255,255,255,100},
    {0,0,0,100},
    {0,0,0,0},
    {0,0,0,100},
    0
};

UI_filled_area *cat404_fibox_backup = NULL;


/*****************************************************************************
 * FUNCTION
 *  ExitCategory404Screen
 * DESCRIPTION
 *  Exits the VoIP dialing screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void ExitCategory404Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_close_inputbox();
    MMI_multiline_inputbox.normal_filler = cat404_fibox_backup;
    reset_softkeys();
    enable_softkey_background();
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    wgui_reset_wallpaper_on_bottom();
#endif
}


/* For detail description, please refer to wgui_categories_CM.h */
void ShowCategory404Screen(
        U16 left_softkey,
        U16 left_softkey_icon,
        U16 right_softkey,
        U16 right_softkey_icon,
        U16 bg_image,
        U8 *Buffer,
        U32 BufferLength,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    static mmi_imm_input_mode_enum required_input_mode[] = 
    {
        IMM_INPUT_MODE_MULTITAP_UPPERCASE_ABC,
        IMM_INPUT_MODE_MULTITAP_LOWERCASE_ABC,
        IMM_INPUT_MODE_123_SYMBOLS,
        IMM_INPUT_MODE_NONE
    };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    entry_full_screen();

    /* setup bg */
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    CM_set_wallpaper_on_bottom(MMI_TRUE);
#endif 
    dm_add_image(get_image(bg_image), NULL, NULL);

    /* setup title */
    MMI_title_string = NULL;
//huking	
#ifndef __MMI_TITLE_BAR_NO_ICON_SHCT__	
    MMI_title_icon = NULL;
#endif/*__MMI_TITLE_BAR_NO_ICON_SHCT__*/
    /* menu shortcut */
    wgui_title_set_menu_shortcut_number(-1);
#ifndef __MMI_TITLE_BAR_NO_ICON_SHCT__
    wgui_title_disable_menu_shortcut_display(MMI_TRUE);
#endif /*__MMI_TITLE_BAR_NO_ICON_SHCT__*/
    /* setup key handlers */
    clear_key_handlers();
    change_right_softkey(right_softkey, right_softkey_icon);
    change_left_softkey(left_softkey, left_softkey_icon);
    clear_left_softkey();
    clear_right_softkey();
    register_left_softkey_handler();
    register_right_softkey_handler();
    register_hide_softkey(wgui_cat033_hide_lsk, MMI_LEFT_SOFTKEY);
    register_hide_softkey(wgui_cat033_hide_rsk, MMI_RIGHT_SOFTKEY);

    /* softkey */
    disable_softkey_background();

    /* status bar */
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
    wgui_status_icon_bar_register_hide_callback(
        WGUI_STATUS_ICON_BAR_H_BAR,
        hide_status_icons_bar0_by_transparent);
    
    mmi_imc_set_fixed_input_box();
    
    /* setup multiline inputbox */
    wgui_setup_inputbox_ext(
        MMI_content_x + 10,
        MMI_content_y + 10,
        MMI_content_width - 20,
        get_menu_item_height() * 4,
        Buffer,
        BufferLength,
        MMI_CATEGORY404_ID,
        get_string(right_softkey),
        get_image(right_softkey_icon),
        IMM_INPUT_TYPE_USER_SPECIFIC,
        history_buffer,
        required_input_mode,
    #ifdef __MMI_FTE_SUPPORT__        
        0,
    #else
        1,
    #endif
        0,
        0,
        0,
        0,
        0,
        NULL
        );
    MMI_multiline_inputbox.normal_text_color = *current_MMI_theme->voip_dialer_editor_text_color;
    MMI_multiline_inputbox.flags |=
        UI_MULTI_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND | UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR;

#ifdef __MMI_FTE_SUPPORT__
    gui_inputs_set_transparent_background(MMI_TRUE);
#endif

    /* disable new line symbol */
    MMI_current_input_ext_type = INPUT_TYPE_EXT_NO_SHOW_NEW_LINE_SYMBOL;
    cat404_fibox_backup = MMI_multiline_inputbox.normal_filler;
    //MMI_multiline_inputbox.normal_filler = &cat404_fibox;

    gdi_layer_unlock_frame_buffer();
    /* setup draw manager functions */
	wgui_cat_setup_category_default_history(
	    MMI_CATEGORY404_ID, 
	    DM_CLEAR_SCREEN_BACKGROUND | DM_SHOW_VKPAD | DM_NO_TITLE | DM_SPECIFIC_HIDE_STATUS_BAR | DM_SET_AS_ABM_LAYER, 
	    ExitCategory404Screen);
    dm_register_vkpad_callback(mmi_imc_redraw_screen_by_state);
    dm_redraw_category_screen();
}


#if defined(__MMI_FTE_SUPPORT__)

/* data structure */
typedef struct
{
    wgui_catcall_fte_iconbar_item_struct button;
    S32 x;
    S32 y;
    S32 w;
    S32 h;
    MMI_BOOL is_disable;
} wgui_catcall_fte_iconbar_item_struct_int;

typedef struct
{
#ifndef __WGUI_CM_FTE_SLIM__
    S32 counts;
    wgui_catcall_fte_iconbar_item_struct_int items[WGUI_CATCALL_ICONBAR_MAX_NUM];
#endif /*__WGUI_CM_FTE_SLIM__*/    
    wgui_catcall_fte_iconbar_item_struct_int unlock_item;
    wgui_catcall_fte_is_screen_touch_handler is_touch_func;
    S32 x;
    S32 y;
    S32 w;
    S32 h;
    S32 touch_idx;
    MMI_BOOL is_screen_locked;
} wgui_catcall_fte_context_struct;

/* context */
static wgui_catcall_fte_context_struct g_wgui_catcall_fte_cntx = {0};


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_reset
 * DESCRIPTION
 *  reset fte icon bar for category 17, 403
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_iconbar_reset(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&g_wgui_catcall_fte_cntx, 0, sizeof(wgui_catcall_fte_context_struct));
    g_wgui_catcall_fte_cntx.touch_idx = -1;
}

#ifndef __WGUI_CM_FTE_SLIM__
/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_item_redraw
 * DESCRIPTION
 *  redraw fte icon bar button for category 17, 403
 * PARAMETERS
 *  item		[IN]		iconbar struct
 *  IsTouch	[IN]		whether down or up
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_iconbar_item_redraw(wgui_catcall_fte_iconbar_item_struct_int *item, MMI_BOOL IsTouch)
{
#if defined(__MMI_TOUCH_SCREEN__)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    GDI_HANDLE active_layer;
    UI_image_type img = NULL;
    color *text_color = NULL;
    S32 x, y, item_w, item_h, max_width;
#if defined(__MMI_MAINLCD_320X480__)
	color temp_disabled_color = gui_color(192,192,192); 
#endif /*__MMI_MAINLCD_320X480__*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
    /* clear background */
    gdi_draw_solid_rect(item->x - 1, item->y - 1, item->w + 1, item->h + 1, GDI_COLOR_TRANSPARENT);
    
    /* draw background */
    if (item->is_disable)
    {
        img = item->button.disable;
#if defined(__MMI_MAINLCD_320X480__)		
        text_color = &temp_disabled_color;
#else /*__MMI_MAINLCD_320X480__*/
        text_color = current_MMI_theme->list_disabled_text_color;
#endif /*__MMI_MAINLCD_320X480__*/
    }
    else
    {
        img = (IsTouch) ? (item->button.down) : (item->button.up);
        text_color = current_MMI_theme->CM_screen_text_color;
    }
    gdi_image_draw_resized(item->x, item->y, item->w, item->h, img);
    
    gdi_layer_get_active(&active_layer);
    gdi_push_and_set_alpha_blending_source_layer(active_layer);
    
    /* draw icon */
    gui_measure_image(item->button.icon, &item_w, &item_h);
    x = item->x + ((item->w - item_w) >> 1);
    y = item->y + WGUI_CATCALL_FTE_TEXT_GAP_Y;
	gdi_layer_push_and_set_clip(x, y, x + item_w, y + item_h);
    if (item->is_disable)
    {         
        gui_draw_image_with_alpha_transparent(item->button.icon, x, y, 125);		
    }
    else
    {
        gdi_image_draw(x, y, item->button.icon);
    }
    gdi_layer_pop_clip(); 
    
    /* draw string */
    gui_set_font(&MMI_small_font);
    gui_set_text_color(*text_color);
    gui_measure_string(item->button.label, &item_w, &item_h);
    max_width = WGUI_CATCALL_FTE_TEXT_GAP_X;
    max_width = item->w - (max_width << 1);
    item_w = (item_w > max_width) ? (max_width) : (item_w);
    x = item->x + ((max_width - item_w) >> 1) + WGUI_CATCALL_FTE_TEXT_GAP_X;
    x += (mmi_fe_get_r2l_state()) ? (item_w - 1) : (0);
    y = item->y + item->h - item_h - WGUI_CATCALL_FTE_TEXT_GAP_Y;
    gui_print_truncated_text(x, y, item_w, item->button.label);
    
    gdi_pop_and_restore_alpha_blending_source_layer();
    
    gdi_layer_pop_clip();
    gdi_layer_blt_previous(item->x - 1, item->y - 1, item->x + item->w + 1, item->y + item->h + 1);
#else /* __MMI_TOUCH_SCREEN__ */
    return ;
#endif /* __MMI_TOUCH_SCREEN__ */
}
#endif /*__WGUI_CM_FTE_SLIM__*/


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_lock_redraw
 * DESCRIPTION
 *  redraw fte icon bar lock&unlock button for category 17, 403
 * PARAMETERS
 *  item		[IN]		iconbar struct
 *  IsTouch	[IN]		whether down or up
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_iconbar_lock_redraw(wgui_catcall_fte_iconbar_item_struct_int *item, MMI_BOOL IsTouch)
{
#if defined(__MMI_TOUCH_SCREEN__)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_image_type img;
    U16 img_bg_id;
    S32 x, y, item_w, item_h, max_width;
    GDI_HANDLE active_layer;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
    /* clear background */
    gdi_draw_solid_rect(item->x - 1, item->y - 1, item->w + 1, item->h + 1, GDI_COLOR_TRANSPARENT);
    
    /* draw lock icon */
#if defined(__WGUI_CATE_FTE_RES_SLIM__) && !defined(__MMI_WEARABLE_DEVICE__)
    if(IsTouch)
    {
        img = item->button.down;
        img_bg_id = IMG_ID_UCM_LOCK_ICON_DOWN_BG;       
    }
    else
    {
        img = item->button.up;
        img_bg_id = IMG_ID_UCM_LOCK_ICON_UP_BG;
    }
    gdi_image_draw_resized(item->x, item->y, item->w, item->h, get_image(img_bg_id)); 
    
    gdi_layer_get_active(&active_layer);
    gdi_push_and_set_alpha_blending_source_layer(active_layer);
    
    gui_measure_image(img, &item_w, &item_h); 
    gdi_image_draw((item->x+ ((item->w - item_w) >> 1)), (item->y + ((item->h- item_h) >> 1)), img);
#else /*__WGUI_CATE_FTE_RES_SLIM__*/
    img = (IsTouch) ? (item->button.down) : (item->button.up);
    gdi_image_draw(item->x, item->y, img);
#endif /*__WGUI_CATE_FTE_RES_SLIM__*/

    /* draw string */
#if defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__)
    gui_set_font(&MMI_small_font);
#else /* defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__) */
    gui_set_font(&MMI_medium_font);
#endif /* defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__) */
    gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
    gui_measure_string(item->button.label, &item_w, &item_h);
    x = item->x + item->w + WGUI_CATCALL_FTE_TEXT_GAP_X;
    y = item->y + ((item->h - item_h) >> 1);
    max_width = g_wgui_catcall_fte_cntx.x + g_wgui_catcall_fte_cntx.w - WGUI_CATCALL_FTE_TEXT_GAP_X - x;
    x += (mmi_fe_get_r2l_state()) ? (max_width - 1) : (0);
    gui_print_truncated_text(x, y, max_width, item->button.label);
#ifdef __WGUI_CATE_FTE_RES_SLIM__
    gdi_pop_and_restore_alpha_blending_source_layer();
#endif /*__WGUI_CATE_FTE_RES_SLIM__*/
    
    gdi_layer_pop_clip();
    gdi_layer_blt_previous(item->x - 1, item->y - 1, item->x + item->w + 1, item->y + item->h + 1);
#else /* __MMI_TOUCH_SCREEN__ */
    return ;
#endif /* __MMI_TOUCH_SCREEN__ */
}


#ifdef __MMI_DIALER_TWO_DT_DIS__ 
/*****************************************************************************
 * FUNCTION
 *  wgui_cat403_draw_duration_str
 * DESCRIPTION
 *  draw duration string
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat403_draw_duration_str(void)
{
#if defined(__MMI_TOUCH_SCREEN__)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_and_set_clip(g_wgui_catcall_fte_cntx.x - 1,
                        g_wgui_catcall_fte_cntx.y - 1,
                        g_wgui_catcall_fte_cntx.x + g_wgui_catcall_fte_cntx.w + 1,
                        g_wgui_catcall_fte_cntx.y + g_wgui_catcall_fte_cntx.h + 1);

    if (MMI_message_string3)
    {
    S32 x = 0, y = 0, str_w = 0, str_h = 0;       
#ifndef __WGUI_CM_FTE_SLIM__
#if defined(__MMI_MAINLCD_240X320__)
    gui_set_font(&MMI_small_font);
#else /*__MMI_MAINLCD_240X320__*/
    gui_set_font(&MMI_medium_font);
#endif /*__MMI_MAINLCD_240X320__*/
#else /*__WGUI_CM_FTE_SLIM__*/
    gui_set_font(&MMI_large_font);
#endif /*__WGUI_CM_FTE_SLIM__*/
    gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
    gui_measure_string(MMI_message_string3, &str_w, &str_h);
    x = (mmi_fe_get_r2l_state()) ? ((U16)(MMI_fixed_icontext_menuitem.width - GUI_TEXT_MENUITEM_TEXT_X - WGUI_CATCALL_DRUATION2_STR1_W)) : ((U16)(GUI_TEXT_MENUITEM_TEXT_X));
    y = WGUI_CATCALL_DRUATION2_STR1_Y;
    str_w = (str_w > WGUI_CATCALL_DRUATION2_STR1_W) ? (WGUI_CATCALL_DRUATION2_STR1_W) : (str_w);
    gui_print_truncated_text(x, y, str_w, MMI_message_string3); 
    }
    gdi_layer_pop_clip();
    gdi_layer_blt_previous(g_wgui_catcall_fte_cntx.x - 1,
                           g_wgui_catcall_fte_cntx.y - 1,
                           g_wgui_catcall_fte_cntx.x + g_wgui_catcall_fte_cntx.w + 1,
                           g_wgui_catcall_fte_cntx.y + g_wgui_catcall_fte_cntx.h + 1);
#else /* __MMI_TOUCH_SCREEN__  */
    return ;
#endif /* __MMI_TOUCH_SCREEN__ */
}
#endif

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_redraw
 * DESCRIPTION
 *  redraw fte icon bar for category 17, 403
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_iconbar_redraw(void)
{
#if defined(__MMI_TOUCH_SCREEN__)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_image_type img = NULL;
    U16 img_bg_id;
    S32 gap_x = WGUI_CATCALL_FTE_TEXT_GAP_X;    
    S32 x, y, item_w, item_h, max_width;
    GDI_HANDLE active_layer;
#ifndef __WGUI_CM_FTE_SLIM__
	color *text_color = NULL;
    S32 gap_y = WGUI_CATCALL_FTE_TEXT_GAP_Y;
    S32 i;
#if defined(__MMI_MAINLCD_320X480__)
	color temp_disabled_color = gui_color(192,192,192); 
#endif /*__MMI_MAINLCD_320X480__*/
#endif /*__WGUI_CM_FTE_SLIM__*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_clip();
    gdi_layer_reset_clip();

    /* clear background */
    gdi_draw_solid_rect(g_wgui_catcall_fte_cntx.x - 1,
                        g_wgui_catcall_fte_cntx.y - 1,
                        g_wgui_catcall_fte_cntx.x + g_wgui_catcall_fte_cntx.w + 1,
                        g_wgui_catcall_fte_cntx.y + g_wgui_catcall_fte_cntx.h + 1,
                        GDI_COLOR_TRANSPARENT);

    if (g_wgui_catcall_fte_cntx.is_screen_locked)
    {
#if defined(__WGUI_CATE_FTE_RES_SLIM__) && !defined(__MMI_WEARABLE_DEVICE__)
        /* draw lock icon */
        if(g_wgui_catcall_fte_cntx.touch_idx == WGUI_CATCALL_ICONBAR_MAX_NUM)
        {
            img = g_wgui_catcall_fte_cntx.unlock_item.button.down;
            img_bg_id = IMG_ID_UCM_LOCK_ICON_DOWN_BG;       
        }
        else
        {
            img = g_wgui_catcall_fte_cntx.unlock_item.button.up;
            img_bg_id = IMG_ID_UCM_LOCK_ICON_UP_BG;
        }
        gdi_image_draw_resized(g_wgui_catcall_fte_cntx.unlock_item.x, 
            g_wgui_catcall_fte_cntx.unlock_item.y, 
            g_wgui_catcall_fte_cntx.unlock_item.w, 
            g_wgui_catcall_fte_cntx.unlock_item.h, 
            get_image(img_bg_id));
        gdi_layer_get_active(&active_layer);
        gdi_push_and_set_alpha_blending_source_layer(active_layer);
        gui_measure_image(img, &item_w, &item_h); 
        gdi_image_draw((g_wgui_catcall_fte_cntx.unlock_item.x + ((g_wgui_catcall_fte_cntx.unlock_item.w - item_w) >> 1)), 
            (g_wgui_catcall_fte_cntx.unlock_item.y + ((g_wgui_catcall_fte_cntx.unlock_item.h- item_h) >> 1)), 
            img);
#else /*__WGUI_CATE_FTE_RES_SLIM__*/
        img = (g_wgui_catcall_fte_cntx.touch_idx == WGUI_CATCALL_ICONBAR_MAX_NUM) ? (g_wgui_catcall_fte_cntx.unlock_item.button.down) : (g_wgui_catcall_fte_cntx.unlock_item.button.up);
        gdi_image_draw(g_wgui_catcall_fte_cntx.unlock_item.x, g_wgui_catcall_fte_cntx.unlock_item.y, img);
#endif /*__WGUI_CATE_FTE_RES_SLIM__*/

        /* draw string */
#if defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__)
        gui_set_font(&MMI_small_font);
#else /* defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__) */
        gui_set_font(&MMI_medium_font);
#endif /* defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__) */
        gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
        gui_measure_string(g_wgui_catcall_fte_cntx.unlock_item.button.label, &item_w, &item_h);
        x = g_wgui_catcall_fte_cntx.unlock_item.x + g_wgui_catcall_fte_cntx.unlock_item.w + gap_x;
        y = g_wgui_catcall_fte_cntx.unlock_item.y + ((g_wgui_catcall_fte_cntx.unlock_item.h - item_h) >> 1);
        max_width = g_wgui_catcall_fte_cntx.x + g_wgui_catcall_fte_cntx.w - gap_x - x;
		x += (mmi_fe_get_r2l_state()) ? (max_width - 1) : (0);
        gui_print_truncated_text(x, y, max_width, g_wgui_catcall_fte_cntx.unlock_item.button.label);
#ifdef __WGUI_CATE_FTE_RES_SLIM__
        gdi_pop_and_restore_alpha_blending_source_layer();
#endif /*__WGUI_CATE_FTE_RES_SLIM__*/
    }
#ifndef __WGUI_CM_FTE_SLIM__
    else if(g_wgui_catcall_fte_cntx.counts > 0)
    {
        gdi_layer_get_active(&active_layer);
        for (i = 0 ; i < g_wgui_catcall_fte_cntx.counts ; i++)
        {
            /* draw background */
            if (g_wgui_catcall_fte_cntx.items[i].is_disable)
            {
                img = g_wgui_catcall_fte_cntx.items[i].button.disable;
        #if defined(__MMI_MAINLCD_320X480__)		
                text_color = &temp_disabled_color;
        #else /*__MMI_MAINLCD_320X480__*/
                text_color = current_MMI_theme->list_disabled_text_color;
        #endif /*__MMI_MAINLCD_320X480__*/
            }
            else
            {
                img = (g_wgui_catcall_fte_cntx.touch_idx == i) ? (g_wgui_catcall_fte_cntx.items[i].button.down) : (g_wgui_catcall_fte_cntx.items[i].button.up);
				text_color = current_MMI_theme->CM_screen_text_color;
            }
            gdi_image_draw_resized(g_wgui_catcall_fte_cntx.items[i].x, g_wgui_catcall_fte_cntx.items[i].y, g_wgui_catcall_fte_cntx.items[i].w, g_wgui_catcall_fte_cntx.items[i].h, img);

            gdi_push_and_set_alpha_blending_source_layer(active_layer);

            /* draw icon */
            gui_measure_image(g_wgui_catcall_fte_cntx.items[i].button.icon, &item_w, &item_h);
            x = g_wgui_catcall_fte_cntx.items[i].x + ((g_wgui_catcall_fte_cntx.items[i].w - item_w) >> 1);
            y = g_wgui_catcall_fte_cntx.items[i].y + gap_y;
            
            gdi_layer_push_and_set_clip(x, y, x + item_w, y + item_h);
            if (g_wgui_catcall_fte_cntx.items[i].is_disable)
            {         
                gui_draw_image_with_alpha_transparent(g_wgui_catcall_fte_cntx.items[i].button.icon, x, y, 125);
            }
            else
            {
                gdi_image_draw(x, y, g_wgui_catcall_fte_cntx.items[i].button.icon);
            }            
            gdi_layer_pop_clip(); 

            /* draw string */
            gui_set_font(&MMI_small_font);
            gui_set_text_color(*text_color);
            gui_measure_string(g_wgui_catcall_fte_cntx.items[i].button.label, &item_w, &item_h);
            max_width = g_wgui_catcall_fte_cntx.items[i].w - (gap_x << 1);
            item_w = (item_w > max_width) ? (max_width) : (item_w);
            x = g_wgui_catcall_fte_cntx.items[i].x + ((max_width - item_w) >> 1) + gap_x;
			x += (mmi_fe_get_r2l_state()) ? (item_w - 1) : (0);
            y = g_wgui_catcall_fte_cntx.items[i].y + g_wgui_catcall_fte_cntx.items[i].h - item_h - gap_y;
            gui_print_truncated_text(x, y, item_w, g_wgui_catcall_fte_cntx.items[i].button.label);

            gdi_pop_and_restore_alpha_blending_source_layer();
        }
    } 
#endif /*__WGUI_CM_FTE_SLIM__*/
    gdi_layer_pop_clip();
    gdi_layer_blt_previous(g_wgui_catcall_fte_cntx.x - 1,
                           g_wgui_catcall_fte_cntx.y - 1,
                           g_wgui_catcall_fte_cntx.x + g_wgui_catcall_fte_cntx.w + 1,
                           g_wgui_catcall_fte_cntx.y + g_wgui_catcall_fte_cntx.h + 1);
#else /* __MMI_TOUCH_SCREEN__  */
    return ;
#endif /* __MMI_TOUCH_SCREEN__ */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_pen_down_hdlr
 * DESCRIPTION
 *  pen down handler for fte icon bar
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_catcall_fte_iconbar_pen_down_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __WGUI_CM_FTE_SLIM__
    S32 i;
#endif /*__WGUI_CM_FTE_SLIM__*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_catcall_fte_cntx.is_screen_locked)
    {
        if (PEN_CHECK_BOUND(point.x, point.y, g_wgui_catcall_fte_cntx.unlock_item.x, g_wgui_catcall_fte_cntx.unlock_item.y, g_wgui_catcall_fte_cntx.unlock_item.w, g_wgui_catcall_fte_cntx.unlock_item.h))
        {
            /* use WGUI_CATCALL_ICONBAR_MAX_NUM to represent pen down in lock icon */
            g_wgui_catcall_fte_cntx.touch_idx = WGUI_CATCALL_ICONBAR_MAX_NUM;
            gui_touch_feedback_play(GUI_TOUCH_FEEDBACK_DOWN);
            wgui_catcall_fte_iconbar_lock_redraw(&g_wgui_catcall_fte_cntx.unlock_item, MMI_TRUE);
            return MMI_TRUE;
        }
    }
#ifndef __WGUI_CM_FTE_SLIM__
    else
    {
        for (i = 0 ; i < g_wgui_catcall_fte_cntx.counts ; i++)
        {
            if (PEN_CHECK_BOUND(point.x, point.y, g_wgui_catcall_fte_cntx.items[i].x, g_wgui_catcall_fte_cntx.items[i].y, g_wgui_catcall_fte_cntx.items[i].w, g_wgui_catcall_fte_cntx.items[i].h))
            {
                if (!g_wgui_catcall_fte_cntx.items[i].is_disable)
                {
                    g_wgui_catcall_fte_cntx.touch_idx = i;
                    gui_touch_feedback_play(GUI_TOUCH_FEEDBACK_DOWN);
                    wgui_catcall_fte_iconbar_item_redraw(&g_wgui_catcall_fte_cntx.items[i], MMI_TRUE);
                    return MMI_TRUE;
                }
                break;
            }
        }
    }
#endif /*__WGUI_CM_FTE_SLIM__*/
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_pen_move_hdlr
 * DESCRIPTION
 *  pen move handler for fte icon bar
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_catcall_fte_iconbar_pen_move_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    wgui_catcall_fte_iconbar_item_struct_int *item;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __WGUI_CM_FTE_SLIM__
    if(g_wgui_catcall_fte_cntx.touch_idx < 0 ||g_wgui_catcall_fte_cntx.touch_idx > WGUI_CATCALL_ICONBAR_MAX_NUM)
    {
        return MMI_TRUE;
    }
    if(g_wgui_catcall_fte_cntx.counts > 0)
    {
        item = (g_wgui_catcall_fte_cntx.is_screen_locked) ? (&g_wgui_catcall_fte_cntx.unlock_item) : (&g_wgui_catcall_fte_cntx.items[g_wgui_catcall_fte_cntx.touch_idx]);
        if (!PEN_CHECK_BOUND(point.x, point.y, item->x, item->y, item->w, item->h))
        {
            g_wgui_catcall_fte_cntx.touch_idx = -1;
            if (g_wgui_catcall_fte_cntx.is_screen_locked)
            {
                wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
            }
            else
            {
                wgui_catcall_fte_iconbar_item_redraw(item, MMI_FALSE);
            }
        }
     }
     else
     {
         if(g_wgui_catcall_fte_cntx.is_screen_locked)
         {
             item = &g_wgui_catcall_fte_cntx.unlock_item;
             if (!PEN_CHECK_BOUND(point.x, point.y, item->x, item->y, item->w, item->h))
             {
                 g_wgui_catcall_fte_cntx.touch_idx = -1;
                 wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
             }
         }

     }
    
#else /*__WGUI_CM_FTE_SLIM__*/
    if(g_wgui_catcall_fte_cntx.is_screen_locked)
    {
        item = &g_wgui_catcall_fte_cntx.unlock_item;
        if (!PEN_CHECK_BOUND(point.x, point.y, item->x, item->y, item->w, item->h))
        {
            g_wgui_catcall_fte_cntx.touch_idx = -1;
            wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
        }
    }

#endif /*__WGUI_CM_FTE_SLIM__*/
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_pen_up_hdlr
 * DESCRIPTION
 *  pen up handler for fte icon bar
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_catcall_fte_iconbar_pen_up_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    wgui_catcall_fte_iconbar_item_struct_int *item;
    FuncPtr func = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __WGUI_CM_FTE_SLIM__
    if(g_wgui_catcall_fte_cntx.touch_idx < 0 ||g_wgui_catcall_fte_cntx.touch_idx > WGUI_CATCALL_ICONBAR_MAX_NUM)
    {
        return MMI_TRUE;
    }
    if(g_wgui_catcall_fte_cntx.counts > 0)
    {
        item = (g_wgui_catcall_fte_cntx.is_screen_locked) ? (&g_wgui_catcall_fte_cntx.unlock_item) : (&g_wgui_catcall_fte_cntx.items[g_wgui_catcall_fte_cntx.touch_idx]);
        if (PEN_CHECK_BOUND(point.x, point.y, item->x, item->y, item->w, item->h))
        {
            func = item->button.handler;
        }

        /* reset icon bar */
        g_wgui_catcall_fte_cntx.touch_idx = -1;
        if (g_wgui_catcall_fte_cntx.is_screen_locked)
        {
            wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
        }
        else
        {
            wgui_catcall_fte_iconbar_item_redraw(item, MMI_FALSE);
        }
    }
    else
    {
         if (g_wgui_catcall_fte_cntx.is_screen_locked)
         {
             item = &g_wgui_catcall_fte_cntx.unlock_item;
             if (PEN_CHECK_BOUND(point.x, point.y, item->x, item->y, item->w, item->h))
             {
                 func = item->button.handler;
             }
        
             /* reset icon bar */
             g_wgui_catcall_fte_cntx.touch_idx = -1;
        
             wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
        }

    }
#else /*__WGUI_CM_FTE_SLIM__*/
    if (g_wgui_catcall_fte_cntx.is_screen_locked)
    {
        item = &g_wgui_catcall_fte_cntx.unlock_item;
        if (PEN_CHECK_BOUND(point.x, point.y, item->x, item->y, item->w, item->h))
        {
            func = item->button.handler;
        }

        /* reset icon bar */
        g_wgui_catcall_fte_cntx.touch_idx = -1;

        wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
   }
#endif /*__WGUI_CM_FTE_SLIM__*/
    /* lauch handler */
    if (func)
    {
        func();
    }

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_pen_abort_hdlr
 * DESCRIPTION
 *  pen abort handler for fte icon bar
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_catcall_fte_iconbar_pen_abort_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    wgui_catcall_fte_iconbar_item_struct_int *item;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* reset icon bar */
    if (g_wgui_catcall_fte_cntx.touch_idx < 0 || g_wgui_catcall_fte_cntx.touch_idx > WGUI_CATCALL_ICONBAR_MAX_NUM)
    {
        g_wgui_catcall_fte_cntx.touch_idx = -1;
        wgui_catcall_fte_iconbar_redraw();
        return MMI_TRUE;
    }
    else
    {
#ifndef __WGUI_CM_FTE_SLIM__
        if(g_wgui_catcall_fte_cntx.counts > 0)
        {
            item = (g_wgui_catcall_fte_cntx.is_screen_locked) ? (&g_wgui_catcall_fte_cntx.unlock_item) : (&g_wgui_catcall_fte_cntx.items[g_wgui_catcall_fte_cntx.touch_idx]);
            g_wgui_catcall_fte_cntx.touch_idx = -1;
            if (g_wgui_catcall_fte_cntx.is_screen_locked)
            {
                wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
            }
            else
            {
                wgui_catcall_fte_iconbar_item_redraw(item, MMI_FALSE);
            }
        }
        else
        {
            if (g_wgui_catcall_fte_cntx.is_screen_locked)
            {        
                item = &g_wgui_catcall_fte_cntx.unlock_item;
                g_wgui_catcall_fte_cntx.touch_idx = -1;
                
                wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
            }
        }
#else /*__WGUI_CM_FTE_SLIM__*/
        if (g_wgui_catcall_fte_cntx.is_screen_locked)
        {        
            item = &g_wgui_catcall_fte_cntx.unlock_item;
            g_wgui_catcall_fte_cntx.touch_idx = -1;
            
            wgui_catcall_fte_iconbar_lock_redraw(item, MMI_FALSE);
        }
#endif /*__WGUI_CM_FTE_SLIM__*/

    }
    
    return MMI_TRUE;
}


/* For detail description, please refer to wgui_categories_CM.h */
void wgui_catcall_fte_setup(
        S32 number_of_items,
        wgui_catcall_fte_iconbar_item_struct *items,
        wgui_catcall_fte_iconbar_item_struct unlock_item,
        wgui_catcall_fte_is_screen_touch_handler is_touch_handler)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __WGUI_CM_FTE_SLIM__
	S32 i;
#endif /*__WGUI_CM_FTE_SLIM__*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_catcall_fte_iconbar_reset();
#ifndef __WGUI_CM_FTE_SLIM__
    number_of_items = (number_of_items > WGUI_CATCALL_ICONBAR_MAX_NUM) ? (WGUI_CATCALL_ICONBAR_MAX_NUM) : (number_of_items);

    g_wgui_catcall_fte_cntx.counts = number_of_items;
    for (i = 0 ; i < number_of_items ; i ++)
    {
        memcpy(&g_wgui_catcall_fte_cntx.items[i].button, &items[i], sizeof(wgui_catcall_fte_iconbar_item_struct));
    }
#endif /*__WGUI_CM_FTE_SLIM__*/

    memcpy(&g_wgui_catcall_fte_cntx.unlock_item.button, &unlock_item, sizeof(wgui_catcall_fte_iconbar_item_struct));
    g_wgui_catcall_fte_cntx.is_touch_func = is_touch_handler;
}

#ifdef __WGUI_CM_FTE_SLIM__
/* For detail description, please refer to wgui_categories_CM.h */
void wgui_catcall_fte_setup_ex(
        wgui_catcall_fte_iconbar_item_struct unlock_item,
        wgui_catcall_fte_is_screen_touch_handler is_touch_handler)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_catcall_fte_iconbar_reset();

    memcpy(&g_wgui_catcall_fte_cntx.unlock_item.button, &unlock_item, sizeof(wgui_catcall_fte_iconbar_item_struct));
    g_wgui_catcall_fte_cntx.is_touch_func = is_touch_handler;
}
#endif /*__WGUI_CM_FTE_SLIM__*/

/* For detail description, please refer to wgui_categories_CM.h */
void wgui_catcall_fte_iconbar_set_item(S32 idx, UI_string_type label, UI_image_type icon)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __WGUI_CM_FTE_SLIM__
    g_wgui_catcall_fte_cntx.items[idx].button.label = label;
    g_wgui_catcall_fte_cntx.items[idx].button.icon = icon;

    if (((g_dm_data.s32CatId != MMI_CATEGORY18_ID) && (g_dm_data.s32CatId != MMI_CATEGORY403_ID)) ||
        (idx >= g_wgui_catcall_fte_cntx.counts))
    {
        /* return directly if not in ategory 17 or 403 or the index is larger than the total numbers */
        return;
    }

    wgui_catcall_fte_iconbar_item_redraw(&g_wgui_catcall_fte_cntx.items[idx], (MMI_BOOL)(g_wgui_catcall_fte_cntx.touch_idx==idx));
#endif /*__WGUI_CM_FTE_SLIM__*/
}


/* For detail description, please refer to wgui_categories_CM.h */
void  wgui_catcall_fte_iconbar_enable_item(S32 idx, MMI_BOOL is_disable, UI_string_type label, UI_image_type icon)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __WGUI_CM_FTE_SLIM__

    g_wgui_catcall_fte_cntx.items[idx].button.label = label;
    g_wgui_catcall_fte_cntx.items[idx].button.icon = icon;

    g_wgui_catcall_fte_cntx.items[idx].is_disable = is_disable;

    if (((g_dm_data.s32CatId != MMI_CATEGORY18_ID) && (g_dm_data.s32CatId != MMI_CATEGORY403_ID)) ||
        (idx >= g_wgui_catcall_fte_cntx.counts))
    {
        /* return directly if not in ategory 17 or 403 or the index is larger than the total numbers */
        return;
    }

    wgui_catcall_fte_iconbar_item_redraw(&g_wgui_catcall_fte_cntx.items[idx], (MMI_BOOL)(g_wgui_catcall_fte_cntx.touch_idx==idx));
#endif /*__WGUI_CM_FTE_SLIM__*/
}

/* For detail description, please refer to wgui_categories_CM.h */
void wgui_catcall_fte_lock_screen(MMI_BOOL is_lock_screen)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if !defined(__MMI_TOUCH_SCREEN__)
    is_lock_screen = MMI_FALSE;
#endif /* !__MMI_TOUCH_SCREEN__ */
    g_wgui_catcall_fte_cntx.is_screen_locked = is_lock_screen;

    gdi_layer_lock_frame_buffer();
    if (g_wgui_catcall_fte_cntx.is_screen_locked)
    {
        wgui_softkey_disable_softkeys();
    }
    else
    {
        wgui_softkey_enable_softkeys();
    }
    gdi_layer_unlock_frame_buffer();

    if ((g_dm_data.s32CatId != MMI_CATEGORY18_ID) && (g_dm_data.s32CatId != MMI_CATEGORY403_ID))
    {
        /* return directly if not in ategory 17 or 403 */
        return;
    }

    gdi_layer_lock_frame_buffer();
    wgui_catcall_fte_iconbar_redraw();
    gdi_layer_unlock_frame_buffer();

    gdi_lcd_repaint_all();
}
/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_draw_ctrl_area1
 * DESCRIPTION
 *  draw control area 1, including popup background, on background new layer
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_draw_ctrl_area1(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    GDI_HANDLE active_layer;
    extern UI_filled_area wgui_pop_up_dialog_background;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(coordinate);

    /* clear background */
    gdi_layer_clear(GDI_COLOR_BLACK);

    /* draw popup background */
    gdi_layer_push_clip();
    gdi_layer_reset_clip();
    gdi_layer_get_active(&active_layer);
    gdi_push_and_set_alpha_blending_source_layer(active_layer);
	gui_draw_filled_area(
        WGUI_CATCALL_FTE_POPUP_X,
        WGUI_CATCALL_FTE_POPUP_Y,
        WGUI_CATCALL_FTE_POPUP_X + WGUI_CATCALL_FTE_POPUP_W - 1,
        WGUI_CATCALL_FTE_POPUP_Y + WGUI_CATCALL_FTE_POPUP_H - 1,
        current_MMI_theme->sub_menu_bkg_filler
        /*&wgui_pop_up_dialog_background*/);
    gdi_pop_and_restore_alpha_blending_source_layer();
    gdi_layer_pop_clip();
}

#if defined(__MMI_MAINLCD_320X240__)
/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_draw_ctrl_area2
 * DESCRIPTION
 *  draw control area 2, including calling string, icon, etc., on base layer
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_draw_ctrl_area2(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 x = 0, y = 0, str_w = 0, str_h = 0, icon_w = 0, icon_h = 0, x_shift = 0, var;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(coordinate);

    /* draw caller icon */
	wgui_catcall_draw_caller_icon(WGUI_CATCALL_FTE_IMG_X + WGUI_CATCALL_FTE_X_OFFSET, WGUI_CATCALL_FTE_IMG_Y, WGUI_CATCALL_FTE_IMG_W, WGUI_CATCALL_FTE_IMG_H);

	/* calling... */
	if (MMI_message_string2)
	{
		S32 x_offset;
        gui_set_font(&MMI_medium_font);
		gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
		gui_measure_string(MMI_message_string2, &str_w, &str_h);
		x = (mmi_fe_get_r2l_state()) ? (WGUI_CATCALL_FTE_STR1_W + WGUI_CATCALL_FTE_STR1_X + WGUI_CATCALL_FTE_X_OFFSET - 1) : (WGUI_CATCALL_FTE_STR1_X + WGUI_CATCALL_FTE_X_OFFSET);
		y = WGUI_CATCALL_FTE_STR1_Y;
		str_w = (str_w > WGUI_CATCALL_FTE_STR1_W) ? (WGUI_CATCALL_FTE_STR1_W) : (str_w);
		x_offset = (WGUI_CATCALL_FTE_STR1_W - str_w) >> 1;
		x += (mmi_fe_get_r2l_state()) ? (-x_offset) : (x_offset);
		gui_print_truncated_text(x, y, str_w, MMI_message_string2);
	}

	/* indicator icon */
	if (gCallLine != 0)
	{
		gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
		x = (mmi_fe_get_r2l_state()) ? (WGUI_CATCALL_FTE_STR2_W + WGUI_CATCALL_FTE_STR2_X - 1 - icon_w) : (WGUI_CATCALL_FTE_STR2_X);
		y = WGUI_CATCALL_FTE_STR2_Y + ((WGUI_CATCALL_FTE_STR2_H - icon_h) >> 1);
		gdi_image_draw_id(x, y, gCallLine);

		x_shift += icon_w + 2;
	}

	/* call number type icon */
	if (g_wgui_catcall_number_type_icons)
	{
		gdi_image_get_dimension_id(g_wgui_catcall_number_type_icons[0], &icon_w, &icon_h);
		x = (mmi_fe_get_r2l_state()) ? (WGUI_CATCALL_FTE_STR2_W + WGUI_CATCALL_FTE_STR2_X - 1 - x_shift - icon_w) : (WGUI_CATCALL_FTE_STR2_X + x_shift);
		y = WGUI_CATCALL_FTE_STR2_Y + ((WGUI_CATCALL_FTE_STR2_H - icon_h) >> 1);
		gdi_image_draw_id(x, y, g_wgui_catcall_number_type_icons[0]);

		x_shift += icon_w + 2;
	}

	/* 0912345678 */
	if (MMI_message_string)
	{
		x = WGUI_CATCALL_FTE_STR2_X;
		x += (mmi_fe_get_r2l_state()) ? (0) : (x_shift);
		y = WGUI_CATCALL_FTE_STR2_Y;
		
#ifndef __WGUI_CM_FTE_SLIM__
		str_w = WGUI_CATCALL_FTE_STR2_W - x_shift;
#else /*__WGUI_CM_FTE_SLIM__*/
        str_w = WGUI_CATCALL_FTE_STR2_W + WGUI_CATCALL_FTE_X_OFFSET * 2 - x_shift;
#endif /*__WGUI_CM_FTE_SLIM__*/
        str_h = WGUI_CATCALL_FTE_STR2_H;

        gui_set_font(&MMI_medium_font);
		gui_create_scrolling_text(
			&CM_scrolling_text,
			x, y, str_w, str_h,
			MMI_message_string,
			CM_scrolling_text_timer_callback,
			CM_draw_scrolling_text_background,
			*current_MMI_theme->CM_screen_text_color,
			gui_color(255, 255, 255));
		CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
		gui_show_scrolling_text(&CM_scrolling_text);
	}
#ifndef __WGUI_CM_FTE_SLIM__
    /* configure icon bar */
	var = WGUI_CATCALL_FTE_ICONBAR_H * 3 + WGUI_CATCALL_FTE_ICONBAR_GAP + WGUI_CATCALL_FTE_ICONBAR_GAP;
    switch(g_wgui_catcall_fte_cntx.counts)
    {
        case 1:
			g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
			g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y;
			g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
			g_wgui_catcall_fte_cntx.h = var;

			g_wgui_catcall_fte_cntx.items[0].x = WGUI_CATCALL_FTE_ICONBAR_X;
			g_wgui_catcall_fte_cntx.items[0].y = WGUI_CATCALL_FTE_ICONBAR_Y + WGUI_CATCALL_FTE_ICONBAR_GAP + WGUI_CATCALL_FTE_ICONBAR_H;
			g_wgui_catcall_fte_cntx.items[0].w = WGUI_CATCALL_FTE_ICONBAR_W;
			g_wgui_catcall_fte_cntx.items[0].h = WGUI_CATCALL_FTE_ICONBAR_H;
        case 2:    
            g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.h = var;

            var = WGUI_CATCALL_FTE_ICONBAR_H / 2;
			g_wgui_catcall_fte_cntx.items[0].x = WGUI_CATCALL_FTE_ICONBAR_X;
			g_wgui_catcall_fte_cntx.items[0].y = WGUI_CATCALL_FTE_ICONBAR_Y + var;
			g_wgui_catcall_fte_cntx.items[0].w = WGUI_CATCALL_FTE_ICONBAR_W;
			g_wgui_catcall_fte_cntx.items[0].h = WGUI_CATCALL_FTE_ICONBAR_H;

			g_wgui_catcall_fte_cntx.items[1].x = WGUI_CATCALL_FTE_ICONBAR_X;
			g_wgui_catcall_fte_cntx.items[1].y = WGUI_CATCALL_FTE_ICONBAR_Y + WGUI_CATCALL_FTE_ICONBAR_H + WGUI_CATCALL_FTE_ICONBAR_GAP + var;
			g_wgui_catcall_fte_cntx.items[1].w = WGUI_CATCALL_FTE_ICONBAR_W;
			g_wgui_catcall_fte_cntx.items[1].h = WGUI_CATCALL_FTE_ICONBAR_H;
            break;
        case 3:
            g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.h = var;

            var = WGUI_CATCALL_FTE_ICONBAR_H + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[0].x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.items[0].y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.items[0].w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.items[0].h = WGUI_CATCALL_FTE_ICONBAR_H;   

			g_wgui_catcall_fte_cntx.items[1].x = WGUI_CATCALL_FTE_ICONBAR_X;
			g_wgui_catcall_fte_cntx.items[1].y = WGUI_CATCALL_FTE_ICONBAR_Y + var;
			g_wgui_catcall_fte_cntx.items[1].w = WGUI_CATCALL_FTE_ICONBAR_W;
			g_wgui_catcall_fte_cntx.items[1].h = WGUI_CATCALL_FTE_ICONBAR_H;

			g_wgui_catcall_fte_cntx.items[2].x = WGUI_CATCALL_FTE_ICONBAR_X;
			g_wgui_catcall_fte_cntx.items[2].y = WGUI_CATCALL_FTE_ICONBAR_Y + var + var;
			g_wgui_catcall_fte_cntx.items[2].w = WGUI_CATCALL_FTE_ICONBAR_W;
			g_wgui_catcall_fte_cntx.items[2].h = WGUI_CATCALL_FTE_ICONBAR_H;
            break;
        default:
            break;
    }

#else /*__WGUI_CM_FTE_SLIM__*/
	var = WGUI_CATCALL_FTE_ICONBAR_H  + WGUI_CATCALL_FTE_ICONBAR_GAP + WGUI_CATCALL_FTE_ICONBAR_GAP;

    g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
    g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y;
    g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
    g_wgui_catcall_fte_cntx.h = var;
#endif /*__WGUI_CM_FTE_SLIM__*/

    //gui_measure_image(g_wgui_catcall_fte_cntx.unlock_item.button.up, &icon_w, &icon_h);
    g_wgui_catcall_fte_cntx.unlock_item.x = WGUI_CATCALL_FTE_ICONBAR_X;

	g_wgui_catcall_fte_cntx.unlock_item.y = WGUI_CATCALL_FTE_ICONBAR_Y + ((WGUI_CATCALL_FTE_ICONBAR_H - icon_h) >> 1);
    g_wgui_catcall_fte_cntx.unlock_item.w = WGUI_CATCALL_FTE_ICONBAR_UNLOCK_W;
    g_wgui_catcall_fte_cntx.unlock_item.h = WGUI_CATCALL_FTE_ICONBAR_UNLOCK_H;

    /* draw icon bar */
    wgui_catcall_fte_iconbar_redraw();

}

#else /* __MMI_MAINLCD_320X240__ */

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_draw_ctrl_area2
 * DESCRIPTION
 *  draw control area 2, including calling string, icon, etc., on base layer
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_draw_ctrl_area2(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 x = 0, y = 0, str_w = 0, str_h = 0, icon_w = 0, icon_h = 0, x_shift = 0;
#ifndef __WGUI_CM_FTE_SLIM__
    S32 btn_w, i;
#endif /*__WGUI_CM_FTE_SLIM__*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(coordinate);

    /* draw caller icon */
    wgui_catcall_draw_caller_icon(WGUI_CATCALL_FTE_IMG_X, WGUI_CATCALL_FTE_IMG_Y, WGUI_CATCALL_FTE_IMG_W, WGUI_CATCALL_FTE_IMG_H);

    /* calling... */
    if (MMI_message_string2)
    {
        S32 x_offset;
#ifndef __WGUI_CM_FTE_SLIM__
#if defined(__MMI_MAINLCD_240X320__)
        gui_set_font(&MMI_small_font);
#else /*__MMI_MAINLCD_240X320__*/
        gui_set_font(&MMI_medium_font);
#endif /*__MMI_MAINLCD_240X320__*/
#else /*__WGUI_CM_FTE_SLIM__*/
        gui_set_font(&MMI_large_font);
#endif /*__WGUI_CM_FTE_SLIM__*/
        gui_set_text_color(*current_MMI_theme->CM_screen_text_color);
        gui_measure_string(MMI_message_string2, &str_w, &str_h);
        x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CATCALL_FTE_STR1_X - 1) : (WGUI_CATCALL_FTE_STR1_X);
        y = WGUI_CATCALL_FTE_STR1_Y;
        str_w = (str_w > WGUI_CATCALL_FTE_STR1_W) ? (WGUI_CATCALL_FTE_STR1_W) : (str_w);
        x_offset = (WGUI_CATCALL_FTE_STR1_W - str_w) >> 1;
        x += (mmi_fe_get_r2l_state()) ? (-x_offset) : (x_offset);
        gui_print_truncated_text(x, y, str_w, MMI_message_string2);
    }

    /* indicator icon */
    if (gCallLine != 0)
    {
        gdi_image_get_dimension_id(gCallLine, &icon_w, &icon_h);
        x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CATCALL_FTE_STR2_X - 1 - icon_w) : (WGUI_CATCALL_FTE_STR2_X);
        y = WGUI_CATCALL_FTE_STR2_Y + ((WGUI_CATCALL_FTE_STR2_H - icon_h) >> 1);
        gdi_image_draw_id(x, y, gCallLine);

        x_shift += icon_w + 2;
    }

    /* call number type icon */
    if (g_wgui_catcall_number_type_icons)
    {
        gdi_image_get_dimension_id(g_wgui_catcall_number_type_icons[0], &icon_w, &icon_h);
        x = (mmi_fe_get_r2l_state()) ? (UI_device_width - WGUI_CATCALL_FTE_STR2_X - 1 - x_shift - icon_w) : (WGUI_CATCALL_FTE_STR2_X + x_shift);
        y = WGUI_CATCALL_FTE_STR2_Y + ((WGUI_CATCALL_FTE_STR2_H - icon_h) >> 1);
        gdi_image_draw_id(x, y, g_wgui_catcall_number_type_icons[0]);

        x_shift += icon_w + 2;
    }

    /* 0912345678 */
    if (MMI_message_string)
    {
        x = WGUI_CATCALL_FTE_STR2_X;
        x += (mmi_fe_get_r2l_state()) ? (0) : (x_shift);
        y = WGUI_CATCALL_FTE_STR2_Y;
        str_w = WGUI_CATCALL_FTE_STR2_W - x_shift;
        str_h = WGUI_CATCALL_FTE_STR2_H;

#ifndef __WGUI_CM_FTE_SLIM__
#if defined(__MMI_MAINLCD_240X320__)
        gui_set_font(&MMI_small_font);
#else /*__MMI_MAINLCD_240X320__*/
        gui_set_font(&MMI_medium_font);
#endif /*__MMI_MAINLCD_240X320__*/
#else /*__WGUI_CM_FTE_SLIM__*/
    gui_set_font(&MMI_large_font);
#endif /*__WGUI_CM_FTE_SLIM__*/

        gui_create_scrolling_text(
            &CM_scrolling_text,
            x, y, str_w, str_h,
            MMI_message_string,
            CM_scrolling_text_timer_callback,
            CM_draw_scrolling_text_background,
            *current_MMI_theme->CM_screen_text_color,
            gui_color(255, 255, 255));
        CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
        gui_show_scrolling_text(&CM_scrolling_text);
    }

    /* configure icon bar */

#ifndef __WGUI_CM_FTE_SLIM__
    switch(g_wgui_catcall_fte_cntx.counts)
    {
        case 0:
            g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y + /*WGUI_CATCALL_FTE_ICONBAR_H + */WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.h = WGUI_CATCALL_FTE_ICONBAR_H;
            break;
        case 1:
        case 2:        
            g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y + /*WGUI_CATCALL_FTE_ICONBAR_H + */WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.h = WGUI_CATCALL_FTE_ICONBAR_H;
    
            if (g_wgui_catcall_fte_cntx.counts > 0)
            {
                btn_w = WGUI_CATCALL_FTE_ICONBAR_W/g_wgui_catcall_fte_cntx.counts;

                for (i=0; i<g_wgui_catcall_fte_cntx.counts; i++)
                {
                    g_wgui_catcall_fte_cntx.items[i].x = WGUI_CATCALL_FTE_ICONBAR_X + btn_w*i - 1;
                    g_wgui_catcall_fte_cntx.items[i].y = WGUI_CATCALL_FTE_ICONBAR_Y + /*WGUI_CATCALL_FTE_ICONBAR_H + */WGUI_CATCALL_FTE_ICONBAR_GAP;
                    g_wgui_catcall_fte_cntx.items[i].w = btn_w;
                    g_wgui_catcall_fte_cntx.items[i].h = WGUI_CATCALL_FTE_ICONBAR_H;
                }
            }
   
            break;

        case 3:
            g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.h = WGUI_CATCALL_FTE_ICONBAR_2LINE_H;

            g_wgui_catcall_fte_cntx.items[0].x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.items[0].y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.items[0].w = WGUI_CATCALL_FTE_ICONBAR_W/2;
            g_wgui_catcall_fte_cntx.items[0].h = WGUI_CATCALL_FTE_ICONBAR_H;   

            g_wgui_catcall_fte_cntx.items[1].x = WGUI_CATCALL_FTE_ICONBAR_X + WGUI_CATCALL_FTE_ICONBAR_W/2 + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[1].y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.items[1].w = WGUI_CATCALL_FTE_ICONBAR_W/2;
            g_wgui_catcall_fte_cntx.items[1].h = WGUI_CATCALL_FTE_ICONBAR_H;        

            g_wgui_catcall_fte_cntx.items[2].x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.items[2].y = WGUI_CATCALL_FTE_ICONBAR_Y + WGUI_CATCALL_FTE_ICONBAR_H + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[2].w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.items[2].h = WGUI_CATCALL_FTE_ICONBAR_H;          
            break;

        case 4:
            g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
            g_wgui_catcall_fte_cntx.h = WGUI_CATCALL_FTE_ICONBAR_2LINE_H;

            g_wgui_catcall_fte_cntx.items[0].x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.items[0].y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.items[0].w = WGUI_CATCALL_FTE_ICONBAR_W/2;
            g_wgui_catcall_fte_cntx.items[0].h = WGUI_CATCALL_FTE_ICONBAR_H;

            g_wgui_catcall_fte_cntx.items[1].x = WGUI_CATCALL_FTE_ICONBAR_X + WGUI_CATCALL_FTE_ICONBAR_W/2 + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[1].y = WGUI_CATCALL_FTE_ICONBAR_Y;
            g_wgui_catcall_fte_cntx.items[1].w = WGUI_CATCALL_FTE_ICONBAR_W/2;
            g_wgui_catcall_fte_cntx.items[1].h = WGUI_CATCALL_FTE_ICONBAR_H;

            g_wgui_catcall_fte_cntx.items[2].x = WGUI_CATCALL_FTE_ICONBAR_X;
            g_wgui_catcall_fte_cntx.items[2].y = WGUI_CATCALL_FTE_ICONBAR_Y + WGUI_CATCALL_FTE_ICONBAR_H + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[2].w = WGUI_CATCALL_FTE_ICONBAR_W/2;
            g_wgui_catcall_fte_cntx.items[2].h = WGUI_CATCALL_FTE_ICONBAR_H;          

            g_wgui_catcall_fte_cntx.items[3].x = WGUI_CATCALL_FTE_ICONBAR_X + WGUI_CATCALL_FTE_ICONBAR_W/2 + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[3].y = WGUI_CATCALL_FTE_ICONBAR_Y + WGUI_CATCALL_FTE_ICONBAR_H + WGUI_CATCALL_FTE_ICONBAR_GAP;
            g_wgui_catcall_fte_cntx.items[3].w = WGUI_CATCALL_FTE_ICONBAR_W/2;
            g_wgui_catcall_fte_cntx.items[3].h = WGUI_CATCALL_FTE_ICONBAR_H;                
            break;

        default:
            break;
    }
#else /*__WGUI_CM_FTE_SLIM__*/
    g_wgui_catcall_fte_cntx.x = WGUI_CATCALL_FTE_ICONBAR_X;
    g_wgui_catcall_fte_cntx.y = WGUI_CATCALL_FTE_ICONBAR_Y + /*WGUI_CATCALL_FTE_ICONBAR_H + */WGUI_CATCALL_FTE_ICONBAR_GAP;
    g_wgui_catcall_fte_cntx.w = WGUI_CATCALL_FTE_ICONBAR_W;
    g_wgui_catcall_fte_cntx.h = WGUI_CATCALL_FTE_ICONBAR_H;

#endif /*__WGUI_CM_FTE_SLIM__*/

    //gui_measure_image(g_wgui_catcall_fte_cntx.unlock_item.button.up, &icon_w, &icon_h);
    g_wgui_catcall_fte_cntx.unlock_item.x = WGUI_CATCALL_FTE_ICONBAR_X;
    
#ifndef __WGUI_CM_FTE_SLIM__
    if (g_wgui_catcall_fte_cntx.counts < 3)
    {
        g_wgui_catcall_fte_cntx.unlock_item.y = WGUI_CATCALL_FTE_ICONBAR_Y + /*WGUI_CATCALL_FTE_ICONBAR_H + */WGUI_CATCALL_FTE_ICONBAR_GAP;
    }
    else
    {
        g_wgui_catcall_fte_cntx.unlock_item.y = WGUI_CATCALL_FTE_ICONBAR_Y + (WGUI_CATCALL_FTE_ICONBAR_2LINE_H - WGUI_CATCALL_FTE_ICONBAR_H) + ((WGUI_CATCALL_FTE_ICONBAR_H - icon_h) >> 1);
    }
#else /*__WGUI_CM_FTE_SLIM__*/
    g_wgui_catcall_fte_cntx.unlock_item.y = WGUI_CATCALL_FTE_ICONBAR_Y + /*WGUI_CATCALL_FTE_ICONBAR_H + */WGUI_CATCALL_FTE_ICONBAR_GAP;
#endif /*__WGUI_CM_FTE_SLIM__*/

    g_wgui_catcall_fte_cntx.unlock_item.w = WGUI_CATCALL_FTE_ICONBAR_UNLOCK_W;
    g_wgui_catcall_fte_cntx.unlock_item.h = WGUI_CATCALL_FTE_ICONBAR_UNLOCK_H;

    /* draw icon bar */
    wgui_catcall_fte_iconbar_redraw();

}
#endif  /* __MMI_MAINLCD_320X240__ */


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_hide_status_bar
 * DESCRIPTION
 *  hide function of horizontal status bar by black color
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_catcall_fte_hide_status_bar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 x1, y1, x2, y2;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_push_clip();
    wgui_status_icon_bar_get_clip(WGUI_STATUS_ICON_BAR_H_BAR, &x1, &y1, &x2, &y2);
    gui_set_clip(x1, y1, x2, y2);
    gdi_draw_solid_rect(x1, y1, x2, y2, GDI_COLOR_BLACK);
    gui_pop_clip();
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_exit
 * DESCRIPTION
 *  exit category 18
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_exit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_catcall_fte_iconbar_reset();
    wgui_catcall_exit();
}

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_screen_pen_down_hdlr
 * DESCRIPTION
 *  pen down handler for the whole screen
 * PARAMETERS
 *  pos     [IN] position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_screen_pen_down_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_catcall_fte_cntx.is_touch_func)
    {
        g_wgui_catcall_fte_cntx.is_touch_func(MMI_TRUE);
    }

    if (!g_wgui_catcall_fte_cntx.is_screen_locked ||
        PEN_CHECK_BOUND(point.x, point.y, g_wgui_catcall_fte_cntx.unlock_item.x, g_wgui_catcall_fte_cntx.unlock_item.y, g_wgui_catcall_fte_cntx.unlock_item.w, g_wgui_catcall_fte_cntx.unlock_item.h))
    {
        wgui_general_pen_down_hdlr(point);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_screen_pen_move_hdlr
 * DESCRIPTION
 *  pen move handler for the whole screen
 * PARAMETERS
 *  pos     [IN] position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_screen_pen_move_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!g_wgui_catcall_fte_cntx.is_screen_locked ||
        (g_wgui_catcall_fte_cntx.touch_idx == WGUI_CATCALL_ICONBAR_MAX_NUM))
    {
        wgui_general_pen_move_hdlr(point);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_screen_pen_up_hdlr
 * DESCRIPTION
 *  pen up handler for the whole screen
 * PARAMETERS
 *  pos     [IN] position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_screen_pen_up_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_catcall_fte_cntx.is_touch_func)
    {
        g_wgui_catcall_fte_cntx.is_touch_func(MMI_FALSE);
    }

    if (!g_wgui_catcall_fte_cntx.is_screen_locked ||
        (g_wgui_catcall_fte_cntx.touch_idx == WGUI_CATCALL_ICONBAR_MAX_NUM))
    {
        wgui_general_pen_up_hdlr(point);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_screen_pen_abort_hdlr
 * DESCRIPTION
 *  pen abort handler for the whole screen
 * PARAMETERS
 *  pos     [IN] position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_screen_pen_abort_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_catcall_fte_cntx.is_touch_func)
    {
        g_wgui_catcall_fte_cntx.is_touch_func(MMI_FALSE);
    }

    if (!g_wgui_catcall_fte_cntx.is_screen_locked ||
        (g_wgui_catcall_fte_cntx.touch_idx == WGUI_CATCALL_ICONBAR_MAX_NUM))
    {
        wgui_general_pen_abort_hdlr(point);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_screen_pen_longtap_hdlr
 * DESCRIPTION
 *  pen long tap handler for the whole screen
 * PARAMETERS
 *  pos     [IN] position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_screen_pen_longtap_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!g_wgui_catcall_fte_cntx.is_screen_locked)
    {
        wgui_general_pen_long_tap_hdlr(point);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_screen_pen_repeat_hdlr
 * DESCRIPTION
 *  pen repeat handler for the whole screen
 * PARAMETERS
 *  pos     [IN] position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_fte_screen_pen_repeat_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!g_wgui_catcall_fte_cntx.is_screen_locked)
    {
        wgui_general_pen_repeat_hdlr(point);
    }
}

/*****************************************************************************
 * FUNCTION
 *  ShowMOMTCallScreen_FTE
 * DESCRIPTION
 *  show MOMT call screen style FTE
 * PARAMETERS
 *  as follows
 * RETURNS
 *  void
 *****************************************************************************/
static void ShowMOMTCallScreen_FTE(
                U16 title_id,               /* useless */
                U16 left_softkey,           /* left softkey string */
                U16 left_softkey_icon,      /* left softkey icon */
                U16 right_softkey,          /* right softkey string */
                U16 right_softkey_icon,     /* right softkey icon */
                U16 NotificationStringId,   /* notification string, e.g. calling... */
                PU8 NameOrNumber,           /* name or number */
                PU8 IP_Number,              /* IP number */
                U16 CallLine,               /* call line indicator icon */
                U16 default_image_id,       /* default image icon */
                U16 resource_id,            /* from resource */
                CHAR* resource_filename,      /* from file */
                wgui_cate_momt_res_type_enum resource_type, /* resource type */
                U16 repeat_count,           /* video/swflash only. 0 means infinite loop */
                BOOL is_visaul_update,      /* video/swflash only. update to LCM */
                BOOL is_aud_enable,         /* video/swflash only. play video's audio */
                BOOL is_play_aud_when_start,/* video/swflash only. play audio when start */
                PU8 history_buffer)         /* histor buffer */
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 s32flags;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* reset global variables */
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__) 
    cat_momt_is_aud_enable = is_aud_enable;
    cat_momt_is_play_aud_when_start = is_play_aud_when_start;
    cat_momt_is_aud_muted = FALSE;
#endif /*defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) || defined(__MMI_SWFLASH__)*/
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    cat_momt_is_visual_update = is_visaul_update;
    cat_momt_is_video_open = FALSE;
    cat_momt_is_video_play = FALSE;
    cat_momt_repeat_count = repeat_count;
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
#if defined(__MMI_SWFLASH__) 
    cat_momt_is_swflash_open = FALSE;
    cat_momt_is_swflash_play = FALSE;
#endif /*__MMI_SWFLASH__*/
#if defined(__MMI_AVATAR__)
    cat_momt_is_avatar_play = FALSE;
#endif /*__MMI_AVATAR__*/

    cat_momt_is_show_default = FALSE;
    cat_momt_resource_filename = (CHAR*) resource_filename;
    cat_momt_resource_id = resource_id;
    cat_momt_default_image_id = default_image_id;
    cat_momt_resource_type = resource_type;

    gCallLine = CallLine;

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    if ((cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_FILE) ||
        (cat_momt_resource_type == WGUI_CATE_MOMT_RES_TYPE_VIDEO_ID))
    {
        srv_backlight_turn_on(SRV_BACKLIGHT_PERMANENT);
        srv_gpio_play_pattern((srv_gpio_pattern_id_enum)srv_led_pattern_get_bg_pattern(), SRV_GPIO_PATN_PLAY_STOP);   
        cat_momt_video_play_time = (history_buffer) ? (cat_momt_video_play_time) : (0);
    }
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */

    /* softkey */
	dm_add_softkey_id((MMI_STR_ID)left_softkey, (MMI_STR_ID)right_softkey);

    /* status icon */
    wgui_status_icon_bar_set_display(WGUI_STATUS_ICON_BAR_H_BAR);
    wgui_status_icon_bar_register_hide_callback(WGUI_STATUS_ICON_BAR_H_BAR, wgui_catcall_fte_hide_status_bar);

    /* set message string */
    if (NameOrNumber)
    {
        memset((CHAR*)CM_string_buf, 0, (SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN)*2);
        gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) IP_Number);
        gui_strcat((UI_string_type) CM_string_buf, (UI_string_type) NameOrNumber);
        MMI_message_string = (UI_string_type) CM_string_buf;
    }
    else
    {
        MMI_message_string = NULL;
    }
    MMI_message_string2 = (NotificationStringId) ? (get_string(NotificationStringId)) : (NULL);

    /* control area */
    dm_register_category_controlled_callback(wgui_catcall_fte_draw_ctrl_area1);
    dm_register_category_controlled2_callback(wgui_catcall_fte_draw_ctrl_area2);
#if defined(__MMI_TOUCH_SCREEN__)
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_fte_iconbar_pen_down_hdlr, MMI_PEN_EVENT_DOWN);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_fte_iconbar_pen_move_hdlr, MMI_PEN_EVENT_MOVE);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_fte_iconbar_pen_up_hdlr, MMI_PEN_EVENT_UP);
    wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_fte_iconbar_pen_abort_hdlr, MMI_PEN_EVENT_ABORT);

    mmi_pen_register_down_handler(wgui_catcall_fte_screen_pen_down_hdlr);
    mmi_pen_register_move_handler(wgui_catcall_fte_screen_pen_move_hdlr);
    mmi_pen_register_up_handler(wgui_catcall_fte_screen_pen_up_hdlr);
    mmi_pen_register_abort_handler(wgui_catcall_fte_screen_pen_abort_hdlr);
    mmi_pen_register_long_tap_handler(wgui_catcall_fte_screen_pen_longtap_hdlr);
    mmi_pen_register_repeat_handler(wgui_catcall_fte_screen_pen_repeat_hdlr);
#endif /* __MMI_TOUCH_SCREEN__ */
    s32flags = DM_CLEAR_SCREEN_BACKGROUND | DM_SET_AS_ABM_LAYER;
#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
	s32flags |= (cat_momt_is_video_open) ? (DM_NO_BLT) : (0);
#endif /*__CATE_CM_VIDEO_PLAY_SUPPORT__*/
    wgui_cat_setup_category(
		MMI_CATEGORY18_ID,
		s32flags,
		wgui_catcall_fte_exit,
		dummy_get_history,
		dummy_get_history_size);
    dm_redraw_category_screen();

    /* if the screen is from the pop-up go-back, do not play video */
    if (mmi_is_redrawing_bk_screens())
    {
        return;
    }

#if defined(__CATE_CM_VIDEO_PLAY_SUPPORT__)
    if(cat_momt_is_video_open)
    {
        MDI_RESULT mdi_ret;

        mdi_ret = mdi_video_ply_play(
                    wgui_layer_1,
#if defined(__MMI_WALLPAPER_ON_BOTTOM__)
                    GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1 | GDI_LAYER_ENABLE_LAYER_2,
                    GDI_LAYER_ENABLE_LAYER_2,
#else /* defined(__MMI_WALLPAPER_ON_BOTTOM__) */
                    GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1,
                    GDI_LAYER_ENABLE_LAYER_1,
#endif /* defined(__MMI_WALLPAPER_ON_BOTTOM__) */
                    (U16) cat_momt_repeat_count,    /* this to recrod repeat count */
                    cat_momt_is_visual_update,      /* update to LCM or not */
                    cat_momt_is_aud_enable,         /* play aud or not */
                    MDI_DEVICE_SPEAKER_BOTH,        /* speaker & earphone */
                    MDI_VIDEO_LCD_ROTATE_0,         /* rotate */
                    100,                            /* 1x play speed */
                    NULL, 0);
        cat_momt_is_video_play = (mdi_ret >= 0) ? TRUE : FALSE;

        gdi_lcd_repaint_all();
    }
#endif /* defined(__CATE_CM_VIDEO_PLAY_SUPPORT__) */
}

/*****************************************************************************
 * FUNCTION
 *  wgui_cat404_fte_draw_ctrl_area1
 * DESCRIPTION
 *  draw icon bar in contaol area 1 for category 403
 * PARAMETERS
 *  coordinate  [IN] coordinate
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat403_fte_draw_ctrl_area1(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef  __WGUI_CM_FTE_SLIM__
 //   if (g_wgui_catcall_fte_cntx.counts > 0)
    {
        S32 i, x, y;
        S32 item_h;
#endif /*__WGUI_CM_FTE_SLIM__*/  
        S32 start_x, start_y, x_offset;
        S32 item_w;
        
#ifndef  __WGUI_CM_FTE_SLIM__
        //gui_measure_image(g_wgui_catcall_fte_cntx.items[0].button.up, &item_w, &item_h);
        item_h = WGUI_CATCALL_FTE_ICONBAR_H;
#endif /*__WGUI_CM_FTE_SLIM__*/

	#if defined(__MMI_MAINLCD_320X240__)
		item_w = WGUI_CATCALL_FTE_ICONBAR_W;
	#else /* __MMI_MAINLCD_320X240__ */
        item_w = WGUI_CATCALL_FTE_ICONBAR_W / 2;
	#endif /* __MMI_MAINLCD_320X240__ */
        x_offset = (((S32)coordinate->s16Width - (item_w << 1) - 2) >> 1);

        start_x = (S32)coordinate->s16X + x_offset;
#if defined(__MMI_MAINLCD_320X480__)
        start_y = (S32)coordinate->s16Y + 5;
#elif defined(__MMI_MAINLCD_240X400__)
        start_y = (S32)coordinate->s16Y + 4;
#else /* defined(__MMI_MAINLCD_240X320__) */
        start_y = (S32)coordinate->s16Y + 5;
#endif

        /* configure icon bar */
        g_wgui_catcall_fte_cntx.x = (S32)coordinate->s16X + 1;
        g_wgui_catcall_fte_cntx.y = (S32)coordinate->s16Y + 1;
        g_wgui_catcall_fte_cntx.w = (S32)coordinate->s16Width - 3;
        g_wgui_catcall_fte_cntx.h = (S32)coordinate->s16Height - 3;
        
#ifndef  __WGUI_CM_FTE_SLIM__
        for (i = 0 ; ((i < g_wgui_catcall_fte_cntx.counts) && (i < WGUI_CATCALL_ICONBAR_MAX_NUM)) ; i ++)
        {
#if defined(__MMI_MAINLCD_240X320__)
            /* For 240x320, only support 2 buttons */
            if (i >= 2)     break;
#endif /* !defined(__MMI_MAINLCD_320X480__) */

		#if defined(__MMI_MAINLCD_320X240__)
			x = start_x + ((i % 2) * item_w);
		    y = start_y;
		#else /* __MMI_MAINLCD_320X240__ */
            /* the order is from left to right, top to bottom */
            x = start_x + ((i % 2) ? (item_w + 2) : (0));
            y = start_y + (item_h + 2)* ((S32)(i / 2));
		#endif /* __MMI_MAINLCD_320X240__ */

            g_wgui_catcall_fte_cntx.items[i].x = x;
            g_wgui_catcall_fte_cntx.items[i].y = y;
            g_wgui_catcall_fte_cntx.items[i].w = item_w;
            g_wgui_catcall_fte_cntx.items[i].h = item_h;
        }
#endif /*__WGUI_CM_FTE_SLIM__*/

        //gui_measure_image(g_wgui_catcall_fte_cntx.unlock_item.button.up, &item_w, &item_h);
        g_wgui_catcall_fte_cntx.unlock_item.x = start_x;
        g_wgui_catcall_fte_cntx.unlock_item.y = start_y + (((S32)coordinate->s16Height - WGUI_CATCALL_FTE_ICONBAR_UNLOCK_H) >> 1);
        g_wgui_catcall_fte_cntx.unlock_item.w = WGUI_CATCALL_FTE_ICONBAR_UNLOCK_W;
        g_wgui_catcall_fte_cntx.unlock_item.h = WGUI_CATCALL_FTE_ICONBAR_UNLOCK_H;
    
        /* draw icon bar */
#ifndef __MMI_DIALER_TWO_DT_DIS__
        wgui_catcall_fte_iconbar_redraw();
#else
        wgui_cat403_draw_duration_str();
#endif
#ifndef  __WGUI_CM_FTE_SLIM__        
    }
#endif /*__WGUI_CM_FTE_SLIM__*/
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat403_fte_iconbar_setup
 * DESCRIPTION
 *  setup FTE icon bar for category 403
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat403_fte_iconbar_setup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dm_register_category_controlled_callback(wgui_cat403_fte_draw_ctrl_area1);
    
    wgui_register_category_screen_control_area_pen_handlers(wgui_catcall_fte_iconbar_pen_down_hdlr, MMI_PEN_EVENT_DOWN);
    wgui_register_category_screen_control_area_pen_handlers(wgui_catcall_fte_iconbar_pen_move_hdlr, MMI_PEN_EVENT_MOVE);
    wgui_register_category_screen_control_area_pen_handlers(wgui_catcall_fte_iconbar_pen_up_hdlr, MMI_PEN_EVENT_UP);
    wgui_register_category_screen_control_area_pen_handlers(wgui_catcall_fte_iconbar_pen_abort_hdlr, MMI_PEN_EVENT_ABORT);

    mmi_pen_register_down_handler(wgui_catcall_fte_screen_pen_down_hdlr);
    mmi_pen_register_move_handler(wgui_catcall_fte_screen_pen_move_hdlr);
    mmi_pen_register_up_handler(wgui_catcall_fte_screen_pen_up_hdlr);
    mmi_pen_register_abort_handler(wgui_catcall_fte_screen_pen_abort_hdlr);
    mmi_pen_register_long_tap_handler(wgui_catcall_fte_screen_pen_longtap_hdlr);
    mmi_pen_register_repeat_handler(wgui_catcall_fte_screen_pen_repeat_hdlr);
}
#endif /* defined(__MMI_FTE_SUPPORT__) */


#if defined(__MMI_CAT116_SUPPORT__)
void(*g_wgui_cat116_resize_and_draw_func) (S32); /* for input method to tell category the height of virtual keyboard */

#if defined (__MMI_WALLPAPER_ON_BOTTOM__)
static U8 g_wgui_cat116_editor_scr_bg_opacity;
#endif /* defined (__MMI_WALLPAPER_ON_BOTTOM__) */

#if defined(__WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__)
/*****************************************************************************
 * FUNCTION
 *  wgui_cate_get_highlight_list
 * DESCRIPTION
 *  get highlight list struct by application
 * PARAMETERS
 *  list	[OUT]	struct HILITE_STR
 * RETURNS
 *  hilite str number
 *****************************************************************************/
U32 wgui_cate_get_highlight_list(HILITE_STR **list)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	return gui_inputs_ml_get_hilite_list(&MMI_multiline_inputbox, list);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat116_register_hilite_keys
 * DESCRIPTION
 *  register hilite keys for ml with up/down arrow key when down event
 * PARAMETERS
 *  void               
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat116_register_hilite_keys(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(wgui_inputs_ml_previous_line_with_hilite_list, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(wgui_inputs_ml_next_line_with_hilite_list, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
}
#endif /* __WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__ */


#if defined(__WGUI_CATE_SUPPORT_SEND_KEY__)
typedef struct
{
    U16 Id;
    FuncPtr	cb_func;
} wgui_cat116_snd_btn;

static wgui_cat116_snd_btn	g_wgui_cat116_snd_btn = {0};
/*****************************************************************************
 * FUNCTION
 *  wgui_cat116_set_send_button_func
 * DESCRIPTION
 *  set send button func 
 * PARAMETERS
 *  button_object       [IN]   button object
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat116_set_send_btn_func(FuncPtr send_btn_func)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_wgui_cat116_snd_btn.cb_func = send_btn_func;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat116_clear_btn_bg
 * DESCRIPTION
 *  clear btn background 
 * PARAMETERS
 *  button_object       [IN]   button object
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat116_clear_btn_bg(void *button_object)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    button *b = (button*) button_object;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_draw_solid_rect(b->x, b->y, b->x+b->width - 1, b->y+b->height - 1, GDI_COLOR_TRANSPARENT);
}
#endif 

#if defined(__MMI_TOUCH_SCREEN__)
/*****************************************************************************
 * FUNCTION
 *  wgui_cat116_get_hw_area
 * DESCRIPTION
 *  Get hand writing area 
 * PARAMETERS
 *  x       [IN/OUT]   X coordinate of hand writing area
 *  y       [IN/OUT]   Y coordinate of hand writing area
 *  w       [IN/OUT]   Width of hand writing area
 *  h       [IN/OUT]   Height of  hand writing area
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat116_get_hw_area(S32 *x, S32 *y, S32 *w, S32 *h)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *x = CAT116_CONTENT_X;
    *y = CAT116_CONTENT_Y;
    *w = CAT116_CONTENT_W - current_MMI_theme->scrollbar_size;
#if defined(__WGUI_CATE_SUPPORT_SEND_KEY__)
    *h = MMI_singleline_inputbox.y - CAT116_CONTENT_Y;
#else /* __WGUI_CATE_SUPPORT_SEND_KEY__ */
    *h = MMI_singleline_inputbox.y + MMI_singleline_inputbox.height - CAT116_CONTENT_Y;
#endif /* __WGUI_CATE_SUPPORT_SEND_KEY__ */
}
#endif /* defined(__MMI_TOUCH_SCREEN__) */ 


/*****************************************************************************
 * FUNCTION
 *  wgui_cat116_resize_and_draw
 * DESCRIPTION
 *  1. resize multiline inputbox 
 *  2. arrange multiline inputbox, information bar, and singleline inputbox
 * PARAMETERS
 *  virtual_keyboard_h            [IN]          Height of virtual keyboard
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat116_resize_and_draw(S32 virtual_keyboard_h)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 multiline_h, singleline_y;
    S32 gap;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();    

    gap = (virtual_keyboard_h <= 2) ? 2 : 0 /* border */;
    
    /* set singleline inputbox position */
    singleline_y = UI_device_height - MMI_BUTTON_BAR_HEIGHT - virtual_keyboard_h - gap - MMI_SINGLELINE_INPUTBOX_HEIGHT - 1;
    move_singleline_inputbox(CAT116_SINGLELINE_INPUTBOX_X, singleline_y); 
#if defined(__WGUI_CATE_SUPPORT_SEND_KEY__)
	gui_move_icontext_button(
	    dm_get_button(g_wgui_cat116_snd_btn.Id), 
	    CAT116_SINGLELINE_INPUTBOX_X + CAT116_SINGLELINE_INPUTBOX_W + CAT116_SEND_BTN_OFFSET_X,
	    singleline_y + CAT116_SEND_BTN_OFFSET_Y);
#endif /* __WGUI_CATE_SUPPORT_SEND_KEY__ */
#if !defined(__MMI_FTE_SUPPORT__)
    /* set information bar position */
    wgui_setup_input_information( 
            MMI_singleline_inputbox.x,
            MMI_singleline_inputbox.y - wgui_inputbox_information_bar_height,
            MMI_singleline_inputbox.width,
            wgui_inputbox_information_bar_height);
    /* set multiline inputbox position and resize it */
    multiline_h = wgui_inputbox_information_bar_y - CAT116_CONTENT_Y + 1;
#else /* __MMI_FTE_SUPPORT__ */
    /* set multiline inputbox position and resize it */
    multiline_h = MMI_singleline_inputbox.y - CAT116_CONTENT_Y + 1;
#endif /* __MMI_FTE_SUPPORT__ */

    resize_multiline_inputbox(CAT116_CONTENT_W, multiline_h);
    move_multiline_inputbox(CAT116_CONTENT_X, CAT116_CONTENT_Y);    

    /* clear background and show multiline inputbox, singleline inputbox, and information bar */  
    gdi_draw_solid_rect(
		0, 
		CAT116_CONTENT_Y, 
		UI_device_width - 1, 
		UI_device_height - MMI_BUTTON_BAR_HEIGHT - virtual_keyboard_h - 1,
		GDI_COLOR_TRANSPARENT);
    show_multiline_inputbox();
    show_singleline_inputbox();
#if defined(__WGUI_CATE_SUPPORT_SEND_KEY__)
	gui_show_icontext_button(dm_get_button(g_wgui_cat116_snd_btn.Id));
#endif /* __WGUI_CATE_SUPPORT_SEND_KEY__ */

#if !defined(__MMI_FTE_SUPPORT__)
    wgui_redraw_singleline_input_information_bar();
#endif	/* __MMI_FTE_SUPPORT__ */

    gdi_layer_unlock_frame_buffer();
}


/*****************************************************************************
 * FUNCTION
 *  ExitCategory116Screen
 * DESCRIPTION
 *  Exit Orange call plan screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitCategory116Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    reset_multiline_inputbox();
    wgui_close_singleline_inputbox();
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    dm_set_scr_bg_opacity(g_wgui_cat116_editor_scr_bg_opacity);
#endif /* __MMI_WALLPAPER_ON_BOTTOM__ */
    g_wgui_cat116_resize_and_draw_func = NULL;
#if defined(__WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__)
    wgui_cate_set_highlight_list(NULL);
#endif /* __WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__ */
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory116HistorySize
 * DESCRIPTION
 *  Gets the history buffer size of category 116
 * PARAMETERS
 *  void
 * RETURNS
 *  size in U8s of the history buffer
 *****************************************************************************/
S32 GetCategory116HistorySize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (((sizeof(singleline_inputbox_category_history) + 3) / 4) * 4 + sizeof(multiline_inputbox_category_history));
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory116History
 * DESCRIPTION
 *  Gets the history buffer of category116
 * PARAMETERS
 *  history_buffer      [OUT]        Is the buffer into which the history data is stored
 * RETURNS
 *  return history buffer
 *****************************************************************************/
U8 *GetCategory116History(U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 s;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	get_singleline_inputbox_category_history(MMI_CATEGORY116_ID, history_buffer);
    s = sizeof(singleline_inputbox_category_history);
    s = (s + 3) / 4;
    s *= 4;
    get_multiline_inputbox_category_history(MMI_CATEGORY116_ID, (U8*) (history_buffer + s));
    return (history_buffer);
}


/*****************************************************************************
 * FUNCTION
 *  ShowCategory116Screen
 * DESCRIPTION
 *  Display Orange call plan screen
 * PARAMETERS
 *  left_softkey                [IN]        Left softkey label
 *  left_softkey_icon           [IN]        Icon for the Left softkey
 *  right_softkey               [IN]        Right softkey label
 *  right_softkey_icon          [IN]        Icon for the right softkey
 *  message                     [IN]        Message shown in multiline inputbox
 *  input_buffer                [IN]        Singleline inputbox input buffer
 *  input_buffer_size           [IN]        Input buffer size (Orange call plan max is 183)
 *  input_type                  [IN]        Input method
 *  history_buffer              [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void ShowCategory116Screen(
        UI_string_type left_softkey,
        PU8 left_softkey_icon,
        UI_string_type right_softkey,
        PU8 right_softkey_icon,
        UI_string_type message,
        UI_buffer_type input_buffer,
        S32 input_buffer_size,
        U32 input_type,
        UI_buffer_type history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 msg_length, singleline_history_size;
	S32 s32flags = DM_CLEAR_SCREEN_BACKGROUND | DM_SET_AS_ABM_LAYER;   

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    /* softkey */
	dm_add_softkey_str((UI_string_type)left_softkey, (UI_string_type)right_softkey);

    g_wgui_cat116_resize_and_draw_func = wgui_cat116_resize_and_draw;

    /* multiline inputbox */
    msg_length = gui_strlen(message);
    create_multiline_inputbox_set_buffer(message, msg_length, msg_length, 0);

#if defined(__WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__)
    wgui_inputs_ml_register_set_key_callback(wgui_cat116_register_hilite_keys);
    gui_inputs_ml_parse_keywords(&MMI_multiline_inputbox, g_cate_hilite_list.hilite_type, NULL, NULL);
    gui_inputs_ml_set_hilite_list(
        &MMI_multiline_inputbox,
        NULL,
        0,
        g_cate_hilite_list.curr_hilite_idx,
        g_cate_hilite_list.hilite_cb,
        g_cate_hilite_list.click_cb);
#endif /* __WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__ */
	
    if (history_buffer != NULL)
    {
        singleline_history_size = sizeof(singleline_inputbox_category_history);
        singleline_history_size = (singleline_history_size + 3) / 4;
        singleline_history_size *= 4;
        set_multiline_inputbox_category_history(MMI_CATEGORY116_ID, (U8*) (history_buffer + singleline_history_size));
    #if defined(__WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__)
        if (MMI_multiline_inputbox.hilite_list != NULL)
        {
            gui_multi_line_input_box_go_to_hilite(
                &MMI_multiline_inputbox,
                MMI_multiline_inputbox.current_hilite_idx,
                MMI_TRUE);
        }
    #endif /* __WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__ */
    }

    MMI_multiline_inputbox.flags |=
        (UI_MULTI_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW |
         UI_MULTI_LINE_INPUT_BOX_VIEW_MODE |
         UI_MULTI_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND |
         UI_MULTI_LINE_INPUT_BOX_AUTO_DISABLE_SCROLLBAR);
    MMI_multiline_inputbox.ext_flags |= GUI_MULTI_LINE_INPUT_BOX_FIXED_Y_OFFSET;

    /* set flags for singleline editor */
    MMI_current_input_ext_type |= INPUT_TYPE_EXT_NO_SHOW_NEW_LINE_SYMBOL;

    register_multiline_inputbox_viewer_keys();

#if defined(__MMI_FTE_SUPPORT__)
    /* singleline inputbox */
    wgui_setup_singleline_inputbox(
        CAT116_SINGLELINE_INPUTBOX_X, 
        CAT116_SINGLELINE_INPUTBOX_Y, 
        CAT116_SINGLELINE_INPUTBOX_W, 
        CAT116_SINGLELINE_INPUTBOX_H, 
        input_buffer, 
        input_buffer_size, 
        MMI_CATEGORY116_ID, 
        right_softkey, 
        right_softkey_icon, 
        input_type, 
        history_buffer,
        0); 
#else /* __MMI_FTE_SUPPORT__ */
    /* singleline inputbox */
    wgui_setup_singleline_inputbox(
        CAT116_SINGLELINE_INPUTBOX_X, 
        CAT116_SINGLELINE_INPUTBOX_Y, 
        CAT116_SINGLELINE_INPUTBOX_W, 
        CAT116_SINGLELINE_INPUTBOX_H, 
        input_buffer, 
        input_buffer_size, 
        MMI_CATEGORY116_ID, 
        right_softkey, 
        right_softkey_icon, 
        input_type, 
        history_buffer,
        1); 

    /* information bar */
    wgui_setup_input_information(
        MMI_singleline_inputbox.x,
        MMI_singleline_inputbox.y - wgui_inputbox_information_bar_height,
        MMI_singleline_inputbox.width,
        wgui_inputbox_information_bar_height);
	
	s32flags |= DM_SINGLE_LINE_INPUT_BOX_WITH_INFORMATION_BAR;
#endif /* __MMI_FTE_SUPPORT__ */

#ifdef __MMI_WALLPAPER_ON_BOTTOM__
    CM_set_wallpaper_on_bottom(MMI_TRUE);
    MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_TRANSPARENT_BACKGROUND;
    dm_get_scr_bg_opacity(&g_wgui_cat116_editor_scr_bg_opacity);
    dm_set_scr_bg_opacity((U8)(current_MMI_theme->bg_opacity_low));
#endif 
        
#if defined(__MMI_TOUCH_SCREEN__)
	s32flags |= DM_SHOW_VKPAD;
	dm_register_vkpad_callback(mmi_imc_redraw_screen_by_state);
	
#if defined(__WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__)
    wgui_cate_register_ctrl_area_pen_hdlr();
#endif /* __WGUI_CATE_SUPPORT_HIGHLIGHT_LIST__ */

#if defined(__WGUI_CATE_SUPPORT_SEND_KEY__)
    g_wgui_cat116_snd_btn.Id= dm_add_button(
                                NULL, 
                                get_image(IMG_ID_CAT116_SEND_KEY_UP), 
                                get_image(IMG_ID_CAT116_SEND_KEY_DOWN), 
                                wgui_cat116_clear_btn_bg);
    dm_register_button_functions(g_wgui_cat116_snd_btn.Id, KEY_EVENT_UP, g_wgui_cat116_snd_btn.cb_func);
    dm_get_button(g_wgui_cat116_snd_btn.Id)->flags &= ~UI_BUTTON_SHIFT_BUTTON1;
    dm_get_button(g_wgui_cat116_snd_btn.Id)->flags |= UI_BUTTON_NO_SHIFT_BUTTON;
#endif /* __WGUI_CATE_SUPPORT_SEND_KEY__ */

#endif /* defined(__MMI_TOUCH_SCREEN__) */

    gdi_layer_unlock_frame_buffer();

    wgui_cat_setup_category(
		MMI_CATEGORY116_ID,
		s32flags,
		ExitCategory116Screen,
		GetCategory116History,
		GetCategory116HistorySize);
    dm_redraw_category_screen();

    MMI_multiline_inputbox.ext_flags &= ~GUI_MULTI_LINE_INPUT_BOX_FIXED_Y_OFFSET;
}
#endif /* defined(__MMI_CAT116_SUPPORT__) */

#if defined (__MMI_MAINLCD_96X64__) || defined (__MMI_WEARABLE_DEVICE__)
/*****************************************************************************
 * FUNCTION
 *  draw_scrolling_text_background_active_call
 * DESCRIPTION
 *  Active call item background.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void draw_scrolling_text_background_active_call(S32 x1, S32 y1, S32 x2, S32 y2)
{	
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 
    WGUI_CM_DRAW_BG_AREA(x1, y1, x2, y2, GDI_COLOR_ACTIVE_BACKGROUND);
}

/*****************************************************************************
 * FUNCTION
 *  draw_scrolling_text_background_held_call
 * DESCRIPTION
 *  Hold call item background.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void draw_scrolling_text_background_held_call(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 
	WGUI_CM_DRAW_BG_AREA(x1, y1, x2, y2, GDI_COLOR_HELD_BACKGROUND);	
}

/*****************************************************************************
 * FUNCTION
 *  wgui_scrolling_text_timer_callback
 * DESCRIPTION
 *  callback function when scrolling text timer expires
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_scrolling_text_timer_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 

	 gui_handle_scrolling_text(&gui_scrolling_text_ctxt);
}

/*****************************************************************************
 * FUNCTION
 *  wgui_scrolling_text_timer_callback_2
 * DESCRIPTION
 *  callback function when scrolling text timer expires
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_scrolling_text_timer_callback_2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 

    gui_handle_scrolling_text(&gui_scrolling_text_ctxt_2);
}

/*****************************************************************************
 * FUNCTION
 *  wgui_cat9023_update_duration
 * DESCRIPTION
 *  update the duration of category 9023, for application usage
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat9023_update_duration(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_CM_SCREEN_HIDE_DATE_TIME__
    if (g_dm_data.s32CatId == MMI_CAT9023_ID)
    {
        //dt_update_duration_gprs();
        dt_update_duration();
    }
#endif /* __MMI_CM_SCREEN_HIDE_DATE_TIME__ */

}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9023_set_duration
 * DESCRIPTION
 *  set new duration of category 9023, for application usage
 * PARAMETERS
 *  CallDuration  [IN]  start time
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat9023_set_duration(MYTIME *CallDuration)
{
    set_duration_start_time(CallDuration);
    dt_update_duration();
}

/*****************************************************************************
 * FUNCTION
 *  wgui_category_9023_draw_category_control_area
 * DESCRIPTION
 *  This function is used to draw the category controlled area of category9023 screen
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_category_9023_draw_category_control_area(dm_coordinates *coordinate)
{
     /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_WEARABLE_DEVICE__
	wgui_category_9023_draw_category_control_area_for_wearable(coordinate);
#else /*__MMI_WEARABLE_DEVICE__*/
	S32 x1, y1, x2, y2;
    color text_color; 
    U8 *icon = NULL;
    S32 sw, sh;
	S32 m_height;
	S32 active_call_index = 2, held_call_index = 2;
	S32 text_x = 5, text_y = 0;
	S32 icon_width, icon_height;
	S32 icon_x = 1, icon_y = 0;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                            ;          */
    /*----------------------------------------------------------------*/

    if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_ACTIVE_CALL )
	{
		active_call_index = 0;
	}
	else if( g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_ACTIVE_CALL)
	{
		active_call_index = 1;
	}
    
	if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_HELD_CALL )
	{
		held_call_index = 0;
	}
	else if(g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_HELD_CALL)
	{
		held_call_index = 1;
	}
    
    m_height = get_menu_item_height();
		
    x1 =  0;
    y1 = MMI_STATUS_BAR_HEIGHT;
    x2 = UI_device_width;
    y2 = y1 + m_height*2;

    text_color = main_LCD_dt_object.duration.text_color;
    
	gdi_layer_lock_frame_buffer();
		
	gdi_layer_reset_clip();
    gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));

    wgui_status_icon_bar_update();

	if(active_call_index == 0 || active_call_index == 1)
    {   
        draw_scrolling_text_background_active_call(x1+2, y1+1, x2-3, y2+1);

	 	gui_measure_string((UI_string_type)CM_caller_buffer, &sw, &sh);
	 	text_y = (m_height >> 1) - (sh >> 1) + 2;
        if(text_y < 0)
		{
		    text_y = 1;
		}

		if(g_wgui_cat9023_CM[active_call_index].active_call_icon != NULL)
        {
			icon = (U8*)get_image(g_wgui_cat9023_CM[active_call_index].active_call_icon);
            text_x += m_height;
            gui_measure_image(icon, &icon_width, &icon_height);
            icon_y = (m_height >> 1) - (icon_height >> 1);

            if (mmi_fe_get_r2l_state())
            {
				gdi_layer_push_and_set_clip( UI_device_width - x1 - text_x + 2, y1 + icon_y, UI_device_width- x1 - icon_x - 4, y1 + m_height*2 - 2);
                gdi_image_draw(UI_device_width - x1 - text_x + 2,y1 + icon_y,icon);
            }
			else
			{
        	    gdi_layer_push_and_set_clip(x1 + icon_x + 4, y1 + icon_y, x1 + text_x - 2, y1 + m_height*2 - 2);
				gdi_image_draw(x1 + icon_x + 4,y1 + icon_y+2,icon);	

            }           
			gdi_layer_pop_clip();
        }  
		gui_push_text_clip();
		gui_set_font(&MMI_medium_font);
		gui_set_text_color(text_color);

		if(mmi_fe_get_r2l_state())
		{
	
	        gui_set_text_clip(UI_device_width - x2, y1, UI_device_width - x1 , y2);
	        gui_create_scrolling_text(&gui_scrolling_text_ctxt,  x1+3,
	                          y1 + text_y, UI_DEVICE_WIDTH - 5 - x1 - text_x, sh,
	                          (UI_string_type)CM_caller_buffer, 
	                          wgui_scrolling_text_timer_callback, draw_scrolling_text_background_active_call,
	                          gui_color(0, 0, 0), gui_color(255, 255, 255));
	        gui_move_text_cursor(UI_DEVICE_WIDTH - 5 - x1 - text_x , y1 + text_y);
		}
		else
		{ 

            gui_set_text_clip(x1, y1, x2, y2);
            gui_create_scrolling_text(&gui_scrolling_text_ctxt, x1 + text_x,
                          y1 + text_y, UI_DEVICE_WIDTH - 5 - x1 - text_x , sh,
                          (UI_string_type)CM_caller_buffer, 
                          wgui_scrolling_text_timer_callback, draw_scrolling_text_background_active_call,
                          gui_color(0, 0, 0), gui_color(255, 255, 255));
            gui_move_text_cursor(x1 + text_x , y1 + text_y);
		}

		gui_scrolling_text_ctxt.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;	
		gui_show_scrolling_text(&gui_scrolling_text_ctxt);
        gui_pop_text_clip();

        if (mmi_fe_get_r2l_state())
        {
	        set_main_lcd_duration_position(UI_device_width - x1 - text_x,y1 + m_height + text_y);     
        }
		else
		{               
	        set_main_lcd_duration_position(x1 + text_x,y1 + m_height + text_y);
		}

        dt_update_duration();
		y1 += m_height*2;
        y2 += m_height*2;
	}
    if(active_call_index == 2)
	{
    	if(held_call_index == 0 || held_call_index == 1)
    	{
            if(g_wgui_cat9023_CM[held_call_index].held_call_icon  !=  NULL)
		    {		
                icon = (U8*)get_image(g_wgui_cat9023_CM[held_call_index].held_call_icon);
                text_x +=  m_height;
            }

            //gdi_layer_reset_clip();
            draw_scrolling_text_background_held_call(2, y1 + 1, UI_DEVICE_WIDTH - 3, y1 + m_height*2 + 1);
            gui_measure_string((UI_string_type)CM_caller_buffer, &sw, &sh);
            text_y = (m_height >> 1) - (sh >> 1) + 2;
            
	     	if(g_wgui_cat9023_CM[held_call_index].held_call_icon != NULL)
            {
                gui_measure_image(icon, &icon_width, &icon_height);
		  		icon_y =  (m_height >> 1) - (icon_height >> 1);

                if (mmi_fe_get_r2l_state())
                {
                    gdi_layer_push_and_set_clip(UI_device_width - x1 - text_x + 2, y1 + icon_y, UI_device_width - x1 - icon_x - 4 , y1 + m_height*2 - 2);
                    gdi_image_draw(UI_device_width - x1 - text_x + 2,y1 + icon_y, icon);
                }
		        else
			  	{
                    gdi_layer_push_and_set_clip(x1 + icon_x + 4, y1 + icon_y, x1 + text_x - 2, y1 + m_height*2 - 2);
                    gdi_image_draw(x1 + icon_x + 4,y1 + icon_y+2,icon);
	            }
                gdi_layer_pop_clip();
			}
			
			gui_push_text_clip();
			gui_set_font(&MMI_medium_font);
			gui_set_text_color(text_color);

	        if (mmi_fe_get_r2l_state())
	        {
	            gui_set_text_clip(UI_device_width - x2, y1, UI_device_width - x1, y2);
	            gui_create_scrolling_text(&gui_scrolling_text_ctxt_2,  x1+3,
	                                y1 + text_y, UI_DEVICE_WIDTH - 5 - x1 - text_x, sh,
	                      (UI_string_type)CM_caller_buffer, wgui_scrolling_text_timer_callback_2, draw_scrolling_text_background_held_call,
	                                gui_color(0, 0, 0), gui_color(255, 255, 255));
		  		gui_move_text_cursor(UI_device_width - x1 - text_x , y1 + text_y);				
	        }
	        else
	        {
	            gui_set_text_clip(x1, y1, x2, y2);
	            gui_create_scrolling_text(&gui_scrolling_text_ctxt_2, x1 + text_x,
	                      y1 + text_y, UI_DEVICE_WIDTH - 5 - x1 - text_x , sh,
	                      (UI_string_type)CM_caller_buffer, wgui_scrolling_text_timer_callback_2, draw_scrolling_text_background_held_call,
	                                gui_color(0, 0, 0), gui_color(255, 255, 255));
	
		   		gui_move_text_cursor(x1 + text_x , y1 + text_y);
			}

			gui_scrolling_text_ctxt_2.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
		    gui_show_scrolling_text(&gui_scrolling_text_ctxt_2);
			gui_pop_text_clip();
            
		    if(g_wgui_cat9023_CM[held_call_index].held_call_str != NULL)
		    {
				y1 += m_height;
				y2 += m_height;	
                
				gui_push_text_clip();
		        if (mmi_fe_get_r2l_state())
		        {
				    gui_set_text_clip(UI_device_width - x2, y1, UI_device_width - x1, y2);
				    gui_move_text_cursor(UI_device_width - x1 - text_x , y1 + text_y);
		        }
				else
				{
				    gui_set_text_clip(x1, y1, x2, y2);
				    gui_move_text_cursor(x1 + text_x , y1 + text_y);
				}

				gui_set_font(&MMI_medium_font);
				gui_set_text_color(text_color);
				gui_print_text((UI_string_type)g_wgui_cat9023_CM[held_call_index].held_call_str );
				gui_pop_text_clip();
       	    }
        }
    }
    show_softkey_background();
    show_left_softkey();
    show_right_softkey();
    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
#endif /*__MMI_WEARABLE_DEVICE__*/
}

/*****************************************************************************
 * FUNCTION
 *  ExitCategory23Screen
 * DESCRIPTION
 *  Exit Active call screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void ExitCategory9023Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
	gdi_layer_lock_frame_buffer();

    gui_cancel_timer(wgui_scrolling_text_timer_callback);
    gui_cancel_timer(wgui_scrolling_text_timer_callback_2);
    gui_cancel_timer(dt_update_duration);
    close_main_LCD_dt_display();
 
#ifdef __MMI_WEARABLE_DEVICE__
	g_Cat_is_end_call_key = 0;
	SetInCallMuteState(1);
	g_in_call_redrawing = 0;	
	g_in_call_vol_info_show = MMI_FALSE;
	g_in_call_vol_bar_is_show = 0;
	gdi_layer_set_opacity(MMI_FALSE, 125);
	#ifndef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	reset_softkeys();
	#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
#else  /*__MMI_WEARABLE_DEVICE__*/
	reset_softkeys();
#endif /*__MMI_WEARABLE_DEVICE__*/
    enactive_main_lcd_update_date_time();
	gdi_layer_unlock_frame_buffer();    
}
/*****************************************************************************
 * FUNCTION
 *  ShowCategory23ScreenInt
 * DESCRIPTION
 *  Display active call screen
 * PARAMETERS
 *  left_softkey                [IN]        Left softkey label
 *  right_softkey               [IN]        Right softkey label
 *  CM_info                     [IN]        Call inforamtion
 *  history_buffer              [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat9023_show(
                U16  left_softkey,
                U16  right_softkey,
                wgui_cat9023_call_info_struct *CM_info,
                U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 flags = DM_NO_TITLE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
	ASSERT(CM_info);
	g_wgui_cat9023_CM = CM_info;	
    memset(CM_caller_buffer, 0x0, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);
#ifdef __MMI_WEARABLE_DEVICE__
	memset(CM_caller_buffer1, 0x0, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);
	wgui_title_resize(0, 0);
	memset(CM_string_buf, 0x0, (SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN) * 2);
#else /*__MMI_WEARABLE_DEVICE__*/
    ShowStatusIconsTitle(); 
#endif /*__MMI_WEARABLE_DEVICE__*/

	gdi_layer_lock_frame_buffer();
#ifndef __MMI_WEARABLE_DEVICE__

    dm_add_softkey_id((MMI_STR_ID)left_softkey, (MMI_STR_ID)right_softkey);
#endif /*__MMI_WEARABLE_DEVICE__*/
    /* get duration string size */
    set_time_display(0, 0, 0, 0, 0);

	if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_ACTIVE_CALL)		
	{	
			
    	set_duration_start_time(g_wgui_cat9023_CM[0].active_call_duration);
        memcpy(CM_caller_buffer, CM_info[0].active_caller, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);
	#ifdef __MMI_WEARABLE_DEVICE__
		if(g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_HELD_CALL)
		{
			memcpy(CM_caller_buffer1, CM_info[1].held_caller, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);
			if(CM_caller_buffer1[0] == '\0')
				CM_caller_buffer1[0] = ' ';
		}
	#endif /*__MMI_WEARABLE_DEVICE__*/
	}
	else if(g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_ACTIVE_CALL) 
	{		
        set_duration_start_time(g_wgui_cat9023_CM[1].active_call_duration);
        memcpy(CM_caller_buffer, CM_info[1].active_caller, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);
	#ifdef __MMI_WEARABLE_DEVICE__
		if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_HELD_CALL)
		{
			memcpy(CM_caller_buffer1, CM_info[0].held_caller, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);

			if(CM_caller_buffer1[0] == '\0')
					CM_caller_buffer1[0] = ' ';
		}
	#endif /*__MMI_WEARABLE_DEVICE__*/
	}
    else
    {
        if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_HELD_CALL)
        {
        
         	set_duration_start_time(g_wgui_cat9023_CM[0].active_call_duration);
         	memcpy(CM_caller_buffer, CM_info[0].held_caller, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);
			gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) CM_info[0].held_call_str);
        }
        else
        {
        
        	set_duration_start_time(g_wgui_cat9023_CM[1].active_call_duration);
            memcpy(CM_caller_buffer, CM_info[1].held_caller, (SRV_UCM_MAX_DISP_NAME_LEN + 1) * 2);			
			gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) CM_info[1].held_call_str);
        }
    }

#ifdef __MMI_CALLSET_CTD_CONFIGURABLE__    
    if(srv_callset_call_time_display_get_mode())
#endif
    {
       set_main_LCD_dt_duration_hide_function(/*wgui_category_cm_screens_hide_duration_display*/ draw_scrolling_text_background_active_call);
    }
#ifndef __MMI_WEARABLE_DEVICE__
	if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_ACTIVE_CALL || g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_ACTIVE_CALL)
#else/*__MMI_WEARABLE_DEVICE__*/
	if(!g_in_call_vol_info_show)
#endif /*__MMI_WEARABLE_DEVICE__*/
	{
		set_dt_display(DT_TABBED_CALL_SCREEN);
		deactive_main_lcd_update_date_time();
	}
	gdi_layer_unlock_frame_buffer();

#ifdef __MMI_WEARABLE_DEVICE__
	if(!g_in_call_vol_info_show)
	{
		#ifndef __MMI_DATETIME_USE_MULTI_LINE__
		main_LCD_time_object.duration.font = &MMI_large_font;
		#endif
		main_LCD_dt_object.duration.text_color = gui_color(255, 255, 255);
	}
	flags |= DM_NO_STATUS_BAR | DM_NO_TITLE;
#ifndef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	flags |= DM_SHOW_SWATCH_SOFTKEY;
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
#else /*__MMI_WEARABLE_DEVICE__*/
	#ifndef __MMI_DATETIME_USE_MULTI_LINE__
	main_LCD_time_object.duration.font = &MMI_small_font;
	#endif
	main_LCD_dt_object.duration.text_color = gui_color(0, 0, 0);
#endif /*__MMI_WEARABLE_DEVICE__*/

    dm_register_category_controlled_callback(wgui_category_9023_draw_category_control_area);

#if defined(__MMI_WEARABLE_DEVICE__)
	wgui_register_category_screen_control_area_pen_handlers(wgui_cat9023_wearable_pen_down_hdlr, MMI_PEN_EVENT_DOWN);
	wgui_register_category_screen_control_area_pen_handlers(wgui_cat9023_wearable_pen_move_hdlr, MMI_PEN_EVENT_MOVE);
	wgui_register_category_screen_control_area_pen_handlers(wgui_cat9023_wearable_pen_up_hdlr, MMI_PEN_EVENT_UP);
#endif /* __MMI_TOUCH_SCREEN__ */

	wgui_cat_setup_category_default_history(MMI_CAT9023_ID, flags, ExitCategory9023Screen);
    dm_redraw_category_screen();
}
#endif /*defined (__MMI_MAINLCD_96X64__) || defined (__MMI_WEARABLE_DEVICE__)*/

#ifdef __MMI_WEARABLE_DEVICE__
#include "Mmi_rp_cui_dialer_def.h"

#if defined(__MMI_MAINLCD_240X240__) 

#define CAT_ICON_X		(15)
#define CAT_ICON_Y		(155)
#define CAT_ICON_W		(57)
#define CAT_ICON_H		(57)

#define CAT_LEFT_TEXT_X		(74)
#define CAT_LEFT_TEXT_Y 	(189)	
#define CAT_RIGHT_TEXT_X 	(73)
#define CAT_RIGHT_TEXT_Y 	(171)
#define CAT_TEXT_WIDTH 		(140)
#define CAT_TEXT_HEGHT 		(15)

#define CAT_LEFT_ARROW_X	(72)
#define CAT_LEFT_ARROW_Y	(171)
#define CAT_RIGHT_ARROW_X	(125)
#define CAT_RIGHT_ARROW_Y	(189)
#define CAT_ARROW_W	(42)
#define CAT_ARROW_H	(12)

#define CAT_IMAGE_X	(92)
#define CAT_IMAGE_Y	(34)
#define CAT_IMAGE_W	(57)
#define CAT_IMAGE_H	(57)
#define CAT_TEXT_GAP_Y	(9)

#elif defined(__MMI_MAINLCD_320X320__)

#define CAT_ICON_X		(20)
#define CAT_ICON_Y		(205)
#define CAT_ICON_W		(57)
#define CAT_ICON_H		(57)

#define CAT_LEFT_TEXT_X		(99)
#define CAT_LEFT_TEXT_Y 	(252)	
#define CAT_RIGHT_TEXT_X 	(115)
#define CAT_RIGHT_TEXT_Y 	(228)
#define CAT_TEXT_WIDTH 		(140)
#define CAT_TEXT_HEGHT 		(15)

#define CAT_LEFT_ARROW_X	(96)
#define CAT_LEFT_ARROW_Y	(228)
#define CAT_RIGHT_ARROW_X	(168)
#define CAT_RIGHT_ARROW_Y	(252)
#define CAT_ARROW_W	(42)
#define CAT_ARROW_H	(12)

#define CAT_IMAGE_X	(134)
#define CAT_IMAGE_Y	(45)
#define CAT_IMAGE_W	(57)
#define CAT_IMAGE_H	(57)
#define CAT_TEXT_GAP_Y	(12)

#elif defined(__MMI_MAINLCD_240X320__)

#define CAT_ICON_X		(15)
#define CAT_ICON_Y		(205)
#define CAT_ICON_W		(57)
#define CAT_ICON_H		(57)

#define CAT_LEFT_TEXT_X		(74)
#define CAT_LEFT_TEXT_Y 	(245)	
#define CAT_RIGHT_TEXT_X 	(65)
#define CAT_RIGHT_TEXT_Y 	(228)
#define CAT_TEXT_WIDTH 		(140)
#define CAT_TEXT_HEGHT 		(15)

#define CAT_LEFT_ARROW_X	(72)
#define CAT_LEFT_ARROW_Y	(228)
#define CAT_RIGHT_ARROW_X	(125)
#define CAT_RIGHT_ARROW_Y	(252)
#define CAT_ARROW_W	(42)
#define CAT_ARROW_H	(12)

#define CAT_IMAGE_X	(92)
#define CAT_IMAGE_Y	(45)
#define CAT_IMAGE_W	(57)
#define CAT_IMAGE_H	(57)
#define CAT_TEXT_GAP_Y	(12)

#else /* defined(__MMI_MAINLCD_240X240__)*/

#define CAT_ICON_X		(15)
#define CAT_ICON_Y		(155)
#define CAT_ICON_W		(57)
#define CAT_ICON_H		(57)

#define CAT_LEFT_TEXT_X		(74)
#define CAT_LEFT_TEXT_Y 	(189)	
#define CAT_RIGHT_TEXT_X 	(73)
#define CAT_RIGHT_TEXT_Y 	(171)
#define CAT_TEXT_WIDTH 		(140)
#define CAT_TEXT_HEGHT 		(15)

#define CAT_LEFT_ARROW_X	(72)
#define CAT_LEFT_ARROW_Y	(171)
#define CAT_RIGHT_ARROW_X	(125)
#define CAT_RIGHT_ARROW_Y	(189)
#define CAT_ARROW_W	(42)
#define CAT_ARROW_H	(12)

#define CAT_IMAGE_X	(92)
#define CAT_IMAGE_Y	(34)
#define CAT_IMAGE_W	(57)
#define CAT_IMAGE_H	(57)
#define CAT_TEXT_GAP_Y	(9)

#endif /* defined(__MMI_MAINLCD_240X240__)*/

#define  CATCALL_TRIANGLE_DURATION     (66)
#define  CATCALL_MAX_X_OFFSET (5)
U8 g_press_lbutton = 0;
U8 g_press_rbutton = 0;
S16 g_down_x_offset = 0;
S16 g_prev_x_pos = 0;

U8 current_answer_frame = 0;
U8 current_reject_frame = 0;
U8 timer_is_cancle = 0;

static void (*incoming_call_accept_handler) (void) = NULL;
static void (*incoming_call_reject_handler) (void) = NULL;
static void (*outgoing_call_end_handler) (void) = NULL;

static U8 g_outgoing_endbutton_status = 1;
static U8 g_cat17_icon_is_shown = 1;

/*****************************************************************************
 * FUNCTION
 *  SetInComingAccepthandler
 * DESCRIPTION
 *  set accept button handler on incoming screen
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void SetInComingAccepthandler(void (*handler) (void))
{
   
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    incoming_call_accept_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  SetInComingRejecthandler
 * DESCRIPTION
 *  set end button handler on incoming screen
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void SetInComingRejecthandler(void (*handler) (void))
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    incoming_call_reject_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  SetOutGoingEndhandler
 * DESCRIPTION
 *  set end button handler on outgoing screen
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void SetOutGoingEndhandler(void (*handler) (void))
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    outgoing_call_end_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  SetOutGoingEndButtonState
 * DESCRIPTION
 *  set mute status
 * PARAMETERS
 *  state [IN] 0: disable; 1: enable
 * RETURNS
 *  void
 *****************************************************************************/
void SetOutGoingEndButtonState(U8 state)
{
   
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_outgoing_endbutton_status = state;
}

/*****************************************************************************
 * FUNCTION
 *  RedrawOutGoingEndButton
 * DESCRIPTION
 *  set mute status
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawOutGoingEndButton(void)
{
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U16 image_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* clear background */
	if(g_outgoing_endbutton_status == 0)
	{
		image_id = IMG_ID_CALL_REJECT_DISABLE;
	}
	else
	{
		image_id = IMG_ID_CALL_REJECT_NORMAL;
	}

	gdi_layer_push_and_set_clip(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
	
	gdi_draw_solid_rect(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
	gdi_image_draw_id(CAT_IMAGE_X, CAT_ICON_Y, image_id);
    gdi_layer_pop_clip();
    gdi_layer_blt_previous(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
}

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_wearable_answer_triangle_icon
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_wearable_answer_triangle_icon(void)
{	

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(timer_is_cancle) 
		return;
	gdi_layer_lock_frame_buffer();

	gdi_layer_push_and_set_clip(CAT_LEFT_ARROW_X, CAT_LEFT_ARROW_Y, 
				CAT_LEFT_ARROW_X + CAT_ARROW_W, CAT_LEFT_ARROW_Y + CAT_ARROW_H);
	gdi_layer_set_source_key(MMI_TRUE,GDI_COLOR_TRANSPARENT);
	gdi_layer_clear(GDI_COLOR_TRANSPARENT);
	
	current_answer_frame ++;
	gdi_image_draw_id(CAT_LEFT_ARROW_X, CAT_LEFT_ARROW_Y, IMG_ID_CALL_ARROW_ACCEPT1 + current_answer_frame);
	if(current_answer_frame >= 4)
	{
		current_answer_frame = 0;
	}
	
	gdi_layer_pop_clip();
	gdi_layer_unlock_frame_buffer();
	gdi_layer_blt_previous(CAT_LEFT_ARROW_X, CAT_LEFT_ARROW_Y, 
				CAT_LEFT_ARROW_X + CAT_ARROW_W, CAT_LEFT_ARROW_Y + CAT_ARROW_H);
	

    gui_start_timer(CATCALL_TRIANGLE_DURATION, wgui_catcall_wearable_answer_triangle_icon);
}

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_wearable_reject_triangle_icon
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_wearable_reject_triangle_icon(void)
{	
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(timer_is_cancle) 
		return;
	gdi_layer_lock_frame_buffer();

	gdi_layer_push_and_set_clip(CAT_RIGHT_ARROW_X, CAT_RIGHT_ARROW_Y,
	      	CAT_RIGHT_ARROW_X + CAT_ARROW_W, CAT_RIGHT_ARROW_Y + CAT_ARROW_H);
	gdi_layer_set_source_key(MMI_TRUE,GDI_COLOR_TRANSPARENT);
	gdi_layer_clear(GDI_COLOR_TRANSPARENT);
	
	current_reject_frame ++;
	gdi_image_draw_id(CAT_RIGHT_ARROW_X, CAT_RIGHT_ARROW_Y, IMG_ID_CALL_ARROW_REJECT1 + current_reject_frame);
	if(current_reject_frame >= 4)
	{
		current_reject_frame = 0;
	}
	gdi_layer_pop_clip();
	gdi_layer_unlock_frame_buffer();
	gdi_layer_blt_previous(CAT_RIGHT_ARROW_X, CAT_RIGHT_ARROW_Y,
		CAT_RIGHT_ARROW_X + CAT_ARROW_W, CAT_RIGHT_ARROW_Y + CAT_ARROW_H);

    gui_start_timer(CATCALL_TRIANGLE_DURATION, wgui_catcall_wearable_reject_triangle_icon);
}
 /*****************************************************************************
 * FUNCTION
 *  wgui_catcall_swatch
 * DESCRIPTION
 *  exit category 18 for smart watch
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_swatch_exit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/	
	gdi_layer_lock_frame_buffer();
	gdi_layer_set_opacity(MMI_FALSE, 125);
	timer_is_cancle = 1;
	g_cat17_icon_is_shown = 1;
	g_Cat_is_end_call_key = 0;
    gui_cancel_timer(CM_scrolling_text_timer_callback);
	gui_cancel_timer(wgui_catcall_wearable_answer_triangle_icon);
	gui_cancel_timer(wgui_catcall_wearable_reject_triangle_icon);
    close_main_LCD_dt_display();
    enactive_main_lcd_update_date_time();
	gdi_layer_unlock_frame_buffer();
}  
/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_wearable_draw_ctrl_area
 * DESCRIPTION
 *  draw control area 1, including background, calling string, icon, etc., on base layer
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_wearable_draw_ctrl_area(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 str_w = 0, str_h = 0 , x = 0, y = 0;
    S32 image_width;
    S32 image_height;
    S32 image_offset_x;
    S32 image_offset_y;
	//GDI_HANDLE active_layer;
	S32 x_offset;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(coordinate);
	gdi_layer_push_clip();
    gdi_layer_reset_clip();
	
	/* background*/
	gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));//21,21,26

	/* draw caller icon */
	gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);
	image_offset_x = (CAT_IMAGE_W - image_width) >> 1;
	
	gdi_image_draw_id(CAT_IMAGE_X + image_offset_x, 
				CAT_IMAGE_Y,  
				cat_momt_default_image_id);

    /* num or name */
				
    if (MMI_message_string)
    {
        y = CAT_IMAGE_Y + CAT_IMAGE_H + CAT_TEXT_GAP_Y;
		
		gui_set_font(&MMI_medium_font);
		gui_measure_string(MMI_message_string, &str_w, &str_h);

		if (str_w > UI_device_width )
		{
			str_w = UI_device_width;
		}
		x = ((UI_device_width - str_w) >> 1) ;        

        gui_create_scrolling_text(
            &CM_scrolling_text,
            x, y, str_w, str_h,
            MMI_message_string,
            CM_scrolling_text_timer_callback,
            CM_draw_scrolling_text_background,
            gui_color(255, 255, 255),
            gui_color(255, 255, 255));
        CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
        gui_show_scrolling_text(&CM_scrolling_text);
    }
	
    /* calling... */
    if (MMI_message_string2)
    {
    	y += str_h + CAT_TEXT_GAP_Y;
		
        gui_set_font(&MMI_medium_font);
        gui_set_text_color(gui_color(255, 255, 255));	
        gui_measure_string(MMI_message_string2, &str_w, &str_h);
#if 0        
/* under construction !*/
/* under construction !*/
#endif		
        x = (UI_device_width - str_w) >> 1;
        gui_print_truncated_text(x, y, str_w, MMI_message_string2);
    }
	
	gdi_layer_pop_clip();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_wearable_draw_ctrl_area2
 * DESCRIPTION
 *  draw control area 2, including background, calling string, icon, etc., on base layer
 * PARAMETERS
 *  coordinate  [IN] unused
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_catcall_wearable_draw_ctrl_area2(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	UI_UNUSED_PARAMETER(coordinate);

	gdi_layer_push_clip();
	gdi_layer_reset_clip();
	/* clear background */
	gdi_draw_solid_rect(0, 0, UI_device_width - 1, UI_device_height - 1, GDI_COLOR_TRANSPARENT);
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_INCOMING_CALL)
	{
		gui_fill_rectangle(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, gui_color(0, 0, 0));//21, 21, 26	

		gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, IMG_ID_CALL_ACCEPT_NORMAL);
		gdi_image_draw_id(CAT_LEFT_ARROW_X, CAT_LEFT_ARROW_Y, IMG_ID_CALL_ARROW_ACCEPT1);

		gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_NORMAL);
		gdi_image_draw_id(CAT_RIGHT_ARROW_X, CAT_RIGHT_ARROW_Y, IMG_ID_CALL_ARROW_REJECT1);
	
		timer_is_cancle = 0;
        gui_start_timer(CATCALL_TRIANGLE_DURATION, wgui_catcall_wearable_answer_triangle_icon);
        gui_start_timer(CATCALL_TRIANGLE_DURATION, wgui_catcall_wearable_reject_triangle_icon);
	}
#ifdef	__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	else if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{	
		U16 image_id = g_outgoing_endbutton_status ? IMG_ID_CALL_REJECT_NORMAL : IMG_ID_CALL_REJECT_DISABLE; 

		gdi_image_draw_id(CAT_IMAGE_X, CAT_ICON_Y, image_id);
	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	gdi_layer_pop_clip();
}

/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_pen_up_hdlr
 * DESCRIPTION
 *  pen up handler
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_catcall_wearable_iconbar_pen_up_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_INCOMING_CALL)
	{		
		if(g_press_lbutton && point.y >= CAT_ICON_Y && point.y <= CAT_ICON_Y + CAT_ICON_H &&  point.x >= UI_device_width/2)
		{
		
			g_press_lbutton = 0;
			if(incoming_call_accept_handler != NULL)
			{
				incoming_call_accept_handler();
			}
		}
		else if(g_press_rbutton && point.y >= CAT_ICON_Y && point.y <= CAT_ICON_Y + CAT_ICON_H &&  point.x <= UI_device_width/2)
		{
		
			g_press_rbutton = 0;
			if(incoming_call_reject_handler != NULL)
			{
				incoming_call_reject_handler();
			}
		}
		else if(g_press_lbutton || g_press_rbutton)
		{
			GDI_HANDLE active_layer = dm_get_layer_handle(0);
			g_press_lbutton = 0;
			g_press_rbutton = 0;
			gdi_layer_push_and_set_active(active_layer);			
			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gui_fill_rectangle(CAT_ICON_X, CAT_ICON_Y, UI_device_width -CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, gui_color(0, 0, 0));//21, 21, 26
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_layer_pop_and_restore_active();

			gdi_layer_push_and_set_clip(0, CAT_ICON_Y, UI_device_width, CAT_ICON_Y + CAT_ICON_H);

			/* clear background */
			gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_TRANSPARENT);

			gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, IMG_ID_CALL_ACCEPT_NORMAL);
			gdi_image_draw_id(CAT_LEFT_ARROW_X, CAT_LEFT_ARROW_Y, IMG_ID_CALL_ARROW_ACCEPT1);

			//maybe need to draw the image between the both icon.
			gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_NORMAL);
			gdi_image_draw_id(CAT_RIGHT_ARROW_X, CAT_RIGHT_ARROW_Y, IMG_ID_CALL_ARROW_REJECT1);

			gdi_layer_pop_clip();
			gdi_layer_blt_previous(0, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);

			gui_start_timer(CATCALL_TRIANGLE_DURATION, wgui_catcall_wearable_answer_triangle_icon);
			gui_start_timer(CATCALL_TRIANGLE_DURATION, wgui_catcall_wearable_reject_triangle_icon);

		}
		g_down_x_offset = 0;
		g_prev_x_pos = 0;
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	else if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{
		if(g_press_rbutton && (point.x >= CAT_IMAGE_X && point.x <= (CAT_IMAGE_X + CAT_ICON_W) 
			&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H)))
		{
			g_press_rbutton = 0;
			if(outgoing_call_end_handler != NULL)
			{
				outgoing_call_end_handler();
			}
		}

	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
    return MMI_TRUE;
}
/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_wearable_iconbar_pen_down_hdlr
 * DESCRIPTION
 *  pen down handler
 * PARAMETERS
 *  point  [IN]  pen position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL wgui_catcall_wearable_iconbar_pen_down_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	GDI_HANDLE  active_layer;
	U16 StringId;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_INCOMING_CALL)
	{
		if(point.x >= CAT_ICON_X && point.x <= (CAT_ICON_X + CAT_ICON_W) 
			&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H)
			&& g_cat17_icon_is_shown)
		{		
			gui_cancel_timer(wgui_catcall_wearable_answer_triangle_icon);
			gui_cancel_timer(wgui_catcall_wearable_reject_triangle_icon);

			active_layer = dm_get_layer_handle(0);
			gdi_layer_push_and_set_active(active_layer);			
			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gui_set_font(&MMI_small_font);
    		gui_set_text_color(gui_color(126, 126, 129));
		#ifdef __MMI_HF_SUPPORT__ 
			if(srv_ucm_bt_query_group_count(SRV_UCM_BT_CALL_STATE_CONNECTED, NULL) == 2
				&& srv_ucm_bt_query_group_count(SRV_UCM_BT_INCOMING_STATE, NULL) > 0)//1A+1H+1W
			{
				StringId = STR_ID_SWATCH_REPLACE;
			}
			else
		#endif /*__MMI_HF_SUPPORT__*/
			{
				StringId = STR_ID_SWATCH_ANSWER;
			}
			gui_print_truncated_text(CAT_LEFT_TEXT_X, CAT_LEFT_TEXT_Y, CAT_TEXT_WIDTH, (UI_string_type)GetString(StringId));	
			gdi_image_draw_id(CAT_LEFT_ARROW_X, CAT_LEFT_ARROW_Y, IMG_ID_CALL_ARROW_ACCEPT1);
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y,  UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_layer_pop_and_restore_active();
			
			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_TRANSPARENT);
					
			gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, IMG_ID_CALL_ACCEPT_PRESS);		

			gdi_layer_pop_clip();
	    	gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			g_press_lbutton = 1;
			g_press_rbutton = 0;
			g_down_x_offset = point.x - CAT_ICON_X;
			g_prev_x_pos = CAT_ICON_X;
		}

		else if(point.x >= (UI_device_width - CAT_ICON_X - CAT_ICON_W) && point.x <= (UI_device_width - CAT_ICON_X ) 
				&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H)
				&& g_cat17_icon_is_shown)
		{	
			gui_cancel_timer(wgui_catcall_wearable_answer_triangle_icon);
			gui_cancel_timer(wgui_catcall_wearable_reject_triangle_icon);

			active_layer = dm_get_layer_handle(0);
			gdi_layer_push_and_set_active(active_layer);			
			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gui_set_font(&MMI_small_font);
    		gui_set_text_color(gui_color(126, 126, 129));
			//(UI_string_type)GetString(STR_ID_SWATCH_REJECT)
			gui_print_truncated_text(CAT_RIGHT_TEXT_X, CAT_RIGHT_TEXT_Y, CAT_TEXT_WIDTH, (UI_string_type)GetString(STR_ID_SWATCH_REJECT));	
			gdi_image_draw_id(CAT_RIGHT_ARROW_X, CAT_RIGHT_ARROW_Y, IMG_ID_CALL_ARROW_REJECT1);
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_layer_pop_and_restore_active();

			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_TRANSPARENT);
						
			gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_PRESS);		
			gdi_layer_pop_clip();
	    	gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			g_press_lbutton = 0;
			g_press_rbutton = 1;
			g_down_x_offset = point.x - (UI_device_width - CAT_ICON_X - CAT_ICON_W);
			g_prev_x_pos = UI_device_width - CAT_ICON_X - CAT_ICON_W;		
		}
		else
		{
		
			g_press_lbutton = 0;
			g_press_rbutton = 0;
			g_down_x_offset = 0;
			g_prev_x_pos = 0;
		}
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	else if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{
		if(point.x >= CAT_IMAGE_X  && point.x <= (CAT_IMAGE_X + CAT_ICON_W) 
			&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H)
			&& g_outgoing_endbutton_status && g_cat17_icon_is_shown)
		{
			gdi_layer_push_and_set_clip(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
			gdi_draw_solid_rect(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
								
			gdi_image_draw_id(CAT_IMAGE_X, CAT_ICON_Y, IMG_ID_CALL_REJECT_PRESS);		
			
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
			g_press_rbutton = 1;
		}
		else
		{
			g_press_rbutton = 0;
		}

	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_catcall_fte_iconbar_pen_move_hdlr
 * DESCRIPTION
 *  pen move handler
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_catcall_wearable_iconbar_pen_move_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 x_offset = 0;
	S16 tx = 0;
	U16 tw = 0;
    MMI_ID_TYPE img_bg_id ;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_INCOMING_CALL)
	{

		 if(g_press_lbutton  
		 	&& point.x >= CAT_ICON_X && point.x <= UI_device_width - CAT_ICON_X 
		 	&& point.y >= CAT_ICON_Y && point.y <= UI_device_height )
		{
			
			point.x = (point.x - g_down_x_offset) >= 0 ? (point.x - g_down_x_offset) : CAT_ICON_X;

			if(point.x  < CAT_ICON_X)
				point.x  = CAT_ICON_X;
			else if( (point.x  + CAT_ICON_W) > (UI_device_width- CAT_ICON_X))
				point.x = UI_device_width- CAT_ICON_X - CAT_ICON_W;
		

			x_offset = point.x - g_prev_x_pos;
			if(x_offset > 0)
			{
				tx = g_prev_x_pos;
			}
			else
			{
				tx = point.x;
				x_offset = -x_offset;
			}
			if(x_offset <= CATCALL_MAX_X_OFFSET)
				return MMI_TRUE;
		#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
		#else
			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width- CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width- CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_TRANSPARENT);		
			
			gdi_image_draw_id(point.x, CAT_ICON_Y, IMG_ID_CALL_ACCEPT_PRESS);
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width- CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);

		#endif		
			g_prev_x_pos = point.x;

	    }
		else if(g_press_rbutton  
		 	&& point.x >= CAT_ICON_X && point.x <= UI_device_width - CAT_ICON_X &&
		 	point.y >= CAT_ICON_Y && point.y <= UI_device_height )
		{
			point.x = (point.x - g_down_x_offset) >= 0 ? (point.x - g_down_x_offset) : CAT_ICON_X;

			if(point.x  < CAT_ICON_X)
				point.x  = CAT_ICON_X;
			else if( (point.x  + CAT_ICON_W) > (UI_device_width - CAT_ICON_X))
				point.x = UI_device_width - CAT_ICON_X - CAT_ICON_W;
		
			x_offset = point.x - g_prev_x_pos;
			if(x_offset > 0)
			{
				tx = g_prev_x_pos;
			}
			else
			{
				tx = point.x;
				x_offset = -x_offset;
			}
			if(x_offset <= CATCALL_MAX_X_OFFSET)
				return MMI_TRUE;
		#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
		#else
			gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);
			gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_TRANSPARENT);
			
			gdi_image_draw_id(point.x, CAT_ICON_Y, IMG_ID_CALL_REJECT_PRESS);
			
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X, CAT_ICON_Y + CAT_ICON_H);


		#endif
			g_prev_x_pos = point.x;
	    }
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	else if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{
		if(g_press_rbutton && (point.x < CAT_IMAGE_X  || point.x > (CAT_IMAGE_X + CAT_ICON_W) 
			|| point.y < CAT_ICON_Y || point.y > (CAT_ICON_Y + CAT_ICON_H)))
		{
			gdi_layer_push_and_set_clip(0 , CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
			gdi_draw_solid_rect(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
								
			gdi_image_draw_id(CAT_IMAGE_X, CAT_ICON_Y, IMG_ID_CALL_REJECT_NORMAL);		
			
			gdi_layer_pop_clip();
			gdi_layer_blt_previous(0, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
			g_press_rbutton = 0;
		}

	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
    return MMI_TRUE;
}

/*****************************************************************************
 * FUNCTION
 *  ShowCategory17Screen_ext
 * DESCRIPTION
 *  Show MO MT call cateogry for wearable device.
 * PARAMETERS
 *  left_softkey                [IN]        Lsk string id
 *  right_softkey               [IN]        Rsk string id
 *  NotificationStringId        [IN]        Notification string, notification string
 *  NameOrNumber                [IN]        Name or number text, name or number text
 *  default_image_id			[IN]		image id
 *  call_type					[IN]		call type:incoming\outgoing\end
 *  history_buffer              [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void ShowCategory17Screen_ext(
                U16 left_softkey,
                U16 right_softkey,
                U16 NotificationStringId,
                PU8 NameOrNumber,
                U16 default_image_id,
                wgui_cate_momt_call_type_enum call_type,
                PU8 history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    dm_data_struct dm_data;
    //S32 text_width, text_height, tx;
    S32 flags;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 
	cat_momt_default_image_id = default_image_id;
	g_cat_momt_call_type = call_type;
	g_cat17_icon_is_shown = 1;
	    
	/* softkey */
#ifndef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{
		if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL && right_softkey != 0)
			g_Cat_is_end_call_key = 1;
		else
			g_Cat_is_end_call_key = 0;
		
		dm_add_softkey_id((MMI_STR_ID)left_softkey, (MMI_STR_ID)right_softkey);
	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	/* status icon */
	wgui_status_icon_bar_reset_display(WGUI_STATUS_ICON_BAR_H_BAR);
	
    /* set message string */
    if (NameOrNumber)
    {
        memset((CHAR*)CM_string_buf, 0, (SRV_CALLSET_MAX_IP_NUMBER_LEN + SRV_UCM_MAX_NUM_URI_LEN)*2);
        gui_strcpy((UI_string_type) CM_string_buf, (UI_string_type) NameOrNumber);
        MMI_message_string = (UI_string_type) CM_string_buf;
    }
    else
    {
        MMI_message_string = NULL;
    }
	if(g_cat_momt_call_type != WGUI_CATE_MOMT_INCOMING_CALL)
    {
    	MMI_message_string2 = (NotificationStringId) ? (get_string(NotificationStringId)) : (NULL);
	}
	else
	{
		MMI_message_string2 = NULL;
	}
	
    /* control area */
    dm_register_category_controlled_callback(wgui_catcall_wearable_draw_ctrl_area);
	dm_register_category_controlled2_callback(wgui_catcall_wearable_draw_ctrl_area2);
#if defined(__MMI_TOUCH_SCREEN__)
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_INCOMING_CALL
		|| g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
   	{
   		wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_wearable_iconbar_pen_down_hdlr, MMI_PEN_EVENT_DOWN);
    	wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_wearable_iconbar_pen_move_hdlr, MMI_PEN_EVENT_MOVE);
    	wgui_register_category_screen_control_area2_pen_handlers(wgui_catcall_wearable_iconbar_pen_up_hdlr, MMI_PEN_EVENT_UP);
	}
#endif /* __MMI_TOUCH_SCREEN__ */

	flags = DM_CLEAR_SCREEN_BACKGROUND | DM_SET_AS_ABM_LAYER | DM_NO_STATUS_BAR;

#ifndef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{
		flags |= DM_SHOW_SWATCH_SOFTKEY;
	}
	else
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	{
		flags |= DM_NO_SOFTKEY;
	}
    wgui_cat_setup_category(
		MMI_CATEGORY18_ID,
		flags,
		wgui_catcall_swatch_exit,
		dummy_get_history,
		dummy_get_history_size);
    dm_redraw_category_screen();
}

/*****************************************************************************
 * FUNCTION
 *  RedrawCategory17Screen
 * DESCRIPTION
 *  redraw Category17Screen by new string info and hide the buttons.
 * PARAMETERS
 *  string_id  [IN] new string id
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawCategory17Screen(U16 string_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 str_w = 0, str_h = 0 , x = 0, y = 0;
	U32 image_width, image_height, image_offset_x;
	
	GDI_HANDLE  active_layer;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(g_cat_momt_call_type == WGUI_CATE_MOMT_INCOMING_CALL
		|| g_cat_momt_call_type == WGUI_CATE_MOMT_OUTGOING_CALL)
	{
		MMI_message_string2 = get_string(string_id);
		gui_cancel_timer(wgui_catcall_wearable_answer_triangle_icon);
		gui_cancel_timer(wgui_catcall_wearable_reject_triangle_icon);
		g_press_lbutton = 0;
		g_press_rbutton = 0;		
		g_cat17_icon_is_shown= 0;
		timer_is_cancle = 1;

		gdi_layer_push_clip();
	    gdi_layer_reset_clip();
		gdi_layer_set_opacity(MMI_TRUE, 125);
		/* background*/
		gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));//21,21,26

		/* draw caller icon */
		gdi_image_get_dimension_id(cat_momt_default_image_id, &image_width, &image_height);
		image_offset_x = (CAT_IMAGE_W - image_width) >> 1;
	
		gdi_image_draw_id(CAT_IMAGE_X + image_offset_x, 
				CAT_IMAGE_Y,  
				cat_momt_default_image_id);

    	/* num or name */			
    	if (MMI_message_string)
    	{
        	y = CAT_IMAGE_Y + CAT_IMAGE_H + CAT_TEXT_GAP_Y;
			
			gui_set_font(&MMI_medium_font);
			gui_measure_string(MMI_message_string, &str_w, &str_h);

			if (str_w > UI_device_width )
			{
				str_w = UI_device_width;
			}
			x = ((UI_device_width - str_w) >> 1) ;        

	        gui_create_scrolling_text(
	            &CM_scrolling_text,
	            x, y, str_w, str_h,
	            MMI_message_string,
	            CM_scrolling_text_timer_callback,
	            CM_draw_scrolling_text_background,
	            gui_color(255, 255, 255),
	            gui_color(255, 255, 255));
	        CM_scrolling_text.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;
	        gui_show_scrolling_text(&CM_scrolling_text);
	    }
	
	    /* calling... */
	    if (MMI_message_string2)
	    {
	    	y += str_h + CAT_TEXT_GAP_Y;
			
	        gui_set_font(&MMI_medium_font);
	        gui_set_text_color(gui_color(255, 255, 255));	
	        gui_measure_string(MMI_message_string2, &str_w, &str_h);
#if 0        
/* under construction !*/
/* under construction !*/
#endif		
	        x = (UI_device_width - str_w) >> 1;
	        gui_print_truncated_text(x, y, str_w, MMI_message_string2);
	    }
		
		gdi_layer_pop_clip();
    	gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);

		active_layer = dm_get_layer_handle(0);
		gdi_layer_push_and_set_active(active_layer);			
		gdi_layer_push_and_set_clip(0, 0, UI_device_width - 1, UI_device_height - 1);	
		gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));//21,21,26
		gdi_layer_pop_clip();
    	gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);		
		gdi_layer_pop_and_restore_active();
	}
}

#define CAT9023_WEARABLE

#if defined(__MMI_MAINLCD_240X240__) 

#define HELD_AREAR_WIDTH 	(UI_device_width)
#define HELD_AREAR_HEIGHT	(50)
#define HELD_ICON_X 		(15)
#define HELD_ICON_Y 		(15)
#define HELD_ICON_WIDTH 	(20)		 
#define HELD_ICON_HEIGHT 	(20)
#define HELD_TEXT_X 		(HELD_ICON_X + HELD_ICON_WIDTH + 8)
#define HELD_TEXT_Y			(0)
#define ACTIVE_TEXT_X		(12)
#define ACTIVE_TEXT_Y		(100)
#define ACTIVE_TEXT_HEIGHT	(22)
#define ACTIVE_DURATION_X	(12)
#define ACTIVE_DURATION_Y	(ACTIVE_TEXT_Y + ACTIVE_TEXT_HEIGHT + 9)
#define ACTIVE_DURATION_HEIGHT	(22)
#define ACTIVE_DURATION_HELD_GAP (6)
#define ACTIVE_DURATION_H_GAP	(9)
#define VOL_BAR_H_X          (3)
#define VOL_BAR_H_Y          (24)

#elif defined(__MMI_MAINLCD_320X320__)

#define HELD_AREAR_WIDTH 	(UI_device_width)
#define HELD_AREAR_HEIGHT	(68)
#define HELD_ICON_X 		(20)
#define HELD_ICON_Y 		(24)
#define HELD_ICON_WIDTH 	(20)		 
#define HELD_ICON_HEIGHT 	(20)
#define HELD_TEXT_X 		(HELD_ICON_X + HELD_ICON_WIDTH + 8)
#define HELD_TEXT_Y			(0)
#define ACTIVE_TEXT_X		(0)
#define ACTIVE_TEXT_Y		(132)
#define ACTIVE_TEXT_HEIGHT	(24)
#define ACTIVE_DURATION_X	(0)
#define ACTIVE_DURATION_Y	(ACTIVE_TEXT_Y + ACTIVE_TEXT_HEIGHT + 12)
#define ACTIVE_DURATION_HEIGHT	(24)
#define ACTIVE_DURATION_HELD_GAP (9)
#define ACTIVE_DURATION_H_GAP	(12)
#define VOL_BAR_H_X          (3)
#define VOL_BAR_H_Y          (24)

#elif defined(__MMI_MAINLCD_240X320__)

#define HELD_AREAR_WIDTH 	(UI_device_width)
#define HELD_AREAR_HEIGHT	(50)
#define HELD_ICON_X 		(15)
#define HELD_ICON_Y 		(15)
#define HELD_ICON_WIDTH 	(20)		 
#define HELD_ICON_HEIGHT 	(20)
#define HELD_TEXT_X 		(HELD_ICON_X + HELD_ICON_WIDTH + 8)
#define HELD_TEXT_Y			(0)
#define ACTIVE_TEXT_X		(12)
#define ACTIVE_TEXT_Y		(132)
#define ACTIVE_TEXT_HEIGHT	(24)
#define ACTIVE_DURATION_X	(0)
#define ACTIVE_DURATION_Y	(ACTIVE_TEXT_Y + ACTIVE_TEXT_HEIGHT + 12)
#define ACTIVE_DURATION_HEIGHT	(24)
#define ACTIVE_DURATION_HELD_GAP (9)
#define ACTIVE_DURATION_H_GAP	(12)
#define VOL_BAR_H_X          (3)
#define VOL_BAR_H_Y          (24)


#else /*__MMI_MAINLCD_240X240__*/

#define HELD_AREAR_WIDTH 	(UI_device_width)
#define HELD_AREAR_HEIGHT	(50)
#define HELD_ICON_X 		(15)
#define HELD_ICON_Y 		(12)
#define HELD_ICON_WIDTH 	(20)		 
#define HELD_ICON_HEIGHT 	(20)
#define HELD_TEXT_X 		(HELD_ICON_X + HELD_ICON_WIDTH + 8)
#define HELD_TEXT_Y			(0)
#define ACTIVE_TEXT_X		(12)
#define ACTIVE_TEXT_Y		(100)
#define ACTIVE_TEXT_HEIGHT	(22)
#define ACTIVE_DURATION_X	(0)
#define ACTIVE_DURATION_Y	(ACTIVE_TEXT_Y + ACTIVE_TEXT_HEIGHT + 9)
#define ACTIVE_DURATION_HEIGHT	(22)
#define ACTIVE_DURATION_HELD_GAP (6)
#define ACTIVE_DURATION_H_GAP	(9)
#define VOL_BAR_H_X          (3)
#define VOL_BAR_H_Y          (24)

#endif /*__MMI_MAINLCD_240X240__*/

static U8 held_is_pressed = 0;
static U8 g_held_call_index = 2;
static U8 g_active_call_index = 2;
static U16 g_held_call_icon_id = 0;
static U16 g_wearable_in_call_iamge_id;
static U8 g_in_call_mute_status = 1;
static U16 g_in_call_max_level = 0;
static U16 g_in_call_cur_level = 0;

static void (*in_call_swap_handler) (void) = NULL;
static void (*in_call_mute_handler) (void) = NULL;
static void (*in_call_end_handler) (void) = NULL;

static void (*in_call_pen_up_handler) (mmi_pen_point_struct pos) = NULL;
static void (*in_call_pen_move_handler) (mmi_pen_point_struct pos) = NULL;
static void (*in_call_pen_down_handler) (mmi_pen_point_struct pos) = NULL;

/*****************************************************************************
 * FUNCTION
 *  SetInCallSwaphandler
 * DESCRIPTION
 *  set swap button handler on incall screen
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void SetInCallSwaphandler(void (*handler) (void))
{
   
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    in_call_swap_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  SetInCallMutehandler
 * DESCRIPTION
 *  set mute/unmute button handler on incall screen
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void SetInCallMutehandler(void (*handler) (void))
{
   
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    in_call_mute_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  SetInCallEndhandler
 * DESCRIPTION
 *  set endcall button handler on incall screen
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void SetInCallEndhandler(void (*handler) (void))
{
   
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    in_call_end_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  SetInCallMuteState
 * DESCRIPTION
 *  set mute status
 * PARAMETERS
 *  state [IN] 0: show unmute icon; 1: show mute icon; 2: show unhold icon
 * RETURNS
 *  void
 *****************************************************************************/
void SetInCallMuteState(U8 state)
{
   
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_in_call_mute_status = state;
}

/*****************************************************************************
 * FUNCTION
 *  wgui_in_call_pen_register_up_handler
 * DESCRIPTION
 *  set pen up handler for APP
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_in_call_pen_register_up_handler(void (*handler) (mmi_pen_point_struct pos))
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	in_call_pen_up_handler = handler;	
}

/*****************************************************************************
 * FUNCTION
 *  wgui_in_call_pen_register_down_handler
 * DESCRIPTION
 *  set pen down handler for APP
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_in_call_pen_register_down_handler(void (*handler) (mmi_pen_point_struct pos))
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	in_call_pen_down_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  wgui_in_call_pen_register_move_handler
 * DESCRIPTION
 *  set pen move handler for APP
 * PARAMETERS
 *  handler [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_in_call_pen_register_move_handler(void (*handler) (mmi_pen_point_struct pos))
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	in_call_pen_move_handler = handler;
}

/*****************************************************************************
 * FUNCTION
 *  RedrawInCallMuteIcon
 * DESCRIPTION
 *  redraw mute/unmute icon
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawInCallMuteIcon(void)
{
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__  
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U16 image_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* clear background */
	if(g_in_call_mute_status == 0)
	{
		image_id = IMG_ID_CALL_MUTE_ON;
	}
	else if(g_in_call_mute_status == 1)
	{
		image_id = IMG_ID_CALL_MUTE_OFF;
	}
	else if(g_in_call_mute_status == 2)
	{
		image_id = IMG_ID_CALL_UNHOLD_NORMAL;
	}
	gdi_layer_push_and_set_clip(CAT_ICON_X, 
					CAT_ICON_Y,
					UI_device_width - CAT_ICON_X - CAT_ICON_W - 1,
					CAT_ICON_Y + CAT_ICON_H);
	
    gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X - CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);

	gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, image_id); 
	   
    gdi_layer_pop_clip();
	
    gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X - CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H);
#endif
}
/*****************************************************************************
 * FUNCTION
 *  SetInCallEndButtonState
 * DESCRIPTION
 *  set end button status
 * PARAMETERS
 *  state [IN] 0: disable; 1: enable
 * RETURNS
 *  void
 *****************************************************************************/
void SetInCallEndButtonState(U8 state)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	g_in_call_endbutton_status = state;
}

/*****************************************************************************
 * FUNCTION
 *  SetInCallVolInfoContentShow
 * DESCRIPTION
 *  set if volume indication text content is show.
 * PARAMETERS
 *  is_show [IN] MMI_FALSE: hide; MMI_TRUE: show
 * RETURNS
 *  void
 *****************************************************************************/
void SetInCallVolInfoContentShow(MMI_BOOL is_show)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	g_in_call_vol_info_show = is_show;
}

/*****************************************************************************
 * FUNCTION
 *  ShowInCallVolInfoContent
 * DESCRIPTION
 *  show volume indication text.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ShowInCallVolInfoContent(void)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 dstr_sw, dtr_sh;
	S32 sw,sh;
	S32 tx, ty;
		
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	SetInCallVolInfoContentShow(MMI_TRUE);

	gui_set_font(&MMI_large_font);
	gui_measure_string((UI_string_type)CM_caller_buffer, &sw, &sh);
	ty = ACTIVE_TEXT_Y + sh + ACTIVE_DURATION_H_GAP;

	gui_set_font(&MMI_small_font);
	gui_measure_string((UI_string_type)get_string(STR_ID_SWATCH_VOL_INFO_CONTENT), &dstr_sw, &dtr_sh);
	tx = (UI_device_width - dstr_sw) >> 1;

	gui_push_text_clip();
	gui_set_text_clip(tx, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
	gui_move_text_cursor(tx , ty);
	
	gui_set_text_color(gui_color(255, 255, 255));
	gui_print_text(get_string(STR_ID_SWATCH_VOL_INFO_CONTENT));
	gui_pop_text_clip();
    gdi_layer_blt_previous(tx, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
}


/*****************************************************************************
 * FUNCTION
 *  ShowInCallDuration
 * DESCRIPTION
 *  show call time.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ShowInCallDuration(void)
{
	/*----------------------------------------------------------------*/
	/* Local Variables                                                */
	/*----------------------------------------------------------------*/
	color text_color; 	
	S32 tx, ty, sw, sh;

	/*----------------------------------------------------------------*/
	/* Code Body                                            ;          */
	/*----------------------------------------------------------------*/ 
	SetInCallVolInfoContentShow(MMI_FALSE);
	set_dt_display(DT_TABBED_CALL_SCREEN);
	deactive_main_lcd_update_date_time();
#ifndef __MMI_DATETIME_USE_MULTI_LINE__
	main_LCD_time_object.duration.font = &MMI_large_font;
#endif
	main_LCD_dt_object.duration.text_color = gui_color(255, 255, 255);	

    text_color = main_LCD_dt_object.duration.text_color;
	
	gui_set_font(&MMI_large_font);
	gui_measure_string((UI_string_type)CM_caller_buffer, &sw, &sh);
	ty = ACTIVE_TEXT_Y + sh + ACTIVE_DURATION_H_GAP;
	gdi_layer_reset_clip();

	gui_push_and_set_clip(ACTIVE_DURATION_X, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
	gui_fill_rectangle(ACTIVE_DURATION_X, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT, gui_color(0, 0, 0));
		
	if(g_active_call_index == 2)        
	{
		if(g_held_call_index == 0 || g_held_call_index == 1)
		{			
			S32 sw_text, sh_text;
			S32 dstr_sw, dtr_sh;
			
			gui_set_font(&MMI_medium_font);
			gui_set_text_color(text_color);
			gui_measure_string((UI_string_type)CM_string_buf, &sw_text, &sh_text);
			main_LCD_measure_time_duration_string(&dstr_sw, &dtr_sh);
			tx = (UI_device_width - dstr_sw - sw_text + ACTIVE_DURATION_HELD_GAP) >> 1;

			gui_push_text_clip();
			gui_set_text_clip(ACTIVE_DURATION_X, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
			gui_move_text_cursor(tx , ty);			
			gui_print_text((UI_string_type)CM_string_buf);
			gui_pop_text_clip();

			tx += sw_text + ACTIVE_DURATION_HELD_GAP;
			set_main_lcd_duration_position(tx, ty);
    		dt_update_duration();		
		}
	}	
	else
	{
		S32 dstr_sw, dtr_sh;
		main_LCD_measure_time_duration_string(&dstr_sw, &dtr_sh);
		tx = (UI_device_width - dstr_sw) >> 1;
		set_main_lcd_duration_position(tx, ty);
        dt_update_duration();
	}
	gui_pop_clip();
    gdi_layer_blt_previous(ACTIVE_DURATION_X, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
}

/*****************************************************************************
 * FUNCTION
 *  RedrawInCallEndButton
 * DESCRIPTION
 *  redraw endcall icon
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawInCallEndButton(void)
{
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__ 
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U16 image_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* clear background */
	if(g_in_call_endbutton_status == 0)
	{
		image_id = IMG_ID_CALL_REJECT_DISABLE;
	}
	else
	{
		image_id = IMG_ID_CALL_REJECT_NORMAL;
	}
	
	gdi_layer_push_and_set_clip(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
	gdi_draw_solid_rect(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
	gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, image_id);
	gdi_layer_pop_clip();
	gdi_layer_blt_previous(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
}

/*****************************************************************************
 * FUNCTION
 *  ShowInCallVolBar
 * DESCRIPTION
 *  show volume bar in call screen
 * PARAMETERS
 *  max_level [IN] max volume level
 *  cur_level [IN] current volume level
 *  is_show   [IN] show volume or not
 * RETURNS
 *  void
 *****************************************************************************/
void ShowInCallVolBar(U16 max_level, U16 cur_level, MMI_BOOL is_show)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(g_in_call_vol_bar_is_show == is_show)
		return;
	
	if(is_show)
	{
		UpdateInCallVolBar(max_level, cur_level);
	}
	else
	{
		g_in_call_vol_bar_is_show = 0;
		g_in_call_max_level = 0;
		g_in_call_cur_level = 0;
		
		gdi_layer_lock_frame_buffer();
		if(CM_caller_buffer1[0] == '\0')
		{
			
			gdi_layer_push_and_set_clip(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1);
			gui_fill_rectangle(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1, gui_color(0, 0, 0));
			gdi_layer_pop_clip();

		}
		else
		{

			gdi_layer_push_and_set_clip(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1);
			if(held_is_pressed)
			{
				gui_fill_rectangle(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT, gui_color(255, 150, 0));
			}
			else
			{
				gui_fill_rectangle(0, 0, HELD_ICON_X - 1, HELD_AREAR_HEIGHT, gui_color(0, 180, 255));	
			}
			gui_fill_rectangle(0, HELD_AREAR_HEIGHT + 1, HELD_ICON_X - 1, UI_device_height - 1, gui_color(0, 0, 0));
			gdi_layer_pop_clip();

		}
		gdi_layer_unlock_frame_buffer();
		
		gdi_layer_blt_previous(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1);
	}

}
/*****************************************************************************
 * FUNCTION
 *  DrawInCallVolBar
 * DESCRIPTION
 *  draw volume bar.
 * PARAMETERS
 *  max_level [IN] max volume level
 *  cur_level [IN] current volume level
 * RETURNS
 *  void
 *****************************************************************************/
static void DrawInCallVolBar(U16 max_level, U16 cur_level)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 level_image_width, level_image_height;
	S32 step_size, draw_height;
	GDI_HANDLE active_layer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_get_active(&active_layer);
    gdi_push_and_set_alpha_blending_source_layer(active_layer);
	gdi_layer_push_and_set_clip(0, 0, ACTIVE_TEXT_X - 1 , UI_device_height - 1);

	gdi_image_draw_id(VOL_BAR_H_X, VOL_BAR_H_Y, IMG_ID_CALL_VOL_BG);

	//get level image width and height
	gui_measure_image((PU8)get_image(IMG_ID_CALL_VOL), &level_image_width, &level_image_height);
	//draw level image 
	step_size = level_image_height / max_level;
	if (max_level != cur_level)
	{
		draw_height = cur_level * step_size;
	}
	else
	{
		draw_height = level_image_height;
	}
	draw_height = level_image_height - draw_height;
	if(draw_height > 0)
	{
		gdi_image_draw_resized_id(VOL_BAR_H_X,
				VOL_BAR_H_Y , level_image_width, draw_height, IMG_ID_CALL_VOL);
	}
	gdi_layer_pop_clip();
	
    gdi_pop_and_restore_alpha_blending_source_layer();
}

/*****************************************************************************
 * FUNCTION
 *  UpdateInCallVolBar
 * DESCRIPTION
 *  update volume bar in call screen
 * PARAMETERS
 *  max_level [IN] max volume level
 *  cur_level [IN] current volume level
 * RETURNS
 *  void
 *****************************************************************************/
void UpdateInCallVolBar(U16 max_level, U16 cur_level)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
	/*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(cur_level > max_level)
		return;
	
	g_in_call_vol_bar_is_show = 1;
	g_in_call_max_level = max_level;
	g_in_call_cur_level = cur_level;
	gdi_layer_lock_frame_buffer();
	
	gdi_layer_push_and_set_clip(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1);

	if(CM_caller_buffer1[0] != '\0')
	{
		if(held_is_pressed)
		{
			gui_fill_rectangle(0, 0, HELD_ICON_X - 1, HELD_AREAR_HEIGHT, gui_color(255, 150, 0));
		}
		else
		{
			gui_fill_rectangle(0, 0, HELD_ICON_X - 1, HELD_AREAR_HEIGHT, gui_color(0, 180, 255));	
		}
		gui_fill_rectangle(0, HELD_AREAR_HEIGHT + 1, HELD_ICON_X - 1, UI_device_height - 1, gui_color(0, 0, 0));
		

	}
	else
	{
	
		gui_fill_rectangle(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1, gui_color(0, 0, 0));

	}
	gdi_layer_pop_clip();
	DrawInCallVolBar(max_level, cur_level);
	gdi_layer_unlock_frame_buffer();

	gdi_layer_blt_previous(0, 0, ACTIVE_TEXT_X - 1, UI_device_height - 1);

}

/*****************************************************************************
 * FUNCTION
 *  wgui_category_9023_draw_held_area
 * DESCRIPTION
 *  This function is used to draw held area of 9023 screen
 * PARAMETERS
 *  held index      [IN]
 *  is_select       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_category_9023_draw_held_area(MMI_BOOL is_select)
{
	 /*----------------------------------------------------------------*/
	/* Local Variables												  */
	/*----------------------------------------------------------------*/
	S32 tx, ty, sw, sh;
	color text_color = gui_color(255, 255, 255);	 
	 /*----------------------------------------------------------------*/
	 /* Code Body											 ;			*/
	 /*----------------------------------------------------------------*/
	 
	if(g_held_call_index == 2) 
		return;
	
	if(!g_held_call_icon_id)
		g_held_call_icon_id = g_wgui_cat9023_CM[g_held_call_index].held_call_icon;

	{
		U8 *icon;
		S32 icon_x, icon_y;
		S32 icon_width, icon_height;
		
		icon = (U8*)get_image(g_held_call_icon_id);
		gui_measure_image(icon, &icon_width, &icon_height);
		icon_x = HELD_ICON_X/*+ (HELD_ICON_WIDTH - icon_width) >> 1*/;
		icon_y = HELD_ICON_Y /*+ (HELD_AREAR_HEIGHT - icon_height) >> 1*/;
		
		gdi_layer_push_and_set_clip(icon_x, icon_y, icon_x + icon_width, icon_y + icon_height);
		gdi_image_draw(icon_x, icon_y, icon);
		gdi_layer_pop_clip();

	}
	if(!is_select)
	{
		draw_scrolling_text_background_held_call(HELD_TEXT_X, 0, UI_device_width, HELD_AREAR_HEIGHT);
 	}	
	gui_push_text_clip();
	gui_set_font(&MMI_large_font);
	gui_set_text_color(text_color);
	gui_measure_string((UI_string_type)CM_caller_buffer1, &sw, &sh);
	ty = HELD_TEXT_Y + (HELD_AREAR_HEIGHT - sh) >> 1;
	gui_set_text_clip(HELD_TEXT_X, ty, UI_device_width, HELD_AREAR_HEIGHT);
	gui_move_text_cursor(HELD_TEXT_X , ty);
	if(!is_select)
    {
    	gui_create_scrolling_text(&gui_scrolling_text_ctxt,  
					   HELD_TEXT_X,
					   ty, 
					   UI_device_width - HELD_TEXT_X,
					   sh,
                       (UI_string_type)CM_caller_buffer1, 
                       wgui_scrolling_text_timer_callback, 
                       draw_scrolling_text_background_held_call,
                       gui_color(255, 255, 255), 
                       gui_color(255, 255, 255));
	   
		gui_scrolling_text_ctxt.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;	
		gui_show_scrolling_text(&gui_scrolling_text_ctxt);
	}
	else
	{		
		gui_print_truncated_text(HELD_TEXT_X, 
						ty, 
						HELD_AREAR_WIDTH - HELD_TEXT_X, 
						(UI_string_type)CM_caller_buffer1);
	}
    gui_pop_text_clip();
}
/*****************************************************************************
 * FUNCTION
 *  wgui_category_9023_draw_category_control_area_for_wearable
 * DESCRIPTION
 *  This function is used to draw the category controlled area of 9023 screen
 * PARAMETERS
 *  coordinate      [IN/OUT]        Coordinates of category controlled area.
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_category_9023_draw_category_control_area_for_wearable(dm_coordinates *coordinate)
{
     /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U16 imag_id = 0, end_image_id;
    color text_color; 
	GDI_HANDLE active_layer;	
    S32 tx, ty, sw, sh;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                            ;          */
    /*----------------------------------------------------------------*/    

    if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_ACTIVE_CALL )
	{
		g_active_call_index = 0;
	}
	else if( g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_ACTIVE_CALL)
	{
		g_active_call_index = 1;
	}
    
	if(g_wgui_cat9023_CM[0].call_flag == WGUI_CAT9023_HELD_CALL )
	{
		g_held_call_index = 0;
	}
	else if(g_wgui_cat9023_CM[1].call_flag == WGUI_CAT9023_HELD_CALL)
	{
		g_held_call_index = 1;
	}
	
    text_color = gui_color(255, 255, 255);
	gdi_layer_lock_frame_buffer();
	
	gdi_layer_reset_clip();
	
	gui_fill_rectangle(0, 0, UI_device_width - 1, UI_device_height - 1, gui_color(0, 0, 0));
	
	if(CM_caller_buffer1[0] == '\0')
	{
		S32 image_width, image_height, image_offset_x;
		/* draw caller icon */
		
		gdi_image_get_dimension_id(g_wearable_in_call_iamge_id, &image_width, &image_height);
		image_offset_x = (CAT_IMAGE_W - image_width) >> 1;
		gdi_layer_get_active(&active_layer);
        gdi_push_and_set_alpha_blending_source_layer(active_layer);
		gdi_layer_push_and_set_clip(CAT_IMAGE_X, 
						CAT_IMAGE_Y,
						CAT_IMAGE_X + CAT_IMAGE_W,
						CAT_IMAGE_Y + CAT_IMAGE_H);
		gdi_image_draw_id(CAT_IMAGE_X + image_offset_x, 
					CAT_IMAGE_Y,  
					g_wearable_in_call_iamge_id);
		
		gdi_layer_pop_clip();
		gdi_pop_and_restore_alpha_blending_source_layer();

	}
	else
	{
		
		gdi_layer_push_and_set_clip(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT);
		gui_fill_rectangle(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT, gui_color(0, 180, 255));
		wgui_category_9023_draw_held_area(MMI_FALSE);
		gdi_layer_pop_clip();
	}
 
	gui_push_text_clip();
	gui_set_font(&MMI_large_font);
	gui_set_text_color(text_color);
	gui_measure_string((UI_string_type)CM_caller_buffer, &sw, &sh);

	tx = (UI_device_width - sw) > 0 ? ((UI_device_width - sw) >> 1) : ACTIVE_TEXT_X;
    gui_set_text_clip(ACTIVE_TEXT_X, ACTIVE_TEXT_Y, UI_device_width, ACTIVE_TEXT_Y + sh);
    gui_create_scrolling_text(&gui_scrolling_text_ctxt_2, 
					tx,
                  	ACTIVE_TEXT_Y,
                  	UI_device_width - ACTIVE_TEXT_X - ACTIVE_TEXT_X , 
                  	sh,
                  	(UI_string_type)CM_caller_buffer, 
                  	wgui_scrolling_text_timer_callback_2,
                  	draw_scrolling_text_background_active_call,
                  	gui_color(255, 255, 255), 
                  	gui_color(255, 255, 255));
    gui_move_text_cursor(tx , ACTIVE_TEXT_Y);
	gui_scrolling_text_ctxt_2.flags &= ~UI_SCROLLING_TEXT_BORDERED_TEXT;	
	gui_show_scrolling_text(&gui_scrolling_text_ctxt_2);
    gui_pop_text_clip();
	
	if(g_in_call_vol_info_show)
	{
		S32 dstr_sw, dtr_sh;
		gui_set_font(&MMI_small_font);
		gui_measure_string((UI_string_type)get_string(STR_ID_SWATCH_VOL_INFO_CONTENT), &dstr_sw, &dtr_sh);
		tx = (UI_device_width - dstr_sw) >> 1;
		ty = ACTIVE_TEXT_Y + sh + ACTIVE_DURATION_H_GAP;
		gui_push_text_clip();
		gui_set_text_clip(tx, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
		gui_move_text_cursor(tx , ty);	
		gui_set_text_color(gui_color(255, 255, 255));
		gui_print_text(get_string(STR_ID_SWATCH_VOL_INFO_CONTENT));
		gui_pop_text_clip();
	}
	else
	{
	    if(g_active_call_index == 2)        
		{
			if(g_held_call_index == 0 || g_held_call_index == 1)
			{			
				S32 sw_text, sh_text;
				S32 dstr_sw, dtr_sh;
				gui_measure_string((UI_string_type)g_wgui_cat9023_CM[g_held_call_index].held_call_str, &sw_text, &sh_text);
				main_LCD_measure_time_duration_string(&dstr_sw, &dtr_sh);
				tx = (UI_device_width - dstr_sw - sw_text + ACTIVE_DURATION_HELD_GAP) >> 1;
				ty = ACTIVE_TEXT_Y + sh + ACTIVE_DURATION_H_GAP;

				gui_push_text_clip();
				gui_set_text_clip(ACTIVE_DURATION_X, ty , UI_device_width, ty + ACTIVE_DURATION_HEIGHT);
				gui_move_text_cursor(tx , ty);
				gui_set_font(&MMI_medium_font);
				gui_set_text_color(text_color);
				gui_print_text((UI_string_type)g_wgui_cat9023_CM[g_held_call_index].held_call_str);
				gui_pop_text_clip();

				tx += sw_text + ACTIVE_DURATION_HELD_GAP;
				set_main_lcd_duration_position(tx, ty);
	    		dt_update_duration();		
			}
		}	
		else
		{
			S32 dstr_sw, dtr_sh;
			main_LCD_measure_time_duration_string(&dstr_sw, &dtr_sh);
			tx = (UI_device_width - dstr_sw) >> 1;
			ty = ACTIVE_TEXT_Y + sh + ACTIVE_DURATION_H_GAP;;
			set_main_lcd_duration_position(tx, ty);
	        dt_update_duration();
		}
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	if(g_in_call_mute_status == 0)
	{
		imag_id = IMG_ID_CALL_MUTE_ON;
	}
	else if(g_in_call_mute_status == 1)
	{
		imag_id = IMG_ID_CALL_MUTE_OFF;
	}
	else if(g_in_call_mute_status == 2)
	{
		imag_id = IMG_ID_CALL_UNHOLD_NORMAL;
	}
	
	end_image_id = g_in_call_endbutton_status ? IMG_ID_CALL_REJECT_NORMAL : IMG_ID_CALL_REJECT_DISABLE; 
	gdi_layer_get_active(&active_layer);
	gdi_push_and_set_alpha_blending_source_layer(active_layer);

	gdi_layer_push_and_set_clip(CAT_ICON_X, 
					CAT_ICON_Y,
					UI_device_width - CAT_ICON_X,
					CAT_ICON_Y + CAT_ICON_H);
	gdi_draw_solid_rect(CAT_ICON_X, 
			CAT_ICON_Y,
			UI_device_width - CAT_ICON_X,
			CAT_ICON_Y + CAT_ICON_H,
			GDI_COLOR_BLACK);

	gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, imag_id);
	
	gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, end_image_id);
	gdi_layer_pop_clip();
	gdi_pop_and_restore_alpha_blending_source_layer();
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9023_wearable_pen_up_hdlr
 * DESCRIPTION
 *  pen up handler
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_cat9023_wearable_pen_up_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(held_is_pressed && point.x >= 0 && point.x <= HELD_AREAR_WIDTH
		&& point.y >= 0 && point.y <= HELD_AREAR_HEIGHT)
	{
		//held_is_pressed = 0;
	#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
	#endif
		if(in_call_swap_handler != NULL)
			in_call_swap_handler();
		//return MMI_TRUE;
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	else if(g_press_lbutton && point.x >= CAT_ICON_X && point.x <= (CAT_ICON_X + CAT_ICON_W) && 
		point.y >= CAT_ICON_Y && point.y <= CAT_ICON_Y + CAT_ICON_H)
	{		
		g_press_lbutton = 0;
	
		if(in_call_mute_handler != NULL)
		{	
			in_call_mute_handler();
		}
		//return MMI_TRUE;
	}
	else if(g_press_rbutton && point.x >= (UI_device_width - CAT_ICON_X - CAT_ICON_W) 
		&& point.x <= (UI_device_width - CAT_ICON_X ) 
		&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H))
	{
		g_press_rbutton = 0;
		if(in_call_end_handler != NULL)
		{
			in_call_end_handler();
		}
		//return MMI_TRUE;
	}
	else if(g_press_lbutton || g_press_rbutton)
	{
		U16 imag_id = 0;
		if(g_in_call_mute_status == 0)
		{
			imag_id = IMG_ID_CALL_MUTE_ON;
		}
		else if(g_in_call_mute_status == 1)
		{
			imag_id = IMG_ID_CALL_MUTE_OFF;
		}
		else if(g_in_call_mute_status == 2)
		{
			imag_id = IMG_ID_CALL_UNHOLD_NORMAL;
		}
		gdi_layer_push_and_set_clip(CAT_ICON_X, 
					CAT_ICON_Y,
					UI_device_width - CAT_ICON_X,
					CAT_ICON_Y + CAT_ICON_H);
		gdi_draw_solid_rect(CAT_ICON_X, 
					CAT_ICON_Y,
					UI_device_width - CAT_ICON_X,
					CAT_ICON_Y + CAT_ICON_H,
					GDI_COLOR_BLACK);

		gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, imag_id);
		gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_NORMAL);
		gdi_layer_pop_clip();
		
	    gdi_layer_blt_previous(CAT_ICON_X, 
					CAT_ICON_Y,
					UI_device_width - CAT_ICON_X,
					CAT_ICON_Y + CAT_ICON_H);
		g_press_lbutton = 0;
		g_press_rbutton = 0;
		//return MMI_TRUE;
	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	if(in_call_pen_up_handler != NULL)
		in_call_pen_up_handler(point);
	if(held_is_pressed)
		held_is_pressed = 0;
    return MMI_TRUE;
}
/*****************************************************************************
 * FUNCTION
 *  wgui_cat9023_wearable_pen_down_hdlr
 * DESCRIPTION
 *  pen down handler
 * PARAMETERS
 *  point  [IN]  pen position
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL wgui_cat9023_wearable_pen_down_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 held_call_index = 2;
	GDI_HANDLE active_layer;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(CM_caller_buffer1[0] != '\0'
		&& (point.x >= 0 && point.x <= HELD_AREAR_WIDTH)
		&& (point.y >= 0 && point.y <= HELD_AREAR_HEIGHT)
		&& !g_in_call_redrawing)
	{
		held_is_pressed = 1;
		gui_cancel_timer(wgui_scrolling_text_timer_callback);
		
		gdi_layer_lock_frame_buffer();
		gdi_layer_reset_clip();	
		gdi_layer_push_and_set_clip(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT);
		gui_fill_rectangle(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT, gui_color(255, 150, 0));//(0,90,127);
		wgui_category_9023_draw_held_area(MMI_TRUE);
		gdi_layer_pop_clip();
		if(g_in_call_vol_bar_is_show)
		{
			DrawInCallVolBar(g_in_call_max_level, g_in_call_cur_level);
		}
		gdi_layer_unlock_frame_buffer();
    	gdi_layer_blt_previous(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_WIDTH);
		//return MMI_TRUE;
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
    else if(point.x >= CAT_ICON_X && point.x <= (CAT_ICON_X + CAT_ICON_W) 
			&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H)
			&& !g_in_call_redrawing)
    {
		U16 imag_id = 0;
		if(g_in_call_mute_status == 0)
		{
			imag_id = IMG_ID_CALL_MUTE_ON_PRESS;
		}
		else if(g_in_call_mute_status == 1)
		{
			imag_id = IMG_ID_CALL_MUTE_OFF_PRESS;
		}
		else if(g_in_call_mute_status == 2)
		{
			imag_id = IMG_ID_CALL_UNHOLD_PRESS;
		}
		gdi_layer_get_active(&active_layer);
        gdi_push_and_set_alpha_blending_source_layer(active_layer);

		gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X - CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H);
		gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X - CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
							
		gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, imag_id);
		
		gdi_layer_pop_clip();
		
		gdi_pop_and_restore_alpha_blending_source_layer();

		gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X - CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H);
		

		g_press_lbutton = 1;
		g_press_rbutton = 0;
		//return MMI_TRUE;
	}
	else if(point.x >= (UI_device_width - CAT_ICON_X - CAT_ICON_W) && point.x <= (UI_device_width - CAT_ICON_X ) 
			&& point.y >= CAT_ICON_Y && point.y <= (CAT_ICON_Y + CAT_ICON_H) 
			&& g_in_call_endbutton_status && !g_in_call_redrawing)
	{
		gdi_layer_get_active(&active_layer);
        gdi_push_and_set_alpha_blending_source_layer(active_layer);

		gdi_layer_push_and_set_clip(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
		gdi_draw_solid_rect(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
				
		gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_PRESS);		
		
		gdi_layer_pop_clip();
		
		gdi_pop_and_restore_alpha_blending_source_layer();
		
		gdi_layer_blt_previous(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);


		g_press_lbutton = 0;
		g_press_rbutton = 1;

		//return MMI_TRUE;
	}
	else
	{
		g_press_lbutton = 0;
		g_press_rbutton = 0;
	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	if(in_call_pen_down_handler != NULL)
		in_call_pen_down_handler(point);

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9023_wearable_pen_move_hdlr
 * DESCRIPTION
 *  pen move handler
 * PARAMETERS
 *  point   [IN] pen position
 * RETURNS
 *  whether to handle this event
 *****************************************************************************/
static MMI_BOOL wgui_cat9023_wearable_pen_move_hdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 x_offset = 0;
	S16 tx = 0;
	U16 tw = 0;
	GDI_HANDLE active_layer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(held_is_pressed)
	{
		if(!((point.x >= 0 && point.x <= HELD_AREAR_WIDTH)
			&& (point.y >= 0 && point.y <= HELD_AREAR_HEIGHT)))
		{
			held_is_pressed = 0;
			gdi_layer_lock_frame_buffer();
			gdi_layer_reset_clip();
			
			gdi_layer_push_and_set_clip(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT);
			gui_fill_rectangle(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT, gui_color(0, 180, 255));
			wgui_category_9023_draw_held_area(MMI_FALSE);
			gdi_layer_pop_clip();
			if(g_in_call_vol_bar_is_show)
			{
				DrawInCallVolBar(g_in_call_max_level, g_in_call_cur_level);
			}
			gdi_layer_unlock_frame_buffer();
	    	gdi_layer_blt_previous(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_WIDTH);
			//return MMI_TRUE;
		}
	}
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	else if(g_press_lbutton && (point.x < CAT_ICON_X  || point.x > (CAT_ICON_X + CAT_ICON_W) 
		|| point.y < CAT_ICON_Y || point.y > (CAT_ICON_Y + CAT_ICON_H)))
	{
		U16 imag_id = 0;
		if(g_in_call_mute_status == 0)
		{
			imag_id = IMG_ID_CALL_MUTE_ON;
		}
		else if(g_in_call_mute_status == 1)
		{
			imag_id = IMG_ID_CALL_MUTE_OFF;
		}
		else if(g_in_call_mute_status == 2)
		{
			imag_id = IMG_ID_CALL_UNHOLD_NORMAL;
		}
		gdi_layer_get_active(&active_layer);
        gdi_push_and_set_alpha_blending_source_layer(active_layer);
		gdi_layer_push_and_set_clip(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X -  CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H);
		gdi_draw_solid_rect(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X -  CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
							
		gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, imag_id);
		
		gdi_layer_pop_clip();
		
		gdi_pop_and_restore_alpha_blending_source_layer();
		gdi_layer_blt_previous(CAT_ICON_X, CAT_ICON_Y, UI_device_width - CAT_ICON_X -  CAT_ICON_W - 1, CAT_ICON_Y + CAT_ICON_H);
		g_press_lbutton = 0;
	}
	else if(g_press_rbutton && (point.x <(UI_device_width - CAT_ICON_X - CAT_ICON_W)  
		|| point.x > (UI_device_width - CAT_ICON_X) 
		|| point.y < CAT_ICON_Y || point.y > (CAT_ICON_Y + CAT_ICON_H)))
	{
	
		gdi_layer_get_active(&active_layer);
		gdi_push_and_set_alpha_blending_source_layer(active_layer);
		gdi_layer_push_and_set_clip(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
		gdi_draw_solid_rect(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H, GDI_COLOR_BLACK);
							
		gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_NORMAL);		
		
		gdi_layer_pop_clip();
		
		gdi_pop_and_restore_alpha_blending_source_layer();
		gdi_layer_blt_previous(CAT_ICON_X + CAT_ICON_W + 1, CAT_ICON_Y, UI_device_width - 1, CAT_ICON_Y + CAT_ICON_H);
		g_press_rbutton = 0;
	}
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	if(in_call_pen_move_handler != NULL)
		in_call_pen_move_handler(point);

    return MMI_TRUE;
}

/*****************************************************************************
 * FUNCTION
 *  wgui_cat9023_show_ex
 * DESCRIPTION
 *  Display active call screen for wearable device
 * PARAMETERS
 *  left_softkey                [IN]        Left softkey label
 *  right_softkey               [IN]        Right softkey label
 *  default_image_id			[IN]		image 
 *  CM_info                     [IN]        Call inforamtion
 *  history_buffer              [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_cat9023_show_ex(
                U16  left_softkey,
                U16  right_softkey,
                U16  default_image_id,
                wgui_cat9023_call_info_struct *CM_info,
                U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	g_wearable_in_call_iamge_id = default_image_id;
	g_in_call_redrawing = 0;
	g_active_call_index = 2;
	g_held_call_index = 2;
#ifndef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	if(right_softkey != 0)
		g_Cat_is_end_call_key = 1;
	else
		g_Cat_is_end_call_key = 0;
#endif
	wgui_cat9023_show(left_softkey, right_softkey, CM_info, history_buffer);
}

/*****************************************************************************
 * FUNCTION
 *  RedrawCat9023
 * DESCRIPTION
 *  redraw category 9023
 * PARAMETERS
 *  string_id                [IN]        new string info
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawCat9023Screen(U16 string_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U16 imag_id = 0;
	S32 sw_text, sh_text;
	S32 sw, sh;
	S32 tx, ty;
	GDI_HANDLE active_layer;
	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
	g_in_call_redrawing = 1;
	gui_cancel_timer(dt_update_duration);

	gdi_layer_lock_frame_buffer();		
	gdi_layer_reset_clip();
	gdi_layer_set_opacity(MMI_TRUE, 125);
	if(CM_caller_buffer1[0] != '\0')
	{
		gdi_layer_push_and_set_clip(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT);
		gui_fill_rectangle(0, 0, HELD_AREAR_WIDTH, HELD_AREAR_HEIGHT, gui_color(0, 180, 255));	
		wgui_category_9023_draw_held_area(MMI_FALSE);
		gdi_layer_pop_clip();
	}
	gui_set_font(&MMI_large_font);
	gui_measure_string((UI_string_type)CM_caller_buffer, &sw, &sh);
	ty = ACTIVE_TEXT_Y + sh + ACTIVE_DURATION_H_GAP;

	gui_set_font(&MMI_medium_font);
	gui_set_text_color(gui_color(255, 255, 255));		
	gui_measure_string((UI_string_type)get_string(string_id), &sw_text, &sh_text);	
	tx = (UI_device_width - sw_text) >> 1;
	
	gdi_layer_push_and_set_clip(0, ty, UI_device_width - 1, CAT_ICON_Y - 1);
	
	gui_fill_rectangle(0, ty, UI_device_width - 1, CAT_ICON_Y - 1, gui_color(0, 0, 0));
	gui_print_truncated_text(tx, ty, sw_text, get_string(string_id));
	gdi_layer_pop_clip();
#ifdef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__			
	if(g_in_call_mute_status == 0)
	{
		imag_id = IMG_ID_CALL_MUTE_ON;
	}
	else if(g_in_call_mute_status == 1)
	{
		imag_id = IMG_ID_CALL_MUTE_OFF;
	}
	else if(g_in_call_mute_status == 2)
	{
		imag_id = IMG_ID_CALL_UNHOLD_NORMAL;
	}
	gdi_layer_get_active(&active_layer);
	gdi_push_and_set_alpha_blending_source_layer(active_layer);
	gdi_layer_push_and_set_clip(CAT_ICON_X, 
				CAT_ICON_Y,
				UI_device_width - CAT_ICON_X,
				CAT_ICON_Y + CAT_ICON_H);
	gdi_draw_solid_rect(CAT_ICON_X, 
				CAT_ICON_Y,
				UI_device_width - CAT_ICON_X,
				CAT_ICON_Y + CAT_ICON_H,
				GDI_COLOR_BLACK);
	
	gdi_image_draw_id(CAT_ICON_X, CAT_ICON_Y, imag_id);
	gdi_image_draw_id(UI_device_width - CAT_ICON_X - CAT_ICON_W, CAT_ICON_Y, IMG_ID_CALL_REJECT_NORMAL);
	gdi_layer_pop_clip();	
	gdi_pop_and_restore_alpha_blending_source_layer();
#endif /*__WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__*/
	if(g_in_call_vol_bar_is_show)
	{
		DrawInCallVolBar(g_in_call_max_level, g_in_call_cur_level);
	}

	gdi_layer_unlock_frame_buffer();
		
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
/*****************************************************************************
 * FUNCTION
 *  wgui_cat_is_in_call_cateogry
 * DESCRIPTION
 *  
 * PARAMETERS
 * icontext_button *b
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL wgui_cat_is_in_call_cateogry(icontext_button *b)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
#ifndef __WGUI_CATE_CM_WEARABLE_SOFTKEY_DISABLE__
	if(g_dm_data.s32CatId == MMI_CAT9023_ID
		|| g_dm_data.s32CatId == MMI_CATEGORY18_ID)
	{
		if(g_Cat_is_end_call_key && (b->x + b->width) >= (UI_device_width - 10))
			return MMI_TRUE;
	}
#endif
	return MMI_FALSE;
}
#endif /*__MMI_WEARABLE_DEVICE__*/

