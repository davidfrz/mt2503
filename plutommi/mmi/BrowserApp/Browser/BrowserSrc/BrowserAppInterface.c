/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE.
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * BrowserAppInterface.c
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
*------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

#include "MMI_features.h"
#ifndef MMI_BROWSERAPPINTERFACE_C
#define MMI_BROWSERAPPINTERFACE_C

/*  Include: MMI header file */

#ifdef __MMI_BROWSER_2__
#include "BrowserResDef.h"
#include "BrowserAppCntrlDB.h"
#include "BrowserAppTypes.h"
#include "BrowserAppScrHdlr.h"
#include "BrowserAppMain.h"
#include "BrowserAppInterface.h"
#include "BrowserAppScrDB.h"
#include "BrowserConfig.h"
#include "BrowserAppSrvHdlr.h"
#include "SmsAppGprot.h"
#include "vObjects.h"
#include "ConnectManageGprot.h"
#include "BookmarkCuiGprot.h"
#include "ServiceDefs.h" /* for the services_wap_string_id */
#if !defined(__MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__)
#include "SmsCuiGprot.h"
#endif
#include "CbmSrvGprot.h"  /* For CBM related APIs and enum */
#include "CbmCuiGprot.h"  /* For the CBM CUI related APIs */
#ifdef __MMI_OPP_SUPPORT__
#include "Btsendcuigprot.h"
#endif /* __MMI_OPP_SUPPORT__ */

#include "SMSAppGprot.h"
#include "EmailAppGprot.h"
#include "RestoreGprot.h"
#include "FileMgrCUIGProt.h"
#include "Drm_gprot.h"
#include "kal_general_types.h"
#include "mmi_frm_scenario_gprot.h"
#include "MMIDataType.h"
#include "wap_mem_cfg.h"
#include "BrowserSrvConfig.h"
#include "mmi_rp_app_browser_def.h"
#include "GlobalConstants.h"
#include "wgui_categories_util.h"
#include "BrowserSrvProts.h"
#include "MMI_inet_app_trc.h"
#include "DebugInitDef_Int.h"
#include "kal_trace.h"
#include "BrowserAppUIDraw.h"
#include "CustDataRes.h"
#include "GlobalResDef.h"
#include "mmi_frm_events_gprot.h"
#include "wap_adp.h"
#include "app_mem.h"
#include "mmi_frm_mem_gprot.h"
#include "kal_public_api.h"
#include "browser_api.h"
#include "UcmSrvGprot.h"
#include "UriAgentSrvGprot.h"
#include "WAPProfileSrvType.h"
#include "WAPProfileSrvGprot.h"
#include "BrowserSrvInterface.h"
#include "stack_config.h"
#include "cbm_api.h"
#include "DLAgentSrvDef.h"
#include "BrowserSrvBookmarks.h"
#include "string.h"
#include "app_buff_alloc.h"
#include "App_ltlcom.h"
#include "bam_struct.h"
#include "drm_def.h"
#include "FileMgrSrvGProt.h"
#include "mmi_rp_file_type_def.h"
#include "Unicodexdcl.h"
#include "smsal_l4c_enum.h"
#include "mms_api.h"
#include "fs_func.h"
#include "gui_data_types.h"
#include "fs_type.h"
#include "stdio.h"
#include "fs_errcode.h"
#include "custom_nvram_config.h"
#include "Conversions.h"
#include "vBookmark.h"
#include "custom_wap_config.h"
#include "wgui_include.h"
#include "gui_switch.h"
#include "wgui.h"
#include "gui.h"
#include "gui_typedef.h"
#include "CustMenuRes.h"
#include "SmsSrvGprot.h"
#include "DtcntSrvGprot.h"
#include "SimCtrlSrvGprot.h"
#include "NwUsabSrvGprot.h"
#include "BrowserSrvMain.h"
#include "BrowserSrvMsgHdlr.h"
#include "BrowserSrvSettings.h"
#include "ModeSwitchSrvGProt.h"
#include "BrowserAppDMgr.h"
#include "das_struct.h"
#include "NetSetSrvGprot.h"

extern void HDIa_widgetContentChangeNotifyFlagSet(void);

#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__)
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_enter_web_address
 * DESCRIPTION
 *  This function is used by other orange homescreen to launch the Input address
 * of browser
 * PARAMETERS
 *  void
 * RETURNS
 *  S32     : Memory Pool SIze
 *****************************************************************************/
void mmi_brw_enter_web_address(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.brw_launching_pad = BRW_LPD_HOME_SCR_ENTER_ADDRESS;
    g_brw_app_cntx.isBookmarkLaunched = MMI_TRUE ;
    mmi_brw_app_common_gateway();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_enter_user_defined_bookmark_list
 * DESCRIPTION
 *  returns the number of user defined bookmarks
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_enter_user_defined_bookmark_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.brw_launching_pad = BRW_LPD_HOME_SCR_USER_DEFINED_BKM;
    g_brw_app_cntx.isBookmarkLaunched = MMI_TRUE ;
    mmi_brw_app_common_gateway();
}
#endif/* defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_scrn_is_present
 * DESCRIPTION
 *  This function is used to check if browser screen is presented in history 
 *  stack/scenario tree or not.
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  0: FASLE; 1: TRUE
 *****************************************************************************/
kal_bool mmi_brw_scrn_is_present(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(mmi_frm_scrn_is_present(BRW_RENDERED_PAGE_GRP_ID, mmi_brw_get_screen_id(), MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
    {
        return KAL_TRUE;
    }
    else
    {
        return KAL_FALSE;
    }    	
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_get_asm_memory_pool_size
 * DESCRIPTION
 *  This function is used by other applications to know the size of ASM Pool 
 *  that is used by Browser
 * PARAMETERS
 *  void
 * RETURNS
 *  S32     : Memory Pool SIze
 *****************************************************************************/
S32 mmi_brw_get_asm_memory_pool_size(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return BROWSER_POOL_SIZE ;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_rendered_page_active
 * DESCRIPTION
 *  This function is to check if the Browser rendered page screen is
 * currently active or not
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_brw_is_rendered_page_active(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BROWSER_MAIN || mmi_frm_scrn_get_active_id() == mmi_brw_app_get_splash_scr_id())
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_rendered_page_active
 * DESCRIPTION
 *  This function is to check if the Browser rendered page screen is
 * currently active or not
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_brw_is_rendered_page_open(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_is_present (BRW_RENDERED_PAGE_GRP_ID, mmi_brw_get_screen_id(), MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG) || mmi_brw_is_rendered_page_active())
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_ren_page_clear_keys
 * DESCRIPTION
 *  This function is to check if the Browser rendered page screen has been 
 * displayed or not (means either active or in history)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_ren_page_clear_keys(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_brw_is_rendered_page_active())
    {
        SetLeftSoftkeyFunction(NULL, KEY_EVENT_UP);
        SetRightSoftkeyFunction(NULL, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_full_screen
 * DESCRIPTION
 *  Function to return the select bookmark screen ID
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U8 mmi_brw_is_full_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_srv_brw_cntx.screen_size_status;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_get_top_screen_id
 * DESCRIPTION
 *  This function is the interface function to enter the Internet services
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_get_top_screen_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_brw_app_get_top_screen_id();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_in_transaction
 * DESCRIPTION
 *  This function is the interface function to enter the Internet services
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
MMI_BOOL mmi_brw_is_in_transaction(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_srv_brw_cntx.srv_brw_dynamic_cntx_p)
    {
        return (g_srv_brw_cntx.srv_brw_dynamic_cntx_p->isBrowserFetching);
    }
    else
    {
        return MMI_FALSE;
    }

}


#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_open_file_from_fmgr
 * DESCRIPTION
 *  This function is the interface function to enter the Internet services
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_open_file_from_fmgr(void *fullname, int is_short)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 temp[20];
    S32 return_val = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!fullname)
    {
        mmi_frm_scrn_close_active_id();
    }

    mmi_asc_to_ucs2((S8*) temp, (S8*) "file:\\\\\\");
    mmi_ucs2cpy((S8*) g_brw_open_file_cntx.file_path, (S8*) temp);
    mmi_ucs2cat((S8*) g_brw_open_file_cntx.file_path, (S8*) fullname);
    return_val = mmi_charset_ucs2_to_utf8_length_in_bytes((kal_uint8*) g_brw_open_file_cntx.file_path);
    if (return_val <= WAP_BAM_MAX_FILE_PATH_LEN)
    {
        /* if a live browser instance is already there then simply fetch the url */
        if (mmi_brw_is_browser_active())
        {
            mmi_brw_srv_hdlr_load_data_req();
            mmi_brw_app_pre_entry_render_page();
        }
        else
        {
            g_brw_app_cntx.brw_launching_pad = BRW_LPD_EXTERNAL_LOAD_DATA_REQ;
            mmi_brw_app_common_gateway();
        }
    }
    else
    {
        mmi_brw_app_ui_draw_display_popup_ext(
            STR_ID_BRW_FILE_PATH_TOO_LONG,
            MMI_EVENT_PROPLEM);
    }
}
#endif /* OBIGO_Q05A */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_pre_entry_internet_services
 * DESCRIPTION
 *  This function is the interface function to enter the Internet services
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
MMI_ID mmi_brw_pre_entry_internet_services(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
     MMI_ID brw_grp_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.brw_launching_pad = BRW_LPD_MAIN_MENU;
    brw_grp_id = mmi_brw_app_common_gateway();
    return brw_grp_id;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_browser_app_launch_func
 * DESCRIPTION
 *  This function is the interface function to enter the Internet services
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
MMI_ID mmi_browser_app_launch_func(void* param, U32 param_size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID brw_grp_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    brw_grp_id = mmi_brw_pre_entry_internet_services();
    return brw_grp_id;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_common_gateway
 * DESCRIPTION
 *  This function is the common gateway to enter Browser. The ASM memory will
 * required to run the Browser is taken here.
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
MMI_ID mmi_brw_app_common_gateway(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //void *asm_memory_pool = NULL;
    MMI_ID brw_grp_id = GRP_ID_INVALID;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_COMMON_GATEWAY);

    /* check if any network is available or not */
    if (!mmi_brw_app_is_any_network_available())
    {
    #ifdef __MMI_WLAN_FEATURES__
        if(srv_dtcnt_wlan_status() == SRV_DTCNT_WLAN_STATUS_INACTIVE)
    #endif
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_GLOBAL_CURRENTLY_NOT_AVAILABLE,
                MMI_EVENT_FAILURE);
            return brw_grp_id;
        }
    }

    /* Check if Browser WAP service is ready or not */
    if (!g_srv_brw_cntx.isWapReady || !wap_is_ready())
    {
        mmi_brw_app_ui_draw_display_popup_ext(
            STR_ID_BRW_WAP_NOT_READY,
            MMI_EVENT_FAILURE);
        g_brw_app_cntx.brw_launching_pad = BRW_LPD_NONE;
        return brw_grp_id;
    }
    if(!mmi_frm_group_is_present(BRW_SCREEN_GROUP))
    {
		mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_CLOSE_GROUP_ID, mmi_brw_close_group_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
		mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_SCREEN_GROUP, mmi_brw_internet_service_screen_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
		g_brw_app_cntx.brw_scr_group_id = BRW_SCREEN_GROUP;
        brw_grp_id = BRW_SCREEN_GROUP;
	}

#ifdef __SAT__
    if(g_brw_app_cntx.brw_launching_pad != BRW_LPD_SAT_LAUNCH_REQ)
#endif
    {

#if (MMI_MAX_SIM_NUM >= 2)
        srv_dtcnt_sim_type_enum sim_id;
        srv_dtcnt_get_sim_preference(&sim_id);
        g_srv_brw_cntx.session_sim_id = srv_brw_convert_dtcnt_sim_id_to_sim_setting(sim_id);
#else
        g_srv_brw_cntx.session_sim_id = SRV_BRW_ACTIVE_SIM_SETTING_SIM1;
#endif
    }

    if (g_srv_brw_cntx.brw_instance_id > 0)
    {
        g_brw_app_cntx.common_gateway_flag = MMI_TRUE;

        /* showing the busy screen */
        mmi_brw_app_show_progress_screen(STR_ID_BRW_INTERNET_SERVICES, STR_GLOBAL_PLEASE_WAIT);
        
        return brw_grp_id;
    }
    else
    {
        applib_mem_ap_free_all_cache();
        g_brw_app_memory_pool = applib_asm_alloc_nc_r(
                                APP_BROWSER,
                                BROWSER_POOL_SIZE);
        if (!g_brw_app_memory_pool)
        {
			mmi_frm_group_close(g_brw_app_cntx.brw_scr_group_id);
			g_brw_app_cntx.brw_scr_group_id = GRP_ID_INVALID;
            mmi_frm_appmem_prompt_to_release_mem(
                APP_BROWSER,
                SERVICES_WAP_IMAGE_ID,
                BROWSER_POOL_SIZE,
                mmi_brw_app_asm_success_callback);
            mmi_frm_appmem_set_cancel_callback(APP_BROWSER, mmi_brw_app_asm_cancel_callback);
        }
        else
        {
            mmi_brw_app_create_service_instance();
        }
    }
#if (defined(__SAT__) && defined(__MMI_WLAN_FEATURES__))
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 16, 0, 0, g_srv_brw_cntx.app_type);
    if(g_srv_brw_cntx.app_type == SRV_BRW_APPTYPE_NO_WIFI)
    {
        U8 value = mmi_wap_prof_register_cbm_app_id(MMI_TRUE, 
            srv_brw_convert_sim_setting_to_profile_sim_id(g_srv_brw_cntx.session_sim_id),
            SRV_WAP_PROF_APPID_BRW);
        g_brw_app_cntx.sat_profile_update = MMI_TRUE;
        mmi_brw_app_register_for_bearer_info();
        mmi_brw_app_ui_draw_display_popup_ext(
            STR_ID_BRW_SIM_IN_USE,
            MMI_EVENT_INFO);

        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 14, 0, 0, value);
    }
    else
    {
        if(g_srv_brw_cntx.app_type == SRV_BRW_APPTYPE_WIFI)
        {
            U8 value = mmi_wap_prof_register_cbm_app_id(MMI_FALSE, 
                srv_brw_convert_sim_setting_to_profile_sim_id(g_srv_brw_cntx.session_sim_id),
                SRV_WAP_PROF_APPID_BRW);
            g_srv_brw_cntx.app_type = SRV_BRW_APPTYPE_NONE;
            mmi_brw_app_register_for_bearer_info();
            MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 15, 0, 0, value);
        }
    }
#endif

    return brw_grp_id;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_asm_success_callback
 * DESCRIPTION
 *  This function is the callback function to be passed to the ASM for the 
 * success case
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_asm_success_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* check if any network is available or not */
    if (!mmi_brw_app_is_any_network_available())
    {
    #ifdef __MMI_WLAN_FEATURES__
        if(srv_dtcnt_wlan_status() == SRV_DTCNT_WLAN_STATUS_INACTIVE)
    #endif
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_GLOBAL_CURRENTLY_NOT_AVAILABLE,
                MMI_EVENT_FAILURE);
            return;
        }
    }
    if(!mmi_frm_group_is_present(BRW_SCREEN_GROUP))
    {
        mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_CLOSE_GROUP_ID, mmi_brw_close_group_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
        mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_SCREEN_GROUP, mmi_brw_internet_service_screen_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
        g_brw_app_cntx.brw_scr_group_id = BRW_SCREEN_GROUP;
    }

    g_brw_app_memory_pool = applib_asm_alloc_nc_r(
                            APP_BROWSER,
                            BROWSER_POOL_SIZE);

    MMI_ASSERT(g_brw_app_memory_pool);

#ifdef __MMI_RMGR_SEAMLESS_UNLOCK__
    if(mmi_rmgr_unlock_session_on())
    {
        mmi_rmgr_resume_unlocking();
    }
#endif
    mmi_brw_app_create_service_instance();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_asm_cancel_callback
 * DESCRIPTION
 *  Callback function to be called by the ASM in case the ASM release memory 
 *  procedure is stopped due to some reason
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_asm_cancel_callback(mmi_frm_appmem_evt_struct *cancel_event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_RMGR_SEAMLESS_UNLOCK__
    mmi_rmgr_unlock_session_callback();
#endif
    g_srv_brw_cntx.session_sim_id = SRV_BRW_ACTIVE_SIM_SETTING_TOTAL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_internet_services_menu
 * DESCRIPTION
 *  This function is the interface function to display the Internet services
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_internet_services_menu(void)
{
     mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_INTERNET_SERVICES);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_bookmarks_list
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks list
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_bookmarks_list(void)
{
    U16 ret_code = MMI_BRW_FALSE;
    U16 scr_id = SCR_ID_BRW_BOOKMARKS;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_bookmark_options_menu
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks options
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_bookmark_options_menu(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_BOOKMARK_OPTIONS);
}


#ifndef __MMI_BRW_SLIM_BOOKMARK_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display the Edit Bookmarks 
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_bookmark_screen(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_EDIT_BOOKMARK, g_brw_app_cntx.brw_scr_group_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_add_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display the Add Bookmarks 
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_show_add_bookmark_screen(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_ADD_BOOKMARK, g_brw_app_cntx.brw_scr_group_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_add_to_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display the Add Bookmarks 
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_show_add_to_bookmark_screen(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_ADD_TO_BOOKMARK, g_brw_app_cntx.add_bkm_cid);
}
#endif


#ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_bookmark_browse_path_options
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks Browse Path 
 * Options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_bookmark_browse_path_options(void)
{
     mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_BOOKMARK_BROWSE_PATH_OPTIONS);
}
#endif


#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_bookmark_open_from_fmgr_screen
 * DESCRIPTION
 *  This function is the interface function to display the Open Bookmarks from 
 * FMGR Options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_bookmark_open_from_fmgr_screen(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_BOOKMARK_OPEN_FROM_FMGR);
}
#endif /* __MMI_BRW_BOOKMARK_IN_FMGR__ */


#ifndef __MMI_BRW_RECENT_PAGES_SLIM__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_recent_page_options_menu
 * DESCRIPTION
 *  This function is the interface function to display the Recent Pages Options 
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_recent_page_options_menu(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_RECENT_PAGE_OPTIONS);
}
#endif

#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_page_objects_options
 * DESCRIPTION
 *  This function is the interface function to display the Page Objects
 * Options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_page_objects_options(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_PAGE_OBJECTS_OPTIONS);
}
#endif /* #ifdef OBIGO_Q05A */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_trusted_certificates_options_menu
 * DESCRIPTION
 *  This function is the interface function to display the Trusted Certificates
 * Options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_trusted_certificates_options_menu(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_TRUSTED_CERTIFICATES_OPTIONS);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_stored_page_options_menu
 * DESCRIPTION
 *  This function is the interface function to display the Stored Pages
 * Options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_stored_page_options_menu(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_STORED_PAGE_OPTIONS);
}

#ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_bookmark_browse_path_screen
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks Browser 
 * path options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_bookmark_browse_path_screen(void)
{
    U16 ret_code = MMI_BRW_FALSE;
    U16 scr_id = SCR_ID_BRW_BOOKMARK_BROWSE_PATH;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif


#ifdef __MMI_BRW_BKM_INTERFACE_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_select_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks Select 
 * Bookmark screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_select_bookmark_screen(void)
{
    U16 ret_code = MMI_BRW_FALSE;
    U16 scr_id = SCR_ID_BRW_SELECT_BOOKMARK;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_store_offline_screen
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks Select 
 * Bookmark screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_store_offline_screen(void)
{
    mmi_brw_app_sh_display_fseditor_cui(SCR_ID_BRW_EDIT_STORE_OFFLINE);
}


#ifndef __MMI_BRW_RECENT_PAGES_SLIM__
#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_recent_pages_host_screen
 * DESCRIPTION
 *  This function is the interface function to display the Bookmarks Select 
 * Bookmark screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_recent_pages_host_screen(void)
{
    U16 ret_code = MMI_BRW_FALSE;
    U16 scr_id;
    scr_id = SCR_ID_BRW_RECENT_PAGES_HOST;

    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_recent_pages_host_options_screen
 * DESCRIPTION
 *  This function is the interface function to display the Recent Pages Host
 * Options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_recent_pages_host_options_screen(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_RECENT_PAGE_HOST_OPTIONS);
}
#endif
#endif

#ifndef SLIM_WAP_MMS
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_page_actions_list
 * DESCRIPTION
 *  This function is the interface function to display the Rendered page Do 
 * element list screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_page_actions_list(void)
{
    U16 scr_id = SCR_ID_BRW_PAGE_ACTIONS;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif


#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_page_object_types
 * DESCRIPTION
 *  This function is the interface function to display the Rendered page Object
 * types list screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_page_object_types(void)
{
    U16 scr_id = SCR_ID_BRW_PAGE_OBJECT_TYPES;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_page_objects
 * DESCRIPTION
 *  This function is the interface function to display the Rendered page Object
 * list screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_page_objects(void)
{
    U16 scr_id = SCR_ID_BRW_PAGE_OBJECTS;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif /* #ifdef OBIGO_Q05A */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_trusted_certificates_list
 * DESCRIPTION
 *  This function is the interface function to display the Trusted Certificates
 * list screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_trusted_certificates_list(void)
{
    U16 scr_id = SCR_ID_BRW_TRUSTED_CERTIFICATES;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_stored_pages_list
 * DESCRIPTION
 *  This function is the interface function to display the Stored Pages
 * list screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_stored_pages_list(void)
{
    U16 scr_id = SCR_ID_BRW_STORED_PAGES;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_settings_menu
 * DESCRIPTION
 *  This function is the interface function to display the Browser Settings
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_settings_menu(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_SETTINGS);
}


#ifdef __MMI_Q05A_LAUNCH_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_shortcuts_list
 * DESCRIPTION
 *  This function is the interface function to display the Shortcuts list
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_shortcuts_list(void)
{
    U16 ret_code = MMI_BRW_FALSE;
    U16 scr_id = SCR_ID_BRW_LAUNCH_PAGE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_entry_shortcuts_list_options
 * DESCRIPTION
 *  This function is the interface function to display the Shortcuts list
 * options screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_shortcuts_list_options(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_LAUNCH_PAGE_OPTIONS);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_shortcut
 * DESCRIPTION
 *  This function is the interface function to display the Add Shortcuts
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_shortcut(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_EDIT_SHORTCUT, g_brw_app_cntx.brw_scr_group_id);
}
#endif

mmi_ret mmi_brw_rendered_page_options_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_FIRST_ENTRY:
            break;
        case EVT_ID_GROUP_INACTIVE:
            break;
        case EVT_ID_GROUP_ACTIVE:
			 g_brw_app_cntx.brw_scr_group_id = BRW_RENDERED_PAGE_OPTIONS_GRP_ID;
            break;
        
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_DELETE_REQ:
        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            mmi_frm_group_close(BRW_RENDERED_PAGE_OPTIONS_GRP_ID);
            break;
        
        case EVT_ID_GROUP_DEINIT:
            mmi_frm_group_close(BRW_RENDERED_PAGE_OPTIONS_GRP_ID);
            break;
        
        case EVT_ID_GROUP_FOCUSED:
            break;
    }
    return MMI_RET_OK;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_rendered_page_options_menu
 * DESCRIPTION
 *  This function is the interface function to display the Rendered page
 * options menu screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_rendered_page_options_menu(void)
{
    g_brw_app_cntx.brw_scr_group_id = mmi_frm_group_create_ex(g_brw_app_cntx.brw_scr_group_id, 
                                                           BRW_RENDERED_PAGE_OPTIONS_GRP_ID,
                                                           mmi_brw_rendered_page_options_group_proc,
                                                           (void*)NULL,
                                                           MMI_FRM_NODE_SMART_CLOSE_FLAG); 
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_RENDERED_PAGE_OPTIONS);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_rendering_modes_screen
 * DESCRIPTION
 *  This function is the interface function to display the Rendering Modes 
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_rendering_modes_screen(void)
{
    U16 scr_id = SCR_ID_BRW_RENDERING_MODES;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_navigation_modes_screen
 * DESCRIPTION
 *  This function is the interface function to display the Navigation Modes 
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_navigation_modes_screen(void)
{
    U16 scr_id = SCR_ID_BRW_NAVIGATION_MODES;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}



/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_font_size_menu
 * DESCRIPTION
 *  This function is the interface function to display the Font Sizes
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_font_size_menu(void)
{
    U16 scr_id = SCR_ID_BRW_FONT_SIZE;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_memory_status_screen
 * DESCRIPTION
 *  This function is the interface function to display Bookmars memory status
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_memory_status_screen(void)
{
    U16 scr_id = SCR_ID_BRW_MEMORY_STATUS;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#ifdef __OP01__ 
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_view_url_screen
 * DESCRIPTION
 *  This function is the interface function to display View URL
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_view_url_screen(void)
{
    U16 scr_id = SCR_ID_BRW_VIEW_URL;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif /* __OP01__  */
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_view_certificate_screen
 * DESCRIPTION
 *  This function is the interface function to display Trusted Certificate view
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_view_certificate_screen(void)
{
    U16 scr_id = SCR_ID_BRW_SETTINGS_VIEW_CERTIFICATE;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


#ifdef __MMI_BRW_POST_SESSION_INFO__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_post_session_info_screen
 * DESCRIPTION
 *  This function is the interface function to display Post Session information
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_post_session_info_screen(void)
{
    U16 scr_id = SCR_ID_BRW_POST_SESSION_INFO;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif


#ifndef __MMI_BRW_SLIM_BOOKMARK_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_view_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display View Bookmark
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_view_bookmark_screen(void)
{
    U16 scr_id = SCR_ID_BRW_VIEW_BOOKMARK;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_save_to_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display Save to Bookmark
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_save_to_bookmark_screen(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_SAVE_TO_BOOKMARK, g_brw_app_cntx.brw_scr_group_id);
}


#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_save_to_bookmark_screen
 * DESCRIPTION
 *  This function is the interface function to display Save to Bookmark
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_object_properties_screen(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_OBJECT_PROPERTIES, g_brw_app_cntx.brw_scr_group_id);
}
#endif /* OBIGO_Q05A */

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_browser_preferences_screen
 * DESCRIPTION
 *  This function is the interface function to display Browser preferences
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_browser_preferences_screen(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_BROWSER_PREFERENCES, g_brw_app_cntx.brw_scr_group_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_auth_dlg
 * DESCRIPTION
 *  This function is the interface function to display Authentication dialog
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_auth_dlg(void)
{
    mmi_brw_app_sh_display_inline_cui(SCR_ID_BRW_SHOW_AUTH_DIALOG, g_brw_app_cntx.brw_scr_group_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_progressing_screen
 * DESCRIPTION
 *  This function is the interface function to display Please wait progress
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_progressing_screen(void)
{
    U16 scr_id = SCR_ID_BRW_BUSY_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_temp_progressing_screen
 * DESCRIPTION
 *  This function is the interface function to display temp Please wait progress
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_temp_progressing_screen(void)
{
    U16 scr_id = SCR_ID_BRW_TEMP_BUSY_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


#ifdef __MMI_BRW_LOADING_TIME_CHECKING__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_loading_time_check_screen
 * DESCRIPTION
 *  This function is the interface function to display loading time check
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_loading_time_check_screen(void)
{
    U16 scr_id = SCR_ID_BRW_LOADING_TIME_CHECK;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif

#ifdef __MMI_BRW_PAGE_SIZE_CHECKING__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_page_size_check_screen
 * DESCRIPTION
 *  This function is the interface function to display Page size check
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_page_size_check_screen(void)
{
    U16 scr_id = SCR_ID_BRW_PAGE_SIZE_CHECK;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif

#ifdef __MMI_URI_AGENT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_uha_uri_scheme_confirm_screen
 * DESCRIPTION
 *  This function is the interface function to display UHA URI confirmation
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_uha_uri_scheme_confirm_screen(void)
{
    U16 scr_id = SCR_ID_BRW_UHA_URI_SCHEME_CONFIRM_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif /* __MMI_URI_AGENT__ */

#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_upload_cancel_confirm_screen
 * DESCRIPTION
 *  This function is the interface function to display upload cancel confirmation
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_upload_cancel_confirm_screen(void)
{
    U16 scr_id = SCR_ID_BRW_UPLOAD_CANCEL_CONFIRMATION_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif /* #ifdef OBIGO_Q05A */




/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_sec_confirm_screen
 * DESCRIPTION
 *  This function is the interface function to display security confirmation
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_sec_confirm_screen(void)
{
    U16 scr_id = SCR_ID_BRW_SECURITY_CONFIRMATION_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_out_of_mem_confirm_screen
 * DESCRIPTION
 *  This function is the interface function to display out of memory
 * confirmation screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_out_of_mem_confirm_screen(void)
{
    U16 scr_id = SCR_ID_BRW_OUT_OF_MEM_CONFIRMATION_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_encoding_methods_screen
 * DESCRIPTION
 *  This function is the interface function to display the encoding methods list
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_encoding_methods_screen(void)
{
    U16 scr_id = SCR_ID_BRW_ENCODING_METHODS;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif /* OBIGO_Q05A */ 

mmi_ret mmi_brw_rendered_page_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_FIRST_ENTRY:
            break;
        case EVT_ID_GROUP_REDRAW_START:
            break;
        case EVT_ID_GROUP_FOCUSED:
        case EVT_ID_GROUP_ACTIVE:
			 g_brw_app_cntx.brw_scr_group_id = BRW_RENDERED_PAGE_GRP_ID;
            break;
        
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_DELETE_REQ:
        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            break;
        
        case EVT_ID_GROUP_DEINIT:
            {
                mmi_brw_app_screenDB_struct *scrDB;
                scrDB = (mmi_brw_app_screenDB_struct*)mmi_brw_app_scrhdlr_get_screenDB(SCR_ID_BRW_BROWSER_MAIN);
                if(scrDB->screen)
                {
                    srv_brw_free(scrDB->screen);
                    scrDB->screen = NULL;
                }
                if(!mmi_frm_group_is_present(BRW_SCREEN_GROUP)  && g_brw_app_cntx.allow_group_deleted)
                {
                    mmi_frm_group_close(BRW_CLOSE_GROUP_ID);
                }
            }
            break;
        
    }
    return MMI_RET_OK;

}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_pre_entry_render_page
 * DESCRIPTION
 *  pre entry function
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_pre_entry_render_page(void)
{

    if (mmi_frm_group_is_present(BRW_RENDERED_PAGE_OPTIONS_GRP_ID))
    {
        mmi_frm_group_close(BRW_RENDERED_PAGE_OPTIONS_GRP_ID);
        return;
    }
    if(!mmi_frm_group_is_present(BRW_RENDERED_PAGE_GRP_ID))
    {
        g_brw_app_cntx.brw_scr_group_id = mmi_frm_group_create_ex(GRP_ID_ROOT, 
                                                               BRW_RENDERED_PAGE_GRP_ID,
                                                               mmi_brw_rendered_page_group_proc,
                                                               (void*)NULL,
                                                               MMI_FRM_NODE_SMART_CLOSE_FLAG); 
    }

    mmi_brw_app_if_show_rendered_page_screen();
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_rendered_page_screen
 * DESCRIPTION
 *  This function is the interface function to display the rendered page
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_rendered_page_screen(void)
{
    U16 ret_code = MMI_BRW_FALSE;
    U16 scr_id;

#ifdef __MMI_BRW_SPLASH_SCREEN_SUPPORT__
    if (mmi_brw_app_is_browser_first_accessed_page())
    {
        scr_id = SCR_ID_BRW_SPLASH_SCREEN;
    }
    else
#endif /* __MMI_BRW_SPLASH_SCREEN_SUPPORT__ */
    {
        scr_id = SCR_ID_BRW_BROWSER_MAIN;
    }
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_stored_page_rename_screen
 * DESCRIPTION
 *  This function is the interface function to display the Stored page rename
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_stored_page_rename_screen(void)
{
    mmi_brw_app_sh_display_fseditor_cui(SCR_ID_BRW_STORED_PAGE_RENAME);
}
#endif /* #ifdef OBIGO_Q05A */


#ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_bookmarks_create_folder
 * DESCRIPTION
 *  This function is the interface function to display the Create Bookmark
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_bookmarks_create_folder(void)
{
    mmi_brw_app_sh_display_naming_rule_cui(SCR_ID_BRW_BKM_CREATE_FOLDER);
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_bookmark_naming_rule_screen
 * DESCRIPTION
 *  This function is the interface function to display the add/edit Bookmark
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_bookmark_naming_rule_screen(void)
{
    mmi_brw_app_sh_display_naming_rule_cui(SCR_ID_BRW_EDIT_BOOKMARK_NAMING_RULE);
}

#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_upload_progress_screen
 * DESCRIPTION
 *  This function is the interface function to display the Upload Progress
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_upload_progress_screen(void)
{
    U16 scr_id = SCR_ID_BRW_UPLOAD_PROGRESS_SCREEN;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_browser_dummy_screen
 * DESCRIPTION
 *  This function is the interface function to display a dummy screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_browser_dummy_screen(void)
{
    
    mmi_frm_group_create_ex(GRP_ID_ROOT, 
                         BRW_DUMMY_GROUP,
                         mmi_dummy_proc,
                         (void*)NULL,
                         MMI_FRM_NODE_SMART_CLOSE_FLAG); 
    if (mmi_frm_scrn_enter(
            BRW_DUMMY_GROUP, 
            SCR_ID_BRW_DUMMY, 
            NULL, 
            mmi_brw_app_if_show_browser_dummy_screen, 
            MMI_FRM_FG_ONLY_SCRN) == MMI_FALSE)
    {
        ASSERT(0);
    }
}


#ifndef __MMI_BRW_RECENT_PAGES_SLIM__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_recent_pages_list
 * DESCRIPTION
 *  This function is the interface function to display the Recent Pages List
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_recent_pages_list(void)
{
    U16 scr_id;
    U16 ret_code = MMI_BRW_FALSE;
    scr_id = SCR_ID_BRW_RECENT_PAGES;
    
	mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_enter_url_screen
 * DESCRIPTION
 *  This function is the interface function
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_enter_url_screen(void)
{
#if defined(__MMI_BRW_URL_AUTO_COMPLETION__) || defined(__MMI_BRW_SEARCH_HISTORY_SUPPORT__)
	U16 scr_id = SCR_ID_BRW_ENTER_URL;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
#else /* #if defined(__MMI_BRW_URL_AUTO_COMPLETION__) || defined(__MMI_BRW_SEARCH_HISTORY_SUPPORT__) */
    mmi_brw_app_sh_display_fseditor_cui(SCR_ID_BRW_ENTER_URL);
#endif /* #if defined(__MMI_BRW_URL_AUTO_COMPLETION__) || defined(__MMI_BRW_SEARCH_HISTORY_SUPPORT__)*/
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_url_screen
 * DESCRIPTION
 *  This function is the interface function for editing the URL present in the
 * address list
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_url_screen(void)
{
    mmi_brw_app_sh_display_fseditor_cui(SCR_ID_BRW_EDIT_URL);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_url
 * DESCRIPTION
 *  This function is the interface function to display the Edit URL screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_url(void)
{
    U16 scr_id = SCR_ID_BRW_EDIT_URL;
    U16 ret_code = MMI_BRW_FALSE;
    mmi_brw_app_set_all_db_index(scr_id);
    ret_code = mmi_brw_app_invoke_ui_controller(scr_id);
    if(ret_code == MMI_BRW_ASYNC_WAIT)
    {
        mmi_brw_app_if_show_progressing_screen();
    }
    else if(ret_code == MMI_BRW_FALSE)
    {
        ASSERT(0);
    }
}


#if defined(__MMI_BRW_URL_AUTO_COMPLETION__) || defined(__MMI_BRW_SEARCH_HISTORY_SUPPORT__)
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_editor_option
 * DESCRIPTION
 *  This function is the interface function to display the Editor Option screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_editor_option(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_EDITOR_OPTION);
}
#endif

#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_encoding_methods
 * DESCRIPTION
 *  This function is the interface function to display the Encoding methods
 * list
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_encoding_methods(void)
{
    mmi_brw_app_sh_display_menu_cui(SCR_ID_BRW_ENCODING_METHODS);
}
#endif

#ifndef __MMI_BRW_USER_DEFINED_HOMEPAGE_SLIM__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_edit_url
 * DESCRIPTION
 *  This function is the interface function to display the Edit URL screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_show_edit_homepage(void)
{
    mmi_brw_app_sh_display_fseditor_cui(SCR_ID_BRW_EDIT_HOMEPAGE);
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_enter_usb_mode
 * DESCRIPTION
 *  This function is the handler function registered to handle the USB mode
 * enter event
 * call
 * PARAMETERS
 *  
 * RETURNS
 *  pBOOL 
 *****************************************************************************/
mmi_ret mmi_brw_app_if_enter_usb_mode(mmi_event_struct* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(mmi_brw_is_browser_active())
    {
        mmi_brw_app_close_download_and_exit();
    }
    return MMI_RET_OK;
}

#if defined(__MMI_UCM__) && defined(__MMI_BACKGROUND_CALL__)
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_ucm_exit_callback
 * DESCRIPTION
 *  This function is the callback function registered with the UCM application
 * to be called when the UCM is deleing all the screen in case of outgoing
 * call
 * PARAMETERS
 *  
 * RETURNS
 *  pBOOL 
 *****************************************************************************/
mmi_ret mmi_brw_app_if_ucm_exit_callback(mmi_event_struct* para)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(mmi_brw_is_browser_active())
	{
        return SRV_UCM_APP_EXIT_QUERY_RESULT_NO;
	}
	else
	{
        return SRV_UCM_APP_EXIT_QUERY_RESULT_YES;
	}
}
#endif /* __MMI_UCM__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_deinit
 * DESCRIPTION
 *  This function is to de-initialize a Browser session by deleting all its
 * screen and freeing the ASM memory and de-initializing the service
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_deinit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_APP_DEINIT);
#ifdef __MMI_RMGR_SEAMLESS_UNLOCK__
    if(g_srv_brw_cntx.sap_msg_id == MSG_ID_WAP_BAM_CREATE_INSTANCE_REQ)
    {
        g_brw_app_cntx.brw_launching_pad = BRW_LPD_SESSION_CLOSED;
    }
#endif /* __MMI_RMGR_SEAMLESS_UNLOCK__ */


    /* de-allocating memory for UHA hanlder */
#ifdef __MMI_URI_AGENT__
    srv_brw_free_OSL_memory((void**)&(g_brw_app_cntx.uha_info_p));
#endif /* __MMI_URI_AGENT__ */ 

    /* releasing memory when browser instance is being created */
    if (mmi_brw_is_browser_active())
    {

	/* releasing the bearer on browser instance deletion */
        if (srv_brw_is_holding_bearer())
        {
			/* calls cbm_release_bearer() & update is_holding_bearer of 
			dynamic cntx */
            srv_brw_set_bearer(MMI_FALSE);
        }
        g_srv_brw_cntx.srv_brw_profile_type = SRV_BRW_PROFILE_TYPE_NONE;

        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_DEINIT_FOR_ACTIVE_BROWSER);
        g_brw_app_cntx.brw_dynamic_cntx_p->isBrowserWaiting = MMI_FALSE; //TODO reset it in app deinit

    #if defined(__MMI_OP11_HOMESCREEN__)  || defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__)
        g_brw_app_cntx.isBookmarkLaunched = MMI_FALSE;
    #endif /* __MMI_OP11_HOMESCREEN__ */ 

        mmi_brw_delete_all_browser_screens();
#ifndef __MMI_BRW_RECENT_PAGES_SLIM__
        srv_brw_recent_pages_list_end_req();
#endif
    #ifdef __MMI_BRW_STORED_PAGES_SUPPORT__
        srv_brw_stored_pages_list_end_req();
    #endif /* __MMI_BRW_STORED_PAGES_SUPPORT__ */
    #ifdef OBIGO_Q05A
        srv_brw_get_resource_list_end_req();
    #endif /* OBIGO_Q05A */
    #ifdef __SAT__
        srv_brw_sat_send_termination_ind(SRV_BRW_SAT_USER_TERMINATION);
    #endif 
        srv_cbm_deregister_bearer_event((U8) srv_wap_prof_get_cbm_app_id(SRV_WAP_PROF_APPID_BRW, srv_brw_convert_sim_setting_to_profile_sim_id(g_srv_brw_cntx.session_sim_id)));
        mmi_brw_app_delete_instance_req();
        g_srv_brw_cntx.session_sim_id = SRV_BRW_ACTIVE_SIM_SETTING_TOTAL;
        mmi_frm_group_close(BRW_RENDERED_PAGE_GRP_ID);
        mmi_frm_group_close(BRW_SCREEN_GROUP);
        g_brw_app_cntx.brw_scr_group_id = GRP_ID_INVALID;
    }
#if defined(__MMI_VBOOKMARK__)
    /* releasing memory when browser instance is not created but ASM is allocated for Select Bookmark Screen */
#ifdef __MMI_BRW_BKM_INTERFACE_SUPPORT__
    else if (g_brw_bkm_sel_bkm_pool)
    {
        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_DEINIT_FOR_BKMS_LIST);
        g_brw_bkm_sel_bkm_pool = MMI_FALSE;
        srv_brw_bkm_deinitialize_bookmark_context();
        mmi_frm_scrn_close( g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_SELECT_BOOKMARK);
        if(g_brw_bkm_sel_bkm_cntx.sel_folder_name)
        {
            mmi_brw_sel_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE, NULL, NULL);
        }
        mmi_brw_app_free_browser_memory((void**)&(g_brw_bkm_sel_bkm_cntx.sel_folder_name));

        /* de-initalize ADM memory */
        if (g_srv_brw_cntx.brw_adm_id)
        {
            kal_adm_delete(g_srv_brw_cntx.brw_adm_id);
            g_srv_brw_cntx.brw_adm_id = NULL;
        }

        /* de-allocate browser app ASM memory */
        if (g_brw_app_memory_pool)
        {
            applib_asm_free_r(APP_BROWSER, g_brw_app_memory_pool);
            g_brw_app_memory_pool = NULL;
        }

        /* if the browser app is terminated by some other App then
           send the success notification to MMI */
        if (g_brw_app_cntx.brw_launching_pad == BRW_LPD_ASM_TERMINATE)
        {
            /* Notify MMI that this application is already stopped */
            applib_mem_ap_notify_stop_finished(APP_BROWSER, KAL_TRUE);
            g_brw_app_cntx.brw_launching_pad = BRW_LPD_NONE;
        }
    }
#endif
#endif
    if(g_brw_app_cntx.add_bkm_cid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(g_brw_app_cntx.add_bkm_cid);
    }
    if(g_brw_app_cntx.sel_bkm_cid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(g_brw_app_cntx.sel_bkm_cid);
    }
#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
    if(mmi_frm_group_is_present(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID))
    {
        mmi_frm_group_close(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID);
    }
#endif /* __MMI_BRW_BOOKMARK_IN_FMGR__ */
#ifdef __MMI_VBOOKMARK__
    if(mmi_frm_group_is_present(BRW_RECV_BOOKMARKS_GRP_ID))
    {
        mmi_frm_group_close(BRW_RECV_BOOKMARKS_GRP_ID);
    }
#endif /* __MMI_VBOOKMARK__ */
#if !defined(__MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__)
    if(g_brw_app_cntx.send_msg_cui_id != GRP_ID_INVALID)
    {
        cui_sms_send_close(g_brw_app_cntx.send_msg_cui_id);
        mmi_frm_group_close(BRW_SEND_GROUP);  
        g_brw_app_cntx.send_msg_cui_id = GRP_ID_INVALID;  
    }
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_idle_deinit
 * DESCRIPTION
 *  This function is the interface function to de-initialize the Browser on
 * entering IDLE screen
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
mmi_ret mmi_brw_app_if_idle_deinit(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_brw_app_deinit();
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_browser_app_init
 * DESCRIPTION
 *  This function is the interface function to initialize the Browser on bootup
 * screen
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
mmi_ret mmi_brw_app_if_browser_app_init(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_URI_AGENT__
    srv_uriagent_err_enum err;
#endif 

   /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_WAP_INIT);
    srv_brw_init();

#ifdef __MMI_OP12_BRW_EMBEDDED_LINKS__
    MMI_ASSERT(WAP_CUSTOM_CFG_N_NBR_EMBEDDED_LINKS <= BRW_MAX_EMBEDDED_LINKS_ALLOWED);
#endif 

    mmi_brw_app_context_init();  /* initializing browser global context */
    mmi_brw_srv_hdlr_register_callback_events();

#ifdef __MMI_URI_AGENT__
    err = srv_uriagent_register_hdlr_by_scheme(BRW_HTTP_URI_SCHEME, mmi_brw_app_if_uri_scheme_handler, MMI_TRUE);
    MMI_ASSERT(err == SRV_URIAGENT_ERR_OK);
    err = srv_uriagent_register_hdlr_by_scheme(BRW_HTTPS_URI_SCHEME, mmi_brw_app_if_uri_scheme_handler, MMI_TRUE);
    MMI_ASSERT(err == SRV_URIAGENT_ERR_OK);
#ifdef OBIGO_Q05A
    err = srv_uriagent_register_hdlr_by_scheme(BRW_FILE_URI_SCHEME, mmi_brw_app_if_uri_scheme_handler, MMI_TRUE);
    MMI_ASSERT(err == SRV_URIAGENT_ERR_OK);
#endif /* OBIGO_Q05A */
#endif /* __MMI_URI_AGENT__ */ 
    mmi_brw_app_register_for_bearer_info();
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_asm_stop_callback
 * DESCRIPTION
 *  This function is the interface function which will be passed to the ASM
 * and which can be called to release the ASM memory taken by Browser 
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_asm_stop_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_brw_app_memory_pool)
    {
        g_brw_app_cntx.brw_launching_pad = BRW_LPD_ASM_TERMINATE;
        if(g_srv_brw_cntx.srv_brw_dynamic_cntx_p->isDeleteInsReqPending)
        {
            return ;
        }
        else
        {
            srv_brw_background_downloads_req(MMI_DA_WAP_NOTIFY_BROWSER_CLOSED);
            mmi_brw_app_deinit();
        }
    }
    else 
    {
        applib_mem_ap_notify_stop_finished(APP_BROWSER, KAL_TRUE);
    }
}



#ifdef __MMI_URI_AGENT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_uri_scheme_handler
 * DESCRIPTION
 *  This function is the interface function which will be registered with the 
 * URI Agent and can be invoked by the URI Agent to launch the reg. URI scheme
 * PARAMETERS
 *  Void
 * RETURNS
 *  Void
 *****************************************************************************/
void mmi_brw_app_if_uri_scheme_handler(
        srv_uriagent_appid_enum ura_appid,
        char *url,
        char *param,
        srv_uriagent_options_enum options,
        srv_uriagent_uri_request_hdlr_cb uri_agent_cb)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(url);

    if (strlen((S8*) url) > WAP_MAX_SEARCH_URL_LENGTH)
    {
        mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_INVALID_URL, MMI_EVENT_PROPLEM);
        if (uri_agent_cb)
        {
            uri_agent_cb(ura_appid, SRV_URIAGENT_APPID_BRW, MMI_FALSE);
        }
        return;
    }

    if (g_brw_app_cntx.uha_info_p)
    {
        if (uri_agent_cb)
        {
            uri_agent_cb(ura_appid, SRV_URIAGENT_APPID_BRW, MMI_FALSE);
        }
        return;
    }
    g_brw_app_cntx.uha_info_p = (brw_uha_handler_struct*) OslMalloc(sizeof(brw_uha_handler_struct));
    MMI_ASSERT(g_brw_app_cntx.uha_info_p);
    memset(g_brw_app_cntx.uha_info_p, 0, sizeof(brw_uha_handler_struct));

    g_brw_app_cntx.uha_info_p->ura_appid = ura_appid;
    strcpy((S8*) g_brw_app_cntx.uha_info_p->url, (S8*) url);
    g_brw_app_cntx.uha_info_p->uri_agent_cb = uri_agent_cb;

    if (options == SRV_URIAGENT_OPTION_NEED_CONFIRM_POPUP)
    {
        mmi_brw_app_if_show_uha_uri_scheme_confirm_screen();
    }
    else
    {
        mmi_brw_app_wap_uri_scheme_launch();
    }
}
#endif /* __MMI_URI_AGENT__ */


#ifdef __MMI_URI_AGENT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_uri_callback
 * DESCRIPTION
 *  This function is to callback function passed to the URI agent to get the
 * response from the URI Agent and send that response to Browser Service
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_uri_callback(srv_uriagent_appid_enum ura_appid, srv_uriagent_appid_enum uha_appid, S32 result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (ura_appid == SRV_URIAGENT_APPID_BRW)
    {
        switch (uha_appid)
        {
            case SRV_URIAGENT_APPID_PHONEBOOK:
            {
            #ifdef OBIGO_Q03C_BROWSER
                srv_brw_uri_req_rsp((U16) mmi_brw_app_uri_agent_get_pb_result(result));
            #else
                srv_brw_wtai_pb_rsp((U16) mmi_brw_app_uri_agent_get_pb_result(result));
            #endif
                break;
            }
        #ifdef __MMI_UCM__
            case SRV_URIAGENT_APPID_CALLMANAGER:
            {
            #ifdef OBIGO_Q03C_BROWSER
                srv_brw_uri_req_rsp((U16) mmi_brw_app_uri_agent_get_tel_result(result));
            #else
                srv_brw_wtai_tel_rsp((U16) mmi_brw_app_uri_agent_get_tel_result(result));
            #endif
                break;
            }
        #endif /* __MMI_UCM__ */
            default:
            #ifdef OBIGO_Q03C_BROWSER
                srv_brw_uri_req_rsp(WAP_BAM_WTAI_RESULT_UNSPECIFIED);
            #endif /* OBIGO_Q03C_BROWSER */
                break;
        }
    }
}
#endif /* __MMI_URI_AGENT__ */


#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_open_file
 * DESCRIPTION
 *  This function is used for invloking the FMGR app so that the user can 
 * select a web page present in the phone memory to be rendered in the 
 * Browser
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_open_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILTER filter;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    FMGR_FILTER_INIT(&filter);
    srv_fmgr_types_filter_set_group(&filter, FMGR_GROUP_BOOKMARK);
    FMGR_FILTER_SET(&filter, FMGR_TYPE_FOLDER);

    g_brw_app_cntx.file_selector_cui_gid = mmi_frm_group_create_ex(g_brw_app_cntx.brw_scr_group_id, 
                                                           GRP_ID_AUTO_GEN,
                                                           mmi_brw_app_open_file_proc,
                                                           (void*)NULL,
                                                           MMI_FRM_NODE_SMART_CLOSE_FLAG); 

    g_brw_app_cntx.file_selector_cid =  cui_file_selector_create(g_brw_app_cntx.file_selector_cui_gid,
                                                           (WCHAR*)L"root",
                                                           &filter,
                                                           CUI_FILE_SELECTOR_STYLE_FILE_ONLY,
                                                           (CUI_FILE_SELECTOR_OPT_ARCHIVE_MASK | CUI_FILE_SELECTOR_OPT_ARCHIVE_AS_FOLDER));
    cui_file_selector_run(g_brw_app_cntx.file_selector_cid);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_open_file_proc
 * DESCRIPTION
 *  proc function to open file from internet service menu
 * PARAMETERS
 *  fullname        [IN]        Selected filename
 *  is_short        [IN]        File name type
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_app_open_file_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
    cui_file_selector_result_event_struct *fmgr_evt ;
    srv_fmgr_fileinfo_struct* info;
    U8 file_path[(SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH];
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_CUI_FILE_SELECTOR_RESULT:
            {
                fmgr_evt = (cui_file_selector_result_event_struct*)evt;
                if(fmgr_evt->result > 0)
                {
                    info = (srv_fmgr_fileinfo_struct*)OslMalloc(sizeof(srv_fmgr_fileinfo_struct));
                    cui_file_selector_get_selected_filepath(g_brw_app_cntx.file_selector_cid,
                                                            info,
                                                            (WCHAR*)file_path,
                                                            ((SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH));
                    mmi_brw_app_if_open_file_callback(file_path, 0);
                    OslMfree(info);
                    cui_file_selector_close(g_brw_app_cntx.file_selector_cid);
                }
                else if(fmgr_evt->result == 0)
                {
                    //mmi_brw_open_file_callback(NULL, NULL);
                    cui_file_selector_close(g_brw_app_cntx.file_selector_cid);
                }
                else
                {
                    cui_file_selector_close(g_brw_app_cntx.file_selector_cid);
                }
            }
            break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_open_file_callback
 * DESCRIPTION
 *  This function is the callback function passed to the FMGR application.
 * It will be called when either the user selects the desired file or user 
 * comes back from the FMGR.
 * PARAMETERS
 *  fullname        [IN]        Selected filename
 *  is_short        [IN]        File name type
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_open_file_callback(void *fullname, int is_short)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 temp[20];
    S32 return_val = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.file_mgr_instance = 0;
    if (fullname)
    {
        mmi_asc_to_ucs2((S8*) temp, (S8*) "file:\\\\\\");
        mmi_ucs2cpy((S8*) g_brw_open_file_cntx.file_path, (S8*) temp);
        mmi_ucs2cat((S8*) g_brw_open_file_cntx.file_path, (S8*) fullname);
        return_val = mmi_charset_ucs2_to_utf8_length_in_bytes((kal_uint8*) g_brw_open_file_cntx.file_path);
        if (return_val <= WAP_BAM_MAX_FILE_PATH_LEN)
        {
            mmi_brw_app_pre_entry_open_file();
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_ID_BRW_FILE_PATH_TOO_LONG,
                MMI_EVENT_PROPLEM);
            //DeleteNHistory(1);
            mmi_frm_scrn_close_active_id();
        }
    }
    else
    {
        mmi_frm_scrn_close_active_id();
    }
}
#endif /* OBIGO_Q05A */


#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_select_upload_file_callback
 * DESCRIPTION
 *  external call back for file manager select file function
 * PARAMETERS
 *  fullname        [IN]        Selected filename
 *  is_short        [IN]        File name type
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_select_upload_file_callback(void *fullname)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined (__DRM_SUPPORT__)
    U8 drm_result;

    /* Check if the selected file is forwardable or not */
    drm_result = DRM_get_object_method(0, (kal_wchar*) fullname);
    /* if the selected file is not forwardable then send selection failed response
       show error popup to the user and remove the file selection screen of file manager */
    if (drm_result & DRM_METHOD_FORWARD_LOCK || drm_result & DRM_METHOD_COMBINED_DELIVERY)
    {
        srv_brw_select_file_rsp(WAP_BAM_ERROR_FILE_SELECTION_FAILED, (U8*) NULL);
        mmi_brw_app_ui_draw_display_popup_ext(
            STR_GLOBAL_DRM_PROHIBITED,
            MMI_EVENT_PROPLEM);
    }
    else
#endif /* defined (__DRM_SUPPORT__) */ 
    {
        /* If the selected file is forwardable then copy the file path to 
           g_brw_open_file_cntx.file_path and send response to BAM and return 
           to rendered page screen */
        srv_brw_select_file_rsp(WAP_BAM_ERROR_FILE_SELECTION_OK, (U8*) fullname);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_open_file_proc
 * DESCRIPTION
 *  proc function to open file from internet service menu
 * PARAMETERS
 *  fullname        [IN]        Selected filename
 *  is_short        [IN]        File name type
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_app_select_upload_file_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
    cui_file_selector_result_event_struct *fmgr_evt ;
    srv_fmgr_fileinfo_struct* info;
    U8 file_path[(SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH];
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_CUI_FILE_SELECTOR_RESULT:
            {
                fmgr_evt = (cui_file_selector_result_event_struct*)evt;
                if(fmgr_evt->result > 0)
                {
                    info = (srv_fmgr_fileinfo_struct*)OslMalloc(sizeof(srv_fmgr_fileinfo_struct));
                    cui_file_selector_get_selected_filepath(g_brw_app_cntx.file_selector_cid,
                                                            info,
                                                            (WCHAR*)file_path,
                                                            ((SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH));
                    mmi_brw_app_if_select_upload_file_callback(file_path);
                    OslMfree(info);
                }
                else if(fmgr_evt->result <= 0)
                {
                    srv_brw_select_file_rsp(WAP_BAM_ERROR_FILE_SELECTION_FAILED, NULL);
                }
                cui_file_selector_close(g_brw_app_cntx.file_selector_cid);
            }
            break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_open_file
 * DESCRIPTION
 *  This function is used for invloking the FMGR app so that the user can 
 * select a web page present in the phone memory to be rendered in the 
 * Browser
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_select_upload_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILTER filter;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    FMGR_FILTER_INIT(&filter);
    FMGR_FILTER_SET(&filter, FMGR_TYPE_ALL);
    FMGR_FILTER_SET(&filter, FMGR_TYPE_FOLDER);

    g_brw_app_cntx.file_selector_cui_gid = mmi_frm_group_create_ex(g_brw_app_cntx.brw_scr_group_id, 
                                                           BRW_GRP_ID_FILE_UPLOAD,
                                                           mmi_brw_app_select_upload_file_proc,
                                                           (void*)NULL,
                                                           MMI_FRM_NODE_SMART_CLOSE_FLAG); 

    g_brw_app_cntx.file_selector_cid =  cui_file_selector_create(g_brw_app_cntx.file_selector_cui_gid,
                                                           (WCHAR*)L"root",
                                                           &filter,
                                                           CUI_FILE_SELECTOR_STYLE_FILE_ONLY,
                                                           (CUI_FILE_SELECTOR_OPT_ARCHIVE_MASK | CUI_FILE_SELECTOR_OPT_ARCHIVE_AS_FOLDER));
    cui_file_selector_run(g_brw_app_cntx.file_selector_cid);

}
#endif /* __MMI_BRW_FILE_UPLOAD_SUPPORT__ */

#ifndef __MMI_BRW_SEND_ADDRESS_SLIM__
#ifndef __MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_send_addr_text_msg
 * DESCRIPTION
 *  This function is to invoke the interface of the SMS application to send
 * a URL through SMS
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_send_addr_text_msg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_sms_write_msg_para_struct *sendData = (mmi_sms_write_msg_para_struct*)srv_brw_malloc(sizeof(mmi_sms_write_msg_para_struct));
    mmi_id parent_gid = 0 ;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    sendData->string = (S8*) g_brw_current_url;
    sendData->stringlength = mmi_ucs2strlen((S8*) g_brw_current_url);
    sendData->dcs = SMSAL_UCS2_DCS;
    sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY; 
    sendData->ascii_addr = NULL;
    sendData->filename = NULL;

    mmi_sms_write_msg_lanch(parent_gid, sendData);
    srv_brw_free(sendData);
}
#endif /* __MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__ */ 


#ifdef __MMI_MMS__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_send_addr_multimedia_msg
 * DESCRIPTION
 *  This function is to invoke the interface of the MMS application to send
 * a URL through MMS
 * PARAMETERS
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_send_addr_multimedia_msg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mms_text_insert_hdlr(NULL, 0, (S8*) g_brw_current_url, mmi_ucs2strlen((S8*) g_brw_current_url));
}
#endif /* defined(__MMI_MMS__) */ 


#if defined(__MMI_OPP_SUPPORT__) && defined(__MMI_VBOOKMARK__)
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_send_addr_via_bt_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_event_struct
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_brw_app_if_send_addr_via_bt_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
	    case EVT_ID_CUI_BT_SENDING_SUCC:
	    case EVT_ID_CUI_BT_SENDING_FAIL:
        {
            FS_Delete((UI_string_type) g_brw_open_file_cntx.file_path); /* delete temporary vbookmark file */
            mmi_frm_group_close(BRW_SEND_GROUP);
        }
    }
    return MMI_RET_OK;
}



/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_send_addr_via_bluetooth
 * DESCRIPTION
 *  This function is to invoke the interface of the BT application to send
 * a URL through Bluetooth
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_send_addr_via_bluetooth(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 def_drive_str[SRV_BRW_BKM_DRIVE_NAME_LENGTH];
    S32 error_code;
    cui_bt_sending_para_struct bt_obj;
    cui_bt_sending_obj_struct *send_obj;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(mmi_brw_app_is_in_usb_mode())
    {
    	return;
    }
    sprintf((S8*) def_drive_str, "%c", BRW_TEMP_VBKM_FILE_DRIVE);

    mmi_asc_to_ucs2((S8*) g_brw_open_file_cntx.file_path, (S8*) def_drive_str);
    mmi_ucs2cat((S8*) g_brw_open_file_cntx.file_path, (S8*) L":");
    mmi_ucs2cat((S8*) g_brw_open_file_cntx.file_path, (S8*) BRW_TEMP_VBKM_FILE_PATH);

    if ((error_code = srv_brw_bookmarks_create_standard_vbookmark_file(
                        g_brw_open_file_cntx.file_path,
                        g_brw_current_url)) == FS_NO_ERROR)
    {
        mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_SEND_GROUP, mmi_brw_app_if_send_addr_via_bt_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
        bt_obj.total = 1;
        bt_obj.option = CUI_BT_SENDIND_OPT_NORMAL;
        send_obj = (cui_bt_sending_obj_struct*) srv_brw_malloc(sizeof(cui_bt_sending_obj_struct));   
        memset(send_obj, 0, sizeof(cui_bt_sending_obj_struct));
        send_obj->data.obj_type = CUI_BT_SENDIND_USE_FILE;
        send_obj->data.u.file.path = (U16*) g_brw_open_file_cntx.file_path;
        send_obj->data.u.file.is_sfn = MMI_FALSE;
        bt_obj.obj = send_obj;

        cui_bt_sending_launch(BRW_SEND_GROUP, &bt_obj);
        srv_brw_free(send_obj);
    }
    else
    {
        mmi_brw_app_file_system_error_handler(error_code);
    }
}
#endif /* defined(__MMI_OPP_SUPPORT__) && defined(__MMI_VBOOKMARK__) */ 


#ifdef __MMI_EMAIL__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_send_addr_via_email
 * DESCRIPTION
 *  This function is to invoke the interface of the Email application to send
 * a URL through Email
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_send_addr_via_email(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_email_app_send_cont((S8*) g_brw_current_url);
}
#endif /* __MMI_EMAIL__ */
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_profile_list
 * DESCRIPTION
 *  This function is the interface function to either call the profile module
 * interface or in case of DUAL sim display the Profile type screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_show_profile_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_wap_prof_display_profile_list(
        srv_brw_convert_sim_setting_to_profile_sim_id(g_srv_brw_cntx.session_sim_id),
        SRV_WAP_PROF_APPID_BRW,
    #ifndef __MMI_TITLE_BAR_NO_ICON_SHCT__    
        mmi_brw_get_wap_icon(),
    #else
        0,
    #endif
        SERVICES_WAP_MENU_ID,
        g_brw_app_cntx.brw_scr_group_id);
}


#ifdef __MMI_BRW_ADVANCED_APP_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_restore_browser_settings
 * DESCRIPTION
 *  This function is used for restoring the Browser settings
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_restore_browser_settings(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* showing the busy screen */
    mmi_brw_app_show_progress_screen(STR_GLOBAL_SETTINGS, STR_GLOBAL_PLEASE_WAIT);
    mmi_restore_app_data(SRV_BROWSER, NULL);

    /* Get the default values of all the settings which were restored */
    srv_brw_settings_restore_data();
    srv_brw_settings_update_all_data();

    g_brw_app_cntx.brw_launching_pad = BRW_LPD_RESTORE_BRW_SETTINGS;
    mmi_brw_app_srv_hdlr_set_profile_req();

#ifdef OBIGO_Q05A
    /* sending request for screen resizing */
    mmi_brw_app_resize_screen_req();
#endif /* OBIGO_Q05A */
}
#endif /* __MMI_BRW_ADVANCED_APP_FEATURES__ */


#ifdef __MMI_CBM_CONNECTION_MANAGER__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_show_connection_info
 * DESCRIPTION
 *  This function is to invoke the CBM API to show the connection information
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_show_connection_info(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 title_icon_id;
    srv_wap_prof_profile_content_struct *profile_content_p;
    U32 data_account_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    title_icon_id = mmi_brw_get_wap_icon();

    srv_brw_get_profile_content((void **)&profile_content_p);

    data_account_id = profile_content_p->data_account_primary_id;

    OslMfree(profile_content_p);
    
    /* Call the CBM API to show the connection information */
    mmi_cnmgr_app_show_bearer_detail_info(MMI_CNMGR_ENTRY_SCREEN_TYPE_BEARER_DETAIL, data_account_id, title_icon_id);
}
#endif /* __MMI_CBM_CONNECTION_MANAGER__ */


#ifdef __MMI_VBOOKMARK__
#if (defined __MMI_BRW_BKM_FOLDER_SUPPORT__ || defined __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__)
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_copy_bookmark_to
 * DESCRIPTION
 *  This function is to perform the tasks which are required to be done
 * on the selection of the Copy To option in Bookmark Options screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_copy_bookmark_to(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_BRW_BKM_FOLDER_SUPPORT__
    FMGR_FILTER filter;
#endif /* #ifndef __MMI_BRW_BKM_FOLDER_SUPPORT__ */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__
    if (!mmi_brw_app_check_available_bookmark_memory())
    {
        return;
    }
#endif /* __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__ */ 
    g_brw_bkm_browse_path_event = BRW_BKM_BROWSE_PATH_COPY_TO;
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_COPY_BKM_FILE_RSP);

#ifndef __MMI_BRW_BKM_FOLDER_SUPPORT__
    FMGR_FILTER_INIT(&filter);
    srv_fmgr_types_filter_set_group(&filter, FMGR_TYPE_FOLDER);

    g_brw_app_cntx.file_selector_cui_gid = mmi_frm_group_create(g_brw_app_cntx.brw_scr_group_id, 
                                                       BRW_COPY_MOVE_BOOKMARK_GRP_ID,
                                                       mmi_brw_app_browse_path_open_folder_proc,
                                                       (void*)NULL); 
    mmi_frm_group_enter(g_brw_app_cntx.file_selector_cui_gid , MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_brw_app_cntx.file_selector_cid =  cui_folder_selector_create(g_brw_app_cntx.file_selector_cui_gid,
                                                           (WCHAR*)L"root",
                                                           CUI_FOLDER_SELECTOR_STYLE_WRITE,
                                                           CUI_FOLDER_SELECTOR_OPT_FOLDER_TRAVERSE_ALL);
    cui_folder_selector_run(g_brw_app_cntx.file_selector_cid);
#else
    g_brw_bkm_cntx.bkm_dynamic_cntx->sel_folder_name[0] = '\0';
    mmi_brw_app_dmgr_pre_entry_browse_path();
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_move_bookmark_to
 * DESCRIPTION
 *  This function is to perform the tasks which are required to be done
 * on the selection of the Move To option in Bookmark Options screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_move_bookmark_to(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_BRW_BKM_FOLDER_SUPPORT__
    FMGR_FILTER filter;
#endif 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_MOVE_BKM_FILE_RSP);
    g_brw_bkm_browse_path_event = BRW_BKM_BROWSE_PATH_MOVE_TO;
#ifndef __MMI_BRW_BKM_FOLDER_SUPPORT__
    FMGR_FILTER_INIT(&filter);
    srv_fmgr_types_filter_set_group(&filter, FMGR_TYPE_FOLDER);

    g_brw_app_cntx.file_selector_cui_gid = mmi_frm_group_create(g_brw_app_cntx.brw_scr_group_id, 
                                                       BRW_COPY_MOVE_BOOKMARK_GRP_ID,
                                                       mmi_brw_app_browse_path_open_folder_proc,
                                                       (void*)NULL); 
    mmi_frm_group_enter(g_brw_app_cntx.file_selector_cui_gid , MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_brw_app_cntx.file_selector_cid =  cui_folder_selector_create(g_brw_app_cntx.file_selector_cui_gid,
                                                           (WCHAR*)L"root",
                                                           CUI_FOLDER_SELECTOR_STYLE_WRITE,
                                                           CUI_FOLDER_SELECTOR_OPT_FOLDER_TRAVERSE_ALL);
    cui_folder_selector_run(g_brw_app_cntx.file_selector_cid);
#else
    g_brw_bkm_cntx.bkm_dynamic_cntx->sel_folder_name[0] = '\0';
    mmi_brw_app_dmgr_pre_entry_browse_path();
#endif
}
#endif


#ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_browse_path_replace_file
 * DESCRIPTION
 *  This function is to replace the existing bookmark file with the new one
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_browse_path_replace_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 actual_index, selected_file_index;
    S32 error_code;
    srv_brw_bookmark_file_struct *obj;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    actual_index = g_brw_bkm_cntx.bkm_dynamic_cntx->bookmark_list[g_brw_bkm_cntx.bkm_dynamic_cntx->sel_folder_index].actual_index;
    selected_file_index = g_brw_bkm_cntx.bkm_dynamic_cntx->selected_file_index;

    obj = (srv_brw_bookmark_file_struct*) OslMalloc(sizeof(srv_brw_bookmark_file_struct));
    memset(obj, 0, sizeof(srv_brw_bookmark_file_struct));

    mmi_chset_utf8_to_ucs2_string((S8*) obj->file_name, 
        SRV_BRW_BKM_MAX_FILE_NAME_LEN * ENCODING_LENGTH,
        (S8*) g_srv_brw_cntx.bkm_cntx_p[selected_file_index].title);
    mmi_asc_to_ucs2((S8*) obj->file_url, (S8*) g_srv_brw_cntx.bkm_cntx_p[selected_file_index].url);
    if(!g_brw_bkm_cntx.bkm_dynamic_cntx->is_first_level)
    {
        strcpy((S8*)obj->parent_folder, (S8*)g_srv_brw_cntx.bkm_cntx_p[actual_index].title);
    }

    if(g_brw_bkm_browse_path_event == BRW_BKM_BROWSE_PATH_COPY_TO)
    {
        obj->selected_bookmark_index = SRV_BRW_BKM_INVALID_INDEX;
        error_code = srv_brw_bookmark_add_replace_item(obj);
    }
    else
    {
        obj->selected_bookmark_index = selected_file_index;
        error_code = srv_brw_bookmark_edit_replace_item(obj, MMI_FALSE);
    }
    OslMfree(obj);
    mmi_brw_app_handle_bookmark_error_code(error_code);
    if(!g_brw_bkm_cntx.bkm_dynamic_cntx->is_first_level)
    {
        strcpy((S8*) g_brw_bkm_cntx.sel_folder_name, (S8*) g_srv_brw_cntx.bkm_cntx_p[actual_index].title);
    }
    else
    {
        g_brw_bkm_cntx.sel_folder_name[0] = '\0';
    }
    g_brw_bkm_cntx.sel_file_index = 0;
    mmi_brw_app_create_bookmark_list();
    mmi_frm_scrn_close(g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_BOOKMARK_BROWSE_PATH);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_browse_path_open_folder
 * DESCRIPTION
 *  This function is to open the selected folder by user in the Browser path
 * screen to display the folder present in the selected folder
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_browse_path_open_folder(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__
    FMGR_FILTER filter;
#endif 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_brw_bkm_cntx.bkm_dynamic_cntx->is_first_level)
    {
    #ifdef __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__
        if(g_brw_bkm_cntx.bkm_dynamic_cntx->sel_folder_index == BRW_BKM_EXTERNAL_MEMORY_MENU_ITEM_INDEX)
        {
            FMGR_FILTER_INIT(&filter);
            srv_fmgr_types_filter_set_group(&filter, FMGR_TYPE_FOLDER);

            g_brw_app_cntx.file_selector_cui_gid = mmi_frm_group_create(g_brw_app_cntx.brw_scr_group_id, 
                                                               GRP_ID_AUTO_GEN,
                                                               mmi_brw_app_browse_path_open_folder_proc,
                                                               (void*)NULL); 
            mmi_frm_group_enter(g_brw_app_cntx.file_selector_cui_gid , MMI_FRM_NODE_SMART_CLOSE_FLAG);

            g_brw_app_cntx.file_selector_cid =  cui_folder_selector_create(g_brw_app_cntx.file_selector_cui_gid,
                                                                   (WCHAR*)L"root",
                                                                   CUI_FOLDER_SELECTOR_STYLE_WRITE,
                                                                   CUI_FOLDER_SELECTOR_OPT_FOLDER_TRAVERSE_ALL);
            cui_folder_selector_run(g_brw_app_cntx.file_selector_cid);
            return;
        }
    #endif
    }

    g_brw_bkm_cntx.bkm_dynamic_cntx->is_first_level = MMI_FALSE;
    mmi_brw_app_create_bookmark_folders_list();
    /* highlighting the first element on entering */
    g_brw_bkm_cntx.bkm_dynamic_cntx->sel_folder_index = 0;
    
    /* here it is used for highlighting the default menu item */
    mmi_brw_app_if_show_browser_dummy_screen();
    mmi_frm_scrn_close_active_id();
}
#endif


#ifdef __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_copy_move_boookmark
 * DESCRIPTION
 * 
 * PARAMETERS
 *  fullname        [IN]        Selected filename
 *  is_short        [IN]        File name type
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_copy_move_boookmark(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *dest_file_path;
    FS_HANDLE file_handle;
    S32 error_code;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dest_file_path = (U8*) srv_brw_malloc((SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH);   
    memset(dest_file_path, 0, (SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH);
    mmi_chset_utf8_to_ucs2_string((S8*) g_brw_current_title, 
        SRV_BRW_BKM_MAX_FILE_NAME_LEN * ENCODING_LENGTH,
        (S8*) g_srv_brw_cntx.bkm_cntx_p[g_brw_bkm_cntx.bookmark_list[g_brw_bkm_cntx.sel_file_index].actual_index].title);
    srv_brw_bookmarks_create_full_file_path((S8*) g_brw_open_file_cntx.file_path,
                                            (S8*) g_brw_current_title,
                                            (S8*) SRV_BRW_BKM_USER_CREATED_FILE_DEFAULT_EXTN,
                                            (S8*) dest_file_path);

    if (mmi_ucs2strlen((S8*) dest_file_path) >= (SRV_FMGR_PATH_MAX_LEN+1))
    {
        srv_brw_free(dest_file_path);
        mmi_brw_app_handle_bookmark_error_code(SRV_BRW_BKM_ERROR_FILE_PATH_LEN_EXCEEDED);
        return;
    }
    file_handle = FS_Open((UI_string_type) dest_file_path, FS_READ_ONLY);
    if (file_handle < 0)
    {
        file_handle = FS_Open((UI_string_type) dest_file_path, FS_READ_WRITE | FS_CREATE);
        if (file_handle < 0)
        {
            if (file_handle == FS_INVALID_FILENAME)
            {
                error_code = SRV_BRW_BKM_ERROR_INVALID_TITLE;
            }
            else
            {
                error_code = file_handle;
            }
        }
        else
        {
            mmi_asc_to_ucs2((S8*) g_brw_current_url, (S8*)g_srv_brw_cntx.bkm_cntx_p[g_brw_bkm_cntx.bookmark_list[g_brw_bkm_cntx.sel_file_index].actual_index].url);
            error_code = srv_vbkm_writer_convert_file_to_standard_format(file_handle, g_brw_current_title, g_brw_current_url);
            FS_Close(file_handle);
            if (error_code != FS_NO_ERROR)
            {
                FS_Delete((UI_string_type) dest_file_path);
            }
        }
    }
    else
    {
        FS_Close(file_handle);
        error_code = SRV_BRW_BKM_ERROR_FILE_ALREADY_EXISTS;
    }
    srv_brw_free(dest_file_path);
    if(error_code == SRV_BRW_BKM_ERROR_FILE_ALREADY_EXISTS)
    {
        mmi_brw_app_copy_move_replace_file_confirm();
        return;
    }
    else if(error_code !=  FS_NO_ERROR)
    {
        mmi_brw_app_handle_bookmark_error_code(error_code);
    }
    else
    {
        if(g_brw_bkm_browse_path_event == BRW_BKM_BROWSE_PATH_MOVE_TO)
        {
            error_code = srv_brw_bkm_delete_bookmark(g_brw_bkm_cntx.bookmark_list[g_brw_bkm_cntx.sel_file_index].actual_index);
            if (error_code >= 0)
            {
                mmi_brw_app_create_bookmark_list();
                mmi_brw_app_ui_draw_display_popup_ext(
                    STR_GLOBAL_DONE,
                    MMI_EVENT_SUCCESS);
            }
            else
            {
                mmi_brw_app_file_system_error_handler(error_code);
            }
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_GLOBAL_DONE,
                MMI_EVENT_SUCCESS);
        }
    }
#ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
    mmi_frm_scrn_close(g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_BOOKMARK_BROWSE_PATH);
#endif
    cui_folder_selector_close(g_brw_app_cntx.file_selector_cid);
    g_brw_app_cntx.file_selector_cid =0;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_copy_move_replace_file
 * DESCRIPTION
 * 
 * PARAMETERS
 *  fullname        [IN]        Selected filename
 *  is_short        [IN]        File name type
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_copy_move_replace_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *dest_file_path;
    FS_HANDLE file_handle;
    S32 error_code;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dest_file_path = (U8*) srv_brw_malloc((SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH);   
    memset(dest_file_path, 0, (SRV_FMGR_PATH_MAX_LEN+1) *ENCODING_LENGTH);
    mmi_chset_utf8_to_ucs2_string((S8*) g_brw_current_title, 
        SRV_BRW_BKM_MAX_FILE_NAME_LEN * ENCODING_LENGTH,
        (S8*) g_srv_brw_cntx.bkm_cntx_p[g_brw_bkm_cntx.bookmark_list[g_brw_bkm_cntx.sel_file_index].actual_index].title);
    srv_brw_bookmarks_create_full_file_path((S8*) g_brw_open_file_cntx.file_path,
                                            (S8*) g_brw_current_title,
                                            (S8*) SRV_BRW_BKM_USER_CREATED_FILE_DEFAULT_EXTN,
                                            (S8*) dest_file_path);

    file_handle = FS_Open((UI_string_type) dest_file_path, FS_READ_WRITE);
    if (file_handle >= 0)
    {
        mmi_asc_to_ucs2((S8*) g_brw_current_url, (S8*)g_srv_brw_cntx.bkm_cntx_p[g_brw_bkm_cntx.bookmark_list[g_brw_bkm_cntx.sel_file_index].actual_index].url);
        error_code = srv_vbkm_writer_convert_file_to_standard_format(file_handle, g_brw_current_title, g_brw_current_url);
        FS_Close(file_handle);
    }
    else
    {
        error_code = file_handle;
    }
    srv_brw_free(dest_file_path);
    if(error_code !=  FS_NO_ERROR)
    {
        mmi_brw_app_handle_bookmark_error_code(error_code);
    }
    if(g_brw_bkm_browse_path_event == BRW_BKM_BROWSE_PATH_MOVE_TO)
    {
        error_code = srv_brw_bkm_delete_bookmark(g_brw_bkm_cntx.bookmark_list[g_brw_bkm_cntx.sel_file_index].actual_index);
        if (error_code >= 0)
        {
            mmi_brw_app_create_bookmark_list();
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_GLOBAL_DONE,
                MMI_EVENT_SUCCESS);
        }
        else
        {
            mmi_brw_app_file_system_error_handler(error_code);
        }
    }
    else
    {
        mmi_brw_app_ui_draw_display_popup_ext(
            STR_GLOBAL_DONE,
            MMI_EVENT_SUCCESS);
    }
#ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
    mmi_frm_scrn_close(g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_BOOKMARK_BROWSE_PATH);
#endif
    cui_folder_selector_close(g_brw_app_cntx.file_selector_cid);
    g_brw_app_cntx.file_selector_cid =0;
}
#endif /* __MMI_BRW_TRANSFER_BOOKMARK_TO_EXT_MEMORY__ */ 


mmi_ret mmi_brw_received_bookmark_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_FIRST_ENTRY:
            break;
        case EVT_ID_GROUP_INACTIVE:
            break;
        case EVT_ID_GROUP_FOCUSED:
        case EVT_ID_GROUP_ACTIVE:
			 g_brw_app_cntx.brw_scr_group_id = BRW_RECV_BOOKMARKS_GRP_ID;
            break;
        
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_DELETE_REQ:
        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            mmi_frm_group_close(BRW_RECV_BOOKMARKS_GRP_ID);
            break;
        
        case EVT_ID_GROUP_DEINIT:
        {
            MMI_BOOL is_asm_memory_taken = MMI_FALSE;
            if(g_brw_ext_bkm_cntx_p)
            {
                if(g_brw_ext_bkm_cntx_p->selected_file_path)
                {
                    srv_brw_free_browser_memory((void**)&(g_brw_ext_bkm_cntx_p->selected_file_path));
                }
                is_asm_memory_taken = g_brw_ext_bkm_cntx_p->is_asm_taken;
                srv_brw_free_browser_memory((void**)&(g_brw_ext_bkm_cntx_p));
            }
            if(is_asm_memory_taken)
            {
                srv_brw_bkm_deinitialize_bookmark_context();
                if (g_srv_brw_cntx.brw_adm_id)
                {
                    kal_adm_delete(g_srv_brw_cntx.brw_adm_id);
                    g_srv_brw_cntx.brw_adm_id = NULL;
                }

                /* de-allocate browser app ASM memory */
                if (g_brw_app_memory_pool)
                {
                    applib_asm_free_r(APP_BROWSER, g_brw_app_memory_pool);
                    g_brw_app_memory_pool = NULL;
                }
            }
            mmi_frm_group_close(BRW_RECV_BOOKMARKS_GRP_ID);
			 g_brw_app_cntx.brw_scr_group_id = GRP_ID_INVALID;
            break;
        }
    #ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
        case EVT_ID_CUI_FOLDER_SELECTOR_RESULT:
            {
                cui_folder_selector_result_event_struct *fmgr_evt = (cui_folder_selector_result_event_struct*)evt;
                if(fmgr_evt->result > 0)
                {
                    S32 error_code = FS_NO_ERROR;
                    srv_fmgr_fileinfo_struct info;
                    error_code = cui_folder_selector_get_selected_filepath(fmgr_evt->sender_id, &info, (WCHAR*)g_brw_open_file_cntx.file_path, (SRV_FMGR_PATH_MAX_LEN+1));
                    if(error_code < 0)
                    {
                        mmi_brw_app_file_system_error_handler(error_code);
                    }
                    else
                    {
                        mmi_brw_app_if_recv_file_save_to_fmgr_callback((void*)g_brw_open_file_cntx.file_path);
                    }
                }
                cui_folder_selector_close(fmgr_evt->sender_id);
            }
    #endif /* __MMI_BRW_BOOKMARK_IN_FMGR__ */
            break;
    }
    return MMI_RET_OK;
}


#ifndef __MMI_BRW_SLIM_BOOKMARK_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bookmarks_recv_file_view
 * DESCRIPTION
 *  This is an external interface for viewing a received Bookmark
 * PARAMETERS
 *  file_path       [IN]        
 *  file_name       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_bookmarks_recv_file_view(kal_uint8 *file_path, kal_uint8 *file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FS_HANDLE file_handle;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(file_path);

    file_handle = FS_Open((UI_string_type) file_path, FS_READ_ONLY);
    if (file_handle >= 0)
    {
        if (srv_vbkm_reader_validate_file(file_handle))
        {
            if (!mmi_frm_group_is_present(BRW_RECV_BOOKMARKS_GRP_ID))
            {
                g_brw_app_cntx.brw_scr_group_id = mmi_frm_group_create_ex(GRP_ID_ROOT, 
                                                                       BRW_RECV_BOOKMARKS_GRP_ID,
                                                                       mmi_brw_received_bookmark_group_proc,
                                                                       (void*)NULL, 
                                                                       MMI_FRM_NODE_SMART_CLOSE_FLAG); 
            }
            
            mmi_ucs2cpy((S8*) g_brw_current_title, (S8*) file_name);
            srv_vbkm_reader_extract_url(file_handle, g_brw_current_url);
            mmi_brw_app_if_show_view_bookmark_screen();
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_ID_BRW_INVALID_BOOKMARK_FILE,
                MMI_EVENT_FAILURE);
        }
        FS_Close(file_handle);
        return;
    }
    else
    {
        mmi_brw_app_file_system_error_handler(file_handle);
        return;
    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bookmarks_recv_file_save_to_bookmark
 * DESCRIPTION
 *  This function is the external interface for saving a received vbookmark file
 *  into bookmark application
 * PARAMETERS
 *  file_path       [IN]        File path in UCS2
 *  file_name       [IN]        File name in UCS2
 *  file_extn       [IN]        File extension in UCS2
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_bookmarks_recv_file_save_to_bookmark(kal_uint8 *file_path, kal_uint8 *file_name, kal_uint8 *file_extn)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *file_path_ascii;
    U8 file_name_ascii[(SRV_BRW_BKM_MAX_INPUT_FILE_NAME_LEN + 1) * BRW_UTF8_ENCODING_LENGTH];
    U8 file_extn_ascii[(SRV_BRW_BKM_MAX_FILE_EXTN_LEN + 1) * BRW_UTF8_ENCODING_LENGTH];
    S32 error_code;
    FS_HANDLE file_handle;
    MMI_BOOL is_asm_taken = MMI_FALSE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(file_path);
    MMI_ASSERT(file_name);
    MMI_ASSERT(file_extn);

    file_path_ascii = (U8*) OslMalloc((SRV_BRW_BKM_MAX_PATH_LEN + 1) * BRW_UTF8_ENCODING_LENGTH);
    memset(file_path_ascii, 0, (SRV_BRW_BKM_MAX_PATH_LEN + 1) * BRW_UTF8_ENCODING_LENGTH);
    
    mmi_chset_ucs2_to_utf8_string(
        (U8*) file_path_ascii,
        (SRV_BRW_BKM_MAX_PATH_LEN + 1) * BRW_UTF8_ENCODING_LENGTH,
        (U8*) file_path);
    mmi_chset_ucs2_to_utf8_string(
        (U8*) file_name_ascii,
        (SRV_BRW_BKM_MAX_INPUT_FILE_NAME_LEN + 1) * BRW_UTF8_ENCODING_LENGTH,
        (U8*) file_name);
    mmi_chset_ucs2_to_utf8_string(
        (U8*) file_extn_ascii,
        (SRV_BRW_BKM_MAX_FILE_EXTN_LEN + 1) * BRW_UTF8_ENCODING_LENGTH,
        (U8*) file_extn);

    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_RECV_FILE_SAVE_TO_BKM);

    MMI_PRINT(
        MOD_MMI_INET_APP,
        MMI_INET_TRC_G4_BRW,
        "[BrowserBookmarks][mmi_brw_bookmarks_recv_file_save_to_bookmark] file_path=%s",
        file_path_ascii);
    MMI_PRINT(
        MOD_MMI_INET_APP,
        MMI_INET_TRC_G4_BRW,
        "[BrowserBookmarks][mmi_brw_bookmarks_recv_file_save_to_bookmark] file_name=%s",
        file_name_ascii);
    MMI_PRINT(
        MOD_MMI_INET_APP,
        MMI_INET_TRC_G4_BRW,
        "[BrowserBookmarks][mmi_brw_bookmarks_recv_file_save_to_bookmark] file_extn=%s",
        file_extn_ascii);

    OslMfree(file_path_ascii);
    file_handle = FS_Open((UI_string_type) file_path, FS_READ_ONLY);
    if (file_handle >= 0)
    {
        if (srv_vbkm_reader_validate_file(file_handle))
        {
            if (!g_srv_brw_cntx.brw_adm_id)
            {
                if(!mmi_frm_group_is_present(BRW_SCREEN_GROUP))
                {
                    mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_SCREEN_GROUP, mmi_brw_internet_service_screen_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
                }
                g_brw_app_memory_pool = applib_asm_alloc_r(APP_BROWSER, SRV_BRW_APP_POOL_SIZE);
                if (!g_brw_app_memory_pool)
                {
                    mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_NOT_AVAILABLE, MMI_EVENT_FAILURE);
                    return;
                }
                else
                {
                    is_asm_taken = MMI_TRUE;
                }

                g_srv_brw_cntx.brw_adm_id = kal_adm_create(
                                            (char*)g_brw_app_memory_pool,
                                            SRV_BRW_APP_POOL_SIZE,
                                            NULL,
                                            KAL_FALSE);
                MMI_ASSERT(g_srv_brw_cntx.brw_adm_id);
            }
            mmi_brw_app_close_all_bookmark_screens();
            /* initalizing bookmark context */
            mmi_brw_app_bookmarks_context_init();

            error_code = srv_brw_bkm_initialize_bookmark_context();
            if(error_code == 0)
            {
                if (!mmi_brw_app_check_available_bookmark_memory())
                {
                    error_code = 1;
                }
            }
            if(error_code != 0)
            {
                if(error_code < 0)
                {
                    mmi_brw_app_file_system_error_handler(error_code);
                }
                if(is_asm_taken)
                {
                    srv_brw_bkm_deinitialize_bookmark_context();
                    if (g_srv_brw_cntx.brw_adm_id)
                    {
                        kal_adm_delete(g_srv_brw_cntx.brw_adm_id);
                        g_srv_brw_cntx.brw_adm_id = NULL;
                    }

                    /* de-allocate browser app ASM memory */
                    if (g_brw_app_memory_pool)
                    {
                        applib_asm_free_r(APP_BROWSER, g_brw_app_memory_pool);
                        g_brw_app_memory_pool = NULL;
                    }
                }
                return;
            }

            if (!mmi_frm_group_is_present(BRW_RECV_BOOKMARKS_GRP_ID))
            {
                g_brw_app_cntx.brw_scr_group_id = mmi_frm_group_create_ex(GRP_ID_ROOT, 
                                                                       BRW_RECV_BOOKMARKS_GRP_ID,
                                                                       mmi_brw_received_bookmark_group_proc,
                                                                       (void*)NULL,
                                                                       MMI_FRM_NODE_SMART_CLOSE_FLAG); 
            }
            g_brw_ext_bkm_cntx_p = (brw_ext_bkm_context_struct*)srv_brw_malloc(sizeof(brw_ext_bkm_context_struct));
            memset(g_brw_ext_bkm_cntx_p, 0, sizeof(brw_ext_bkm_context_struct));
            g_brw_ext_bkm_cntx_p->is_asm_taken = is_asm_taken;
            srv_vbkm_reader_extract_url(file_handle, g_brw_ext_bkm_cntx_p->bookmark_url);
            mmi_ucs2cpy((S8*) g_brw_ext_bkm_cntx_p->bookmark_name, (S8*) file_name);
            mmi_ucs2cpy((S8*) g_brw_current_title, (S8*) g_brw_ext_bkm_cntx_p->bookmark_name);
            mmi_ucs2cpy((S8*) g_brw_current_url, (S8*) g_brw_ext_bkm_cntx_p->bookmark_url);
        #ifndef __MMI_BRW_SLIM_BOOKMARK_SUPPORT__
            mmi_brw_app_if_show_save_to_bookmark_screen();
        #else
            mmi_brw_app_dmgr_save_to_bookmark();
        #endif
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_ID_BRW_INVALID_BOOKMARK_FILE,
                MMI_EVENT_FAILURE);
        }
        FS_Close(file_handle);
        return;
    }
    else
    {
        mmi_brw_app_file_system_error_handler(file_handle);
        return;
    }
}


#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bookmarks_recv_file_save_to_fmgr
 * DESCRIPTION
 *  This function is an external interface for saving a received vbookmark
 *  file to file manager
 * PARAMETERS
 *  file_path       [IN]        File path in UCS2
 *  file_name       [IN]        File name in UCS2
 *  file_extn       [IN]        File extension in UCS2
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_bookmarks_recv_file_save_to_fmgr(kal_uint8 *file_path, kal_uint8 *file_name, kal_uint8 *file_extn)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILTER filter;
    U8 *file_path_ascii;
    U8 file_name_ascii[(SRV_BRW_BKM_MAX_INPUT_FILE_NAME_LEN + 1) * BRW_UTF8_ENCODING_LENGTH];
    U8 file_extn_ascii[(SRV_BRW_BKM_MAX_FILE_EXTN_LEN + 1) * BRW_UTF8_ENCODING_LENGTH];
    FS_HANDLE file_handle;

    MMI_ID child_id;
    MMI_BOOL is_asm_taken = MMI_FALSE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(file_path);
    MMI_ASSERT(file_name);
    MMI_ASSERT(file_extn);

    file_path_ascii = (U8*) OslMalloc((SRV_BRW_BKM_MAX_PATH_LEN + 1) * BRW_UTF8_ENCODING_LENGTH);
    memset(file_path_ascii, 0, (SRV_BRW_BKM_MAX_PATH_LEN + 1) * BRW_UTF8_ENCODING_LENGTH);

    mmi_chset_ucs2_to_utf8_string(
        (U8*) file_path_ascii,
        (SRV_BRW_BKM_MAX_PATH_LEN + 1) * BRW_UTF8_ENCODING_LENGTH,
        (U8*) file_path);
    mmi_chset_ucs2_to_utf8_string(
        (U8*) file_name_ascii,
        (SRV_BRW_BKM_MAX_INPUT_FILE_NAME_LEN + 1) * BRW_UTF8_ENCODING_LENGTH,
        (U8*) file_name);
    mmi_chset_ucs2_to_utf8_string(
        (U8*) file_extn_ascii,
        (SRV_BRW_BKM_MAX_FILE_EXTN_LEN + 1) * BRW_UTF8_ENCODING_LENGTH,
        (U8*) file_extn);

    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_RECV_FILE_SAVE_TO_FMGR);

    MMI_PRINT(
        MOD_MMI_INET_APP,
        MMI_INET_TRC_G4_BRW,
        "[BrowserBookmarks][mmi_brw_bookmarks_recv_file_save_to_fmgr] file_path=%s",
        file_path_ascii);
    MMI_PRINT(
        MOD_MMI_INET_APP,
        MMI_INET_TRC_G4_BRW,
        "[BrowserBookmarks][mmi_brw_bookmarks_recv_file_save_to_fmgr] file_name=%s",
        file_name_ascii);
    MMI_PRINT(
        MOD_MMI_INET_APP,
        MMI_INET_TRC_G4_BRW,
        "[BrowserBookmarks][mmi_brw_bookmarks_recv_file_save_to_fmgr] file_extn=%s",
        file_extn_ascii);

    OslMfree(file_path_ascii);

    /* initalizing bookmark context */
    file_handle = FS_Open((UI_string_type) file_path, FS_READ_ONLY);
    /* Check if the URL is invalid or not */
    if (file_handle >= 0)
    {
        if (srv_vbkm_reader_validate_file(file_handle))
        {
            srv_vbkm_reader_extract_url(file_handle, g_brw_current_url);
            FS_Close(file_handle);
            if (srv_brw_validate_url(g_brw_current_url, WAP_MAX_SEARCH_URL_LENGTH) < 0)
            {
                mmi_brw_app_ui_draw_display_popup((PU8) GetString(STR_GLOBAL_INVALID_URL), MMI_EVENT_PROPLEM);
                return;
            }
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_ID_BRW_INVALID_BOOKMARK_FILE,
                MMI_EVENT_FAILURE);
            FS_Close(file_handle);
            return;
        }
    }
    else
    {
        mmi_brw_app_file_system_error_handler(file_handle);
        return;
    }    
    if (!g_srv_brw_cntx.brw_adm_id)
    {
        if(!mmi_frm_group_is_present(BRW_SCREEN_GROUP))
        {
            mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_SCREEN_GROUP, mmi_brw_internet_service_screen_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
        }
        g_brw_app_memory_pool = applib_asm_alloc_r(APP_BROWSER, SRV_BRW_APP_POOL_SIZE);
        if (!g_brw_app_memory_pool)
        {
            mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_NOT_AVAILABLE, MMI_EVENT_FAILURE);
            return;
        }
        else
        {
            is_asm_taken = MMI_TRUE;
        }

        g_srv_brw_cntx.brw_adm_id = kal_adm_create(
                                    (char*)g_brw_app_memory_pool,
                                    SRV_BRW_APP_POOL_SIZE,
                                    NULL,
                                    KAL_FALSE);
        MMI_ASSERT(g_srv_brw_cntx.brw_adm_id);
    }
    if (!mmi_frm_group_is_present(BRW_RECV_BOOKMARKS_GRP_ID))
    {
        g_brw_app_cntx.brw_scr_group_id = mmi_frm_group_create_ex(GRP_ID_ROOT, 
                                                               BRW_RECV_BOOKMARKS_GRP_ID,
                                                               mmi_brw_received_bookmark_group_proc,
                                                               (void*)NULL,
                                                               MMI_FRM_NODE_SMART_CLOSE_FLAG); 
    }
    g_brw_ext_bkm_cntx_p = (brw_ext_bkm_context_struct*)srv_brw_malloc(sizeof(brw_ext_bkm_context_struct));
    memset(g_brw_ext_bkm_cntx_p, 0, sizeof(brw_ext_bkm_context_struct));
    g_brw_ext_bkm_cntx_p->is_asm_taken = is_asm_taken;
    mmi_ucs2cpy((S8*) g_brw_ext_bkm_cntx_p->bookmark_name, (S8*) file_name);
    g_brw_ext_bkm_cntx_p->selected_file_path = (U8*)srv_brw_malloc((SRV_BRW_BKM_MAX_PATH_LEN + 1) *ENCODING_LENGTH);
    memset(g_brw_ext_bkm_cntx_p->selected_file_path, 0, (SRV_BRW_BKM_MAX_PATH_LEN + 1) *ENCODING_LENGTH);
    mmi_ucs2cpy((S8*) g_brw_ext_bkm_cntx_p->selected_file_path, (S8*) file_path);

    FMGR_FILTER_INIT(&filter);
    srv_fmgr_types_filter_set_group(&filter, FMGR_TYPE_FOLDER);

    child_id =  cui_folder_selector_create(g_brw_app_cntx.brw_scr_group_id,
                                           (WCHAR*)L"root",
                                           CUI_FOLDER_SELECTOR_STYLE_WRITE,
                                           CUI_FOLDER_SELECTOR_OPT_FOLDER_TRAVERSE_ALL);
    cui_folder_selector_run(child_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_recv_file_save_to_fmgr_callback
 * DESCRIPTION
 *  Call back for Book shelf Screen
 * PARAMETERS
 *  fullname        [IN]        
 *  is_short        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_recv_file_save_to_fmgr_callback(void *fullname)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 dest_file_path[(SRV_BRW_BKM_MAX_PATH_LEN + 1) * ENCODING_LENGTH];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.file_mgr_instance = 0;
    if (fullname)
    {
        mmi_ucs2cpy((S8*) dest_file_path, (S8*) fullname);
        mmi_ucs2cat((S8*) dest_file_path, (S8*) g_brw_ext_bkm_cntx_p->bookmark_name);
        mmi_ucs2cat((S8*) dest_file_path, (S8*) L".");
        mmi_ucs2cat((S8*) dest_file_path, (S8*) SRV_BRW_BKM_FILE_EXTN_URL_STRING);
        mmi_brw_app_if_copy_recv_file_to_dest(g_brw_ext_bkm_cntx_p->selected_file_path, dest_file_path);
    }
    else
    {
        mmi_frm_scrn_close_active_id();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_copy_recv_bookmark_file_rsp
 * DESCRIPTION
 *  This function is the response handler for mmi_fmgr_send_copy_req function
 * PARAMETERS
 *  info        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_app_if_copy_recv_bookmark_file_rsp(mmi_event_struct *info)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_fmgr_async_done_event_struct* async_evt;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(info->evt_id)
    {
        case EVT_ID_SRV_FMGR_ASYNC_DONE:
        {
            async_evt = (srv_fmgr_async_done_event_struct*)info;
            if(async_evt->result == 0)
            {
                if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BUSY_SCREEN)
                {
                    mmi_brw_app_ui_draw_display_popup_ext(
                        STR_GLOBAL_SAVED,
                        MMI_EVENT_EXPLICITLY_SAVED);
                }

                /* deleting the busy screen */
                mmi_brw_app_delete_busy_screen();
                mmi_vbkm_clean_one_file_buffer();
            }
            else
            {
                if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BUSY_SCREEN)
                {
                    mmi_brw_app_file_system_error_handler(async_evt->result);
                }
                /* deleting the busy screen */
                mmi_brw_app_delete_busy_screen();
            }

        }
        default:
            break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bookmarks_copy_recv_file_to_dest
 * DESCRIPTION
 *  This function is to copy the received bookmark at the given destination path
 * PARAMETERS
 *  src_file_path       [IN]        
 *  dest_file_path      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_copy_recv_file_to_dest(U8 *src_file_path, U8 *dest_file_path)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 attr;
    S32 error_code;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    attr = FS_GetAttributes((WCHAR*) src_file_path);
    attr &= ~FS_ATTR_HIDDEN;
    FS_SetAttributes((WCHAR*) src_file_path, (BYTE) attr);
    srv_brw_bookmarks_modify_filepath_for_save(dest_file_path);

    error_code = srv_fmgr_async_copy((const WCHAR*) src_file_path,
                                   (const WCHAR*) dest_file_path,
                                   NULL,
                                   mmi_brw_app_if_copy_recv_bookmark_file_rsp,
                                   NULL);
    if (error_code >= FS_NO_ERROR)
    {
        mmi_brw_app_show_progress_screen(STR_ID_BRW_BOOKMARKS, STR_GLOBAL_SAVING);
    }
    else
    {
        mmi_brw_app_file_system_error_handler(error_code);
    }
    attr = FS_GetAttributes((WCHAR*) src_file_path);
    attr &= FS_ATTR_HIDDEN;
    FS_SetAttributes((WCHAR*) src_file_path, (BYTE) attr);
}
#endif /* __MMI_BRW_BOOKMARK_IN_FMGR__ */


#endif /* __MMI_VBOOKMARK__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_server_connection_timer_callback
 * DESCRIPTION
 *  This is the callback function that will be invoked when the server connection
 * timer expires
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_server_connection_timer_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_brw_rendering_error_event_struct event;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_brw_stop_page_fetching_req();
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BROWSER_MAIN)
    {
        event.error_code = WAP_BAM_ERROR_REQUEST_TIMED_OUT;
        mmi_brw_srv_hdlr_error_ind_proc((mmi_event_struct*)&event);
    }
}


#ifdef __MMI_BRW_SPLASH_SCREEN_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_splash_screen_timer_callback
 * DESCRIPTION
 *  This is the callback function that will be executed when the Splash screen
 * timer expires
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_splash_screen_timer_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_brw_app_screenDB_struct *scrDB;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_SPLASH_SCR_TIMER_CALLBACK);

    g_brw_app_cntx.brw_dynamic_cntx_p->brw_first_page_flag = MMI_FALSE;
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_SPLASH_SCREEN)
    {
        mmi_brw_app_pre_entry_render_page();
        mmi_frm_scrn_close(g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_SPLASH_SCREEN);        
    }
    else
    {
        mmi_frm_node_struct new_node;
        new_node.id = SCR_ID_BRW_BROWSER_MAIN;
        new_node.entry_proc = (mmi_proc_func)mmi_brw_app_if_show_rendered_page_screen;
        new_node.user_data = NULL;
        mmi_frm_scrn_replace(BRW_RENDERED_PAGE_GRP_ID, SCR_ID_BRW_SPLASH_SCREEN, &new_node);
        scrDB = (mmi_brw_app_screenDB_struct*)mmi_brw_app_scrhdlr_get_screenDB(SCR_ID_BRW_SPLASH_SCREEN);
        if(scrDB->screen)
        {
            srv_brw_free(scrDB->screen);
            scrDB->screen = NULL;
        }
    }
}
#endif /* __MMI_BRW_SPLASH_SCREEN_SUPPORT__ */


#ifdef __MMI_BRW_LOADING_TIME_CHECKING__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_loading_time_check_timer_callback
 * DESCRIPTION
 *  This function is the Callback function for loading time check timer
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_loading_time_check_timer_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_brw_app_if_show_loading_time_check_screen();
}
#endif /* __MMI_BRW_LOADING_TIME_CHECKING__ */


#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_upload_completed_timer_callback
 * DESCRIPTION
 *  This function is the callback function that will be called when the 
 * Upload completed Timer expires
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_upload_completed_timer_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 prevScrId;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.brw_dynamic_cntx_p->upload_status = BRW_UPLOAD_STATUS_FINISHED;
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_UPLOAD_PROGRESS_SCREEN)
    {
        mmi_frm_scrn_close_active_id();
    }
    else
    {
        if (mmi_brw_app_is_screen_present(SCR_ID_BRW_UPLOAD_PROGRESS_SCREEN))
        {
            //GetPreviousScrnIdOf(SCR_ID_BRW_UPLOAD_PROGRESS_SCREEN, &prevScrId);
            prevScrId = mmi_frm_scrn_get_neighbor_id(g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_UPLOAD_PROGRESS_SCREEN, MMI_FRM_NODE_AFTER_FLAG);
            g_brw_app_cntx.top_scr_id = prevScrId;
        }
        mmi_frm_scrn_close( g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_UPLOAD_PROGRESS_SCREEN);
    }
}

#endif /* __MMI_BRW_FILE_UPLOAD_SUPPORT__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_load_service_message
 * DESCRIPTION
 *  Function to launch a Service message URL using the sim specified by the
 * service message application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_load_service_message (kal_uint8 *url, kal_bool is_from_inbox, kal_uint16 sim_id)
{
}


//TODO check if to rename the following API names or not
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_load_service_message
 * DESCRIPTION
 *  Function to launch a Service message URL using the sim specified by the
 * service message application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U16 mmi_brw_get_screen_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_BRW_SPLASH_SCREEN_SUPPORT__
	if(mmi_brw_app_is_screen_present(SCR_ID_BRW_SPLASH_SCREEN))
		return SCR_ID_BRW_SPLASH_SCREEN;
	else
#endif /* __MMI_BRW_SPLASH_SCREEN_SUPPORT__ */
		return SCR_ID_BRW_BROWSER_MAIN;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_start_browser_action
 * DESCRIPTION
 *  This func is the interface for the external application to allow browser
 *  to perform some particular action
 * PARAMETERS
 *  option      [IN]        Type of browser action
 *  url         [IN]        URL string in UCS2
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_start_browser_action(U8 option, U8 *url)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *url_ascii;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    url_ascii = (U8*)OslMalloc(SRV_BRW_MAX_URL_LEN + 1);
    memset(url_ascii, 0, SRV_BRW_MAX_URL_LEN + 1);
    if (url)
    {
        mmi_ucs2_n_to_asc((S8*) url_ascii, (S8*) url, SRV_BRW_MAX_URL_LEN * ENCODING_LENGTH);
    }

    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_START_BRW_ACTION, option);

    MMI_PRINT(MOD_MMI_INET_APP, MMI_INET_TRC_G4_BRW, "[BrowserMain][mmi_brw_start_browser_action] url=%s", url_ascii);
    OslMfree(url_ascii);

    if(g_srv_brw_cntx.is_create_instance_processing)
    {
        return;
    }

    switch (option)
    {
        case WAP_BROWSER_GOTO_HOMEPAGE:
        {
            mmi_brw_app_if_launch_homepage();
            break;
        }
        case WAP_BROWSER_GOTO_OP_HOMEPAGE:
        {
            mmi_brw_app_if_launch_operator_homepage();
            break;
        }
        case WAP_BROWSER_GOTO_URL_BACKGROUND:
        {
            MMI_ASSERT(url);
            mmi_brw_app_if_launch_background_url(url);
            break;
        }
        case WAP_BROWSER_GOTO_URL:
        {
            MMI_ASSERT(url);
            mmi_brw_app_if_launch_url(url);
            break;
        }
        default:
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_ID_BRW_UNSUPPORTED_ACTION,
                MMI_EVENT_PROPLEM);
            return;
        }
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_launch_homepage
 * DESCRIPTION
 *  This func is the external interface to open the browser homepage
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_launch_homepage(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_wap_prof_profile_content_struct *profile_content_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_brw_get_profile_content((void **)&profile_content_p);
    mmi_brw_app_load_url((U8*) profile_content_p->url);
    OslMfree(profile_content_p);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_launch_operator_homepage
 * DESCRIPTION
 *  This func is the external interface to open the operator specified homepage
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_launch_operator_homepage(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_wap_prof_profile_content_struct *operator_profile_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_srv_brw_cntx.srv_brw_profile_type = SRV_BRW_PROFILE_TYPE_OPERATOR;

    srv_brw_get_profile_content((void **)&operator_profile_p);
/* To support WAP KEY feature for China Unicom operator */
#ifdef OBIGO_Q03C_BROWSER
    if(strlen(WAP_CUSTOM_CFG_WAP_KEY_URL) != 0)
    {
        mmi_brw_app_load_url((U8*)WAP_CUSTOM_CFG_WAP_KEY_URL);
    }
    else
#endif /* OBIGO_Q03C_BROWSER */
    {
        mmi_brw_app_load_url(operator_profile_p->url);
    }

    OslMfree(operator_profile_p);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_launch_background_url
 * DESCRIPTION
 *  This func is the external interface to fetch the given url in bakcground
 * PARAMETERS
 *  url_p       [IN]        URL string in UCS2
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_launch_background_url(U8 *url_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_ucs2strlen((S8*) url_p) > SRV_BRW_MAX_URL_LEN)
    {
        mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_INVALID_URL, MMI_EVENT_PROPLEM);
        return;
    }

    if (srv_brw_validate_url((U8*)url_p,  SRV_BRW_MAX_URL_LEN - 1) < 0)
    {
        mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_INVALID_URL, MMI_EVENT_PROPLEM);
        return;
    }
    if (!(g_srv_brw_cntx.brw_instance_id > 0))
    {
        mmi_brw_app_if_launch_url(url_p);
        return;
    }
    else if ((g_srv_brw_cntx.brw_instance_id > 0) && (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BROWSER_MAIN))
    {
        mmi_ucs2ncpy((S8*) g_brw_current_url, (S8*) url_p, SRV_BRW_MAX_URL_LEN);
        mmi_brw_app_load_url(g_brw_current_url);
        return;
    }
    else if ((g_srv_brw_cntx.brw_instance_id > 0) && (mmi_brw_app_is_screen_present(SCR_ID_BRW_BROWSER_MAIN) || mmi_brw_app_is_screen_present(mmi_brw_app_get_splash_scr_id())))
    {
        mmi_brw_app_free_browser_memory((void**)&(g_brw_app_cntx.brw_dynamic_cntx_p->requested_url_p));
        g_brw_app_cntx.brw_dynamic_cntx_p->requested_url_p = (U8*)srv_brw_malloc(SRV_BRW_MAX_URL_LEN + 1);
        memset(g_brw_app_cntx.brw_dynamic_cntx_p->requested_url_p, 0, (SRV_BRW_MAX_URL_LEN + 1));
        mmi_ucs2_n_to_asc((S8*) g_brw_app_cntx.brw_dynamic_cntx_p->requested_url_p, (S8*) url_p, SRV_BRW_MAX_URL_LEN * ENCODING_LENGTH);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_launch_url
 * DESCRIPTION
 *  This func is the external interface to fetch the given url in bakcground
 * PARAMETERS
 *  url_p       [IN]        URL string in UCS2
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_launch_url(U8 *url_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *url_ascii;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_ucs2strlen((S8*) url_p) > WAP_MAX_SEARCH_URL_LENGTH)
    {
        mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_INVALID_URL, MMI_EVENT_PROPLEM);
    #ifdef __MMI_RMGR_SEAMLESS_UNLOCK__
        mmi_rmgr_unlock_session_callback();
    #endif 
        return;
    }

    url_ascii = (U8*) OslMalloc(WAP_MAX_SEARCH_URL_LENGTH + 1);
    memset(url_ascii, 0, WAP_MAX_SEARCH_URL_LENGTH + 1);

    mmi_chset_ucs2_to_utf8_string((U8*) url_ascii, WAP_MAX_SEARCH_URL_LENGTH + 1, (U8*) url_p);

    if (mmi_brw_is_browser_active())
    {
        /* deinitializing the current browser instance so that a new instance can be created */
        /* this change has been done to resolve the CQ issue# MAUI_00544465 */
        mmi_brw_app_deinit();

        /* Notifying download agent about browser deinitialization */
        srv_brw_background_downloads_req(MMI_DA_WAP_NOTIFY_BROWSER_REOPENED);
    }
    if(mmi_frm_group_is_present(BRW_SCREEN_GROUP))
    {
        mmi_frm_group_close(BRW_SCREEN_GROUP);
    }
    if(g_brw_app_cntx.add_bkm_cid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(g_brw_app_cntx.add_bkm_cid);
    }
    if(g_brw_app_cntx.sel_bkm_cid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(g_brw_app_cntx.sel_bkm_cid);
    }
#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
    if(mmi_frm_group_is_present(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID))
    {
        mmi_frm_group_close(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID);
    }
#endif /* __MMI_BRW_BOOKMARK_IN_FMGR__ */
#ifdef __MMI_VBOOKMARK__
    if(mmi_frm_group_is_present(BRW_RECV_BOOKMARKS_GRP_ID))
    {
        mmi_frm_group_close(BRW_RECV_BOOKMARKS_GRP_ID);
    }
#endif /* __MMI_VBOOKMARK__ */
    mmi_brw_app_load_url(url_ascii);
    OslMfree(url_ascii);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_rendered_page_present
 * DESCRIPTION
 *  This function is to check if the Browser rendered page screen has been 
 * displayed or not (means either active or in history)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_brw_is_rendered_page_present(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BROWSER_MAIN || mmi_brw_app_is_screen_present(SCR_ID_BRW_BROWSER_MAIN))
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_temp_busy_screen_active
 * DESCRIPTION
 *  This function is to check if the Browser temp busy screen is currently 
  * active or not(for WIDGET)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_brw_is_temp_busy_screen_active(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_TEMP_BUSY_SCREEN)
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


#ifdef OBIGO_Q03C_BROWSER
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_paint_outside_look
 * DESCRIPTION
 *  This function is called by Widget when they need to draw the outside look
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_paint_outside_look(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BROWSER_MAIN)
    {
#if defined(__MMI_FTE_SUPPORT__)
#ifdef __MMI_ICON_BAR_SUPPORT__
        if(wgui_icon_bar_is_created())
        {
            wgui_icon_bar_move(0, UI_device_height - MMI_ICON_BAR_HEIGHT - MMI_SOFTKEY_BAR_HEIGHT);
            wgui_icon_bar_resize(UI_device_width, MMI_ICON_BAR_HEIGHT);
            wgui_icon_bar_show();
        }  
#endif
#endif
        mmi_brw_app_draw_ren_page_title();
        show_softkey_background();
        redraw_left_softkey();
        redraw_right_softkey();
    }
}
#endif /* OBIGO_Q03C_BROWSER */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_active_profile_homepage_change
 * DESCRIPTION
 *  This function is written to keep the behavior of profile module same for
 *  both Q03C and Q05A Browser.
 *  No need to do anything in this function as Browser application takes the
 *  homepage from the profile itself when the homepage is launched
 * PARAMETERS
 *  ascii_url          [IN]
 *  sim_id             [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_active_profile_homepage_change (U8 *ascii_url, srv_wap_prof_sim_id_enum sim_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_is_active_profile_in_use
 * DESCRIPTION
 *  This func is used for displaying the session info
 * PARAMETERS
 *  void
 *  url(?)      [IN]        Url in ASCII
 * RETURNS
 *  void
 *****************************************************************************/
kal_bool mmi_brw_is_active_profile_in_use(mmi_brw_sim_id_enum sim_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_brw_app_is_screen_present(mmi_brw_get_screen_id()) && 
        (srv_brw_convert_sim_setting_to_browser_sim_id(g_srv_brw_cntx.session_sim_id) == sim_id))
    {
        return KAL_TRUE;
    }
    else
    {
        return KAL_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_get_error_string_id
 * DESCRIPTION
 *  This function is used return the error string to be displayed by UM
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U16 mmi_brw_get_error_string_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (STR_GLOBAL_CURRENTLY_NOT_AVAILABLE);
}


#ifdef __MMI_VBOOKMARK__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bookmarks_goto_from_fmgr
 * DESCRIPTION
 *  This function is an external interface for file manager to fetch the URL
 *  given in selected vbookmark file
 * PARAMETERS
 *  fullname        [IN]        
 *  is_short        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_bookmarks_goto_from_fmgr(void *fullname, int is_short)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FS_HANDLE file_handle;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(fullname);
    file_handle = FS_Open((UI_string_type) fullname, FS_READ_ONLY);
    if (file_handle >= 0)
    {
        if (srv_vbkm_reader_validate_file(file_handle))
        {
            srv_vbkm_reader_extract_url(file_handle, g_brw_current_url);
            mmi_brw_app_if_launch_url(g_brw_current_url);
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup(
                (PU8) GetString(STR_ID_BRW_INVALID_BOOKMARK_FILE),
                MMI_EVENT_FAILURE);
        }
        FS_Close(file_handle);
        return;
    }
    else
    {
        mmi_brw_app_file_system_error_handler(file_handle);
        return;
    }
}
#endif

#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
mmi_ret mmi_brw_open_bookmark_from_fmgr_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_FOCUSED:
        case EVT_ID_GROUP_ACTIVE:
			 g_brw_app_cntx.brw_scr_group_id = BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID;
            break;
        
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_DELETE_REQ:
        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            mmi_frm_group_close(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID);
            break;
        
        case EVT_ID_GROUP_DEINIT:
        {
            MMI_BOOL is_asm_taken  = MMI_FALSE;
            if(g_brw_ext_bkm_cntx_p)
            {
                if(g_brw_ext_bkm_cntx_p->selected_file_path)
                {
                    srv_brw_free_browser_memory((void**)&(g_brw_ext_bkm_cntx_p->selected_file_path));
                }
                is_asm_taken = g_brw_ext_bkm_cntx_p->is_asm_taken;
                srv_brw_free_browser_memory((void**)&(g_brw_ext_bkm_cntx_p));
            }
            if(is_asm_taken)
            {
                srv_brw_bkm_deinitialize_bookmark_context();
                if (g_srv_brw_cntx.brw_adm_id)
                {
                    kal_adm_delete(g_srv_brw_cntx.brw_adm_id);
                    g_srv_brw_cntx.brw_adm_id = NULL;
                }

                /* de-allocate browser app ASM memory */
                if (g_brw_app_memory_pool)
                {
                    applib_asm_free_r(APP_BROWSER, g_brw_app_memory_pool);
                    g_brw_app_memory_pool = NULL;
                }
            }
            mmi_frm_group_close(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID);
            g_brw_app_cntx.brw_scr_group_id = GRP_ID_INVALID;
            break;
        }
    }
    return MMI_RET_OK;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bookmarks_open_from_fmgr
 * DESCRIPTION
 *  This function is an external interface for file manager to display the Open
 *  menu for the selected vbookmark file
 * PARAMETERS
 *  fullname        [IN]        
 *  is_short        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_bookmarks_open_from_fmgr(void *fullname)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FS_HANDLE file_handle;
    MMI_BOOL is_asm_taken = MMI_FALSE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(fullname);

    file_handle = FS_Open((UI_string_type) fullname, FS_READ_ONLY);
    if (file_handle >= 0)
    {
        if (srv_vbkm_reader_validate_file(file_handle))
        {
            if (!g_srv_brw_cntx.brw_adm_id)
            {
                if(!mmi_frm_group_is_present(BRW_SCREEN_GROUP))
                {
                    mmi_frm_group_create_ex(GRP_ID_ROOT, BRW_SCREEN_GROUP, mmi_brw_internet_service_screen_proc, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
                }
                g_brw_app_memory_pool = applib_asm_alloc_r(APP_BROWSER, SRV_BRW_APP_POOL_SIZE);
                if (!g_brw_app_memory_pool)
                {
                    mmi_brw_app_ui_draw_display_popup_ext(STR_GLOBAL_NOT_AVAILABLE, MMI_EVENT_FAILURE);
                    return;
                }
                else
                {
                    is_asm_taken = MMI_TRUE;
                }

                g_srv_brw_cntx.brw_adm_id = kal_adm_create(
                                            (char*)g_brw_app_memory_pool,
                                            SRV_BRW_APP_POOL_SIZE,
                                            NULL,
                                            KAL_FALSE);
                MMI_ASSERT(g_srv_brw_cntx.brw_adm_id);
            }
            if (!mmi_frm_group_is_present(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID))
            {
                g_brw_app_cntx.brw_scr_group_id = mmi_frm_group_create_ex(GRP_ID_ROOT, 
                                                                       BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID,
                                                                       mmi_brw_open_bookmark_from_fmgr_group_proc,
                                                                       (void*)NULL,
                                                                       MMI_FRM_NODE_SMART_CLOSE_FLAG); 
            }
            g_brw_ext_bkm_cntx_p = (brw_ext_bkm_context_struct*)srv_brw_malloc(sizeof(brw_ext_bkm_context_struct));
            memset(g_brw_ext_bkm_cntx_p, 0, sizeof(brw_ext_bkm_context_struct));
            g_brw_ext_bkm_cntx_p->is_asm_taken = is_asm_taken;
            srv_vbkm_reader_extract_url(file_handle, g_brw_ext_bkm_cntx_p->bookmark_url);
            srv_vbkm_reader_extract_title(file_handle, g_brw_ext_bkm_cntx_p->bookmark_name);
            g_brw_ext_bkm_cntx_p->selected_file_path = (U8*)srv_brw_malloc(SRV_FMGR_PATH_MAX_LEN);
            memset(g_brw_ext_bkm_cntx_p->selected_file_path, 0, SRV_FMGR_PATH_MAX_LEN);
            mmi_ucs2cpy((S8*)g_brw_ext_bkm_cntx_p->selected_file_path, (S8*)fullname);
            mmi_brw_app_if_show_bookmark_open_from_fmgr_screen();
        }
        else
        {
            mmi_brw_app_ui_draw_display_popup_ext(
                STR_ID_BRW_INVALID_BOOKMARK_FILE,
                MMI_EVENT_FAILURE);
        }
        FS_Close(file_handle);
        return;
    }
    else
    {
        mmi_brw_app_file_system_error_handler(file_handle);
        return;
    }
}

#endif /* __MMI_BRW_BOOKMARK_IN_FMGR__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_memory_card_plug_out_hdlr
 * DESCRIPTION
 *  This function is called from file manager to deinitalize browser if memory
 *  card is removed
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_app_if_memory_card_plug_out(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_MEMORY_CARD_HNDLR);
    switch(evt->evt_id)
    {
        case EVT_ID_SRV_FMGR_NOTIFICATION_DEV_PLUG_OUT:
            {
#ifdef OBIGO_Q03C_BROWSER
                HDIa_widgetContentChangeNotifyFlagSet();
#endif
#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
                if(mmi_frm_group_is_present(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID))
                {
                    if(*g_brw_ext_bkm_cntx_p->selected_file_path == SRV_FMGR_CARD_DRV)
                    {
                        mmi_frm_group_close(BRW_OPEN_BOOKMARKS_FROM_FMGR_GRP_ID);
                    }
                }
#endif

            }
        break;

        case EVT_ID_SRV_FMGR_NOTIFICATION_DEV_PLUG_IN:
#ifdef OBIGO_Q03C_BROWSER
            HDIa_widgetContentChangeNotifyFlagSet();
#endif
        break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_deinit_browser
 * DESCRIPTION
 *  Function to deinit browser and remove all its screen if SMS removes Browser
 *  screen on re-nentry
 * PARAMETERS
 *  
 * RETURNS
 *   
 *****************************************************************************/
void mmi_brw_deinit_browser(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!mmi_brw_app_is_browser_launched_from_main_menu())
    {
        mmi_brw_app_close_download_and_exit();
    }
}


#ifdef __MMI_OP11_HOMESCREEN__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_OP11_HOMESCREEN__ */


#ifdef MMI_BRW_BEARER_SWITCH_SUPPORT
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bearer_switch_hdlr
 * DESCRIPTION
 *  This func is callback for getting the current bearer status
 * PARAMETERS  
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_app_if_bearer_switch_hdlr(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_cbm_bearer_event_struct *evt = (srv_cbm_bearer_event_struct*) param;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_srv_brw_cntx.srv_brw_dynamic_cntx_p->is_activating_wifi)
    {
        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 12, 0, 0, 0);
        return MMI_RET_OK;
    }
    if(evt->type == SRV_CBM_BEARER_EVENT_DISCONNECT)
    {
        if(srv_brw_is_in_transaction())
        {
            g_srv_brw_cntx.srv_brw_dynamic_cntx_p->relaunch_info.is_switching_bearer = MMI_TRUE;
            srv_brw_stop_page_fetching_req();
            MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 8, 0, 0, 0);
        }
        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 9, 0, 0, 0);
        return MMI_RET_OK;
    }
    if (evt->user_result)
    {
        wap_mmi_file_dl_nw_switch_ind_struct *myMsgPtr = (wap_mmi_file_dl_nw_switch_ind_struct *)
		        construct_local_para((kal_uint16) sizeof(wap_mmi_file_dl_nw_switch_ind_struct),
				        TD_RESET);
	    myMsgPtr->user_result = evt->user_result;
	    myMsgPtr->switch_type = (kal_int32) evt->switch_type;
        srv_brw_event_hdlr_send_ilm_to_mmi(MSG_ID_WAP_MMI_FILE_DL_NW_SWITCH_IND, myMsgPtr, NULL);
        if (srv_brw_is_holding_bearer())
        {
            MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 10, 0, 0, 0);
            srv_brw_set_bearer(MMI_FALSE);
        }
        if(srv_brw_is_in_transaction())
        {
            MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 11, 0, 0, 0);
            srv_brw_stop_page_fetching_req();
            g_srv_brw_cntx.srv_brw_dynamic_cntx_p->relaunch_info.is_switching_bearer = MMI_TRUE;
        }
        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 13, 0, 0, evt->switch_type);
        if (evt->switch_type ==  SRV_CBM_BEARER_SWITCH_PS_TO_WIFI
            || evt->switch_type == SRV_CBM_BEARER_SWITCH_WIFI_TO_PS
            || evt->switch_type == SRV_CBM_BEARER_SWITCH_WIFI_TO_WIFI)
        {
            if(g_srv_brw_cntx.srv_brw_dynamic_cntx_p->is_closing_sockets)
            {
                MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 5, 0, 0, evt->switch_type);
            }
            else
            {
                srv_brw_act_req_struct obj = {0};
                srv_brw_list_element_req_struct data;
                MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 6, 0, 0, evt->switch_type);
                mmi_brw_app_show_progress_screen(STR_ID_BRW_INTERNET_SERVICES, STR_GLOBAL_PLEASE_WAIT);
                obj.rsp_callback = mmi_brw_srv_hdlr_close_sockets;
                srv_brw_release_sockets_req(&obj);
            }
        }
        if(evt->type == SRV_CBM_BEARER_WIFI)
        {
            g_brw_app_cntx.brw_dynamic_cntx_p->is_using_wifi = MMI_TRUE;
        }
        else
        {
            g_brw_app_cntx.brw_dynamic_cntx_p->is_using_wifi = MMI_FALSE;
        }
    }
    else
    {
        if(!g_srv_brw_cntx.srv_brw_dynamic_cntx_p->document_info_p && mmi_brw_app_is_browser_launched_from_main_menu())
        {
            MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 4, 0, 0, 0);
            g_srv_brw_cntx.srv_brw_dynamic_cntx_p->isBrowserFetching = MMI_FALSE;
            mmi_frm_scrn_close(BRW_RENDERED_PAGE_GRP_ID, SCR_ID_BRW_BROWSER_MAIN);
        #ifdef __MMI_BRW_SPLASH_SCREEN_SUPPORT__
            mmi_frm_scrn_close(BRW_RENDERED_PAGE_GRP_ID, SCR_ID_BRW_SPLASH_SCREEN);
        #endif /* __MMI_BRW_SPLASH_SCREEN_SUPPORT__ */
        }
        srv_brw_set_bearer(MMI_FALSE);
        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 7, 0, 0, 0);
    }
    return MMI_RET_OK;
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_bearer_status_proc
 * DESCRIPTION
 *  This func is callback for getting the current bearer status
 * PARAMETERS  
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_app_if_wifi_bearer_status_proc(mmi_event_struct* event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_cbm_bearer_info_struct *bearer_info_p = (srv_cbm_bearer_info_struct*)event;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_srv_brw_cntx.srv_brw_dynamic_cntx_p &&  g_srv_brw_cntx.srv_brw_dynamic_cntx_p->is_activating_wifi)
    {
        switch (bearer_info_p->state)
        {
            case SRV_CBM_ACTIVATED:
            {
                srv_wap_prof_profile_content_struct *profile_content_p;
                srv_brw_act_req_struct obj = {0};
                srv_brw_set_profile_req_struct prof = {0};
                srv_brw_get_profile_content((void **)&profile_content_p);
                obj.rsp_callback = mmi_brw_srv_hdlr_set_profile;
                prof.currprof = profile_content_p;
                prof.setting_id = wap_bam_setting_type_profile;
                prof.type = wap_bam_do_not_set_profile_to_brs;
                obj.req_data = (void*)&prof;
                srv_brw_set_profile_req_by_data(&obj);
                OslMfree(profile_content_p);
                if(g_brw_app_cntx.brw_launching_pad == BRW_LPD_NONE)
                {
                    g_brw_app_cntx.brw_launching_pad = BRW_LPD_WIFI_PREFER_LAUNCH;
                }
                MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 1, 0, 0, 0);
                g_srv_brw_cntx.srv_brw_dynamic_cntx_p->is_activating_wifi = MMI_FALSE;
                if(bearer_info_p->type == SRV_CBM_BEARER_WIFI)
                {
                    g_brw_app_cntx.brw_dynamic_cntx_p->is_using_wifi = MMI_TRUE;
                }
                else
                {
                    g_brw_app_cntx.brw_dynamic_cntx_p->is_using_wifi = MMI_FALSE;
                }
            }
            break;

            case SRV_CBM_DEACTIVATED:
            {
                srv_wap_prof_profile_content_struct *profile_content_p;
                g_brw_app_cntx.brw_dynamic_cntx_p->is_using_wifi = MMI_FALSE;
                srv_brw_open_bearer_rsp(0);
                if (srv_brw_is_holding_bearer())
                {
                    srv_brw_set_bearer(MMI_FALSE);
                }
            #ifdef OBIGO_Q05A
                if (mmi_frm_scrn_get_active_id() == SCR_ID_BRW_BUSY_SCREEN)
            #endif
                {
                    if(g_srv_brw_cntx.srv_brw_dynamic_cntx_p->is_activating_wifi && bearer_info_p->error_cause != ABM_E_REJECTED)
                    {
                        mmi_brw_app_ui_draw_display_popup_ext(
                            STR_ID_BRW_CONNECTION_FAILED,
                            MMI_EVENT_PROPLEM);
                    }
                }
                if(g_srv_brw_cntx.srv_brw_dynamic_cntx_p  &&
                    (g_brw_app_cntx.brw_dynamic_cntx_p->launch_type == BRW_LAUNCH_TYPE_OUTSIDE_URL ||
                    g_brw_app_cntx.brw_dynamic_cntx_p->launch_type == BRW_LAUNCH_TYPE_OUTSIDE_FILE))
                {
                    mmi_brw_app_deinit();
                }
                g_brw_app_cntx.brw_dynamic_cntx_p->launch_type = BRW_LAUNCH_TYPE_END;
                g_srv_brw_cntx.srv_brw_dynamic_cntx_p->is_activating_wifi = MMI_FALSE;
                MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_FALLBACK_NOTIFY, 2, 0, 0, 0);
                mmi_brw_app_delete_busy_screen();
            }
            break;
        }
    }
    if (g_srv_brw_cntx.srv_brw_dynamic_cntx_p)
    {
        MMI_TRACE(MMI_INET_TRC_G4_BRW, MMI_BRW_BEARER_STATUS_NOTIFY, bearer_info_p->state, bearer_info_p->type, bearer_info_p->account_id, 1);
    
        if (bearer_info_p->state == SRV_CBM_DEACTIVATED)
        {
            if (g_srv_brw_cntx.srv_brw_dynamic_cntx_p->isBrowserFetching)
            {
                g_srv_brw_cntx.srv_brw_dynamic_cntx_p->need_bearer_release = MMI_TRUE;
            }
            else
            {
                if (srv_brw_is_holding_bearer())
                {
                    srv_brw_set_bearer(MMI_FALSE);
                }
            }
        }
        if (bearer_info_p->state == SRV_CBM_ACTIVATED)
        {
            g_brw_app_cntx.brw_dynamic_cntx_p->is_bearer_active = MMI_TRUE;
        }
        else if (bearer_info_p->state == SRV_CBM_DEACTIVATED 
        #ifdef __TCPIP_OVER_CSD__
            || bearer_info_p->state == SRV_CBM_CSD_AUTO_DISC_TIMEOUT
        #endif /*#ifdef __TCPIP_OVER_CSD__ */
        #ifdef __MMI_WAP_GPRS_LINGER_TIMEOUT__
            || bearer_info_p->state == SRV_CBM_GPRS_AUTO_DISC_TIMEOUT
        #endif
        )
        {
            g_brw_app_cntx.brw_dynamic_cntx_p->is_bearer_active = MMI_FALSE;
        }
    #ifndef __MMI_TITLE_BAR_NO_ICON_SHCT__    
    #ifdef __MMI_BRW_PAGE_FETCHING_STATUS__
        if (g_brw_app_cntx.brw_dynamic_cntx_p->page_fetching_status == BRW_TOTAL_FETCHING_STATUS)
    #endif
        {
            mmi_brw_app_set_ren_page_title_icon();
        }
    #endif
    }
#if (MMI_MAX_SIM_NUM >= 2)
    if (g_brw_app_cntx.brw_launching_pad == BRW_LPD_TEMP_PROFILE_CHANGED &&
        g_srv_brw_cntx.is_profile_req_received)
    {
        mmi_brw_app_launch_browser();
    }
#endif /* (MMI_MAX_SIM_NUM >= 2) */
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_sel_bkm_send_result
 * DESCRIPTION
 *  To send result for select bookmark
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_sel_bkm_send_result(cui_bkm_evt_enum result, U8 * url, U8* title)
{
    cui_bkm_sel_bkm_result_evt_struct evt;

    /* handle cancel operation */

    MMI_FRM_INIT_EVENT(&evt, result);
    //MMI_FRM_INIT_GROUP_EVENT((&evt), (sizeof(cui_bkm_sel_bkm_result_evt_struct)), (g_brw_app_cntx.sel_bkm_cid));
    evt.sender_id = g_brw_app_cntx.sel_bkm_cid;
    //evt.selected_utf8_url = url; /* e.g. MMI_UCM_RESULT_CALLED_PARTY_BUSY */
    evt.selected_utf8_url = url;
    evt.selected_utf8_title = title;
    /* post back result */
    //MMI_FRM_SEND_EVENT((mmi_event_struct *)&evt, NULL, NULL);
    mmi_frm_group_send_to_caller(g_brw_app_cntx.sel_bkm_cid, (mmi_group_event_struct*) &evt);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bkm_sel_bookmark_proc
 * DESCRIPTION
 *  Proc funtion for select bookmark
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_bkm_sel_bookmark_proc(mmi_event_struct *evt)
{
    switch(evt->evt_id)
    {
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
            mmi_brw_sel_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE, NULL, NULL);
            break;
        case EVT_ID_GROUP_DELETE_REQ:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            mmi_brw_sel_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE, NULL, NULL);
            break;
        case EVT_ID_GROUP_EXIT:
        case EVT_ID_GROUP_DEINIT:
            mmi_brw_sel_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE, NULL, NULL);
            break;
        default:
            return MMI_RET_OK;        
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_brw_add_bkm_send_result
 * DESCRIPTION
 *  To send result for select bookmark
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_add_bkm_send_result(cui_bkm_evt_enum result)
{
    cui_bkm_add_bkm_result_evt_struct evt;

    /* handle cancel operation */
    if(g_brw_app_cntx.add_bkm_cid != GRP_ID_INVALID)
    {
        MMI_FRM_INIT_EVENT(&evt, result);
        evt.sender_id = g_brw_app_cntx.add_bkm_cid;
        /* post back result */
        //MMI_FRM_SEND_EVENT((mmi_event_struct *)&evt, NULL, NULL);
        mmi_frm_group_send_to_caller(g_brw_app_cntx.add_bkm_cid, (mmi_group_event_struct*) &evt);
    }
}
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_bkm_add_bookmark_proc
 * DESCRIPTION
 *  Proc funtion for select bookmark
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_brw_bkm_add_bookmark_proc(mmi_event_struct *evt)
{
    switch(evt->evt_id)
    {
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
            mmi_brw_add_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE);
            break;
        case EVT_ID_GROUP_DELETE_REQ:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            mmi_brw_add_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE);
            break;
        case EVT_ID_GROUP_EXIT:
        case EVT_ID_GROUP_DEINIT:
            mmi_brw_add_bkm_send_result(EVT_ID_CUI_BKM_ADD_BKM_CLOSE);
            break;
        default:
            return MMI_RET_OK;        
    }
    return MMI_RET_OK;
}
/* End of Select Bookmark and Add Bookmark*/

#ifdef OBIGO_Q05A
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_web_page_open_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_web_page_open_handler(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (item_id)
    {
        case MENU_ID_BRW_WEB_PAGE_OPEN:
        {
            mmi_brw_open_file_from_fmgr((U8*)filepath, 0);
            break;
        }
        default:
            break;
    }
}
#endif

#ifdef __MMI_VBOOKMARK__
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_fmgr_bookmark_options_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_fmgr_bookmark_options_handler(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (item_id)
    {
        case MENU_ID_BRW_FMGR_BOOKMARK_GOTO:
        {
            mmi_brw_bookmarks_goto_from_fmgr((U8*)filepath, 0);
            break;
        }
#ifdef __MMI_BRW_BOOKMARK_IN_FMGR__
        case MENU_ID_BRW_FMGR_BOOKMARK_OPEN:
        {
            mmi_brw_bookmarks_open_from_fmgr((U8*)filepath);
            break;
        }
#endif
#if !defined (__MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__)
        case MENU_ID_BRW_FMGR_BOOKMARK_SEND_BY_SMS:
        {
            mmi_vbkm_fmgr_sms_forward((U8*)filepath);
            break;
        }
#endif
        default:
            break;
    }
}
#endif


/*****************************************************************************
 * FUNCTION
 *  mmi_prof_app_filemgr_option_enabler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_web_page_open_enabler(mmi_menu_id item_id, 
                                         const WCHAR* filepath, 
                                         const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!mmi_brw_app_is_any_network_available() ||
        !srv_mode_switch_is_network_service_available())
    {
    #ifdef __MMI_WLAN_FEATURES__
        if(srv_dtcnt_wlan_status() == SRV_DTCNT_WLAN_STATUS_INACTIVE)
    #endif
        {
            mmi_frm_hide_menu_item(MENU_ID_BRW_WEB_PAGE_OPEN);
        }
    }  
}

/*****************************************************************************
 * FUNCTION
 *  mmi_prof_app_filemgr_option_enabler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_fmgr_bookmark_enabler(mmi_menu_id item_id, 
                                         const WCHAR* filepath, 
                                         const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!mmi_brw_app_is_any_network_available() ||
        !srv_mode_switch_is_network_service_available() )
    {
    #ifdef __MMI_WLAN_FEATURES__
        if(srv_dtcnt_wlan_status() == SRV_DTCNT_WLAN_STATUS_INACTIVE)
    #endif
        {
            mmi_frm_hide_menu_item(MENU_ID_BRW_FMGR_BOOKMARK_GOTO);
            mmi_frm_hide_menu_item(MENU_ID_BRW_FMGR_BOOKMARK_OPEN);
        }
    }
#if !defined (__MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__)
    if(srv_sms_is_hide_send_sms_menu_item())
    {
        mmi_frm_hide_menu_item(MENU_ID_BRW_FMGR_BOOKMARK_SEND_BY_SMS);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_BRW_FMGR_BOOKMARK_SEND_BY_SMS);
    }
#endif
}

#ifdef OBIGO_Q03C_BROWSER
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_reload_req_processed
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_reload_req_processed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.brw_dynamic_cntx_p->reload_req_processing = MMI_FALSE;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_load_url_req_processed
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_brw_app_if_load_url_req_processed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_brw_app_cntx.brw_dynamic_cntx_p->load_req_processing = MMI_FALSE;
}
#endif

#if (defined(__SIM_HOT_SWAP_SUPPORT__)|| defined(__SIM_RECOVERY_ENHANCEMENT__))
/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_sim_event_detected_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 * RETURNS
 *  0.
 *****************************************************************************/
mmi_ret mmi_brw_app_if_sim_event_detected_proc(mmi_event_struct *evt)
{
    srv_sim_ctrl_event_detected_evt_struct *sim_evt = (srv_sim_ctrl_event_detected_evt_struct*)evt;
    if(sim_evt->type == SRV_SIM_CTRL_EVENT_DET_REMOVED
    #ifdef __SIM_RECOVERY_ENHANCEMENT__
        || sim_evt->type == SRV_SIM_CTRL_EVENT_DET_RECOVERY_START
    #endif
        )
    {
    #if (MMI_MAX_SIM_NUM >= 2)
        srv_brw_active_sim_setting_enum removed_sim = SRV_BRW_ACTIVE_SIM_SETTING_SIM1;
        switch(sim_evt->sim)
        {
    #if (MMI_MAX_SIM_NUM >= 4)
            case MMI_SIM4:
            {
                removed_sim = SRV_BRW_ACTIVE_SIM_SETTING_SIM4;
                break;
            }
    #endif
    #if (MMI_MAX_SIM_NUM >= 3)
            case MMI_SIM3:
            {
                removed_sim = SRV_BRW_ACTIVE_SIM_SETTING_SIM3;
                break;
            }
    #endif
            case MMI_SIM2:
            {
                removed_sim = SRV_BRW_ACTIVE_SIM_SETTING_SIM2;
                break;
            }
            default:
            {
                removed_sim = SRV_BRW_ACTIVE_SIM_SETTING_SIM1;
                break;
            }
        }
        if(removed_sim == g_srv_brw_cntx.session_sim_id)
    #endif /* (MMI_MAX_SIM_NUM >= 2) */
        {
            if(!g_brw_app_cntx.brw_dynamic_cntx_p->is_using_wifi)
            {
                mmi_brw_app_close_download_and_exit();
            }
        }
    }
    return MMI_RET_OK;
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_if_bookmark_provisioning_handler
 * DESCRIPTION
 *  callback function for the bookmark provisioning
 * PARAMETERS
 * RETURNS
 *  0.
 *****************************************************************************/
mmi_ret mmi_brw_app_if_bookmark_provisioning_handler(mmi_event_struct *param)
{
    if(mmi_frm_scrn_is_present(g_brw_app_cntx.brw_scr_group_id, SCR_ID_BRW_BOOKMARKS, MMI_FRM_NODE_ALL_FLAG))
    {
        mmi_brw_app_create_bookmark_list();
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_brw_app_is_any_network_available
 * DESCRIPTION
 *  
 * PARAMETERS
 * RETURNS
 *  MMI_TRUE if any network is available MMI_FALSE otherwise.
 *****************************************************************************/
MMI_BOOL mmi_brw_app_is_any_network_available(void)
{
    /* On WLAN project, if WLAN is not GSM only, network is always available. */
#ifdef __MMI_WLAN_FEATURES__
    if (srv_netset_get_pref_mode() != SRV_NETSET_PREF_MODE_GSM_ONLY)
    {
        return MMI_TRUE;
    }
#endif /* __MMI_WLAN_FEATURES__ */

    /* Then, check the SIM service usablility */
#if (MMI_MAX_SIM_NUM >= 2)
    if (srv_nw_usab_get_one_usable_sim() != MMI_SIM_NONE)
    {
        return MMI_TRUE;
    }
#else
    if (srv_sim_ctrl_is_available(MMI_SIM1))
    {
        return MMI_TRUE;
    }
#endif

    return MMI_FALSE;

}


#endif /* __MMI_BROWSER_2__ */

#endif /* MMI_BROWSERAPPINTERFACE_C */
