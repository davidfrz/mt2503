/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * ScreenSaver.c
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   This file is intends for Screen Saver application
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
/***************************************************************************** 
* Include
*****************************************************************************/
#include "MMI_features.h"
#include "MMIDataType.h"
#include "WPSSProtos.h"
#ifdef __MMI_SCREEN_SAVER__
#include "WallpaperDefs.h"
#include "SettingProt.h"
#include "PhoneSetup.h"
#include "PhnsetProt.h"
#include "IdleAppDef.h"
#include "Conversions.h"
#include "Menucuigprot.h"
#ifdef __MMI_THEMES_V2_SUPPORT__
#include "MMIThemes.h"  /* ritesh */
#endif 


#include "Inlinecuigprot.h"

#if defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__)
#include "dmuigprot.h" /* For DM lock check */
#endif /* defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__) */

#ifdef __MMI_USB_SUPPORT__
#include "USBSrvGProt.h"
#endif

/* auto add by kw_check begin */
#include "GlobalResDef.h"
#include "mmi_rp_srv_screensaver_def.h"
#include "ImeGprot.h"
#include "mmi_rp_app_phonesetting_new_def.h"
#include "mmi_frm_scenario_gprot.h"
#include "CustDataRes.h"
#include "kal_general_types.h"
#include "wgui_categories_util.h"
#include "wgui_inline_edit.h"
#include "GlobalConstants.h"
#include "mmi_frm_events_gprot.h"
#include "AlertScreen.h"
#include "mmi_frm_mem_gprot.h"
#include "kal_public_api.h"
#include "mmi_frm_nvram_gprot.h"
#include "gui_data_types.h"
#include "gui.h"
#include "PhoneSetupResList.h"
#include "mmi_theme_mgr.h"
#include "DebugInitDef_Int.h"
#include "MMI_common_app_trc.h"
#include "mmi_common_app_trc.h"
#include "kal_trace.h"
#include "wgui_categories_list.h"
#include "mmi_frm_history_gprot.h"
#include "mmi_frm_scenario_gprot.h"
#include "mmi_phnset_dispchar.h"
#include "wgui_categories_multimedia.h"
#include "wgui_include.h"
#include "gdi_include.h"
#include "wgui_categories_clock.h"
#include "mmi_frm_input_gprot.h"
#include "gui_typedef.h"
#include "mmi_rp_file_type_def.h"
#include "FileMgrSrvGProt.h"
#include "Unicodexdcl.h"
#include "FileMgrType.h"
#include "FileMgrGProt.h"
#include "string.h"
#include "nvram_common_defs.h"
#include "mmi_rp_app_mainmenu_def.h"
/* auto add by kw_check end */
#include "IdleGprot.h"
#include "PhoneSetupGprots.h"
#include "ViewSettingCommonProt.h"
#include "MMI_ap_dcm_config.h"
/***************************************************************************** 
* Local Variable
*****************************************************************************/
static CHAR* error_str_ptr;
static U8 ss_item_amount;

#ifdef __MMI_SETTING_SS_WAITTIME_SELECT__
static U8 ss_wait_time[6];
#define MMI_SETTING_SCREENSAVE_MIN_TIME 4
#define MMI_SETTING_SCREENSAVE_MAX_TIME 60
#endif /* __MMI_SETTING_SS_WAITTIME_SELECT__ */

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/* Inline CUI */
#define SCREEN_SAVER_SETTING_SET_STATUS_CAPTION (CUI_INLINE_ITEM_ID_BASE + 1)
#define SCREEN_SAVER_SETTING_SET_STATUS  (CUI_INLINE_ITEM_ID_BASE + 2)
#if 0
/* under construction !*/
/* under construction !*/
#endif
static U16 g_screensaver_status_str_id[] = 
{
    STR_GLOBAL_OFF,
    STR_GLOBAL_ON,
#ifdef __MMI_LCD_PARTIAL_ON__    
    STR_SCREENSAVER_DISPLAY_TIME
#endif    
};
static cui_inline_item_caption_struct g_screensaver_caption1 = {STR_SCREENSAVER_STATUS};
static cui_inline_item_select_struct g_screensaver_select1 =
{
#ifdef __MMI_LCD_PARTIAL_ON__
    3,
#else
    2,
#endif
    0,
    g_screensaver_status_str_id
};
#if 0
#ifndef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif
const static cui_inline_set_item_struct g_screensaver_inline_data[] =
{
    {SCREEN_SAVER_SETTING_SET_STATUS_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, NULL, &g_screensaver_caption1},
    {SCREEN_SAVER_SETTING_SET_STATUS, CUI_INLINE_ITEM_TYPE_SELECT, 0, &g_screensaver_select1}
#if 0
/* under construction !*/
#ifndef __MMI_SETTING_SS_WAITTIME_SELECT__        
/* under construction !*/
#else
/* under construction !*/
#endif
#endif
};
static const cui_inline_struct g_screensaver_inline = 
{
    sizeof(g_screensaver_inline_data)/sizeof(cui_inline_set_item_struct),
    STR_GLOBAL_SETTINGS,
    NULL,
    CUI_INLINE_SCREEN_DEFAULT_TEXT | CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    g_screensaver_inline_data    
};
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
/*static S32 g_screensaver_status;  for MAUI_02638640 */
static mmi_ret mmi_phnset_screensaver_sub_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static mmi_ret mmi_phnset_screensaver_sub_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static void mmi_phnset_init_screensaver_menu(void);
static void EntryPhnsetScrSvrSettings(MMI_ID parent_gid);
static void mmi_phnset_screen_saver_init_inline(void);
static mmi_ret mmi_phnset_screen_saver_setting_proc(mmi_event_struct *param);
static void mmi_phnset_screen_saver_entry_system_int(mmi_scrn_essential_struct *scrn_data);
static void mmi_phnset_entry_screensaver_main(mmi_id parent_gid);
static mmi_ret mmi_phnset_screensaver_main_proc(mmi_event_struct *evt);
/***************************************************************************** 
* External Variable
*****************************************************************************/
static S32 g_mmi_screensaver_current_status;
static S32 g_mmi_screensaver_waiting_time;
static U16 g_mmi_screensaver_id;
#ifdef __MMI_FILE_MANAGER__
static mmi_setting_display_cache_file_nvram_struct g_mmi_screensaver_user_file;
static WCHAR g_mmi_screensaver_cache_file_name[MMI_SETTING_DISPLAY_CACHE_USER_FILE_NAME_LEN];
static void mmi_phnset_screensaver_init(void);
#endif

/***************************************************************************** 
* External Function
*****************************************************************************/
extern U8 PhnsetGetDefEncodingType(void);



#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  HintPhnsetScreenSaver
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Display Character -> Screen Saver
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetScreenSaver(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* hint_str = NULL;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (PhnsetGetCurScrSvrStatus())
    {
    case SET_SS_STATUS_ON:
        hint_str = PhnsetGetCurScrSvrName();
        break;

    case SET_SS_STATUS_OFF:
        hint_str = (CHAR*)GetString(STR_GLOBAL_OFF);
        break;

#ifdef __MMI_LCD_PARTIAL_ON__
    case SET_SS_STATUS_POWERSAVING:
        hint_str = (CHAR*)GetString(STR_SCREENSAVER_DISPLAY_TIME);
        break;
#endif /* __MMI_LCD_PARTIAL_ON__ */ 

    default:
        break;
    }
    if (hint_str)
	{
        cui_menu_set_item_hint(
            mmi_frm_group_get_active_id(),
            MENU_SETTING_SCR_SVR,
            (WCHAR*)hint_str);  	
	}
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetScrSvrSetting
 * DESCRIPTION
 *  This function is hint handler for Phonesetup->IdleScreenDisplay->ScreenSaver -> Setting
 *  Following Functions:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetScrSvrSetting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* hint_str;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (PhnsetGetCurScrSvrStatus())
    {
        case SET_SS_STATUS_ON:
            hint_str = (CHAR*)GetString(STR_GLOBAL_ON);
            break;

        case SET_SS_STATUS_OFF:
            hint_str = (CHAR*)GetString(STR_GLOBAL_OFF);
            break;

    #ifdef __MMI_LCD_PARTIAL_ON__
        case SET_SS_STATUS_POWERSAVING:
            hint_str = (CHAR*)GetString(STR_SCREENSAVER_DISPLAY_TIME);
            break;
    #endif /* __MMI_LCD_PARTIAL_ON__ */ 

        default:
            hint_str = (CHAR*)GetString(STR_GLOBAL_OFF);
            break;
    }
    cui_menu_set_item_hint(
        mmi_frm_group_get_active_id(),
        MENU_SETTING_SS_SETTING,
        (WCHAR*)hint_str);    
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetScrSvrSelect
 * DESCRIPTION
 *  This function is hint handler for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select
 *  Following Functions:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetScrSvrSelect(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CHAR* p = PhnsetGetCurScrSvrName();
    cui_menu_set_item_hint(
        mmi_frm_group_get_active_id(),
        MENU_SETTING_SS_SELECT,
        (WCHAR*)p);
}



#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
#else /* __MMI_SETTING_SS_WAITTIME_SELECT__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_SETTING_SS_WAITTIME_SELECT__ */
/* under construction !*/
/* under construction !*/
#endif

/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetScrSvrSettings
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay->ScreenSaver -> Setting
 *  Following Functions:   PhnsetScrSvrSettingLskHdlr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
static void EntryPhnsetScrSvrSettings(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID *inlinecui_gid;
        
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    if(mmi_phnset_entry_group_check_ex(parent_gid,GRP_ID_SCREENSAVER_SETTING))
        return;
    inlinecui_gid = (MMI_ID*)OslMalloc(sizeof(MMI_ID));
  
    mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_SCREENSAVER_SETTING,
        mmi_phnset_screen_saver_setting_proc,
        (void*)inlinecui_gid,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

    *inlinecui_gid = cui_inline_create(GRP_ID_SCREENSAVER_SETTING, &g_screensaver_inline);

    mmi_phnset_screen_saver_init_inline();

    cui_inline_set_value(*inlinecui_gid, SCREEN_SAVER_SETTING_SET_STATUS, (void*)g_mmi_screensaver_current_status);
#if 0
/* under construction !*/
#ifndef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else /* __MMI_SETTING_SS_WAITTIME_SELECT__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_SETTING_SS_WAITTIME_SELECT__ */
#endif
    //cui_inline_set_all_items_softkey_text(*inlinecui_gid, MMI_LEFT_SOFTKEY, STR_GLOBAL_SAVE);
    cui_inline_run(*inlinecui_gid);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screen_saver_init_inline
 * DESCRIPTION
 *  Initialize variables for Inline CUI 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_screen_saver_init_inline(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SCREENSAVER_STATUS, &(g_mmi_screensaver_current_status), DS_BYTE, &error);
    ReadValue(NVRAM_SCREENSAVER_WAITING, &(g_mmi_screensaver_waiting_time), DS_BYTE, &error);

#ifndef __MMI_LCD_PARTIAL_ON__
    /* If __MMI_LCD_PARTIAL_ON__ is turned off without reseting NVRAM */
    if (g_mmi_screensaver_current_status == (S32) SET_SS_STATUS_POWERSAVING)
    {
        g_mmi_screensaver_current_status = 0xFF;
    }
#endif /* __MMI_LCD_PARTIAL_ON__ */ 

    if (g_mmi_screensaver_current_status == 0xFF)
    {
        g_mmi_screensaver_current_status = FACTORY_RESTORE_DEFAULT_SCREENSAVER_STATUS;
        WriteValue(NVRAM_SCREENSAVER_STATUS, &(g_mmi_screensaver_current_status), DS_BYTE, &error);
    }

    if (g_mmi_screensaver_waiting_time == 0xFF)
    {
        g_mmi_screensaver_waiting_time = FACTORY_RESTORE_DEFAULT_SCREENSAVER_WAITING_TIME;
        WriteValue(NVRAM_SCREENSAVER_WAITING, &(g_mmi_screensaver_waiting_time), DS_BYTE, &error);
    }
#if 0
#ifndef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
#endif /* __MMI_SETTING_SS_WAITTIME_SELECT__ */   
#endif

}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screen_saver_setting_proc
 * DESCRIPTION
 *  Proc function for screen saver setting 
 * PARAMETERS
 *  
 * RETURNS
 *  static mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_screen_saver_setting_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID *inlinecui_gid =(MMI_ID*)mmi_frm_group_get_user_data(GRP_ID_SCREENSAVER_SETTING);
    U8 highlighted_item;    
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(param->evt_id)
    {
    case EVT_ID_CUI_INLINE_SUBMIT:
    case EVT_ID_CUI_INLINE_CSK_PRESS:        
        PhnsetScrSvrSettingLskHdlr();
        break;
        
    case EVT_ID_CUI_INLINE_ABORT:
        cui_inline_close(*inlinecui_gid);
        break;

    case EVT_ID_CUI_INLINE_NOTIFY:
        {
            cui_event_inline_notify_struct *notify_event = (cui_event_inline_notify_struct*)param;
			if (notify_event->event_type == CUI_INLINE_NOTIFY_HIGHLIGHT_ITEM)
            {
                cui_inline_set_softkey_text(
                    notify_event->sender_id, 
                    notify_event->item_id,
                    MMI_LEFT_SOFTKEY,
                    STR_GLOBAL_SAVE);
			}
            if (notify_event->event_type == CUI_INLINE_NOTIFY_SELECT_FOCUS_CHANGED)
        	{
                switch (notify_event->item_id)
            	{
                case SCREEN_SAVER_SETTING_SET_STATUS:
            	    cui_inline_get_value(
                        *inlinecui_gid,
                        SCREEN_SAVER_SETTING_SET_STATUS,
                        (void*) &highlighted_item);
                    
                        /* Change the wait time display string according to status */
                        #if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
                            #ifdef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
                            #endif
/* under construction !*/
/* under construction !*/
						#endif
                    break;
                #if 0
/* under construction !*/
/* under construction !*/
                    #ifdef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
                    #else
/* under construction !*/
/* under construction !*/
/* under construction !*/
                    #endif
/* under construction !*/
                #endif    
            	}

        	}
            break;
        }   

    case EVT_ID_GROUP_DEINIT:
        if (param->user_data)
    	{
            OslMfree(param->user_data);
            param->user_data = NULL;
    	}
        break;
        
    default:
        break;
    }
    return MMI_RET_OK;    
}

/*****************************************************************************
 * FUNCTION
 *  PhnsetScrSvrSettingLskHdlr
 * DESCRIPTION
 *  This function is left softkey handler for Phonesetup->IdleScreenDisplay->ScreenSaver -> Setting
 *  Ancestor Functions:   EntryPhnsetScrSvrSettings
 *  PhnsetScrSvrInlineHiliteHdlr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetScrSvrSettingLskHdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    MMI_ID *inlinecui_gid = mmi_frm_group_get_user_data(GRP_ID_SCREENSAVER_SETTING);
    U8 status;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(
        *inlinecui_gid, 
        SCREEN_SAVER_SETTING_SET_STATUS, 
        (void*)&status);
#if 0
#ifndef __MMI_SETTING_SS_WAITTIME_SELECT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else /* __MMI_SETTING_SS_WAITTIME_SELECT__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_SETTING_SS_WAITTIME_SELECT__ */
#endif
	g_mmi_screensaver_current_status = status;

    WriteValue(NVRAM_SCREENSAVER_STATUS, &(g_mmi_screensaver_current_status), DS_BYTE, &error);

    if (g_mmi_screensaver_current_status == 1)
    {
        WriteValue(NVRAM_SCREENSAVER_WAITING, &(g_mmi_screensaver_waiting_time), DS_BYTE, &error);
    }

    g_phnset_cntx_p->isCorrectSet = 1;
    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);    
    mmi_frm_group_close(GRP_ID_SCREENSAVER_SETTING);
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif

/* 
 * Phonesetup->IdleScreenDisplay->ScreenSaver -> Select
 */

/*****************************************************************************
 * FUNCTION
 *  PhnsetConstSysScrSvrList
 * DESCRIPTION
 *  This function is to construct system screen saver list
 *  for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System
 * PARAMETERS
 *  pSysSSStrList       [IN]            
 *  pSysSSImgIDList     [?]             
 *  HighliteItem        [?]             
 *  a(?)                [IN/OUT]        U8 **pSysSSStrList, U16 *pSysSSImgIDList, S16 *HighliteItem
 *  b(?)                [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetConstSysScrSvrList(U8 **pSysSSStrList, U16 *pSysSSImgIDList, S16 *HighliteItem)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 i;

    U8 index_other = 0;
    U8 index_swflash = 0;
    U8 index_img = 0; /* count of image */
    U8 index_vdo = 0; /* count of video */
    U8 ss_max;
    U8 max_ss_img = MAX_SCREENSAVER_IMG - MAX_OTHER_SCREENSAVER - MAX_DISPCHAR_SWFLASH;
    U8 max_ss_other = MAX_OTHER_SCREENSAVER;
    U8 max_ss_swflash = MAX_DISPCHAR_SWFLASH;


#ifdef __MMI_THEMES_V2_SUPPORT__
        if(!mmi_tm_get_current_theme_screensaver())
        {
            max_ss_other --;            
        }
#endif /* __MMI_THEMES_V2_SUPPORT__ */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* Layout
     *
     * -- Video         --
     *
     * -- Normal Images --
     * -- Normal Images -- SVG
     * -- Normal Images -- M3D
     * -- Analog clock  --
     * -- Digital clock --
     * -- Theme         --
     * -- SWFLASH        --
     */


    for (i = 0; i < (MAX_SCREENSAVER_VDO + max_ss_img + max_ss_other + max_ss_swflash); i++)
    {
        U16 strID = 0, imgID = 0;
        
        if (i < MAX_SCREENSAVER_VDO)
        {
           imgID = IMG_ID_PHNSET_SS_VDO_START + i;
        }
        else if (i >= MAX_SCREENSAVER_VDO && 
                 i < (MAX_SCREENSAVER_VDO + max_ss_img))
        {
           imgID = IMG_ID_PHNSET_SS_START + (i - MAX_SCREENSAVER_VDO);
        }
        else if (max_ss_other &&
                 i >= (MAX_SCREENSAVER_VDO + max_ss_img) &&
                 i < (MAX_SCREENSAVER_VDO + (max_ss_img + max_ss_other)))
        {
            imgID = IMG_ID_DISPCHAR_OTHER_START + (i - (MAX_SCREENSAVER_VDO + max_ss_img)) + 1;
        }
        else if (max_ss_swflash)
        {
            imgID = IMG_ID_DISPCHAR_SWFLASH_START + (i - (MAX_SCREENSAVER_VDO + (max_ss_img + max_ss_other)));
        }
#ifndef __MMI_MAINLCD_96X64__
        if (imgID >= IMG_ID_PHNSET_SS_VDO_START && imgID <= IMG_ID_PHNSET_SS_VDO_MAX)
        {
            strID = STR_ID_PHNSET_DISPCHAR_VDOID_START + index_vdo;
            ++index_vdo;
        }
#endif        
        /* normal/SVG/M3D  images*/
        else if (imgID >= IMG_ID_PHNSET_SS_START && imgID <= IMG_ID_PHNSET_SS_MAX)
        {
            strID = STR_ID_PHNSET_DISPCHAR_IMGID_START + index_img;
            index_img++;
        }
        else if ( imgID > IMG_ID_DISPCHAR_OTHER_START && imgID < IMG_ID_DISPCHAR_OTHER_MAX)
        {

    #if !defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
        
    #ifdef __MMI_ANALOG_CLOCK__
            /* Analog clock */
            if (imgID == IMG_ID_DISPCHAR_ANALOG_CLK)
            {
                strID = STR_ID_PHNSET_DISPCHAR_ANALOG;
            }
    #endif /* __MMI_ANALOG_CLOCK__ */ 
        
    #ifdef __MMI_DIGITAL_CLOCK__
            /* Digital clock */
            if (imgID == IMG_ID_DISPCHAR_DIGITAL_CLK)
            {
                strID = STR_ID_PHNSET_DISPCHAR_DIGITAL;
            }
    #endif /* __MMI_DIGITAL_CLOCK__ */ 
        
    #endif /* !__MMI_UI_TECHNO_IDLESCREEN_BAR__ */ 
        
    #ifdef __MMI_THEMES_V2_SUPPORT__
            /* Theme */
            if (mmi_tm_get_current_theme_screensaver() && imgID == IMG_ID_DISPCHAR_THEME_WALLPAPER)
            {
                imgID = IMG_ID_DISPCHAR_THEME_SCREENSAVER;
                strID = STR_ID_DISPCHAR_THEME_SCREENSAVER;
            }
    #endif /* __MMI_THEMES_V2_SUPPORT__ */

            ++index_other;
        }
        if(strID && imgID)
        {
            if (pSysSSImgIDList)
            {
                pSysSSImgIDList[i] = imgID;
            }
            
            if (pSysSSStrList)
            {
                pSysSSStrList[i] = (PU8) GetString(strID);
            }
            
            if (HighliteItem && g_mmi_screensaver_id == pSysSSImgIDList[i])
            {
                *HighliteItem = i;
            }
        }
    }
    ss_max = i;
    MMI_ASSERT(index_other == max_ss_other);
    MMI_ASSERT(index_swflash == max_ss_swflash);

    return ss_max;   /* amount, will be used to construct list */

}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetScrSvrSystem
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System
 *  Following Functions:   EntryPhnsetScrSvrSysView
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetScrSvrSystem(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_ENTRY_SS_SYSTEM);
    if(mmi_phnset_entry_group_check_ex(parent_gid,GRP_ID_SCREENSAVER_SYSTEM))
        return;
    
    mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_SCREENSAVER_SYSTEM,
        NULL,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

    mmi_frm_scrn_first_enter(
        GRP_ID_SCREENSAVER_SYSTEM,
        SCR_SCREENSAVER_SYSTEM_LIST,
        (FuncPtr)mmi_phnset_screen_saver_entry_system_int,
        NULL);
	
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screen_saver_entry_system_int
 * DESCRIPTION
 *  Internal entry function for screen saver system resource setting menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_screen_saver_entry_system_int(mmi_scrn_essential_struct *scrn_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter(
            scrn_data->group_id,
            scrn_data->scrn_id,
            NULL,
            (FuncPtr)mmi_phnset_screen_saver_entry_system_int,
            MMI_FRM_FULL_SCRN))
    {
        guiBuffer = mmi_frm_scrn_get_gui_buf(scrn_data->group_id, scrn_data->scrn_id);

        RegisterHighlightHandler(PhnsetScrSvrSysHiliteHdlr);

        g_phnset_cntx_p->curHightlightItem = 0;
        ss_item_amount = PhnsetConstSysScrSvrList(
                            subMenuDataPtrs,
                            g_phnset_cntx_p->SysWPSSList,
                            (S16*) & g_phnset_cntx_p->curHightlightItem);

        if (g_mmi_screensaver_id == 0)
            g_phnset_cntx_p->curHightlightItem = 0;        

        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        
        ShowCategory36Screen(
            STR_GLOBAL_SELECT,
            IMG_SCR_SETTING_CAPTION,
            STR_GLOBAL_VIEW,
            0,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            ss_item_amount,
            subMenuDataPtrs,
            (U16) (g_phnset_cntx_p->curHightlightItem),
            guiBuffer);

        SetLeftSoftkeyFunction(EntryPhnsetScrSvrSysView, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(EntryPhnsetScrSvrSysView, KEY_EVENT_UP);
        //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetScrSvrSysHiliteHdlr
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System
 * PARAMETERS
 *  nIndex      [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetScrSvrSysHiliteHdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
    if (nIndex < MAX_SCREENSAVER_VDO)
    {
        ChangeLeftSoftkey(STR_GLOBAL_PLAY, 0);
    }
    else
#endif /* defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */ 
    if (nIndex > ss_item_amount - MAX_DISPCHAR_SWFLASH - 1)
        ChangeLeftSoftkey(STR_GLOBAL_PLAY, 0);
    else
        ChangeLeftSoftkey(STR_GLOBAL_VIEW, 0);

    g_phnset_cntx_p->curHightlightItem = (U16) nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetScrSvrSysView
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System ->View
 *  Following Functions:   EntryScrSetScreenSaver
 *  PhnsetScrSvrSysViewPre
 *  PhnsetScrSvrSysViewNext
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetScrSvrSysView(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    /* Notice: g_phnset_cntx_p->SysWPSSList Has been constructed at  EntryPhnsetScrSvrSystem() */
    U16 screenSaverId = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];
    U8 *ssName = (U8 *)PhnsetGetScrSvrNameById(screenSaverId);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->isCorrectSet = 0;

    if(mmi_phnset_enter_switch_screen())
    {
        guiBuffer = mmi_frm_scrn_get_gui_buf(GRP_ID_SCREENSAVER_SYSTEM, mmi_frm_scrn_get_active_id());
#ifndef __MMI_PHNSET_WP_SLIM__
        wgui_set_touch_title_bar_buttons(); /* enable the display of title bar buttons */

#if defined(__MMI_TOUCH_SCREEN__)
        register_touch_button_handlers(NULL, PhnsetScrSvrSysViewPre, NULL, PhnsetScrSvrSysViewNext);
#endif 
#endif 


        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_ENTRY_SS_SYS_VIEW, screenSaverId);

#if defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
#ifndef __MMI_MAINLCD_96X64__
        if (PhnsetGetDisplayType(screenSaverId) == PHNSET_TYPE_DISP_VIDEO)
        {
			mmi_frm_start_scenario(MMI_SCENARIO_ID_HIGH_SCRN);
        #ifdef __DRM_SUPPORT__
            wgui_catvdo_set_drm_flag(WGUI_CATVDO_DRM_DISABLE_CONSUME_ALL);
        #endif /* __DRM_SUPPORT__ */

            EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            wgui_softkey_disable_text_translucence();
            ShowCategory225Screen(
                STR_ID_PHNSET_DISPCHAR_VDOID_START + (screenSaverId - IMG_ID_PHNSET_SS_VDO_START),        /* title_str */
                0,                  /* title_icon */
                STR_GLOBAL_OK,      /* lsk_str */
                IMG_GLOBAL_OK,      /* lsk_icon */
                STR_GLOBAL_BACK,    /* rsk_str */
                IMG_GLOBAL_BACK,    /* rsk_icon */
                screenSaverId,      /* video_id */
                NULL,               /* video_filename */
                0,                  /* repeat_count */
                TRUE,               /* is_visual_update */
                FALSE,              /* is_play_audio */
                TRUE,               /* is_lcd_no_sleep */
                GDI_COLOR_BLACK,    /* bg_color */
                mmi_phnset_view_setting_common_image_play_callback,
                guiBuffer);
#endif            
        }
        else
#endif /* defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */ 

#ifndef __MMI_UI_TECHNO_IDLESCREEN_BAR__    
#ifdef __MMI_ANALOG_CLOCK__
            /* Category 86 to View Analog Clock Screen Saver */
        if ((screenSaverId == IMG_ID_DISPCHAR_ANALOG_CLK))
        {
            EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            ShowCategory86Screen(STR_ID_PHNSET_DISPCHAR_ANALOG, 0, STR_GLOBAL_OK, IMG_GLOBAL_OK, STR_GLOBAL_BACK, IMG_GLOBAL_BACK, IMG_ID_DISPCHAR_ANALOG_CLK, guiBuffer);        /* 051305 Calvin modified */
        }
        else
#endif /* __MMI_ANALOG_CLOCK__ */ 

#ifdef __MMI_DIGITAL_CLOCK__
            /* Category 128 to View Digital Clock Screen Saver */
        if (screenSaverId == IMG_ID_DISPCHAR_DIGITAL_CLK)
        {
            EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            ShowCategory128Screen(
                STR_ID_PHNSET_DISPCHAR_DIGITAL,
                0,
                STR_GLOBAL_OK,
                IMG_GLOBAL_OK,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                IMG_ID_DISPCHAR_DIGITAL_CLK,
                guiBuffer);

        }
        else
#endif /* __MMI_DIGITAL_CLOCK__ */ 
#endif /* __MMI_UI_TECHNO_IDLESCREEN_BAR__  */
        /* Category 129 to view other Screensavers */
        {
            EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            wgui_softkey_disable_text_translucence();            
            ShowCategory129Screen(
                ssName,
                0,
                STR_GLOBAL_OK,
                IMG_GLOBAL_OK,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                screenSaverId,
                guiBuffer);
        }

        SetLeftSoftkeyFunction(PhnsetScrSvrSysViewLskHdlr, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(PhnsetScrSvrSysViewLskHdlr, KEY_EVENT_UP);
        //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
        
#ifndef __MMI_PHNSET_WP_SLIM__        
        mmi_frm_send_incomplete_key_event_to_new_screen(MMI_TRUE); /* for handle long press LNK and RNK */    
        SetKeyHandler(PhnsetScrSvrSysViewPre, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
        SetKeyHandler(PhnsetScrSvrSysViewPre, KEY_LEFT_ARROW, KEY_REPEAT);    
        SetKeyHandler(PhnsetScrSvrSysViewPre, KEY_LEFT_ARROW, KEY_LONG_PRESS);        
        SetKeyHandler(PhnsetScrSvrSysViewNext, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);    
        SetKeyHandler(PhnsetScrSvrSysViewNext, KEY_RIGHT_ARROW, KEY_REPEAT);    
        SetKeyHandler(PhnsetScrSvrSysViewNext, KEY_RIGHT_ARROW, KEY_LONG_PRESS);           
#endif
    }
}

/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetScrSvrSysView
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System ->View
 *  Following Functions:   EntryScrSetScreenSaver
 *  PhnsetScrSvrSysViewPre
 *  PhnsetScrSvrSysViewNext
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_exit_scrsvr_sys_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
    U16 screenSaverId = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];
#endif
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
#if defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
	if (PhnsetGetDisplayType(screenSaverId) == PHNSET_TYPE_DISP_VIDEO)
	{
		mmi_frm_end_scenario(MMI_SCENARIO_ID_HIGH_SCRN);
	}	
#endif
}
#ifndef __MMI_PHNSET_WP_SLIM__
/*****************************************************************************
 * FUNCTION
 *  PhnsetScrSvrSysViewPre
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System ->View
 *  Ancestor Functions:   EntryPhnsetScrSvrSysView
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetScrSvrSysViewPre(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExitCategoryFunction();
    if (g_phnset_cntx_p->curHightlightItem <= 0)
    {
        g_phnset_cntx_p->curHightlightItem = ss_item_amount;
    }

    g_phnset_cntx_p->curHightlightItem--;

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_SYS_VIEW_PRE, g_phnset_cntx_p->curHightlightItem);

    EntryPhnsetScrSvrSysView();
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetScrSvrSysViewNext
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System ->View
 *  Ancestor Functions:   EntryPhnsetScrSvrSysView
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetScrSvrSysViewNext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExitCategoryFunction();

    if (g_phnset_cntx_p->curHightlightItem >= ss_item_amount - 1)
    {
        g_phnset_cntx_p->curHightlightItem = -1;
    }

    g_phnset_cntx_p->curHightlightItem++;

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_SYS_VIEW_NEXT, g_phnset_cntx_p->curHightlightItem);

    EntryPhnsetScrSvrSysView();
}
#endif

/*****************************************************************************
 * FUNCTION
 *  PhnsetScrSvrSysViewLskHdlr
 * DESCRIPTION
 *  This function is Left softkey for Phonesetup->IdleScreenDisplay->ScreenSaver -> Select -> System ->View
 *  Ancestor Functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetScrSvrSysViewLskHdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_screensaver_id = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];
    mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_SYS_VIEW_LSK_HDL, g_mmi_screensaver_id);

    /* when set system screen saver delete default file in folder */

    g_phnset_cntx_p->isCorrectSet = 1;
	mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_SCREENSAVER_MAIN);
}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
#ifdef __MMI_THEMES_V2_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  ThemeManagerSetScreensaver
 * DESCRIPTION
 *  ...
 * PARAMETERS
 *  nId         [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void ThemeManagerSetScreensaver(U16 nId)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_screensaver_id = nId;
    mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));
}
#endif /* __MMI_THEMES_V2_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  DispIdleScrSvrBadFilePopup
 * DESCRIPTION
 *  To show a popup of selecting an invalid file
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void DispIdleScrSvrBadFilePopup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (error_str_ptr)
    {
		mmi_popup_display_simple((WCHAR*) error_str_ptr, MMI_EVENT_FAILURE, GRP_ID_ROOT, NULL);
    }
    else
    {
		mmi_popup_display_simple((WCHAR*) GetString(STR_IDLE_SS_DECODE_ERR), MMI_EVENT_FAILURE, GRP_ID_ROOT, NULL);
    }
    error_str_ptr = NULL;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetScreenSaverBadFileCallBack
 * DESCRIPTION
 *  This function is call back function for showcategories33screen,
 *  If display user defined image got problem in idle screen, this function will be executed
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
S32 PhnsetScreenSaverBadFileCallBack(U16 StrID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_BADFILE_CALLBACK);

    PhnsetRstScrSvrDefault();

    if (StrID)
        error_str_ptr = (CHAR*)GetString(StrID);
    else
        error_str_ptr = NULL;
	
    /* Should not display popup in DM lock */
#if defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__)
    if (!mmi_dmui_is_phone_lock())
#endif
	{
    DispIdleScrSvrBadFilePopup();
	}
    return g_mmi_screensaver_id;
}

#ifdef __MMI_FILE_MANAGER__


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurScrSvrFileName
 * DESCRIPTION
 *  get Current screensaver path
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
CHAR* PhnsetGetCurScrSvrFileName(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_GET_CUR_SS_NAME);
    return (CHAR*) mmi_phnset_screensaver_get_user_file();
}
#endif /* defined(__MMI_FILE_MANAGER__) */ /* __MMI_WAP__ */

/*
 * Externel Interfaces
 */


/*****************************************************************************
 * FUNCTION
 *  PhnsetRstScrSvrDefault
 * DESCRIPTION
 *  This function is to set screen saver status/waiting time/image to default value
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetRstScrSvrDefault(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //g_mmi_screensaver_id = RstGetScrSaverImgIdDefault();
	
    mmi_dispchar_get_img_id(RESTORE_DEFAULT_CURRENT_SCREENSVER_ID, &g_mmi_screensaver_id);
    mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_RST_DEFAULT, g_mmi_screensaver_id);

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurScrSvr
 * DESCRIPTION
 *  This function is to get screen saver image ID to default value
 * PARAMETERS
 *  screenSaver     [?]             
 *  a(?)            [IN/OUT]        
 *  b(?)            [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetGetCurScrSvr(U16 *screenSaver)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *screenSaver = g_mmi_screensaver_id;
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_GET_CUR_SS_ID, g_mmi_screensaver_id);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetScrSvrSetings
 * DESCRIPTION
 *  This function is to get screen saver setting status
 * PARAMETERS
 *  ScreenSaverStatus       [?]             
 *  ScreenSaverWait         [?]             
 *  a(?)                    [IN/OUT]        
 *  b(?)                    [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetGetScrSvrSetings(U8 *ScreenSaverStatus, U8 *ScreenSaverWait)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *ScreenSaverStatus = (U8) g_mmi_screensaver_current_status;
    *ScreenSaverWait = (U8) g_mmi_screensaver_waiting_time;

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_GET_SS_INFO,
                         g_mmi_screensaver_current_status, g_mmi_screensaver_waiting_time);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetReadNvramScrSvrSettings
 * DESCRIPTION
 *  This function is to read screen saver setting status/waiting time/image from nvram
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadNvramScrSvrSettings(void)
{
    mmi_phnset_screensaver_init();
}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurScrSvrName
 * DESCRIPTION
 *  This function is to get screen saver name string ptr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
CHAR* PhnsetGetCurScrSvrName(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_GET_CUR_SS_NAME, g_mmi_screensaver_id);

#ifdef __MMI_FILE_MANAGER__
    if (g_mmi_screensaver_id == 0)
    {
        return (CHAR*)mmi_phnset_view_setting_util_get_file_name_ptr(g_mmi_screensaver_user_file.file_name);
    }
    else
#endif /* __MMI_FILE_MANAGER__ */ 
        return PhnsetGetScrSvrNameById(g_mmi_screensaver_id);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetScrSvrNameById
 * DESCRIPTION
 *  This function is to get screen saver name string ptr by image ID
 * PARAMETERS
 *  Id          [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
CHAR* PhnsetGetScrSvrNameById(U16 Id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* ssName = NULL;
    U32 strID;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_GET_NAME_BY_ID, Id);

#if defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
#ifndef __MMI_MAINLCD_96X64__
    if (Id >= IMG_ID_PHNSET_SS_VDO_START && Id <= IMG_ID_PHNSET_SS_VDO_MAX)
    {
        ssName = GetString((U16) STR_ID_PHNSET_DISPCHAR_VDOID_START + (Id - IMG_ID_PHNSET_SS_VDO_START));
    }
    else
#endif        
#endif /* defined(__MMI_SCREENSAVER_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */ /* defined( __MMI_POWER_ON_OFF_DISPLAY_VIDEO__ ) && defined(__MTK_TARGET__) */
    if (Id >= IMG_ID_PHNSET_SS_START && Id <= IMG_ID_PHNSET_SS_MAX)
    {
        strID = STR_ID_PHNSET_DISPCHAR_IMGID_START + (Id - IMG_ID_PHNSET_SS_START);
        ssName = GetString((U16) strID);
    }
#ifndef __MMI_UI_TECHNO_IDLESCREEN_BAR__    
#ifdef __MMI_ANALOG_CLOCK__
    else if (Id == IMG_ID_DISPCHAR_ANALOG_CLK)
    {
        strID = STR_ID_PHNSET_DISPCHAR_ANALOG;
        ssName = GetString((U16) strID);
    }
#endif /* __MMI_ANALOG_CLOCK__ */ 

#ifdef __MMI_DIGITAL_CLOCK__
    else if (Id == IMG_ID_DISPCHAR_DIGITAL_CLK)
    {
        strID = STR_ID_PHNSET_DISPCHAR_DIGITAL;
        ssName = GetString((U16) strID);
    }
#endif /* __MMI_DIGITAL_CLOCK__ */ 
#endif /* __MMI_UI_TECHNO_IDLESCREEN_BAR__ */

#ifdef __MMI_THEMES_V2_SUPPORT__
    else if (Id == IMG_ID_DISPCHAR_THEME_SCREENSAVER)
    {
        strID = STR_ID_DISPCHAR_THEME_SCREENSAVER;
        ssName = GetString((U16) strID);
    }
#endif /* __MMI_THEMES_V2_SUPPORT__ */ 
    return ssName;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurScrSvrStatus
 * DESCRIPTION
 *  This function is to get screen saver status on/off
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  0 OFF, 1 ON
 *****************************************************************************/
SET_SS_SETTING_STATUS PhnsetGetCurScrSvrStatus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_mmi_screensaver_current_status)
    {
        case 1:
            return SET_SS_STATUS_ON;
    #ifdef __MMI_LCD_PARTIAL_ON__
        case 2:
            return SET_SS_STATUS_POWERSAVING;
    #endif /* __MMI_LCD_PARTIAL_ON__ */ 
        default:
            return SET_SS_STATUS_OFF;
    }
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif

/*****************************************************************************
 * FUNCTION
 *  PhnsetIsScrSvrAnalogClock
 * DESCRIPTION
 *  This function is to query if screen set Analog Clock
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  0 OFF, 1 ON
 *****************************************************************************/
BOOL PhnsetIsScrSvrAnalogClock(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

#ifndef __MMI_UI_TECHNO_IDLESCREEN_BAR__    
#ifdef __MMI_ANALOG_CLOCK__
    if (g_mmi_screensaver_id == IMG_ID_DISPCHAR_ANALOG_CLK)
    {
        return TRUE;
    }
    else
#endif /* __MMI_ANALOG_CLOCK__ */ 
#endif /* __MMI_UI_TECHNO_IDLESCREEN_BAR__ */

        return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetIsScrSvrDigitalClock
 * DESCRIPTION
 *  This function is to query if screen set Digital Clock
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  0 OFF, 1 ON
 *****************************************************************************/
BOOL PhnsetIsScrSvrDigitalClock(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_UI_TECHNO_IDLESCREEN_BAR__    
#ifdef __MMI_DIGITAL_CLOCK__
    if (g_mmi_screensaver_id == IMG_ID_DISPCHAR_DIGITAL_CLK)
    {
        return TRUE;
    }
    else
#endif /* __MMI_DIGITAL_CLOCK__ */ 
#endif /* __MMI_UI_TECHNO_IDLESCREEN_BAR__ */
        return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetIsScrSvrPartialOn
 * DESCRIPTION
 *  To check if the current screensaver is the partial one.
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  0 OFF, 1 ON
 *****************************************************************************/
BOOL PhnsetIsScrSvrPartialOn(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_LCD_PARTIAL_ON__
    if (g_mmi_screensaver_current_status == (S32) SET_SS_STATUS_POWERSAVING)
    {
        return TRUE;
    }
    else
#endif /* __MMI_LCD_PARTIAL_ON__ */ 
        return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_disable_partial_ss
 * DESCRIPTION
 *  To disable partial screensaver.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_disable_partial_ss(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_LCD_PARTIAL_ON__
    g_mmi_screensaver_current_status = (S32) SET_SS_STATUS_OFF;
#endif 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_enable_partial_ss
 * DESCRIPTION
 *  To enable partial screensaver.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_enable_partial_ss(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_LCD_PARTIAL_ON__
    S16 error;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_LCD_PARTIAL_ON__
    ReadValue(NVRAM_SCREENSAVER_STATUS, &(g_mmi_screensaver_current_status), DS_BYTE, &error);
#endif 
}

#ifdef __MMI_THEMES_V2_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  PhnsetIsScrSvrCurrentTheme
 * DESCRIPTION
 *  To check if the current screensaver is the current theme.
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  0 OFF, 1 ON
 *****************************************************************************/
BOOL PhnsetIsScrSvrCurrentTheme(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_screensaver_id == IMG_ID_DISPCHAR_THEME_SCREENSAVER)
    {
        return TRUE;
    }
    else
    {
        return FALSE;
    }

}
#endif /* __MMI_THEMES_V2_SUPPORT__ */ 

#ifdef __USB_IN_NORMAL_MODE__


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_enter_mass_storage_mode
 * DESCRIPTION
 *  Use default build-in screensaver
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_screensaver_enter_mass_storage_mode(void)
{
#ifdef __MMI_FILE_MANAGER__    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PHNSET_TYPE_DISP type;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    type = PhnsetGetDisplayType(g_mmi_screensaver_id);
    if (type == PHNSET_TYPE_DISP_USER
        && (srv_usb_check_path_exported((WCHAR*) g_mmi_screensaver_user_file.cache_file_name)))
    {
		mmi_dispchar_get_img_id(RESTORE_DEFAULT_CURRENT_SCREENSVER_ID, &g_mmi_screensaver_id);
        //g_mmi_screensaver_id = RstGetScrSaverImgIdDefault();
    }

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_USE_DEFAULT, g_mmi_screensaver_id);
#endif /* __MMI_FILE_MANAGER__ */
}

void mmi_phnset_screensaver_exit_mass_storage_mode(void)
{
    mmi_dispchar_get_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));
}
#endif /* __USB_IN_NORMAL_MODE__ */ 


#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_sub_menu_handler
 * DESCRIPTION
 *  Proc function for screensaver group 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_phnset_screensaver_sub_menu_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    switch(param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        return mmi_phnset_screensaver_sub_menu_entry_handler(param, parent_gid);

    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
        return mmi_phnset_screensaver_sub_menu_select_handler(param, parent_gid);

    default:
        break;          
    }

    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_sub_menu_entry_handler
 * DESCRIPTION
 *  Entry proc function for screensaver menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_screensaver_sub_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/  
    switch (param->parent_menu_id)
    {
    case MENU_SETTING_SCR_SVR:
    case MENU_SETTING_SS_SELECT:
        mmi_phnset_init_screensaver_menu();
        return MMI_RET_OK;
    	
    default:
    	break;
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_sub_menu_select_handler
 * DESCRIPTION
 *  Select proc function for screensaver menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_screensaver_sub_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/  
    switch (param->highlighted_menu_id)
    {
    case MENU_SETTING_SCR_SVR:
        g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_SS;
        mmi_phnset_entry_screensaver_main(parent_gid);
        return MMI_RET_OK;
        
    case MENU_SETTING_SS_SETTING:
    	EntryPhnsetScrSvrSettings(parent_gid);
        return MMI_RET_OK;

#if defined(__MMI_FILE_MANAGER__)
    case MENU_SELECT_SS_SELECT_SYSTEM:
        EntryPhnsetScrSvrSystem(parent_gid);
        return MMI_RET_OK;
        
#if defined(__MMI_FILE_USEAS_SUPPORT__)
    case MEUN_SELECT_SS_SELECT_DOWNLOAD:
        mmi_phnset_view_setting_common_entry_fmgr(parent_gid, MMI_PHNSET_TYPE_SS);
        return MMI_RET_OK;
#endif /* __MMI_FILE_USEAS_SUPPORT__ */

#else /* defined(__MMI_FILE_MANAGER__) */
    case MENU_SETTING_SS_SELECT:
        EntryPhnsetScrSvrSystem(parent_gid);
        return MMI_RET_OK;
#endif /* defined(__MMI_FILE_MANAGER__) */

    default:
    	break;
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_screensaver_menu
 * DESCRIPTION
 *  Initialize the screensaver menu 
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_init_screensaver_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID screensaver_menu_cui_id = mmi_frm_group_get_active_id();
    #if  !defined(__MMI_FILE_MANAGER__) || !defined(__MMI_FILE_USEAS_SUPPORT__)
    U8 screensaver_num;
    #endif
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set menu list flags to numbered icon menu list at the first time enter*/
    cui_menu_set_currlist_flags(screensaver_menu_cui_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);

    /* set hints of menu item */
    // If there is only one screen saver, do not display the select menu
    #if  !defined(__MMI_FILE_MANAGER__) || !defined(__MMI_FILE_USEAS_SUPPORT__)
    screensaver_num = PhnsetConstSysScrSvrList(NULL, NULL, NULL);
    if (screensaver_num <= 1)
    {
        cui_menu_set_item_hidden(screensaver_menu_cui_id, MENU_SETTING_SS_SELECT, MMI_TRUE);
    }
    else
    #endif        
    {
	    HintPhnsetScrSvrSelect();
    }

    HintPhnsetScrSvrSetting();
    cui_menu_set_currlist_title_by_id(screensaver_menu_cui_id, STR_MENU_SETTING_SCREEN_SVR, NULL);
    cui_menu_set_currlist_left_softkey_by_id(screensaver_menu_cui_id, STR_GLOBAL_OK);
    cui_menu_set_currlist_right_softkey_by_id(screensaver_menu_cui_id, STR_GLOBAL_BACK); 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_screensaver_main
 * DESCRIPTION
 *  Entry the main menu of screen saver 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_entry_screensaver_main(mmi_id parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(mmi_phnset_entry_group_check_ex(parent_gid,GRP_ID_SCREENSAVER_MAIN))
        return;

    mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_SCREENSAVER_MAIN,
        mmi_phnset_screensaver_main_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
	cui_menu_create_and_run(
        GRP_ID_SCREENSAVER_MAIN,
        CUI_MENU_SRC_TYPE_RESOURCE,
        CUI_MENU_TYPE_APPMAIN,
        MENU_SETTING_SCR_SVR,
        MMI_FALSE,
        NULL);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_main_proc
 * DESCRIPTION
 *  Proc function of screen saver 
 * PARAMETERS
 *  
 * RETURNS
 *  static mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_screensaver_main_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (evt->evt_id == EVT_ID_CUI_MENU_CLOSE_REQUEST)
	{
	    cui_menu_close(((cui_menu_event_struct*)evt)->sender_id);
        return MMI_RET_OK;
	}
    else if (cui_menu_is_menu_event(evt->evt_id))
    {        
        return mmi_phnset_screensaver_sub_menu_handler((cui_menu_event_struct*)evt,GRP_ID_SCREENSAVER_MAIN);
    }    
    return MMI_RET_OK;    
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
#ifdef __MMI_FILE_MANAGER__
void mmi_fmgr_to_screensaver_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_view_setting_common_forward_from_fmgr(MMI_PHNSET_TYPE_SS, filepath, (filetypes_file_type_enum)fileinfo->type);
}
#define MMI_PHNSET_SCREEN_SAVER_CACHE_FILE_NAME (L"\\UserSS_")
void mmi_phnset_screensaver_get_default_file_prefix(void *obj, WCHAR *buffer, U8 buffer_len)
{
    mmi_setting_display_cache_setting_object_struct *screensaver_obj = (mmi_setting_display_cache_setting_object_struct*)obj;
    screensaver_obj->get_default_folder(screensaver_obj, buffer, buffer_len);
    if (mmi_wcslen(buffer) + mmi_wcslen(MMI_PHNSET_SCREEN_SAVER_CACHE_FILE_NAME) > buffer_len)
	{
	    ASSERT(0);
	}
    mmi_wcscat(buffer, MMI_PHNSET_SCREEN_SAVER_CACHE_FILE_NAME);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_set_file
 * DESCRIPTION
 *  Set cache file 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_screensaver_set_file(void* obj, const WCHAR* user_file_name, const WCHAR* cache_file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 screensaver_id = 0;
    S16 error;
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!cache_file_name && !user_file_name)
    {
        return;
    }
    
    if (cache_file_name)
	{
        mmi_wcscpy(g_mmi_screensaver_cache_file_name, cache_file_name);
        mmi_ucs2_to_asc(g_mmi_screensaver_user_file.cache_file_name, (CHAR*)g_mmi_screensaver_cache_file_name);
        g_mmi_screensaver_id = 0;
        mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &screensaver_id);

        if (mmi_idle_is_active())
        {
            mmi_idle_display();
        }	
	}
    if (user_file_name)
	{
        mmi_wcscpy(g_mmi_screensaver_user_file.file_name, user_file_name);
	}      
   
    WriteRecord(NVRAM_EF_SCREENSAVER_FILENAME_LID, 1, &g_mmi_screensaver_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        

    mmi_popup_display_simple((WCHAR*) GetString(STR_GLOBAL_DONE), MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_SCREENSAVER_MAIN);
}

void mmi_phnset_screensaver_direct_set_file(void* obj, const WCHAR* file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    //mmi_wcscpy(g_mmi_screensaver_cache_file_name, file_name);

    g_mmi_screensaver_id = 0;
    mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &g_mmi_screensaver_id);

    if (mmi_idle_is_active())
    {
        mmi_idle_display();
    }	

    mmi_wcscpy(g_mmi_screensaver_user_file.file_name, file_name);

    WriteRecord(NVRAM_EF_SCREENSAVER_FILENAME_LID, 1, &g_mmi_screensaver_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        

    mmi_popup_display_simple((WCHAR*) GetString(STR_GLOBAL_DONE), MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_SCREENSAVER_MAIN);
    mmi_phnset_view_setting_notify_result(MMI_TRUE, PHNSET_WP_SS_SET_NO_ERROR);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_get_cache_file
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  WCHAR*
 *****************************************************************************/
WCHAR* mmi_phnset_screensaver_get_cache_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_screensaver_init();
    return g_mmi_screensaver_cache_file_name;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_get_user_file
 * DESCRIPTION
 *  Get file name 
 * PARAMETERS
 *  
 * RETURNS
 *  WCHAR*
 *****************************************************************************/
WCHAR* mmi_phnset_screensaver_get_user_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_screensaver_init();
    return g_mmi_screensaver_user_file.file_name;
}

#endif /* __MMI_FILE_MANAGER__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_get_static_id
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
U16 mmi_phnset_screensaver_get_static_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_mmi_screensaver_id;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_set_static_id
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
void mmi_phnset_screensaver_set_static_id(U16 id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_screensaver_id = id;
    mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &id);
    if (id == 0)
	{
	   return;
	}

    if (mmi_idle_is_active())
    {
        mmi_idle_display();
    }

#ifdef __MMI_FILE_MANAGER__
    mmi_phnset_view_setting_cache_util_del_file(mmi_phnset_screensaver_get_cache_file());
#endif
}

static void mmi_phnset_screensaver_init(void)
{
    static MMI_BOOL is_init = MMI_FALSE;
	S16 error;
    PHNSET_TYPE_DISP type;    

    if (is_init)
    {
        return;
    }
	is_init = MMI_TRUE;

    ReadValue(NVRAM_SCREENSAVER_STATUS, &(g_mmi_screensaver_current_status), DS_BYTE, &error);
    ReadValue(NVRAM_SCREENSAVER_WAITING, &(g_mmi_screensaver_waiting_time), DS_BYTE, &error);

    mmi_dispchar_get_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));
    
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SS_READ_SS_INFO,
                         mmi_phnset_screensaver_get_static_id(), g_mmi_screensaver_current_status, g_mmi_screensaver_waiting_time);

#ifdef __MMI_SETTING_SS_WAITTIME_SELECT__
    if ((g_mmi_screensaver_waiting_time < MMI_SETTING_SCREENSAVE_MIN_TIME + 1) || 
        (g_mmi_screensaver_waiting_time > MMI_SETTING_SCREENSAVE_MAX_TIME - 1))
    {
        g_mmi_screensaver_waiting_time = 30;
        WriteValue(NVRAM_SCREENSAVER_WAITING, &g_mmi_screensaver_waiting_time, DS_BYTE, &error);
    }
#endif /* __MMI_SETTING_SS_WAITTIME_SELECT__ */

#ifndef __MMI_LCD_PARTIAL_ON__
    /* If __MMI_LCD_PARTIAL_ON__ is turned off without reseting NVRAM */
    if (g_mmi_screensaver_current_status == (S32) SET_SS_STATUS_POWERSAVING)
    {
        g_mmi_screensaver_current_status = 0xFF;
    }
#endif /* __MMI_LCD_PARTIAL_ON__ */ 

    if (g_mmi_screensaver_current_status == 0xFF)
    {
        g_mmi_screensaver_current_status = FACTORY_RESTORE_DEFAULT_SCREENSAVER_STATUS;
        WriteValue(NVRAM_SCREENSAVER_STATUS, &(g_mmi_screensaver_current_status), DS_BYTE, &error);
    }

    if (g_mmi_screensaver_waiting_time == 0xFF)
    {
        g_mmi_screensaver_waiting_time = FACTORY_RESTORE_DEFAULT_SCREENSAVER_WAITING_TIME;
        WriteValue(NVRAM_SCREENSAVER_WAITING, &g_mmi_screensaver_waiting_time, DS_BYTE, &error);
    }

    if ((type = PhnsetGetDisplayType(g_mmi_screensaver_id)) == PHNSET_TYPE_DISP_INVALID)
    {
    	PhnsetRstScrSvrDefault();
        //g_mmi_screensaver_id = RstGetScrSaverImgIdDefault();
        //mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));
    }
#ifdef __MMI_FILE_MANAGER__    
    else if (type == PHNSET_TYPE_DISP_USER)
    {
        ReadRecord(NVRAM_EF_SCREENSAVER_FILENAME_LID, 1, &g_mmi_screensaver_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);

        if (error != NVRAM_READ_SUCCESS)
        {
            memset(&g_mmi_screensaver_user_file, 0, sizeof(g_mmi_screensaver_user_file));
            memset(&g_mmi_screensaver_cache_file_name, 0, sizeof(g_mmi_screensaver_cache_file_name));
            
			PhnsetRstScrSvrDefault();
            //g_mmi_screensaver_id = RstGetScrSaverImgIdDefault();
            //mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_mmi_screensaver_id));
        }
        mmi_asc_to_wcs(g_mmi_screensaver_cache_file_name, g_mmi_screensaver_user_file.cache_file_name);
    }
#endif /* __MMI_FILE_MANAGER__ */

} 
#else
void PhnsetReadNvramScrSvrSettings(void)
{
}

void PhnsetGetScrSvrSetings(U8 *ScreenSaverStatus, U8 *ScreenSaverWait)
{
    *ScreenSaverStatus = SET_SS_STATUS_OFF;
    *ScreenSaverWait = 30;
}

void PhnsetGetCurScrSvr(U16 *screenSaver)
{
    *screenSaver = IMG_ID_PHNSET_SS_0;
}

CHAR* PhnsetGetCurScrSvrFileName(void)
{
    return NULL;
}

S32 PhnsetScreenSaverBadFileCallBack(U16 StrID)
{
   return NULL;
}

void PhnsetRstScrSvrDefault(void)
{
}

void PhnsetSetScrSvrByFileName(CHAR *path)
{
}

#ifdef __MMI_THEMES_V2_SUPPORT__
BOOL PhnsetIsScrSvrCurrentTheme(void)
{
    return FALSE;
}

void ThemeManagerSetScreensaver(U16 nId)
{
}
#endif /* __MMI_THEMES_V2_SUPPORT__ */ 
void mmi_phnset_disable_partial_ss(void)
{
}
void mmi_phnset_enable_partial_ss(void)
{
}

BOOL PhnsetIsScrSvrAnalogClock(void)
{
    return FALSE;
}
BOOL PhnsetIsScrSvrDigitalClock(void)
{
    return FALSE;
}
BOOL PhnsetIsScrSvrPartialOn(void)
{
    return FALSE;
}
#ifdef __MMI_FILE_MANAGER__
void mmi_fmgr_to_screensaver_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
}
#endif /* __MMI_FILE_MANAGER__ */
#endif /* __MMI_SCREEN_SAVER__ */

