/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*******************************************************************************/
/*******************************************************************************
 *  Modification Notice:
 *  --------------------------
 *  This software is modified by MediaTek Inc. and the information contained
 *  herein is confidential. The software may not be copied and the information
 *  contained herein may not be used or disclosed except with the written
 *  permission of MediaTek Inc. (C) 2001
 *
 *******************************************************************************/
/*******************************************************************************
 *
 * Filename:
 * ---------
 *  CertManMMIUI.c
 *
 * Project:
 * --------
 *  Certificate Manager
 *
 * Description:
 * ------------
 *   This file is intends for handling UI of Certificate Manager
 *
 * Author:
 * ------------
 * -------
 *
 *==============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!! 
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!! 
 *============================================================================== 
 ********************************************************************************/
#ifdef __PLUTO_MMI_PACKAGE__
#ifdef __CERTMAN_SUPPORT__

#include "kal_release.h"
#include "MMIDataType.h"
#include "kal_trace.h"
#include "mmi_frm_events_gprot.h"
#include "mmi_frm_scenario_gprot.h"
#include "FSEditorCuiGprot.h"
#include "inlineCuiGprot.h"
#include "CertManMMIGProts.h"
#include "CertManMMIResDef.h"
#include "CertManMMITypes.h"
#include "CertManMMIProts.h"
#include "CommonScreensResDef.h"
#include "CommonScreens.h"
#include "UcmSrvGprot.h"
#include "custom_events_notify.h"
#include "ProfilesSrvGprot.h"
extern FuncPtr PopupFunc;
extern U8 wgui_inline_list_menu_changed;
#include "MenuCuiGprot.h"
#include "PhoneSetupGprots.h"
#include "MMI_inet_app_trc.h"
#include "DebugInitDef_Int.h"
#include "kal_general_types.h"
#include "certman_defs.h"
#include "mmi_frm_scenario_gprot.h"
#include "certman_api.h"
#include "stack_config.h"
#include "certman_struct.h"
#include "CustDataRes.h"
#include "GlobalResDef.h"
#include "Unicodexdcl.h"
#include "mmi_rp_app_mmi_certman_def.h"
#include "mmi_frm_history_gprot.h"
#include "custpack_certs.h"
#include "string.h"
#include "AlertScreen.h"
#include "InlineCuiGprot.h"
#include "custom_mmi_default_value.h"
#include "kal_public_api.h"
#include "gui_data_types.h"
#include "stack_msgs.h"
#include "GpioSrvGprot.h"
#include "FileManagerResDef.h"
#include "TimerEvents.h"
#include "CustMenuRes.h"
#include "Wgui_categories_util.h"
#include "FileMgrResDef.h"
#include "mmi_rp_srv_filemanager_def.h"
#include "mmi_rp_app_uiframework_def.h"

extern int  certman_cfg_get_num_cert_in_database(void);

/* FMGR Revise */
/* extern fmgr_context_struct *fmgr_p; */

mmi_imm_input_mode_enum g_mmi_certman_default_input_type = IMM_INPUT_MODE_MULTITAP_LOWERCASE_ABC;

cui_inline_item_softkey_struct g_mmi_certman_inline_softkeys =
{
    {
        {CUI_INLINE_SOFTKEY_DEFAULT_VALUE, 0},
        {CUI_INLINE_SOFTKEY_DEFAULT_VALUE, 0},
        {CUI_INLINE_SOFTKEY_DEFAULT_VALUE, 0}
    }
};

/*------------Certificate validation screen : inline CUI---------------------*/

#ifdef __OCSP_SUPPORT__

#define MMI_CERTMAN_OCSP_SETTING_INLINE_CAPTION       CUI_INLINE_ITEM_ID_BASE+1
#define MMI_CERTMAN_OCSP_SETTING_INLINE_SELECT        CUI_INLINE_ITEM_ID_BASE+2
#define MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR_CAPTION     CUI_INLINE_ITEM_ID_BASE+3
#define MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR             CUI_INLINE_ITEM_ID_BASE+4

cui_inline_item_caption_struct g_mmi_certman_online_cert_check_caption_struct =
{
    STR_ID_CERTMAN_CERTIFICATE_CHECK
}; 


U16 g_mmi_certman_ocsp_options_strings[] =
{
    STR_GLOBAL_ON, 
    STR_GLOBAL_OFF, 
#ifdef __MMI_CERTMAN_OCSP_MUST_BE_PASSED_OPTION__
    STR_ID_CERTMAN_MUST_BE_PASSED,
#endif /* __MMI_CERTMAN_OCSP_MUST_BE_PASSED_OPTION__ */
};

cui_inline_item_select_struct g_mmi_certman_online_cert_check_options_struct =
{
    MMI_CERTMAN_OCSP_END,
    0,
    g_mmi_certman_ocsp_options_strings
};

cui_inline_item_caption_struct g_mmi_certman_ocsp_default_web_addr_caption_struct = 
{
    /* default web addr */
    STR_ID_CERTMAN_CERT_STATUS_SERVER
};

cui_inline_item_fullscreen_edit_struct g_mmi_certman_ocsp_default_web_addr_struct = 
{
    0,
    0,
    STR_ID_CERTMAN_CERT_STATUS_SERVER,
    IMG_ID_CERTMAN_CERT_MANAGER,
    0,
    IMM_INPUT_TYPE_URL,
    NVRAM_EF_CERTMAN_OCSP_URL_SIZE/2,
    &g_mmi_certman_default_input_type
};

cui_inline_set_item_struct g_mmi_certman_ocsp_inline_items[] = 
{
    {MMI_CERTMAN_OCSP_SETTING_INLINE_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L1, &g_mmi_certman_online_cert_check_caption_struct},
    {MMI_CERTMAN_OCSP_SETTING_INLINE_SELECT, CUI_INLINE_ITEM_TYPE_SELECT, 0, &g_mmi_certman_online_cert_check_options_struct},
    {MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L2, &g_mmi_certman_ocsp_default_web_addr_caption_struct},
    {MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR, CUI_INLINE_ITEM_TYPE_FULLSCREEN_EDIT, 0, &g_mmi_certman_ocsp_default_web_addr_struct},
};

cui_inline_struct g_mmi_certman_ocsp_inline = 
{
    4,
    STR_ID_CERTMAN_CERT_VALIDATION,
    IMG_ID_CERTMAN_CERT_MANAGER,
    CUI_INLINE_SCREEN_LOOP,
    &g_mmi_certman_inline_softkeys,
    g_mmi_certman_ocsp_inline_items
};

#endif /* __OCSP_SUPPORT__ */
/*--------------Certificates input screen : inline CUI-----------------------*/


#define MMI_CERTMAN_CERT_INPUT_LABEL_CAPTION                         CUI_INLINE_ITEM_ID_BASE+5
#define MMI_CERTMAN_CERT_INPUT_INLINE_LABEL                          CUI_INLINE_ITEM_ID_BASE+6
#define MMI_CERTMAN_CERT_INPUT_KEY_USAGE_CAPTION                     CUI_INLINE_ITEM_ID_BASE+7
#define MMI_CERTMAN_CERT_INPUT_KEY_USAGE                             CUI_INLINE_ITEM_ID_BASE+8
#define MMI_CERTMAN_CERT_INPUT_KEY_PROTECTION_CAPTION                CUI_INLINE_ITEM_ID_BASE+9
#define MMI_CERTMAN_CERT_INPUT_INLINE_KEY_PROTECTION                 CUI_INLINE_ITEM_ID_BASE+10
#define MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD_CAPTION         CUI_INLINE_ITEM_ID_BASE+11
#define MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD                 CUI_INLINE_ITEM_ID_BASE+12
#define MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD_CAPTION       CUI_INLINE_ITEM_ID_BASE+13
#define MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD               CUI_INLINE_ITEM_ID_BASE+14

cui_inline_item_caption_struct g_mmi_certman_inline_label_caption = 
{
    STR_ID_CERTMAN_CERTIFICATE_LABEL
};

U16 g_mmi_certman_key_protection_strings[] = 
{
    STR_GLOBAL_NONE,
    STR_ID_CERTMAN_CERTIFICATE_PRIV_KEY_CONFIRMATION,
    STR_GLOBAL_PASSWORD
};

cui_inline_item_fullscreen_edit_struct g_mmi_certman_cert_input_inline_label = 
{
    0,
    0,
    STR_ID_CERTMAN_CERTIFICATE_LABEL,
    IMG_ID_CERTMAN_CERT_MANAGER,
    0,
    IMM_INPUT_TYPE_SENTENCE,
    CERTMAN_LABEL_LENGTH / 2 + 1,
    &g_mmi_certman_default_input_type   /* can use this */
};

cui_inline_item_caption_struct g_mmi_certman_inline_key_usage_caption =
{
    STR_ID_CERTMAN_CERTIFICATE_KEY_USAGE
};

cui_inline_item_display_only_struct g_mmi_certman_inline_display_only = 
{
    STR_ID_CERTMAN_KP_ALL
};


cui_inline_item_select_struct g_mmi_certman_cert_input_inline_key_protection =
{
    3,
    0,
    g_mmi_certman_key_protection_strings
};

cui_inline_item_caption_struct g_mmi_certman_inline_key_protection_caption = 
{
    STR_ID_CERTMAN_CERTIFICATE_PRIVATE_KEY_PROTECTION
};

cui_inline_item_caption_struct g_mmi_certman_inline_cert_input_password_caption = 
{
    STR_ID_CERTMAN_INPUT_PASSWORD,
};


cui_inline_item_caption_struct g_mmi_certman_cert_input_inline_confirm_password_caption = 
{
    STR_ID_CERTMAN_CERTIFICATE_CONFIRM_PWD
};

cui_inline_item_fullscreen_edit_struct g_mmi_certan_inline_cert_input_password = 
{
    0,
    0,
    STR_ID_CERTMAN_INPUT_PASSWORD,
    IMG_ID_CERTMAN_CERT_MANAGER,
    0,
    IMM_INPUT_TYPE_ALPHANUMERIC_PASSWORD | INPUT_TYPE_USE_ONLY_ENGLISH_MODES,
    CERTMAN_PASSWORD_LENGTH + 1,
    &g_mmi_certman_default_input_type   /* can use this */
};


cui_inline_set_item_struct g_mmi_certman_cert_input_inline_items[] = 
{
    {MMI_CERTMAN_CERT_INPUT_LABEL_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L1, &g_mmi_certman_inline_label_caption},
    {MMI_CERTMAN_CERT_INPUT_INLINE_LABEL, CUI_INLINE_ITEM_TYPE_FULLSCREEN_EDIT, 0, &g_mmi_certman_cert_input_inline_label},
    {MMI_CERTMAN_CERT_INPUT_KEY_USAGE_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L2, &g_mmi_certman_inline_key_usage_caption},
    {MMI_CERTMAN_CERT_INPUT_KEY_USAGE, CUI_INLINE_ITEM_TYPE_DISPLAY_ONLY, 0, &g_mmi_certman_inline_key_usage_caption},
    {MMI_CERTMAN_CERT_INPUT_KEY_PROTECTION_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L3, &g_mmi_certman_inline_key_protection_caption},
    {MMI_CERTMAN_CERT_INPUT_INLINE_KEY_PROTECTION, CUI_INLINE_ITEM_TYPE_SELECT, 0, &g_mmi_certman_cert_input_inline_key_protection},
    {MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L4, &g_mmi_certman_inline_cert_input_password_caption},
    {MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD, CUI_INLINE_ITEM_TYPE_FULLSCREEN_EDIT, 0, &g_mmi_certan_inline_cert_input_password},
    {MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, IMG_GLOBAL_L5, &g_mmi_certman_cert_input_inline_confirm_password_caption},
    {MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD, CUI_INLINE_ITEM_TYPE_FULLSCREEN_EDIT, 0, &g_mmi_certan_inline_cert_input_password}
};

cui_inline_struct g_mmi_certman_cert_input_inline_personal = 
{
    10,
    STR_ID_CERTMAN_CERTIFICATE_INFO,
    IMG_ID_CERTMAN_CERT_MANAGER,
    CUI_INLINE_SCREEN_LOOP,
    &g_mmi_certman_inline_softkeys,
    g_mmi_certman_cert_input_inline_items
};

cui_inline_struct g_mmi_certman_cert_input_inline = 
{
    4,
    STR_ID_CERTMAN_CERTIFICATE_INFO,
    IMG_ID_CERTMAN_CERT_MANAGER,
    CUI_INLINE_SCREEN_LOOP,
    &g_mmi_certman_inline_softkeys,
    g_mmi_certman_cert_input_inline_items
};


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_set_protocol_events
 * DESCRIPTION
 *  function to set protocol handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_set_protocol_events(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetProtocolEventHandler(mmi_certman_install_certificates_ind_handler, MSG_ID_MMI_CERTMAN_INSTALL_CERT_IND);
    SetProtocolEventHandler(mmi_certman_launch_certificates_ind_handler, MSG_ID_MMI_CERTMAN_LAUNCH_CERT_IND);
    SetProtocolEventHandler(mmi_certman_select_certificates_ind_handler, MSG_ID_MMI_CERTMAN_SELECT_CERT_IND);
    SetProtocolEventHandler(mmi_certman_view_certificates_ind_handler, MSG_ID_MMI_CERTMAN_VIEW_CERT_IND);
    SetProtocolEventHandler(mmi_certman_invalid_certificates_ind_handler, MSG_ID_MMI_CERTMAN_INVALID_CERT_IND);
    SetProtocolEventHandler(mmi_certman_select_user_certificates_ind_handler, MSG_ID_MMI_CERTMAN_SELECT_USER_CERT_IND);

    SetProtocolEventHandler(mmi_certman_privkey_usage_password_ind_handler, MSG_ID_CERTMAN_PRIVKEY_USAGE_PASSWORD_IND);
    SetProtocolEventHandler(
        mmi_certman_send_privkey_usage_confirm_ind_handler,
        MSG_ID_CERTMAN_PRIVKEY_USAGE_CONFIRM_IND);
    SetProtocolEventHandler(mmi_certman_read_task_queue_ind_handler, MSG_ID_MMI_CERTMAN_READ_TASK_QUEUE_IND);

}

/*****************************IMPORT CERTIFICATES*****************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_get_decryption_password
 * DESCRIPTION
 *  pre entry function to input decryption password
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_get_decryption_password(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_PRE_ENTRY_GET_DECRYPTION_PASSWORD);
    memset(
        g_mmi_certman_context.import_context_p->password,
        0,
        sizeof(g_mmi_certman_context.import_context_p->password));
    mmi_certman_get_decryption_password();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_decryption_password
 * DESCRIPTION
 *  entry screen to input decryption password
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_get_decryption_password(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    mmi_certman_fseditor_struct *fseditor;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    fseditor = (mmi_certman_fseditor_struct *)mmi_certman_malloc(sizeof(mmi_certman_fseditor_struct));
    fseditor->grp_id = GRP_ID_CERTMAN_IMPORT;
    fseditor->title = STR_ID_CERTMAN_INPUT_PASSWORD;
    fseditor->title_icon = IMG_ID_CERTMAN_CERT_MANAGER;
    fseditor->lsk_label = STR_GLOBAL_OPTIONS;
    fseditor->lsk_icon = IMG_GLOBAL_OPTIONS;
    fseditor->rsk_label = STR_GLOBAL_BACK;
    fseditor->rsk_icon = IMG_GLOBAL_BACK;
    fseditor->input_mode = IMM_INPUT_TYPE_ALPHANUMERIC_PASSWORD | INPUT_TYPE_USE_ONLY_ENGLISH_MODES;
    fseditor->buffer_len = CERTMAN_PASSWORD_SIZE *ENCODING_LENGTH;
    fseditor->input_len = CERTMAN_PASSWORD_LENGTH;
    fseditor->buffer = g_mmi_certman_context.import_context_p->password;

    fseditor->submit_fp = mmi_certman_decryption_pwd_lsk;
    fseditor->cancel_fp = mmi_certman_exit_pwd_screen;

    g_mmi_certman_context.import_context_p->fseditor = fseditor;

    fseditor->id = mmi_certman_fseditor_scr_entry(fseditor);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_decryption_pwd_lsk
 * DESCRIPTION
 *  lsk function for decryption pwd screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_decryption_pwd_lsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DECR_PWD_LSK);    
    mmi_frm_scrn_close (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_GET_DECR_PWD);
    mmi_frm_scrn_close (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_EDITOR_OPTION);
    mmi_certman_check_decryption_pwd(g_mmi_certman_context.import_context_p->password);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_decr_pwd_length_validation
 * DESCRIPTION
 *  It checks if the Min. required password entered or not
 * PARAMETERS
 *  text_p          [IN]        
 *  cursor_p        [IN]        
 *  length          [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_decr_pwd_length_validation(U8 *text_p, U8 *cursor_p, S32 length)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((length) < 1)
    {
        ChangeLeftSoftkey(0, 0);
        ClearKeyHandler(KEY_POUND, KEY_EVENT_UP);
    }
    else
    {
        EnableLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
        SetKeyHandler(mmi_certman_decryption_pwd_lsk, KEY_POUND, KEY_EVENT_UP);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_exit_pwd_screen
 * DESCRIPTION
 *  This function is for exit from pdecryption password screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_exit_pwd_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_close(GRP_ID_CERTMAN_IMPORT);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_display_file_info
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_display_file_info(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_PRE_DISP_FILE_INFO);    
    mmi_certman_display_file_info();
    mmi_frm_scrn_close(GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_PROGRESS_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_file_info
 * DESCRIPTION
 *  Entry function to display PKCS#12 file information
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_file_info(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *file_info;
    U8 *gui_buffer;
    S8 buf[12] = { '\0' };
    S8 buf1[10] = { '\0' };
    U16 no_of_pkeys = 0;
    U16 no_of_authority_certificates = 0;
    U16 no_of_user_certificates = 0;
    S32 buff_length;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_IMPORT, (MMI_ID)SCR_ID_CERTMAN_FILE_INFO,
        NULL, (FuncPtr)mmi_certman_display_file_info, (mmi_frm_scrn_type_enum)0))
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISPLAY_FILE_INFO);
	gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_FILE_INFO);
	buff_length = MAX_SUB_MENUS * MAX_SUB_MENU_SIZE;
	file_info = (PU8) subMenuData;
	file_info[0] = 0;
	file_info[1] = 0;

        mmi_ucs2ncpy((PS8) file_info, (PS8) GetString(STR_ID_CERTMAN_FILE_CONTAINS), buff_length);
	buff_length = (buff_length -=
	    ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_FILE_CONTAINS))) >
	    0 ? buff_length : 0;

	no_of_authority_certificates = mmi_certman_get_no_of_authority_certificates();
	if (no_of_authority_certificates > 0)
	{
	    sprintf((S8*) buf, "%d", no_of_authority_certificates);
	    mmi_asc_to_ucs2((S8*) buf1, (S8*) buf);
            mmi_ucs2ncat((PS8) file_info, (PS8) L"\n", buff_length);
	    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

	    mmi_ucs2ncat((PS8) file_info, (PS8) buf1, buff_length);
	    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) buf1)) > 0 ? buff_length : 0;

	    mmi_ucs2ncat((PS8) file_info, (PS8) L" ", buff_length);
	    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L" ")) > 0 ? buff_length : 0;

	    mmi_ucs2ncat((PS8) file_info, (PS8) GetString(STR_ID_CERTMAN_AUTHORITY_CERT), buff_length);
	    buff_length = (buff_length -=
                ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_AUTHORITY_CERT))) >
		0 ? buff_length : 0;
        }
	no_of_user_certificates = mmi_certman_get_no_of_user_certificates();
	if (no_of_user_certificates > 0)
	{
	    sprintf((S8*) buf, "%d", no_of_user_certificates);
	    mmi_asc_to_ucs2((S8*) buf1, (S8*) buf);

	    mmi_ucs2ncat((PS8) file_info, (PS8) L"\n", buff_length);
	    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

	    mmi_ucs2ncat((PS8) file_info, (PS8) buf1, buff_length);
	    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) buf1)) > 0 ? buff_length : 0;

	    mmi_ucs2ncat((PS8) file_info, (PS8) L" ", buff_length);
	    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L" ")) > 0 ? buff_length : 0;

	    mmi_ucs2ncat((PS8) file_info, (PS8) GetString(STR_ID_CERTMAN_USER_CERT), buff_length);
	    buff_length = (buff_length -=
                ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_USER_CERT))) >
		0 ? buff_length : 0;
	}

	no_of_pkeys = mmi_certman_get_no_of_private_keys();
	sprintf((S8*) buf, "%d", no_of_pkeys);
	mmi_asc_to_ucs2((S8*) buf1, (S8*) buf);

        mmi_ucs2ncat((PS8) file_info, (PS8) L"\n", buff_length);
	buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

	mmi_ucs2ncat((PS8) file_info, (PS8) buf1, buff_length);
	buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) buf1)) > 0 ? buff_length : 0;

	mmi_ucs2ncat((PS8) file_info, (PS8) L" ", buff_length);
	buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L" ")) > 0 ? buff_length : 0;

	mmi_ucs2ncat((PS8) file_info, (PS8) GetString(STR_ID_CERTMAN_PRIVATE_KEY), buff_length);
	buff_length = (buff_length -=
	ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_PRIVATE_KEY))) >
	0 ? buff_length : 0;

	ShowCategory74Screen(
	    STR_ID_CERTMAN_PERSONAL_CERTIFICATE,
	    IMG_ID_CERTMAN_CERT_MANAGER,
	    STR_GLOBAL_SAVE,
	    NULL,
	    STR_GLOBAL_DISCARD,
	    NULL,
	    file_info,
	    mmi_ucs2strlen((const S8*)file_info),
	    gui_buffer);
	SetLeftSoftkeyFunction(mmi_certman_display_file_info_lsk, KEY_EVENT_UP);
	SetRightSoftkeyFunction(mmi_certman_discard_file, KEY_EVENT_UP);
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_certman_display_file_info_lsk, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_file_info_lsk
 * DESCRIPTION
 *  LSK function for file info screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_file_info_lsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISP_FILE_INFO_LSK);	
    mmi_frm_scrn_close (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_FILE_INFO);
    mmi_certman_save_file();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_discard_file
 * DESCRIPTION
 *  This function discards file
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_discard_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISCARD_FILE);		
    mmi_certman_displaypop_with_callback(
        (PU8) GetString((U16) STR_ID_CERTMAN_NOT_SAVED),
        MMI_EVENT_SUCCESS,
        mmi_certman_import_grp_close_callback,
        GRP_ID_CERTMAN_IMPORT);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_display_certificate_contents
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_display_certificate_contents(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_PRE_DISP_CERT_CONTENTS);		
    mmi_certman_display_certificate_contents();
    mmi_frm_scrn_close(GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_PROGRESS_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_certificate_contents
 * DESCRIPTION
 *  This function display the contents of the certificate in case of import
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_certificate_contents(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer;
    pBOOL result = MMI_TRUE;
    PU8 cert_info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_IMPORT, (MMI_ID)SCR_ID_CERTMAN_CERTIFICATE_DETAILS, NULL, 
	(FuncPtr)mmi_certman_display_certificate_contents, (mmi_frm_scrn_type_enum)0))
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISP_CERT_CONTENTS);		

	cert_info = (PU8) subMenuData;
	cert_info[0] = 0;
	cert_info[1] = 0;
	result = mmi_certman_fill_certificate_contents_only(
                     cert_info,
		     &(g_mmi_certman_context.import_context_p->parsed_data_p->cert));
	if (result == MMI_FALSE)
        {
            certman_parsed_data_free(g_mmi_certman_context.import_context_p->parsed_data_p);
			 g_mmi_certman_context.import_context_p->parsed_data_p = NULL;
	    g_mmi_certman_context.import_context_p->current_state = MMI_CERTMAN_IMPORT_DETAIL_REQUEST;
            mmi_certman_import_state(NULL);
	    return;
	}
	MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISPLAY_CERTIFICATE_CONTENTS);
	gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_CERTIFICATE_DETAILS);

	ShowCategory74Screen(
	    STR_ID_CERTMAN_CERTIFICATE_DETAILS,
	    IMG_ID_CERTMAN_CERT_MANAGER,
	    STR_GLOBAL_SAVE,
	    NULL,
	    STR_GLOBAL_DISCARD,
	    NULL,
	    cert_info,
	    (mmi_ucs2strlen((const S8*)cert_info)),
	    gui_buffer);
	ClearKeyEvents();
	SetLeftSoftkeyFunction(mmi_certman_import_certificate_validation, KEY_EVENT_UP);
	SetRightSoftkeyFunction(mmi_certman_display_certificate_rsk, KEY_EVENT_UP);
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_certman_import_certificate_validation, KEY_EVENT_UP);
    }
}

mmi_ret mmi_certman_import_cert_confirmCb(mmi_alert_result_evt_struct *evt)
{
    if (evt->evt_id == EVT_ID_ALERT_QUIT)
    {
        switch (evt->result)
        {
        case MMI_ALERT_CNFM_1:
            mmi_certman_check_certificate_expiry();
            break;
        case MMI_ALERT_CNFM_2:
            mmi_certman_check_certificate_expiry();
            break;
        case MMI_ALERT_CNFM_3:
            mmi_certman_import_certificate_validation_rsk();
            break;
        case MMI_ALERT_CNFM_OK:
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_YES:
            break;
        case MMI_ALERT_CNFM_NO:
            break;
        }
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_import_certificate_validation
 * DESCRIPTION
 *  This function check whether the certificate is valid  or not
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_import_certificate_validation(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_certman_context.import_context_p->parsed_data_p->not_validated != 0)
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_IMPORT_CERT_VALIDATION);		    
        do {
	    mmi_confirm_property_struct arg;
	    mmi_confirm_property_init(&arg, CNFM_TYPE_USER_DEFINE);
	    arg.softkey[0].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_YES));
            arg.softkey[1].img = get_image(IMG_GLOBAL_COMMON_CSK);
	    arg.softkey[2].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_NO));
	    arg.callback = (mmi_proc_func)mmi_certman_import_cert_confirmCb;
	    arg.parent_id = GRP_ID_CERTMAN_IMPORT;
	    mmi_confirm_display((WCHAR *)((UI_string_type)get_string(STR_ID_CERTMAN_NOT_VALIDATED)), MMI_EVENT_QUERY, &arg);
	} while(0);
    }
    else
    {
        mmi_certman_check_certificate_expiry();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_import_certificate_validation_rsk
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_import_certificate_validation_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_IMPORT_CERT_VALIDATION_RSK);
    GoBackHistory();
    mmi_certman_display_certificate_rsk();
}


mmi_ret mmi_certman_import_expired_confirmCb(mmi_alert_result_evt_struct *evt)
{
    if (evt->evt_id == EVT_ID_ALERT_QUIT)
    {
        switch (evt->result)
        {
        case MMI_ALERT_CNFM_1:
            mmi_certman_save_certificate();
            break;
        case MMI_ALERT_CNFM_2:
            mmi_certman_save_certificate();
            break;
        case MMI_ALERT_CNFM_3:
            mmi_certman_check_certificate_expiry_rsk();
            break;
        case MMI_ALERT_CNFM_OK:
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_YES:
            break;
        case MMI_ALERT_CNFM_NO:
            break;
        }
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_check_certificate_expiry
 * DESCRIPTION
 *  This function is for checking the expiry of the certificate
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_check_certificate_expiry(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_certman_context.import_context_p->parsed_data_p->cert_expired != 0)
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_CHECK_CERT_EXPIRY);		    
        do {
	    mmi_confirm_property_struct arg;
	    mmi_confirm_property_init(&arg, CNFM_TYPE_USER_DEFINE);
	    arg.softkey[0].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_YES));
            arg.softkey[1].img = get_image(IMG_GLOBAL_COMMON_CSK);  /* CSK */
	    arg.softkey[2].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_NO));
	    arg.callback = (mmi_proc_func)mmi_certman_import_expired_confirmCb;
	    arg.parent_id = GRP_ID_CERTMAN_IMPORT;
	    mmi_confirm_display((WCHAR *)((UI_string_type)get_string(STR_ID_CERTMAN_EXPIRED_CERT)), MMI_EVENT_QUERY, &arg);
	} while(0);
    }
    else
    {
        mmi_certman_save_certificate();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_check_certificate_expiry_rsk
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_check_certificate_expiry_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_CHECK_CERT_EXPIRY_LSK);		    	
    GoBackHistory();
    mmi_certman_display_certificate_rsk();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_certificate_rsk
 * DESCRIPTION
 *  the RSK function for display certificate entry function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_certificate_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISP_CERT_LSK);
    mmi_certman_display_message_with_callback(
        STR_ID_CERTMAN_DISCARDED,
        MMI_EVENT_SUCCESS,
        mmi_certman_discard_certificate,
        GRP_ID_CERTMAN_IMPORT);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_get_certificate_inputs
 * DESCRIPTION
 *  Pre-entry function to  get certificate's input by user
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_get_certificate_inputs(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_PRE_CERT_INPUTS);	
    g_mmi_certman_context.import_context_p->protection_method = CERTMAN_PROTECT_NONE;
    memset(g_mmi_certman_context.import_context_p->privatekey_pwd, 0, 2);
    memset(g_mmi_certman_context.import_context_p->privatekey_cnf_pwd, 0, 2);

    if (g_mmi_certman_context.import_context_p->cert_group == CERTMAN_CERTGRP_PERSONAL)
    {
        g_mmi_certman_context.import_context_p->inline_cui_id = cui_inline_create(GRP_ID_CERTMAN_IMPORT, &g_mmi_certman_cert_input_inline_personal);
        
        cui_inline_set_item_attributes(
            g_mmi_certman_context.import_context_p->inline_cui_id,
            MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD,
            CUI_INLINE_SET_ATTRIBUTE,
            CUI_INLINE_ITEM_DISABLE);

        cui_inline_set_item_attributes(
            g_mmi_certman_context.import_context_p->inline_cui_id,
            MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD,
            CUI_INLINE_SET_ATTRIBUTE,
            CUI_INLINE_ITEM_DISABLE);

        cui_inline_set_softkey_icon(
            g_mmi_certman_context.import_context_p->inline_cui_id,
            MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD,
            MMI_CENTER_SOFTKEY,
            IMG_GLOBAL_COMMON_CSK);
			
        cui_inline_set_softkey_icon(
            g_mmi_certman_context.import_context_p->inline_cui_id,
            MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD,
            MMI_CENTER_SOFTKEY,
            IMG_GLOBAL_COMMON_CSK);
    }
    else
    {
         g_mmi_certman_context.import_context_p->inline_cui_id = cui_inline_create(GRP_ID_CERTMAN_IMPORT, &g_mmi_certman_cert_input_inline);
    }

    cui_inline_set_softkey_text (
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_KEY_USAGE, 
        MMI_LEFT_SOFTKEY, 
        STR_GLOBAL_SELECT);

	cui_inline_set_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_INLINE_LABEL,
        g_mmi_certman_context.import_context_p->certificate_label);

	cui_inline_set_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_KEY_USAGE,
        g_mmi_certman_context.show_string);

    cui_inline_set_screen_attributes(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        CUI_INLINE_SET_ATTRIBUTE,
        CUI_INLINE_SCREEN_CHANGED);

    cui_inline_set_softkey_icon(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_INLINE_LABEL,
        MMI_CENTER_SOFTKEY,
        IMG_GLOBAL_COMMON_CSK);

    cui_inline_set_softkey_icon(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_KEY_USAGE,
        MMI_CENTER_SOFTKEY,
        IMG_GLOBAL_COMMON_CSK);
    
    cui_inline_run(g_mmi_certman_context.import_context_p->inline_cui_id);
}

void mmi_certman_enable_disable_inline_cui_items(mmi_event_struct *evt)
{
    cui_event_inline_notify_struct *data = (cui_event_inline_notify_struct*)evt;
    U32 key_protection = 0;
    if (data->item_id == MMI_CERTMAN_CERT_INPUT_INLINE_KEY_PROTECTION)
    {
        cui_inline_get_value(
            g_mmi_certman_context.import_context_p->inline_cui_id,
            MMI_CERTMAN_CERT_INPUT_INLINE_KEY_PROTECTION,
            &key_protection);
        if (key_protection == CERTMAN_PROTECT_USAGE_PASSWORD)
        {
            cui_inline_set_item_attributes(data->sender_id, MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD, CUI_INLINE_RESET_ATTRIBUTE, CUI_INLINE_ITEM_DISABLE);
            cui_inline_set_item_attributes(data->sender_id, MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD, CUI_INLINE_RESET_ATTRIBUTE, CUI_INLINE_ITEM_DISABLE);
        }
        else
        {
            cui_inline_set_item_attributes(data->sender_id, MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD, CUI_INLINE_SET_ATTRIBUTE, CUI_INLINE_ITEM_DISABLE);
            cui_inline_set_item_attributes(data->sender_id, MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD, CUI_INLINE_SET_ATTRIBUTE, CUI_INLINE_ITEM_DISABLE);
        }
    }
}


void mmi_certman_import_inline_set_soft_key(void* evt)
{
    cui_event_inline_set_key_struct *data = (cui_event_inline_set_key_struct*)evt;
    if (data->item_id == MMI_CERTMAN_CERT_INPUT_KEY_USAGE)
    {
        wgui_inline_set_lsk_function(mmi_certman_entry_select_key_usage_screen);
#if 0
/* under construction !*/
/* under construction !*/
#endif
        ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        SetCenterSoftkeyFunction(mmi_certman_entry_select_key_usage_screen, KEY_EVENT_UP);
        g_mmi_certman_context.count_key_usages = 0;
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_select_key_usage_screen
 * DESCRIPTION
 *  This function is the entry key usage screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_select_key_usage_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer = NULL;
    U32 count = 0;
    U32 all_key_purposes = 0;
    U16 temp = 0x01;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)g_mmi_certman_context.import_context_p->inline_cui_id, (MMI_ID)SCR_ID_CERTMAN_CERTIFICATE_KEY_USAGES, NULL, 
		     (FuncPtr)mmi_certman_entry_select_key_usage_screen, (mmi_frm_scrn_type_enum)0))
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_SELECT_KEY_USAGE);
        gui_buffer = mmi_frm_scrn_get_gui_buf (g_mmi_certman_context.import_context_p->inline_cui_id, SCR_ID_CERTMAN_CERTIFICATE_KEY_USAGES);
        if (gui_buffer == NULL)
        {
            all_key_purposes = g_mmi_certman_context.import_context_p->key_purpose_all;

            for (count = 0; count < MMI_CERTMAN_TOTAL_KEY_USAGE; count++, temp <<= 1)
            {

                if ((all_key_purposes & temp) == temp)
                {
                    mmi_ucs2cpy(
                        (S8*) g_mmi_certman_context.key_usage_list[g_mmi_certman_context.count_key_usages++],
                        (S8*) get_string((U16) (STR_ID_CERTMAN_KP_ALL + 1 + count)));
                }

            }
            mmi_certman_set_key_purpose(g_mmi_certman_context.import_context_p->key_purpose, all_key_purposes);
        }
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_SELECT_KEY_USAGE_SCREEN);
        SetCheckboxToggleRightSoftkeyFunctions(mmi_certman_import_set_selected_listbox_and_goback, GoBackHistory);

        ShowCategory187Screen(
            STR_ID_CERTMAN_CERTIFICATE_KEY_USAGE,
            IMG_ID_CERTMAN_CERT_MANAGER,
            g_mmi_certman_context.count_key_usages,
            mmi_certman_get_item_hdlr,
            mmi_certman_get_item_img_hdlr,
            NULL,
            NULL,
            (U8*) g_mmi_certman_context.list_of_state,
            0,
            NULL,
            gui_buffer);
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_import_set_selected_listbox_and_goback
 * DESCRIPTION
 *  set selected listbox
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_import_set_selected_listbox_and_goback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 no_of_true = 0;
    U16 count = 0;
    U32 all_key_purposes = 0;
    U32 count_key_usages = 0;
    U16 temp = 0x01;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_IMPORT_SET_SELECTED_LISTBOX_AND_GOBACK);
    g_mmi_certman_context.import_context_p->key_purpose = 0;
    all_key_purposes = g_mmi_certman_context.import_context_p->key_purpose_all;
    memset(g_mmi_certman_context.show_string, 0, 2);
    for (count = 0; count < MMI_CERTMAN_TOTAL_KEY_USAGE; count++)
    {

        if ((all_key_purposes & temp) == temp)
        {
            if (g_mmi_certman_context.list_of_state[count_key_usages] == MMI_TRUE)
            {
                g_mmi_certman_context.import_context_p->key_purpose |= temp;
                mmi_ucs2cat(
                    (S8*) g_mmi_certman_context.show_string,
                    (S8*) GetString((U16) (STR_ID_CERTMAN_KP_ALL + 1 + count)));
                mmi_ucs2cat((S8*) g_mmi_certman_context.show_string, (PS8) GetString(STR_ID_CERTMAN_SEMI_COLON));
                mmi_ucs2cat((S8*) g_mmi_certman_context.show_string, (S8*) L" ");
                no_of_true++;
            }
            count_key_usages++;
        }
        temp <<= 1;
    }
    if (no_of_true == 0)
    {
        mmi_ucs2cpy((S8*) g_mmi_certman_context.show_string, (S8*) GetString(STR_GLOBAL_NONE));
    }
    else if (no_of_true == count_key_usages)
    {
        mmi_ucs2cpy((S8*) g_mmi_certman_context.show_string, (S8*) GetString(STR_ID_CERTMAN_KP_ALL));
    }
    else
    {   /* Do not show ";" after the last key usage */
        count = mmi_ucs2strlen((S8*)g_mmi_certman_context.show_string);
        count = count - 2;
        count = count*ENCODING_LENGTH;
        g_mmi_certman_context.show_string[count] = '\0';
        g_mmi_certman_context.show_string[count+1] = '\0';
    }
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_certificate_inputs_rsk
 * DESCRIPTION
 *  RSK function for certificate inputs
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_certificate_inputs_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_INLINE_LABEL,
        g_mmi_certman_context.import_context_p->certificate_label);

    cui_inline_get_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_INLINE_INPUT_PASSWORD,
        g_mmi_certman_context.import_context_p->privatekey_pwd);


    cui_inline_get_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_INLINE_CONFIRM_PASSWORD,
        g_mmi_certman_context.import_context_p->privatekey_cnf_pwd);

    cui_inline_get_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_INLINE_KEY_PROTECTION,
        &g_mmi_certman_context.import_context_p->protection_method);

    cui_inline_get_value(
        g_mmi_certman_context.import_context_p->inline_cui_id,
        MMI_CERTMAN_CERT_INPUT_KEY_USAGE,
        &g_mmi_certman_context.show_string);

    mmi_certman_check_label();

    
}

/**************************************************************************/
/*****************************LAUNCH CERTIFICATES**************************/
/**************************************************************************/



#ifdef __OCSP_SUPPORT__


mmi_ret mmi_certman_set_ocsp_settings_confirmCb(mmi_alert_result_evt_struct *evt)
{
    if (evt->evt_id == EVT_ID_ALERT_QUIT)
    {
        switch (evt->result)
        {
        case MMI_ALERT_CNFM_1:
            mmi_certman_set_ocsp_settings();
            break;
        case MMI_ALERT_CNFM_2:
            mmi_certman_set_ocsp_settings();
            break;
        case MMI_ALERT_CNFM_3:
            mmi_certman_ocsp_settings_done();
            break;
        case MMI_ALERT_CNFM_OK:
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_YES:
            break;
        case MMI_ALERT_CNFM_NO:
            break;
        }
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_set_ocsp_settings_confirm
 * DESCRIPTION
 *  Shows confirmation pop up to user
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_set_ocsp_settings_confirm(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_OCSP_SETTINGS_CONFIRM);
    do {
        mmi_confirm_property_struct arg;
	mmi_confirm_property_init(&arg, CNFM_TYPE_USER_DEFINE);
	arg.softkey[0].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_YES));
        arg.softkey[1].img = get_image(IMG_GLOBAL_COMMON_CSK);  /* CSK */
	arg.softkey[2].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_NO));
	arg.callback = (mmi_proc_func)mmi_certman_set_ocsp_settings_confirmCb;
	arg.parent_id = g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id;
	mmi_confirm_display((WCHAR *)((UI_string_type)get_string(STR_GLOBAL_SAVE_ASK)), MMI_EVENT_QUERY, &arg);
	} while(0);

    cui_inline_get_value(
        g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id,
        MMI_CERTMAN_OCSP_SETTING_INLINE_SELECT,
        &g_mmi_certman_context.selected_ocsp_option);


    cui_inline_get_value(
        g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id,
        MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR,
        g_mmi_certman_context.default_ocsp_responder);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_ocsp_settings_done_err
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_ocsp_settings_done_err(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_OCSP_SETTINGS_DONE_ERR);
    mmi_frm_scrn_close_active_id();
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_ocsp_settings_done
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_ocsp_settings_done(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_OCSP_SETTINGS_DONE);
    cui_inline_close(g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
}
/*****************************************************************************
 * FUNCTION
 *  mmi_certman_set_ocsp_settings
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_set_ocsp_settings(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 error;
    U8* temp;
    S32 len;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_SET_OCSP_SETTINGS);

    /* Verify responder URL */
    len = mmi_ucs2strlen((S8*)g_mmi_certman_context.default_ocsp_responder);
    if (len > 0)
    {
        temp = mmi_certman_malloc(len+1);
        if (temp != NULL)
        {
            mmi_ucs2_to_asc((S8*)temp, (S8*)g_mmi_certman_context.default_ocsp_responder);
        }
        else
        {
            mmi_certman_handle_error_with_callback(
                CERTMAN_ERR_MEMFULL,
                mmi_certman_ocsp_settings_done_err,
                g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
            return ;
        }
    }
    else
    {
        temp = NULL;
    }
    error = certman_ocsp_check_responder_url((S8*)temp);
    if (error != CERTMAN_ERR_NONE)
    {
        mmi_certman_handle_error_with_callback(
            (certman_error_enum)error,
            mmi_certman_ocsp_settings_done_err,
            g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
        mmi_certman_free(temp);
        return ;
    }
    
    /* send configuration settings to core */
    error = mmi_certman_send_ocsp_settings(temp);
    mmi_certman_free(temp);
    if (error != CERTMAN_ERR_NONE)
    {
        mmi_certman_handle_error_with_callback(
           (certman_error_enum) error,
            mmi_certman_ocsp_settings_done_err,
            g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
        return ;
    }

    /* if every thing was ok, then write setting to NVRAM */
    error = mmi_certman_write_nvram_settings();
    
    /* show success/failure to user */
    if (error != NVRAM_WRITE_SUCCESS)
    {
        mmi_certman_displaypop_with_callback(
            (PU8) GetString(STR_GLOBAL_FAILED_TO_SAVE),
            MMI_EVENT_FAILURE,
            mmi_certman_ocsp_settings_done,
            g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
    }
    else
    {
        mmi_certman_displaypop_with_callback(
            (PU8) GetString(STR_GLOBAL_SAVED),
            MMI_EVENT_SUCCESS,
            mmi_certman_ocsp_settings_done,
            g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_ocsp_config
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_ocsp_config(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_read_nvram_settings();
    g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id = cui_inline_create(GRP_ID_CERTMAN_LAUNCH, &g_mmi_certman_ocsp_inline);

    cui_inline_set_value(
        g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id,
        MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR,
        g_mmi_certman_context.default_ocsp_responder);

    cui_inline_set_value(
        g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id,
        MMI_CERTMAN_OCSP_SETTING_INLINE_SELECT,
        (void*)g_mmi_certman_context.selected_ocsp_option);

    cui_inline_set_softkey_icon(
        g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id,
        MMI_CERTMAN_OCSP_DEFAULT_WEB_ADDR,
        MMI_CENTER_SOFTKEY,
        IMG_GLOBAL_COMMON_CSK);


    cui_inline_run(g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
}

#endif /* __OCSP_SUPPORT__ */


/* Screen group create functions */
/*****************************************************************************
 * FUNCTION
 *  mmi_cermtan_entry_import
 * DESCRIPTION
 *  Entry functions for import screen group
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_cermtan_entry_import(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_IMPORT_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_IMPORT, mmi_certman_import_proc, NULL);
    mmi_frm_group_enter(GRP_ID_CERTMAN_IMPORT, MMI_FRM_NODE_NONE_FLAG);
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_IMPORT;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_select_group
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_select_group(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_SELECT_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_SELECT, mmi_certman_select_proc, NULL);
    mmi_frm_group_enter(GRP_ID_CERTMAN_SELECT, MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_SELECT;    
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_select_user_group
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_select_user_group(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_SELECT_USER_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_SELECT_USER, mmi_certman_select_user_proc, NULL);    
    mmi_frm_group_enter(GRP_ID_CERTMAN_SELECT_USER, MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_SELECT_USER;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_view_group
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_view_group(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_VIEW_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_VIEW, mmi_certman_view_proc, NULL);    
    mmi_frm_group_enter(GRP_ID_CERTMAN_VIEW, MMI_FRM_NODE_SMART_CLOSE_FLAG);    
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_VIEW;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_invalid_group
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_invalid_group(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_INVALID_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_INVALID, mmi_certman_invalid_proc, NULL);    
    mmi_frm_group_enter(GRP_ID_CERTMAN_INVALID, MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_INVALID;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_invalid_group
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_priv_key_group(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_PRIV_KEY_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_PRIV_KEY, mmi_certman_priv_key_proc, NULL);    
    mmi_frm_group_enter(GRP_ID_CERTMAN_INVALID, MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_PRIV_KEY;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_launch_group
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_launch_group(void)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_ENTRY_LAUNCH_GRP);
    mmi_frm_group_create(GRP_ID_ROOT, GRP_ID_CERTMAN_LAUNCH, mmi_certman_launch_proc, NULL);
    mmi_frm_group_enter(GRP_ID_CERTMAN_LAUNCH, MMI_FRM_NODE_SMART_CLOSE_FLAG);
    g_mmi_certman_context.g_mmi_certman_active_grp = GRP_ID_CERTMAN_LAUNCH;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_launch_scr_entry
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_launch_scr_entry(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_id id;
    id = cui_menu_create(GRP_ID_CERTMAN_LAUNCH,
	                 CUI_MENU_SRC_TYPE_RESOURCE,
                         CUI_MENU_TYPE_APPMAIN,
                         MENU_ID_CERTMAN_ALL_CERT,
                         MMI_TRUE,
                         NULL);
	cui_menu_set_default_title_image(id, get_image(IMG_ID_CERTMAN_CERT_MANAGER));
	cui_menu_run(id);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_launch_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_launch_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_LAUNCH_PROC, evt->evt_id);

    switch(evt->evt_id)
    {
        case EVT_ID_GROUP_GOBACK:
    	    break;
	    case EVT_ID_GROUP_DEINIT:
        {
            mmi_certman_exit_from_select_launch();
            break;
        }
        case EVT_ID_CUI_INLINE_SUBMIT:
#ifdef __OCSP_SUPPORT__
            mmi_certman_set_ocsp_settings_confirm();
#endif /* __OSCP_SUPPORT__ */
            break;
        case EVT_ID_CUI_INLINE_ABORT:
#ifdef __OCSP_SUPPORT__
            cui_inline_close(g_mmi_certman_context.launch_select_context_p->oscp_inline_cui_id);
#endif /* __OCSP_SUPPORT__ */
            break;
        case EVT_ID_CUI_MENU_ITEM_SELECT:
	{
            cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	    if (menu_evt->highlighted_menu_id == MENU_ID_CERTMAN_AUTHORITY_CERT)
	    {
	        mmi_certman_display_authority_certificates();
	    }
	    else if (menu_evt->highlighted_menu_id == MENU_ID_CERTMAN_USER_CERT)
	    {
	        mmi_certman_display_user_certificates();
	    }
#ifdef __OCSP_SUPPORT__
	    else if (menu_evt->highlighted_menu_id == MENU_ID_CERTMAN_CERT_VALIDATION)
	    {
                mmi_certman_pre_entry_ocsp_config();
	    }
#endif /* __OCSP_SUPPORT__ */
            else if (menu_evt->highlighted_menu_id == MENU_ID_CERTMAN_OPTION_VIEW_CERTIFICATE)
	    {
	        mmi_certman_view_certificates();
	    }
	    else if (menu_evt->highlighted_menu_id == MENU_ID_CERTMAN_OPTION_DELETE_CERTIFICATE)
	    {
	        mmi_certman_pre_delete_certificates();
	    }
	    else if (menu_evt->highlighted_menu_id == MENU_ID_CERTMAN_OPTION_TRUST_SETTINGS_CERTIFICATE)
	    {
	        mmi_certman_pre_entry_key_usages_certificates();
	    }
    }
	    break;
	case EVT_ID_CUI_MENU_CLOSE_REQUEST:
	{
            cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	    cui_menu_close(menu_evt->sender_id);
	}
	    break;
	default:
             break;
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_import_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_import_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_IMPORT_PROC, evt->evt_id);

    switch(evt->evt_id)
	{
	    case EVT_ID_GROUP_DEINIT:
		{
            mmi_certman_exit_from_import();
            mmi_certman_read_queue_task_if_present();
		    break;
		}
        case EVT_ID_CUI_FSEDITOR_SUBMMIT:
            if (g_mmi_certman_context.import_context_p)
            {
                cui_fseditor_get_text(
                    g_mmi_certman_context.import_context_p->fseditor->id,
                    (WCHAR* )g_mmi_certman_context.import_context_p->password,
                    CERTMAN_PASSWORD_SIZE *ENCODING_LENGTH);
                g_mmi_certman_context.import_context_p->fseditor->submit_fp();
            }
            break;
        
        /* when user cancel edit (Select Cancel in Options or Press RSK (Back)) */
        case EVT_ID_CUI_FSEDITOR_ABORT:
            if ((g_mmi_certman_context.import_context_p)
              &&(g_mmi_certman_context.import_context_p->fseditor))
            {
                cui_fseditor_close(g_mmi_certman_context.import_context_p->fseditor->id);
                g_mmi_certman_context.import_context_p->fseditor->cancel_fp();
                if ((g_mmi_certman_context.import_context_p)
                  &&(g_mmi_certman_context.import_context_p->fseditor))
                {   /* need to check this as cancel fp may have emit EVT_ID_GROUP_DEINIT*/
                    mmi_certman_free(g_mmi_certman_context.import_context_p->fseditor);
                    g_mmi_certman_context.import_context_p->fseditor = NULL;
                }
            }
            break;
       
        case EVT_ID_CUI_INLINE_SUBMIT:
            mmi_certman_certificate_inputs_rsk();
            break;
        case EVT_ID_CUI_INLINE_ABORT:
        case EVT_ID_CUI_INLINE_GROUP_DEINIT:
            cui_inline_close(g_mmi_certman_context.import_context_p->inline_cui_id);
            break;
        case EVT_ID_CUI_INLINE_SET_KEY:
            /* key selection screen */
            mmi_certman_import_inline_set_soft_key((void*)evt);
            break;
        case EVT_ID_CUI_INLINE_NOTIFY:
            mmi_certman_enable_disable_inline_cui_items(evt);
            break;
        default:
           MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_EVENT_NOT_HANDLED);	
            break;
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_select_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_select_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_SELECT_PROC, evt->evt_id);

    switch(evt->evt_id)
	{
	      case EVT_ID_GROUP_DEINIT:
		  {
              mmi_certman_exit_from_select_launch();
			  break;
		  }
		  default:
                 MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_EVENT_NOT_HANDLED);
                 break;
	}
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_select_user_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_select_user_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_SELECT_USER_PROC, evt->evt_id);

    switch(evt->evt_id)
	{
	    case EVT_ID_GROUP_DEINIT:
		{
            mmi_certman_exit_user_certificates_list_with_goback_history();
			break;
		}
		default:
               MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_EVENT_NOT_HANDLED);	
            break;
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_invalid_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_INVALID_PROC, evt->evt_id);

    switch(evt->evt_id)
	{
	    case EVT_ID_GROUP_DEINIT:
		{
            mmi_certman_exit_view_invalid_certificate_contents_only_with_gobackhistory();
		    break;
		}
        case EVT_ID_CUI_FSEDITOR_SUBMMIT:
            if (g_mmi_certman_context.view_invalid_context_p)
            {
                cui_fseditor_get_text(
                    g_mmi_certman_context.view_invalid_context_p->fseditor->id,
                    (WCHAR*)g_mmi_certman_context.view_invalid_context_p->label,
                    CERTMAN_LABEL_SIZE);
                g_mmi_certman_context.view_invalid_context_p->fseditor->submit_fp();
            }
            break;
        
        /* when user cancel edit (Select Cancel in Options or Press RSK (Back)) */
        case EVT_ID_CUI_FSEDITOR_ABORT:
            if ((g_mmi_certman_context.view_invalid_context_p)
              &&(g_mmi_certman_context.view_invalid_context_p->fseditor))
            {
                cui_fseditor_close(g_mmi_certman_context.view_invalid_context_p->fseditor->id);
                g_mmi_certman_context.view_invalid_context_p->fseditor->cancel_fp();
                
                if ((g_mmi_certman_context.view_invalid_context_p)
                  &&(g_mmi_certman_context.view_invalid_context_p->fseditor))
                {
                    /* need to check this as cancel fp may have emit EVT_ID_GROUP_DEINIT*/
                    mmi_certman_free(g_mmi_certman_context.view_invalid_context_p->fseditor);
                    g_mmi_certman_context.view_invalid_context_p->fseditor = NULL;
                }
            }
            break;
       
		default:
             MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_EVENT_NOT_HANDLED);			
            break;
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_view_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_view_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_VIEW_PROC, evt->evt_id);

    switch(evt->evt_id)
	{
	    case EVT_ID_GROUP_DEINIT:
		{
            mmi_certman_exit_view_invalid_certificate_contents_only_with_gobackhistory();
			break;
		}
		default:
              MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_EVENT_NOT_HANDLED);	
              break;
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_priv_key_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  mmi_ret
 * RETURNS
 *  mmi_event_struct *
 *****************************************************************************/
mmi_ret mmi_certman_priv_key_proc(mmi_event_struct *evt)
{
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_PRIV_KEY_PROC, evt->evt_id);

    switch(evt->evt_id)
	{
	    case EVT_ID_GROUP_DEINIT:
		    break;
		default:
           MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_EVENT_NOT_HANDLED);				
              break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_display_certificate_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_display_certificate_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_display_certificate_list();
    mmi_frm_scrn_close(GRP_ID_CERTMAN_LAUNCH, SCR_ID_CERTMAN_PROGRESS_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_certificate_list
 * DESCRIPTION
 *  Function to display the certificate list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_certificate_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_LAUNCH, (MMI_ID)SCR_ID_CERTMAN_CERTIFICATE_LIST,
		      NULL, (FuncPtr)mmi_certman_display_certificate_list, (mmi_frm_scrn_type_enum)0))
    {
        PU8 gui_buffer; /* Buffer holding history data */

        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISPLAY_CERTIFICATE_LIST);
        if (g_mmi_certman_context.launch_select_context_p->current_state == MMI_CERTMAN_LAUNCH_SELECT_CREATE_LIST)
        {
            g_mmi_certman_context.launch_select_context_p->certificate_count = 0;
            g_mmi_certman_context.launch_select_context_p->current_state = MMI_CERTMAN_LAUNCH_SELECT_GROUP_REQ;
            mmi_certman_launch_select_state(NULL);
            return;
       }
       if (g_mmi_certman_context.launch_select_context_p->cert_group ==
    	         (CERTMAN_CERTGRP_ROOTCA |CERTMAN_CERTGRP_OTHERUSER|CERTMAN_CERTGRP_CA))
       {
           g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_AUTHORITY_CERT;
       }
       else if (g_mmi_certman_context.launch_select_context_p->cert_group ==
                   CERTMAN_CERTGRP_PERSONAL)
       {
           g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_USER_CERT;
       }

	gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_LAUNCH,
											   SCR_ID_CERTMAN_CERTIFICATE_LIST);

        RegisterHighlightHandler(mmi_certman_certificate_list_highlight_handler);
        if (g_mmi_certman_context.launch_select_context_p->certificate_count == 0)
        {
            ShowCategory184Screen(
                g_mmi_certman_context.popup_string_id,
                IMG_ID_CERTMAN_CERT_MANAGER,
		0,
                0,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                g_mmi_certman_context.launch_select_context_p->certificate_count,
                mmi_certman_get_certificates,
                NULL,
                0,
                gui_buffer);
        }
	else
	{
            ShowCategory184Screen(
                g_mmi_certman_context.popup_string_id,
                IMG_ID_CERTMAN_CERT_MANAGER,
                STR_GLOBAL_OPTIONS,
                IMG_GLOBAL_OPTIONS,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                g_mmi_certman_context.launch_select_context_p->certificate_count,
                mmi_certman_get_certificates,
                NULL,
                0,
                gui_buffer);
            SetLeftSoftkeyFunction(mmi_certman_launch_options, KEY_EVENT_UP);
            ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            SetCenterSoftkeyFunction(mmi_certman_view_certificates, KEY_EVENT_UP);
        }
         ClearKeyEvents();
        SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
#if (defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__))
        wgui_register_list_tap_callback(mmi_certman_list_tap_callback);
#endif /* __MMI_FTE_SUPPORT__ */
    }
}

#if (defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__))
/*****************************************************************************
 * FUNCTION
 *  mmi_certman_list_tap_callback
 * DESCRIPTION
 *  Tap handling callback on the certificate list
 * PARAMETERS
 *  tap_type
 *  index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_list_tap_callback(mmi_tap_type_enum tap_type, S32 index)
{
    index = index;
    if (tap_type == ENUM_TAP_ON_HIGHLIGHTED_ITEM)
    {
        mmi_certman_view_certificates();
    }
    return;
}
#endif /* __MMI_FTE_SUPPORT__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_certificates
 * DESCRIPTION
 *  To get the certificates from list
 * PARAMETERS
 *  item_index          [IN]        (index of current item)
 *  str_buff            [IN]        
 *  img_buff_p          [IN]        
 *  str_img_mask        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
pBOOL mmi_certman_get_certificates(S32 item_index, UI_string_type str_buff, PU8 *img_buff_p, U8 str_img_mask)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 len;
    U8* temp = NULL;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((item_index < 0) || (item_index >= MMI_CERTMAN_CERTIFICATES_MAX))
    {
        return FALSE;
    }
    if ((g_mmi_certman_context.current_status == MMI_CERTMAN_SELECT) && (item_index == 0))
    {
        ASSERT((g_mmi_certman_context.launch_select_context_p->multiple_selection_flag == MMI_FALSE));
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STR_GLOBAL_NONE));
        *img_buff_p = NULL;
        return TRUE;
    }
    if (g_mmi_certman_context.current_status == MMI_CERTMAN_SELECT)
    {
        item_index--;
    }

    /* Append ... if list item len exceeds MAX_SUB_MENU_SIZE/ENCODING_LENGTH */
    if (g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].certificate_dcs == CERTMAN_DCS_ASCII)
    {   /* ASCII */
        len = strlen((S8*)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_label);
        if (len > MAX_SUB_MENU_SIZE/ENCODING_LENGTH)
        {
            /* create temp buffer for editing label */
            temp = mmi_certman_malloc(MAX_SUB_MENU_SIZE/ENCODING_LENGTH);
            if (temp!=NULL)
            {
                strncpy((S8*)temp, (S8*)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_label,
                              MAX_SUB_MENU_SIZE/ENCODING_LENGTH);
                temp[MAX_SUB_MENU_SIZE/ENCODING_LENGTH-1] = '\0';
                temp[MAX_SUB_MENU_SIZE/ENCODING_LENGTH-2] = '.';
                temp[MAX_SUB_MENU_SIZE/ENCODING_LENGTH-3] = '.';
                temp[MAX_SUB_MENU_SIZE/ENCODING_LENGTH-4] = '.';
            }
        }
    }
    else
    {   /* UCS2 */
        len = mmi_ucs2strlen((S8*)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_label);
        if (len > MAX_SUB_MENU_SIZE/ENCODING_LENGTH)
        {
            /* create temp buffer for editing label */
            temp = mmi_certman_malloc(MAX_SUB_MENU_SIZE);
            if (temp!=NULL)
            {
                memcpy((S8*)temp, (S8*)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_label, 
                             CERTMAN_LABEL_SIZE);
                temp[CERTMAN_LABEL_SIZE-1] = '\0';
                temp[CERTMAN_LABEL_SIZE-2] = '\0';
                temp[CERTMAN_LABEL_SIZE-3] = '\0';
                temp[CERTMAN_LABEL_SIZE-4] = '.';
                temp[CERTMAN_LABEL_SIZE-5] = '\0';
                temp[CERTMAN_LABEL_SIZE-6] = '.';
                temp[CERTMAN_LABEL_SIZE-7] = '\0';
                temp[CERTMAN_LABEL_SIZE-8] = '.';
            }
        }
    }

    if(temp!=NULL)
    {
        mmi_certman_cert_strncpy(
            (PU8) str_buff, temp,
            (certman_dcs_enum)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].certificate_dcs,
            MAX_SUB_MENU_SIZE);
        mmi_certman_free(temp);
    }
    else
    {
        mmi_certman_cert_strncpy(
            (PU8) str_buff,
            g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_label,
            (certman_dcs_enum)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].certificate_dcs,
            MAX_SUB_MENU_SIZE);
    }
    *((U8*)str_buff+MAX_SUB_MENU_SIZE-1) = '\0';
    *((U8*)str_buff+MAX_SUB_MENU_SIZE-2) = '\0';

    if (g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_group ==
        CERTMAN_CERTGRP_ROOTCA)
    {
        *img_buff_p = (PU8) GetImage((U16) (IMG_ID_CERTMAN_ROOT_CERT));
        return TRUE;
    }
    if (g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_group == CERTMAN_CERTGRP_CA)
    {
        *img_buff_p = (PU8) GetImage((U16) (IMG_ID_CERTMAN_INTERMEDIATE_CERT));
        return TRUE;
    }
    if (g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_group ==
        CERTMAN_CERTGRP_OTHERUSER)
    {
        *img_buff_p = (PU8) GetImage((U16) (IMG_ID_CERTMAN_USER_CERT));
        return TRUE;
    }
    if (g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_group ==
        CERTMAN_CERTGRP_PERSONAL)
    {
        *img_buff_p = (PU8) GetImage((U16) (IMG_ID_CERTMAN_PERSONAL_CERT));
        return TRUE;
    }
    *img_buff_p = NULL;
    return TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_certificate_list_highlight_handler
 * DESCRIPTION
 *  highlight handler for certificate
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_certificate_list_highlight_handler(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_certman_context.launch_select_context_p->selected_index = index;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_launch_options
 * DESCRIPTION
 *  Functions for launch options
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_launch_options(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_id id;
    id = cui_menu_create(GRP_ID_CERTMAN_LAUNCH,
	                 CUI_MENU_SRC_TYPE_RESOURCE,
                         CUI_MENU_TYPE_OPTION,
                         MENU_ID_CERTMAN_OPTIONS,
                         MMI_TRUE,
                         NULL);
    cui_menu_set_default_title_image(id, get_image(IMG_ID_CERTMAN_CERT_MANAGER));
    cui_menu_run(id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_view_certificate_content
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_view_certificate_content(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_view_certificate_content();
    mmi_frm_scrn_close(GRP_ID_CERTMAN_LAUNCH, SCR_ID_CERTMAN_PROGRESS_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_view_certificate_content
 * DESCRIPTION
 *  entry function to view certificate content in case of launch
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_view_certificate_content(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer;
    pBOOL result = MMI_TRUE;
    PU8 cert_info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_LAUNCH, (MMI_ID)SCR_ID_CERTMAN_CERTIFICATE_VIEW,
        NULL, (FuncPtr)mmi_certman_view_certificate_content, (mmi_frm_scrn_type_enum)0))
    {

        cert_info = (PU8) subMenuData;
        cert_info[0] = 0;
        cert_info[1] = 0;
        result = mmi_certman_fill_certificate_contents_only(
                 cert_info,
                 g_mmi_certman_context.launch_select_context_p->display_p);
        if (result == MMI_FALSE)
        {
            certman_parsed_data_free(g_mmi_certman_context.view_invalid_context_p->parsed_data_p);
			 g_mmi_certman_context.view_invalid_context_p->parsed_data_p = NULL;
            g_mmi_certman_context.view_invalid_context_p->current_state = MMI_CERTMAN_VIEW_INVALID_DISPLAY;
            mmi_certman_view_invalid_state(NULL);
            return;
        }
	gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_LAUNCH, SCR_ID_CERTMAN_CERTIFICATE_VIEW);
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_VIEW_CERTIFICATE_CONTENT);
        ShowCategory74Screen(
            STR_ID_CERTMAN_CERTIFICATE_DETAILS,
            IMG_ID_CERTMAN_CERT_MANAGER,
            NULL,
            NULL,
            STR_GLOBAL_BACK,
            NULL,
            cert_info,
            (mmi_ucs2strlen((const S8*)cert_info)),
            gui_buffer);
            ClearKeyEvents();
        SetRightSoftkeyFunction(mmi_certman_exit_view, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_exit_view
 * DESCRIPTION
 *  function ro exit from view
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_exit_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    certman_cert_display_content_free(g_mmi_certman_context.launch_select_context_p->display_p);
    /* 20071108 Sanity Test Fail Tmp Patch */
    free_ctrl_buffer(g_mmi_certman_context.launch_select_context_p->display_p);
    g_mmi_certman_context.launch_select_context_p->display_p = 0;
    GoBackHistory();
}


mmi_ret mmi_certman_delete_confirmCb(mmi_alert_result_evt_struct *evt)
{
    if (evt->evt_id == EVT_ID_ALERT_QUIT)
    {
        switch (evt->result)
        {
        case MMI_ALERT_CNFM_1:
            mmi_certman_delete_certificates();
            break;
        case MMI_ALERT_CNFM_2:
            break;
        case MMI_ALERT_CNFM_3:
            GoBackHistory();
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_OK:
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_YES:
	    break;
        case MMI_ALERT_CNFM_NO:
//            GoBackHistory();
            break;
        }
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_delete_certificates
 * DESCRIPTION
 *  pre function for delete
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_delete_certificates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index = g_mmi_certman_context.launch_select_context_p->selected_index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_PRE_DELETE_CERTIFICATES);
    if (g_mmi_certman_context.launch_select_context_p->certificate_list[index].cert_prop & CERTMAN_PROP_READ_ONLY)
    {
       mmi_popup_display_simple((WCHAR*)((UI_string_type)GetString((U16)STR_ID_CERTMAN_READ_ONLY)), MMI_EVENT_ERROR, GRP_ID_CERTMAN_LAUNCH, NULL);

        mmi_frm_scrn_multiple_close(
            GRP_ID_CERTMAN_LAUNCH, 
            SCR_ID_CERTMAN_CERTIFICATE_OPTIONS,
            MMI_TRUE,
            0,
            SCR_ID_CERTMAN_CERTIFICATE_LIST,
            MMI_FALSE);
    }
    else
    {
        do {
    	    mmi_confirm_property_struct arg;
	    mmi_confirm_property_init(&arg, CNFM_TYPE_USER_DEFINE);
	    arg.softkey[0].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_YES));
	    arg.softkey[2].str = (WCHAR *)((UI_string_type)GetString(STR_GLOBAL_NO));
	    arg.callback = (mmi_proc_func)mmi_certman_delete_confirmCb;
	    arg.parent_id = GRP_ID_CERTMAN_LAUNCH;
            arg.f_auto_map_empty_softkey= MMI_FALSE;
	    mmi_confirm_display((WCHAR *)((UI_string_type)get_string(STR_ID_CERTMAN_DELETE_CONFIRM)), MMI_EVENT_QUERY, &arg);
	    } while(0);
    }

}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_key_usages_certificates
 * DESCRIPTION
 *  Pre entry function to set key usages
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_key_usages_certificates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = g_mmi_certman_context.launch_select_context_p->selected_index;
    g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose_change =
        g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose;
    g_mmi_certman_context.count_key_usages = 0;
    mmi_certman_key_usages_certificates();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_key_usages_certificates
 * DESCRIPTION
 *  Entry function to set key usages
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_key_usages_certificates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer = NULL;
    U16 index = 0;
    U32 count = 0;
    U32 all_key_purposes = 0;
    U16 temp = 0x01;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_LAUNCH, (MMI_ID)SCR_ID_CERTMAN_CERTIFICATE_SET_KEY_USAGES,
        NULL, (FuncPtr)mmi_certman_key_usages_certificates, (mmi_frm_scrn_type_enum)0))
    {    
        gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_LAUNCH, SCR_ID_CERTMAN_CERTIFICATE_SET_KEY_USAGES);
        if (gui_buffer == NULL)
        {
            index = g_mmi_certman_context.launch_select_context_p->selected_index;
            all_key_purposes = g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose_all;

            for (count = 0; count < MMI_CERTMAN_TOTAL_KEY_USAGE; count++)
            {

                if ((all_key_purposes & temp) == temp)
                {
                    mmi_ucs2cpy(
                        (S8*) g_mmi_certman_context.key_usage_list[g_mmi_certman_context.count_key_usages],
                        (S8*) get_string((U16) (STR_ID_CERTMAN_KP_ALL + 1 + count)));
                    g_mmi_certman_context.count_key_usages++;
                }
                temp <<= 1;
            }
            mmi_certman_set_key_purpose(
                g_mmi_certman_context.launch_select_context_p->certificate_list[g_mmi_certman_context.launch_select_context_p->selected_index].key_purpose,
                all_key_purposes);
        }
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_KEY_USAGE_CERTIFICATES);
        SetCheckboxToggleRightSoftkeyFunctions(mmi_certman_launch_set_selected_listbox_and_goback, GoBackHistory);
        ShowCategory187Screen(
            STR_ID_CERTMAN_CERTIFICATE_KEY_USAGE,
            IMG_ID_CERTMAN_CERT_MANAGER,
            g_mmi_certman_context.count_key_usages,
            mmi_certman_get_item_hdlr,
            mmi_certman_get_item_img_hdlr,
            NULL,
            NULL,
            (U8*) g_mmi_certman_context.list_of_state,
            0,
            NULL,
            gui_buffer);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_set_key_purpose
 * DESCRIPTION
 *  function to set key purpose values
 * PARAMETERS
 *  key_purpose             [IN]        
 *  all_key_purposes        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_set_key_purpose(U32 key_purpose, U32 all_key_purposes)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 count = 0;

    U32 count_key_usages = 0;
    U16 temp = 0x01;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (count = 0; count < MMI_CERTMAN_TOTAL_KEY_USAGE; count++)
    {
        if ((all_key_purposes & temp) == temp)
        {
            if ((key_purpose & temp) == temp)
            {
                g_mmi_certman_context.list_of_state[count_key_usages] = MMI_TRUE;
            }
            else
            {
                g_mmi_certman_context.list_of_state[count_key_usages] = MMI_FALSE;
            }
            count_key_usages++;
        }
        temp <<= 1;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_launch_set_selected_listbox_and_goback
 * DESCRIPTION
 *  function to set seleced list box
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_launch_set_selected_listbox_and_goback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index = 0;
    U16 count = 0;
    U32 all_key_purposes = 0;
    U32 count_key_usages = 0;
    U16 temp = 0x01;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = g_mmi_certman_context.launch_select_context_p->selected_index;
    all_key_purposes = g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose_all;
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_LAUNCH_SET_SELECTED_LISTBOX_AND_GOBACK);
    g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose = 0;

    for (count = 0; count < MMI_CERTMAN_TOTAL_KEY_USAGE; count++)
    {

        if ((all_key_purposes & temp) == temp)
        {
            if (g_mmi_certman_context.list_of_state[count_key_usages] == MMI_TRUE)
            {
                g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose |= temp;
            }
            count_key_usages++;
        }
        temp <<= 1;
    }
    SetProtocolEventHandler(mmi_certman_launch_update_key_purpose_cnf_handler, MSG_ID_CERTMAN_UPDATE_KEY_PURPOSE_CNF);

    mmi_certman_pre_entry_progress_screen(GRP_ID_CERTMAN_LAUNCH);
    certman_send_update_key_purpose_req(
        MOD_MMI,
        g_mmi_certman_context.launch_select_context_p->trans_id,
        g_mmi_certman_context.launch_select_context_p->certificate_list[index].cert_id,
        g_mmi_certman_context.launch_select_context_p->certificate_list[index].key_purpose);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_item_hdlr
 * DESCRIPTION
 *  function to get item handler
 * PARAMETERS
 *  item_index      [IN]        
 *  str_buff        [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_certman_get_item_hdlr(S32 item_index, UI_string_type str_buff)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_ucs2cpy((S8*) str_buff, (S8*) g_mmi_certman_context.key_usage_list[item_index]);
    return TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_item_img_hdlr
 * DESCRIPTION
 *  function to get images
 * PARAMETERS
 *  item_index      [IN]        
 *  state           [IN]        
 *  img_buff_p      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_certman_get_item_img_hdlr(S32 item_index, U8 state, PU8 *img_buff_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *img_buff_p = get_image((MMI_ID_TYPE) ((state) ? CHECKBOX_ON_IMAGE_ID : CHECKBOX_OFF_IMAGE_ID));
    return TRUE;
}

/**************************************************************************/
/*****************************SELECT CERTIFICATES**************************/
/**************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_certificates_selection_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_certificates_selection_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_certificates_selection_list();
    mmi_frm_scrn_close(GRP_ID_CERTMAN_SELECT, SCR_ID_CERTMAN_PROGRESS_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_certificates_selection_list
 * DESCRIPTION
 *  entry function for the selection of certificates
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_certificates_selection_list()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_certman_context.launch_select_context_p->certificate_count == 0)
    {
        mmi_certman_displaypop_with_callback(
            (U8*) GetString((U16) STR_GLOBAL_EMPTY),
            MMI_EVENT_ERROR,
            mmi_certman_select_grp_close_callback,
            GRP_ID_CERTMAN_SELECT);
        return;
    }

    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_SELECT, (MMI_ID)SCR_ID_CERTMAN_SELECT_CERTIFICATE,
        NULL, (FuncPtr)mmi_certman_certificates_selection_list, (mmi_frm_scrn_type_enum)0))
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_CERTIFICATE_SELECTION_LIST);
        gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_SELECT, SCR_ID_CERTMAN_SELECT_CERTIFICATE);
        if (g_mmi_certman_context.launch_select_context_p->multiple_selection_flag)
        {
            SetCheckboxToggleRightSoftkeyFunctions(
                mmi_certman_select_multiple_certificate,
                mmi_certman_exit_select_certificate);

            ShowCategory187Screen(
                STR_ID_CERTMAN_CERTIFICATES,
                IMG_ID_CERTMAN_CERT_MANAGER,
                g_mmi_certman_context.launch_select_context_p->certificate_count,
                mmi_certman_input_cert_label,
                mmi_certman_get_item_img_hdlr,
                NULL,
                NULL,
                (U8*) g_mmi_certman_context.launch_select_context_p->is_selected,
                0,
                NULL,
                gui_buffer);

        }
        else
        {
            RegisterHighlightHandler(mmi_certman_certificate_list_highlight_handler);
            ShowCategory184Screen(
                STR_ID_CERTMAN_CERTIFICATES,
                IMG_ID_CERTMAN_CERT_MANAGER,
                STR_GLOBAL_OK,
                IMG_GLOBAL_OK,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                g_mmi_certman_context.launch_select_context_p->certificate_count + 1,
                mmi_certman_get_certificates,
                NULL,
                0,
                gui_buffer);
            SetLeftSoftkeyFunction(mmi_certman_select_single_certificate, KEY_EVENT_UP);
            SetRightSoftkeyFunction(mmi_certman_exit_select_certificate, KEY_EVENT_UP);
            ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            SetCenterSoftkeyFunction(mmi_certman_select_single_certificate, KEY_EVENT_UP);
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_input_cert_label
 * DESCRIPTION
 *  function to get certificate label
 * PARAMETERS
 *  item_index      [IN]        
 *  str_buff        [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_certman_input_cert_label(S32 item_index, UI_string_type str_buff)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_cert_strncpy(
        (PU8) str_buff,
        g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].cert_label,
        (certman_dcs_enum)g_mmi_certman_context.launch_select_context_p->certificate_list[item_index].certificate_dcs,
        CERTMAN_LABEL_SIZE * ENCODING_LENGTH);
    return TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_select_single_certificate
 * DESCRIPTION
 *  function to fill certficate id's of selected certificates in case of multiple_selection_flag=FALSE
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_select_single_certificate(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index = g_mmi_certman_context.launch_select_context_p->selected_index;
    mmi_certman_certificate_ids_struct selected_certs;
    U32 trans_id;
    U16 max_certificate_num;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    selected_certs.count = 1;
    
    max_certificate_num =certman_cfg_get_num_cert_in_database();
	selected_certs.cert_ids = (kal_uint32*)mmi_certman_malloc(sizeof(kal_uint32)*max_certificate_num);
	
    if (index == 0)
    {
        selected_certs.cert_ids[0] = 0;
    }
    else
    {
        selected_certs.cert_ids[0] = g_mmi_certman_context.launch_select_context_p->certificate_list[index-1].cert_id;
    }
    trans_id = g_mmi_certman_context.launch_select_context_p->trans_id;
    mmi_certman_select_certificates_rsp(MMI_TRUE, selected_certs.count, selected_certs.cert_ids, trans_id);
    
    	mmi_certman_free(selected_certs.cert_ids);
    	
    mmi_frm_group_close(GRP_ID_CERTMAN_SELECT);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_select_multiple_certificate
 * DESCRIPTION
 *  function to fill certficate id's of selected certificates  in case of multiple_selection_flag=TRUE
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_select_multiple_certificate(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 temp_count = 0;
    mmi_certman_certificate_ids_struct selected_certs;
    U16 max_certificate_num;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    selected_certs.count = 0;
    
     max_certificate_num =certman_cfg_get_num_cert_in_database();
	   selected_certs.cert_ids = (kal_uint32*)mmi_certman_malloc(sizeof(kal_uint32)*max_certificate_num);
	
    for (temp_count = 0; temp_count < g_mmi_certman_context.launch_select_context_p->certificate_count; temp_count++)
    {
        if (g_mmi_certman_context.launch_select_context_p->is_selected[temp_count] == 1)
        {
            selected_certs.cert_ids[selected_certs.count] =
                g_mmi_certman_context.launch_select_context_p->certificate_list[temp_count].cert_id;
            selected_certs.count++;
        }

    }
    mmi_certman_select_certificates_rsp(
        MMI_TRUE,
        selected_certs.count,
        selected_certs.cert_ids,
        g_mmi_certman_context.launch_select_context_p->trans_id);
        
        mmi_certman_free(selected_certs.cert_ids);
        
    mmi_frm_group_close(GRP_ID_CERTMAN_SELECT);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_exit_select_certificate
 * DESCRIPTION
 *  function to exit select certificate
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_exit_select_certificate(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 trans_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    trans_id = g_mmi_certman_context.launch_select_context_p->trans_id;
    mmi_certman_select_certificates_rsp(MMI_FALSE, 0, 0, trans_id);
    mmi_frm_group_close(GRP_ID_CERTMAN_SELECT);

}

/*********************************************************************************/
/*****************************PRIVATE KEY PASSWORD REQUEST ***********************/
/*********************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_get_priv_key_password
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_get_priv_key_password(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(
        g_mmi_certman_context.priv_key_context_p->privatekey_pwd,
        0,
        sizeof(g_mmi_certman_context.priv_key_context_p->privatekey_pwd));
    mmi_certman_get_priv_key_password();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_priv_key_password
 * DESCRIPTION
 *  input function for private key pwd
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_get_priv_key_password(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer; /* Buffer holding history data */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_PRIV_KEY, (MMI_ID)SCR_ID_CERTMAN_PRIVKEY_PASSWORD,
	NULL, (FuncPtr)mmi_certman_get_priv_key_password, (mmi_frm_scrn_type_enum)0))
    {
        gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_PRIV_KEY, SCR_ID_CERTMAN_PRIVKEY_PASSWORD);
        ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);   /* To set  the Right soft key */
        ShowCategory111Screen(
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            STR_ID_CERTMAN_INPUT_PASSWORD,
            IMM_INPUT_TYPE_ALPHANUMERIC_PASSWORD | INPUT_TYPE_USE_ONLY_ENGLISH_MODES,
            g_mmi_certman_context.priv_key_context_p->privatekey_pwd,
            CERTMAN_PASSWORD_LENGTH,
            g_mmi_certman_context.priv_key_context_p->label,
            gui_buffer);
        SetLeftSoftkeyFunction(mmi_certman_get_priv_key_password_ok, KEY_EVENT_UP);
        SetCategory111RightSoftkeyFunction(mmi_certman_exit_priv_key_pwd_screen, KEY_EVENT_UP);
        ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        SetCenterSoftkeyFunction(mmi_certman_get_priv_key_password_ok, KEY_EVENT_UP);
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_exit_priv_key_pwd_screen
 * DESCRIPTION
 *  exit function for private key pwd screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_exit_priv_key_pwd_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 trans_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(g_mmi_certman_context.priv_key_context_p!=NULL);
    trans_id = g_mmi_certman_context.priv_key_context_p->trans_id;
    certman_send_privkey_usage_password_rsp(MOD_MMI, trans_id, MMI_FALSE);
    mmi_certman_free(g_mmi_certman_context.priv_key_context_p);
    g_mmi_certman_context.priv_key_context_p = NULL;
    g_mmi_certman_context.private_key_status = MMI_CERTMAN_PRIVATE_KEY_IDLE;
    mmi_certman_use_priv_key_queue();
    mmi_frm_group_close(GRP_ID_CERTMAN_PRIV_KEY);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_priv_key_password_ok
 * DESCRIPTION
 *  LSK function for private key pwd screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_get_priv_key_password_ok(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_check_priv_key_pwd();
    mmi_frm_group_close(GRP_ID_CERTMAN_PRIV_KEY);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pwd_length_validation
 * DESCRIPTION
 *  function to check the pwd length
 * PARAMETERS
 *  text_p          [IN]        
 *  cursor_p        [IN]        
 *  length          [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pwd_length_validation(U8 *text_p, U8 *cursor_p, S32 length)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((length) < 1)
    {
        ChangeLeftSoftkey(0, 0);
        ClearKeyHandler(KEY_POUND, KEY_EVENT_UP);
    }
    else
    {
        EnableLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
        SetKeyHandler(mmi_certman_check_priv_key_pwd, KEY_POUND, KEY_EVENT_UP);
    }

}

/*********************************************************************************/
/*****************************PRIVATE KEY CONFIRMATION****************************/
/*********************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_priv_key_confirmation
 * DESCRIPTION
 *  function for the private key confirmation
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_priv_key_confirmation(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_PRIV_KEY, (MMI_ID)SCR_ID_CERTMAN_CONFIRM_SCREEN,
		      NULL, (FuncPtr)mmi_certman_priv_key_confirmation, (mmi_frm_scrn_type_enum)0))
    {
        gui_lock_double_buffer();
        ShowCategory66Screen(
            STR_ID_CERTIFICATE_MANAGER,
            IMG_ID_CERTMAN_CERT_MANAGER,
            STR_GLOBAL_YES,
            IMG_GLOBAL_YES,
            STR_GLOBAL_NO,
            IMG_GLOBAL_NO,
            (U8*) GetString(STR_ID_CERTMAN_USE_PERSONAL_CERTIFICATE),
            IMG_GLOBAL_QUESTION,
            NULL);
        if(!srv_prof_is_tone_playing(SRV_PROF_TONE_WARNING))
        {
            mmi_certman_play_requeseted_tone(WARNING_TONE);
        }
        SetLeftSoftkeyFunction(mmi_certman_priv_key_confirmation_yes, KEY_EVENT_UP);
        SetRightSoftkeyFunction(mmi_certman_priv_key_confirmation_no, KEY_EVENT_UP);
        ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        SetCenterSoftkeyFunction(mmi_certman_priv_key_confirmation_yes, KEY_EVENT_UP);
        ChangeTitleString((U8*) g_mmi_certman_context.priv_key_context_p->label);
        draw_title();
        gui_unlock_double_buffer();
        gui_BLT_double_buffer(0, 0, UI_device_width - 1, UI_device_height - 1);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_priv_key_confirmation_yes
 * DESCRIPTION
 *  function for positive confirmation
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_priv_key_confirmation_yes(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 trans_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(g_mmi_certman_context.priv_key_context_p!=NULL);
    trans_id = g_mmi_certman_context.priv_key_context_p->trans_id;
    mmi_certman_free(g_mmi_certman_context.priv_key_context_p);
    g_mmi_certman_context.priv_key_context_p = NULL;
    certman_send_privkey_usage_confirm_rsp(MOD_MMI, trans_id, MMI_TRUE);
    g_mmi_certman_context.private_key_status = MMI_CERTMAN_PRIVATE_KEY_IDLE;
    GoBackHistory();
    mmi_certman_use_priv_key_queue();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_priv_key_confirmation_no
 * DESCRIPTION
 *  function to handle the rsk of confirmation screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_priv_key_confirmation_no(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 trans_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(g_mmi_certman_context.priv_key_context_p!=NULL);
    trans_id = g_mmi_certman_context.priv_key_context_p->trans_id;
    mmi_certman_free(g_mmi_certman_context.priv_key_context_p);
    g_mmi_certman_context.priv_key_context_p = NULL;
    certman_send_privkey_usage_confirm_rsp(MOD_MMI, trans_id, MMI_FALSE);
    GoBackHistory();
    g_mmi_certman_context.private_key_status = MMI_CERTMAN_PRIVATE_KEY_IDLE;
    mmi_certman_use_priv_key_queue();
}

/***************************************************************************/
/*****************************VIEW / INVALID CERTIFICATE'S CONTENT ONLY*****/
/***************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_highlight_invalid_cert_install
 * DESCRIPTION
 *  This function is for highlight invalid certificate install
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_highlight_invalid_cert_install(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_certman_invalid_cert_install, KEY_EVENT_UP);
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_certman_invalid_cert_install, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_highlight_invalid_cert_continue
 * DESCRIPTION
 *  This function is for highlight invalid certificate continue
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_highlight_invalid_cert_continue(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_certman_invalid_cert_continue, KEY_EVENT_UP);
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_certman_invalid_cert_continue, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_highlight_invalid_cert_cancel
 * DESCRIPTION
 *  This function is for highlight invalid certificate cancel
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_highlight_invalid_cert_cancel(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_certman_invalid_cert_cancel, KEY_EVENT_UP);
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_certman_invalid_cert_cancel, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_view_certificate_contents_only
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_view_certificate_contents_only(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* This function is also called in the flow of invalid certificate handling.
       For example when certificate is discarded on editor(input label) screen */

    /* this screen can come up on idle screen. So use nmgr interface here */
    mmi_certman_entry_view_certificate_contents_only();
    mmi_frm_scrn_close(g_mmi_certman_context.g_mmi_certman_active_grp, SCR_ID_CERTMAN_PROGRESS_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_entry_view_certificate_contents_only
 * DESCRIPTION
 *  entry function for view certificate contents only
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_entry_view_certificate_contents_only(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer;
    pBOOL result = MMI_TRUE;
    PU8 cert_info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)g_mmi_certman_context.g_mmi_certman_active_grp, (MMI_ID)SCR_ID_CERTMAN_VIEW_CERTIFICATE_CONTENTS,
        NULL, (FuncPtr)mmi_certman_entry_view_certificate_contents_only, (mmi_frm_scrn_type_enum)0))
    {
        if(!g_mmi_certman_context.view_invalid_context_p->parsed_data_p)
		       return;
		       
        cert_info = (PU8) subMenuData;
        cert_info[0] = 0;
        cert_info[1] = 0;
        result = mmi_certman_fill_certificate_contents_only(
                cert_info,
                &(g_mmi_certman_context.view_invalid_context_p->parsed_data_p->cert));
        if (result == MMI_FALSE)
        {
            certman_parsed_data_free(g_mmi_certman_context.view_invalid_context_p->parsed_data_p);
			 g_mmi_certman_context.view_invalid_context_p->parsed_data_p = NULL;
            return;
        }
        gui_buffer = mmi_frm_scrn_get_gui_buf (g_mmi_certman_context.g_mmi_certman_active_grp, SCR_ID_CERTMAN_VIEW_CERTIFICATE_CONTENTS);
        if (g_mmi_certman_context.current_status == MMI_CERTMAN_INVALID)
        {
            if (g_mmi_certman_context.view_invalid_context_p->mod_name == 0)
            {
                g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CERTIFICATE_DETAILS;
            }
            else
            {
                g_mmi_certman_context.popup_string_id = g_mmi_certman_context.view_invalid_context_p->mod_name;
            }
            ShowCategory74Screen(
                g_mmi_certman_context.popup_string_id,
                IMG_ID_CERTMAN_CERT_MANAGER,
                STR_GLOBAL_OPTIONS,
                IMG_GLOBAL_OPTIONS,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                cert_info,
                mmi_ucs2strlen((const S8*)cert_info),
                gui_buffer);
            SetLeftSoftkeyFunction(mmi_certman_invalid_certificate_option_pre_entry, KEY_EVENT_UP);
            ChangeCenterSoftkey(0, IMG_GLOBAL_OPTION_CSK);
            SetCenterSoftkeyFunction(mmi_certman_invalid_certificate_option_pre_entry, KEY_EVENT_UP);
        }
        else if (g_mmi_certman_context.current_status == MMI_CERTMAN_VIEW)
        {
            ShowCategory74Screen(
                STR_ID_CERTMAN_CERTIFICATE_DETAILS,
                IMG_ID_CERTMAN_CERT_MANAGER,
                NULL,
                NULL,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                cert_info,
                mmi_ucs2strlen((const S8*)cert_info),
                gui_buffer);

        }
        SetRightSoftkeyFunction(mmi_certman_back_view_invalid_certificate_contents_only, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_back_view_invalid_certificate_contents_only
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_back_view_invalid_certificate_contents_only(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	mmi_frm_group_close(g_mmi_certman_context.g_mmi_certman_active_grp);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_certificate_option_pre_entry
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_invalid_certificate_option_pre_entry(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    certman_parsed_data_free(g_mmi_certman_context.view_invalid_context_p->parsed_data_p);
	 g_mmi_certman_context.view_invalid_context_p->parsed_data_p = NULL;
    g_mmi_certman_context.view_invalid_context_p->current_state = MMI_CERTMAN_VIEW_INVALID_OPTIONS;
    mmi_certman_view_invalid_state(NULL);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_certificate_option
 * DESCRIPTION
 *  Entry function to invalid certificate options
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_invalid_certificate_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer;
    U16 nStrItemList[3];
    U16 num_of_items = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)GRP_ID_CERTMAN_INVALID, (MMI_ID)SCR_ID_CERTMAN_INVALID_CERT_OPTION,
        NULL, (FuncPtr)mmi_certman_invalid_certificate_option, (mmi_frm_scrn_type_enum)0))
    {
        gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_INVALID, SCR_ID_CERTMAN_INVALID_CERT_OPTION);

       if ((g_mmi_certman_context.view_invalid_context_p->install_option == MMI_TRUE) || 
			(g_mmi_certman_context.view_invalid_context_p->parsed_data_p && 
				(g_mmi_certman_context.view_invalid_context_p->parsed_data_p->cert_exists)))
        {
            /* user doesn't want install option */
            num_of_items = GetNumOfChild(MENU_ID_CERTMAN_INVALID_OPTIONS2);
            GetSequenceStringIds(MENU_ID_CERTMAN_INVALID_OPTIONS2, nStrItemList);
            SetParentHandler(MENU_ID_CERTMAN_INVALID_OPTIONS2);
        }
        else
        {
            num_of_items = GetNumOfChild(MENU_ID_CERTMAN_INVALID_OPTIONS1);
            GetSequenceStringIds(MENU_ID_CERTMAN_INVALID_OPTIONS1, nStrItemList);
            SetParentHandler(MENU_ID_CERTMAN_INVALID_OPTIONS1);
        }
        RegisterHighlightHandler(ExecuteCurrHiliteHandler);
        ShowCategory15Screen(
            STR_ID_CERTMAN_INVALID_CERTIFICATE,
            IMG_ID_CERTMAN_CERT_MANAGER,
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            NULL,
            NULL,
            num_of_items,
            nStrItemList,
            (U16*) gIndexIconsImageList,
            LIST_MENU,
            0,
            gui_buffer);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_cert_install
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_invalid_cert_install(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_certman_context.view_invalid_context_p->current_state = MMI_CERTMAN_VIEW_INVALID_CERT_LABEL;
    mmi_certman_view_invalid_state(NULL);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_invalid_cert_label
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_invalid_cert_label(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(g_mmi_certman_context.view_invalid_context_p->label, CERTMAN_LABEL_SIZE, 0);
    mmi_certman_input_invalid_cert_label();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_input_invalid_cert_label
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_input_invalid_cert_label(void)
{
    mmi_certman_fseditor_struct *fseditor;
    fseditor = (mmi_certman_fseditor_struct *)mmi_certman_malloc(sizeof(mmi_certman_fseditor_struct));
    fseditor->grp_id = GRP_ID_CERTMAN_INVALID;
    fseditor->title = STR_ID_CERTMAN_CERTIFICATE_LABEL;
    fseditor->title_icon = IMG_ID_CERTMAN_CERT_MANAGER;
    fseditor->lsk_label = STR_GLOBAL_OPTIONS;
    fseditor->lsk_icon = IMG_GLOBAL_OPTIONS;
    fseditor->rsk_label = STR_GLOBAL_DISCARD;
    fseditor->rsk_icon = 0;
    fseditor->input_mode = IMM_INPUT_TYPE_SENTENCE;
    fseditor->buffer_len = CERTMAN_LABEL_SIZE;
    fseditor->input_len = (CERTMAN_LABEL_LENGTH / 2);
    fseditor->buffer = (U8*) g_mmi_certman_context.view_invalid_context_p->label;

    fseditor->submit_fp = mmi_certman_invalid_cert_check_label;
    fseditor->cancel_fp = mmi_certman_invalid_cert_cancel;

    g_mmi_certman_context.view_invalid_context_p->fseditor = fseditor;

    fseditor->id = mmi_certman_fseditor_scr_entry(fseditor);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_cert_check_label
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_invalid_cert_check_label(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    certman_error_enum error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_INVALID_CERT_CHECK_LABEL);
    mmi_frm_scrn_close (GRP_ID_CERTMAN_INVALID, SCR_ID_CERTMAN_INVALID_CERT_LABEL);
    mmi_ucs2cpy(
        (S8*) g_mmi_certman_context.view_invalid_context_p->label,
        (S8*) mmi_certman_left_trim_label(g_mmi_certman_context.view_invalid_context_p->label));
    error = certman_import_check_label_exists(g_mmi_certman_context.view_invalid_context_p->label, CERTMAN_DCS_UCS2);
    switch (error)
    {
        U32 total;
        case CERTMAN_ERR_LABEL_EXISTS:
        case CERTMAN_ERR_INVALID_LABEL:
            mmi_certman_handle_error_with_callback(
                error,
		NULL,
                GRP_ID_CERTMAN_INVALID);
            break;
        default:

            cui_fseditor_close(g_mmi_certman_context.view_invalid_context_p->fseditor->id);
            mmi_certman_free(g_mmi_certman_context.view_invalid_context_p->fseditor);
            g_mmi_certman_context.view_invalid_context_p->fseditor = NULL;
			
	    total = certman_get_cert_count(CERTMAN_CERTGRP_NONE, CERTMAN_KP_NONE);
            if (total >= MMI_CERTMAN_CERTIFICATES_MAX)
            {
                mmi_certman_display_message_with_callback(
                    STR_ID_CERTMAN_MAX_LIMIT,
                    MMI_EVENT_PROPLEM,
                    mmi_certman_exit_view_invalid_certificate_contents_only_with_gobackhistory,
                    GRP_ID_CERTMAN_INVALID);
                break;
            }

            error = certman_ctx_import_new(
                        g_mmi_certman_context.view_invalid_context_p->job_id,
                        g_mmi_certman_context.view_invalid_context_p->ref_id,
                        &(g_mmi_certman_context.view_invalid_context_p->ctx_import_p));

            error = certman_import_set_label(
                        g_mmi_certman_context.view_invalid_context_p->ctx_import_p,
                        g_mmi_certman_context.view_invalid_context_p->label,
                        CERTMAN_DCS_UCS2);

            ASSERT(error <= CERTMAN_ERR_NONE);
            g_mmi_certman_context.view_invalid_context_p->current_state = MMI_CERTMAN_VIEW_INVALID_IMPORT;
            mmi_certman_pre_entry_progress_screen(GRP_ID_CERTMAN_INVALID);
            certman_send_import_req(
                MOD_MMI,
                g_mmi_certman_context.view_invalid_context_p->trans_id,
                g_mmi_certman_context.view_invalid_context_p->ctx_import_p);

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_cert_continue
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_invalid_cert_continue(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_back_view_invalid_certificate_contents();
    mmi_certman_invalid_certificates_rsp(
        MMI_CERTMAN_INVALID_CERT_ACCEPT,
        g_mmi_certman_context.view_invalid_context_p->trans_id);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_invalid_cert_cancel
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_invalid_cert_cancel(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_back_view_invalid_certificate_contents();
    mmi_certman_invalid_certificates_rsp(
        MMI_CERTMAN_INVALID_CERT_DENY,
        g_mmi_certman_context.view_invalid_context_p->trans_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_back_view_invalid_certificate_contents
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_back_view_invalid_certificate_contents(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_certman_context.view_invalid_context_p->current_state = MMI_CERTMAN_VIEW_INVALID_PARSE_END;
    mmi_certman_pre_entry_progress_screen(GRP_ID_CERTMAN_INVALID);
    certman_send_parse_end_req(
        MOD_MMI,
        g_mmi_certman_context.view_invalid_context_p->trans_id,
        (kal_uint16) g_mmi_certman_context.view_invalid_context_p->job_id);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_exit_view_invalid_certificate_contents_only_with_gobackhistory
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_exit_view_invalid_certificate_contents_only_with_gobackhistory(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_exit_view_invalid_certificate_contents_only();
    mmi_certman_read_queue_task_if_present();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_fill_certificate_contents_only
 * DESCRIPTION
 *  function to fill the certificate contents in case of view
 * PARAMETERS
 *  cert_info           [IN]        
 *  display_cert        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
pBOOL mmi_certman_fill_certificate_contents_only(U8 *cert_info, certman_cert_display_struct *display_cert)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 temp_buffer1[20];
    U8 temp_buffer2[10];
    U8 temp_array[MMI_CERTMAN_MAX_FIELD_SIZE];
    S32 buff_length;
    U8 date_format;
    U8 seperator_format;
    U8 seperator;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(cert_info, 0, 2);
    if (display_cert == NULL)
    {
        return MMI_FALSE;
    }
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_FILL_CERTIFICATE_CONTENTS_ONLY);
    buff_length = MAX_SUB_MENUS * MAX_SUB_MENU_SIZE;
    if (g_mmi_certman_context.current_status == MMI_CERTMAN_INVALID)
    {
        U16 error_str_id;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_INVALID_CERT_ERROR), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_INVALID_CERT_ERROR))) >
            0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

        error_str_id = mmi_certman_error_string_id();
        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(error_str_id), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(error_str_id))) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERTIFICATE_DETAILS), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERTIFICATE_DETAILS))) >
            0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }
    /* Certificate Label */
    if ((g_mmi_certman_context.current_status != MMI_CERTMAN_IMPORT) && 
		(display_cert->label && mmi_ucs2strlen((S8*) display_cert->label)))
    {
        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERTIFICATE_LABEL), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERTIFICATE_LABEL))) >
            0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(temp_array, display_cert->label, display_cert->dcs_label, MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_FILE_CONTAINS))) >
            0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;
    }

    /* Certificate Serial no. */
    if (display_cert->serial)
    {
        U32 counter;
        U8 temp_array1[65] = {0, };
        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_SERIAL_NO), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_SERIAL_NO))) >
            0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;
        for (counter = 0; counter < display_cert->serial_size; counter++)
        {
            sprintf((S8*) temp_buffer2, "%02X", display_cert->serial[counter]);
            strcat((S8*) temp_array1, (S8*) temp_buffer2);
            strcat((PS8) temp_array1, (PS8) " ");
        }
        mmi_asc_to_ucs2((PS8) temp_array, (PS8) temp_array1);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;
    }

    /* Certificate Version */

    if (display_cert->version)
    {
        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_VERSION), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_VERSION))) >
            0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

        sprintf((PS8) temp_buffer1, "%d", display_cert->version);
        mmi_asc_to_ucs2((PS8) temp_buffer2, (PS8) temp_buffer1);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_buffer2, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_buffer2)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;
    }
    /* Certificate Issuer */
    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_ISSUER), buff_length);
    buff_length = (buff_length -=
                   ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_ISSUER))) >
        0 ? buff_length : 0;

     mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    /* Certificate Issuer Common Name */
    if (display_cert->issuer.names[CERTMAN_NAMETYPE_COMMON_NAME])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->issuer.names[CERTMAN_NAMETYPE_COMMON_NAME],
            display_cert->issuer.dcs[CERTMAN_NAMETYPE_COMMON_NAME],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;
    }

    /* Certificate Issuer Orgainization */

    if (display_cert->issuer.names[CERTMAN_NAMETYPE_ORGANISATION])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->issuer.names[CERTMAN_NAMETYPE_ORGANISATION],
            display_cert->issuer.dcs[CERTMAN_NAMETYPE_ORGANISATION],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }
    /* Certificate Issuer Orgainization Unit */

    if (display_cert->issuer.names[CERTMAN_NAMETYPE_ORGANISATION_UNIT])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->issuer.names[CERTMAN_NAMETYPE_ORGANISATION_UNIT],
            display_cert->issuer.dcs[CERTMAN_NAMETYPE_ORGANISATION_UNIT],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }

    /* Certificate Issuer Locality */
    if (display_cert->issuer.names[CERTMAN_NAMETYPE_LOCALITY])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->issuer.names[CERTMAN_NAMETYPE_LOCALITY],
            display_cert->issuer.dcs[CERTMAN_NAMETYPE_LOCALITY],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }

    /* Certificate Issuer state */
    if (display_cert->issuer.names[CERTMAN_NAMETYPE_STATE])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->issuer.names[CERTMAN_NAMETYPE_STATE],
            display_cert->issuer.dcs[CERTMAN_NAMETYPE_STATE],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }

    /* Certificate Issuer Country */
    if (display_cert->issuer.names[CERTMAN_NAMETYPE_COUNTRY])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->issuer.names[CERTMAN_NAMETYPE_COUNTRY],
            display_cert->issuer.dcs[CERTMAN_NAMETYPE_COUNTRY],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }
    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    /* Certificate Subject */

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_GLOBAL_SUBJECT), buff_length);
    buff_length = (buff_length -=
                   ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_GLOBAL_SUBJECT))) >
        0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    /* Certificate Subject Common Name */
    if (display_cert->subject.names[CERTMAN_NAMETYPE_COMMON_NAME])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->subject.names[CERTMAN_NAMETYPE_COMMON_NAME],
            display_cert->subject.dcs[CERTMAN_NAMETYPE_COMMON_NAME],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;
    }

    /* Certificate subject Orgainization */

    if (display_cert->subject.names[CERTMAN_NAMETYPE_ORGANISATION])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->subject.names[CERTMAN_NAMETYPE_ORGANISATION],
            display_cert->subject.dcs[CERTMAN_NAMETYPE_ORGANISATION],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }
    /* Certificate subject Orgainization Unit */

    if (display_cert->subject.names[CERTMAN_NAMETYPE_ORGANISATION_UNIT])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->subject.names[CERTMAN_NAMETYPE_ORGANISATION_UNIT],
            display_cert->subject.dcs[CERTMAN_NAMETYPE_ORGANISATION_UNIT],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }

    /* Certificate subject Locality */
    if (display_cert->subject.names[CERTMAN_NAMETYPE_LOCALITY])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->subject.names[CERTMAN_NAMETYPE_LOCALITY],
            display_cert->subject.dcs[CERTMAN_NAMETYPE_LOCALITY],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }

    /* Certificate subject state */
    if (display_cert->subject.names[CERTMAN_NAMETYPE_STATE])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->subject.names[CERTMAN_NAMETYPE_STATE],
            display_cert->subject.dcs[CERTMAN_NAMETYPE_STATE],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    }

    /* Certificate subject Country */
    if (display_cert->subject.names[CERTMAN_NAMETYPE_COUNTRY])
    {
        memset(temp_array, 0, 2);
        mmi_certman_cert_strncpy(
            temp_array,
            display_cert->subject.names[CERTMAN_NAMETYPE_COUNTRY],
            display_cert->subject.dcs[CERTMAN_NAMETYPE_COUNTRY],
            MMI_CERTMAN_MAX_FIELD_SIZE);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;
    }
    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    /* Certificate Valid From */
    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_VALID_FROM), buff_length);
    buff_length = (buff_length -=
                   ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_VALID_FROM))) >
        0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    date_format = PhnsetGetDateFormat();
    seperator_format = PhnsetGetDateSeperatorFormat();

    switch(seperator_format)
    {
	case 0:
		seperator = '.';
		break;
	case 1:
		seperator = ':';
		break;
	case 2:
		seperator = '/';
		break;
	default :
		seperator = '-';
		break;
    }

    switch(date_format)
    {
        case 0:
                sprintf(
			(S8*) temp_buffer1,
                        "%02d%c%02d%c%d",
                        display_cert->valid_from.nDay,
                        seperator,
                        display_cert->valid_from.nMonth,
                        seperator,
                        display_cert->valid_from.nYear);		
                break;
        case 1:
                sprintf(
                        (S8*) temp_buffer1,
                        "%02d%c%02d%c%d",
                        display_cert->valid_from.nMonth,
                        seperator,
                        display_cert->valid_from.nDay,
                        seperator,
                        display_cert->valid_from.nYear);
                break;
        default:
                sprintf(
                       (S8*) temp_buffer1,
                       "%d%c%02d%c%02d",
                       display_cert->valid_from.nYear,
                       seperator,
                       display_cert->valid_from.nMonth,
                       seperator,
                       display_cert->valid_from.nDay);
                break;
    }


    mmi_asc_to_ucs2((PS8) temp_array, (PS8) temp_buffer1);
    mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;

    /* Certificate valid Upto */

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_VALID_UPTO), buff_length);
    buff_length = (buff_length -=
                   ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_VALID_UPTO))) >
        0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;


    switch(date_format)
    {
        case 0:
                sprintf(
                    (S8*) temp_buffer1,
                    "%02d%c%02d%c%d",
                    display_cert->valid_until.nDay,
                    seperator,
                    display_cert->valid_until.nMonth,
                    seperator,
                    display_cert->valid_until.nYear);		
        break;
        case 1:
                sprintf(
                     (S8*) temp_buffer1,
                     "%02d%c%02d%c%d",
                     display_cert->valid_until.nMonth,
                     seperator,
                     display_cert->valid_until.nDay,
                     seperator,
                     display_cert->valid_until.nYear);
        break;
        default:
                 sprintf(
                     (S8*) temp_buffer1,
                     "%d%c%02d%c%02d",
                     display_cert->valid_until.nYear,
                     seperator,
                     display_cert->valid_until.nMonth,
                     seperator,
                     display_cert->valid_until.nDay);
        break;
    }

    mmi_asc_to_ucs2((PS8) temp_array, (PS8) temp_buffer1);
    mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;
    /* Certificate Finger Print */
    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_FINGER_PRINT), buff_length);
    buff_length = (buff_length -=
                   ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_FINGER_PRINT))) >
        0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
			0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    if (display_cert->fngrprt_sha1)
    {
        U32 counter;
        U8 temp_array1[65] = {0, };
        for (counter = 0; counter < CERTMAN_SHA1_SIZE; counter++)
        {
            sprintf((S8*) temp_buffer2, "%02X", display_cert->fngrprt_sha1[counter]);
            strcat((S8*) temp_array1, (S8*) temp_buffer2);
            strcat((PS8) temp_array1, (PS8) " ");
        }
        mmi_asc_to_ucs2((PS8) temp_array, (PS8) temp_array1);
        mmi_ucs2ncat((PS8) cert_info, (PS8) temp_array, buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) temp_array)) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n\n", buff_length);
        buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n\n")) > 0 ? buff_length : 0;

    }
    /* Certificate Type */
    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_TYPE), buff_length);
    buff_length = (buff_length -=
                   ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_TYPE))) > 0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_COLON), buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_COLON))) >
		0 ? buff_length : 0;

    mmi_ucs2ncat((PS8) cert_info, (PS8) L"\n", buff_length);
    buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) L"\n")) > 0 ? buff_length : 0;

    if (display_cert->cert_type == CERTMAN_CERTTYPE_X509)
    {
        //mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERT_TYPE), buff_length);
        //buff_length = (buff_length -= ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERT_TYPE))) > 0 ? buff_length : 0;

        mmi_ucs2ncat((PS8) cert_info, (PS8) GetString(STR_ID_CERTMAN_CERTTYPE_X509), buff_length);
        buff_length = (buff_length -=
                       ENCODING_LENGTH * mmi_ucs2strlen((S8*) GetString(STR_ID_CERTMAN_CERTTYPE_X509))) >
            0 ? buff_length : 0;
    }
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_error_string_id
 * DESCRIPTION
 *  function for error string
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U32 mmi_certman_error_string_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 error_string = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_BCONST_NOT_CRITICAL) ==
        MMI_CERTMAN_WARN_BCONST_NOT_CRITICAL)
    {
        error_string = STR_ID_CERTMAN_WARN_BCONST_NOT_CRITICAL;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_UNKNOWN_CRITICAL_EXT) ==
        MMI_CERTMAN_WARN_UNKNOWN_CRITICAL_EXT)
    {
        error_string = STR_ID_CERTMAN_WARN_UNKNOWN_CRITICAL_EXT;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_VALIDITY) == MMI_CERTMAN_WARN_VALIDITY)
    {
        error_string = STR_ID_CERTMAN_WARN_VALIDITY;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_KEY_MISUSE) ==
        MMI_CERTMAN_WARN_KEY_MISUSE)
    {
        error_string = STR_ID_CERTMAN_WARN_KEY_MISUSE;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_INVALID_SIGNATURE) ==
        MMI_CERTMAN_WARN_INVALID_SIGNATURE)
    {
        error_string = STR_ID_CERTMAN_WARN_INVALID_SIGNATURE;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_CORRUPTED_CERT) ==
        MMI_CERTMAN_WARN_CORRUPTED_CERT)
    {
        error_string = STR_ID_CERTMAN_WARN_CORRUPTED_CERT;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_TRUSTED_NO_KEY_USAGE) ==
        MMI_CERTMAN_WARN_TRUSTED_NO_KEY_USAGE)
    {
        error_string = STR_ID_CERTMAN_WARN_TRUSTED_NO_KEY_USAGE;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_NO_CERT_HASH) ==
        MMI_CERTMAN_WARN_NO_CERT_HASH)
    {
        error_string = STR_ID_CERTMAN_WARN_NO_CERT_HASH;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_URLS_DONT_MATCH) ==
        MMI_CERTMAN_WARN_URLS_DONT_MATCH)
    {
        error_string = STR_ID_CERTMAN_WARN_URLS_DONT_MATCH;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_NO_TRUSTED_CERTS) ==
        MMI_CERTMAN_WARN_NO_TRUSTED_CERTS)
    {
        error_string = STR_ID_CERTMAN_WARN_NO_TRUSTED_CERTS;
    }
    if ((g_mmi_certman_context.view_invalid_context_p->error & MMI_CERTMAN_WARN_TRUSTED_EXPIRED) ==
        MMI_CERTMAN_WARN_TRUSTED_EXPIRED)
    {
        error_string = STR_ID_CERTMAN_WARN_TRUSTED_EXPIRED;
    }
    if(!error_string)
    {
        error_string = STR_ID_CERTMAN_INVALID_CERT_ID;
    }
    return error_string;
}


void mmi_certman_pre_entry_progress_screen(kal_int32 grp)
{
    if (mmi_frm_scrn_is_present (grp, SCR_ID_CERTMAN_PROGRESS_SCREEN, MMI_FRM_NODE_ALL_FLAG))
    {
        return;
    }
    g_mmi_certman_context.g_mmi_certman_active_grp = grp;
    mmi_certman_entry_progress_screen();
}

void mmi_certman_entry_progress_screen(void)
{
    /* use user data in goback history */
    if (mmi_frm_scrn_enter((MMI_ID)g_mmi_certman_context.g_mmi_certman_active_grp, (MMI_ID)SCR_ID_CERTMAN_PROGRESS_SCREEN, NULL, 
	    (FuncPtr)mmi_certman_entry_progress_screen, (mmi_frm_scrn_type_enum)0))
    {
#ifdef __MMI_SCREEN_SWITCH_EFFECT__
        gui_screen_switch_effect_block(MMI_TRUE);
#endif
        if(g_mmi_certman_context.string_status == MMI_TRUE)
	{
	    ShowCategory66Screen(
	        STR_ID_CERTIFICATE_MANAGER,
		IMG_ID_CERTMAN_CERT_MANAGER,
		0,
		0,
		0,
		0,
		(U8*) GetString(STR_GLOBAL_DELETING),
         	mmi_get_event_based_image(MMI_EVENT_PROGRESS),
		NULL);
            }
	    else
	    {
                ShowCategory66Screen(
		    STR_ID_CERTIFICATE_MANAGER,
		    IMG_ID_CERTMAN_CERT_MANAGER,
		    0,
		    0,
		    0,
		    0,
		    (U8*) GetString(STR_GLOBAL_PLEASE_WAIT),
		    mmi_get_event_based_image(MMI_EVENT_PROGRESS),
		    NULL);
        }
        srv_backlight_turn_on(SRV_BACKLIGHT_SHORT_TIME);
        ClearAllKeyHandler();
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_import_incorrect_pwd_continue
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_import_incorrect_pwd_continue(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    memset(g_mmi_certman_context.import_context_p->password,
           0,
           sizeof(g_mmi_certman_context.import_context_p->password));

    cui_fseditor_set_text(g_mmi_certman_context.import_context_p->fseditor->id,
                          (WCHAR *)g_mmi_certman_context.import_context_p->password,
                          CERTMAN_PASSWORD_SIZE *ENCODING_LENGTH,
                          CERTMAN_PASSWORD_LENGTH);

    mmi_frm_scrn_close (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_PROGRESS_SCREEN);
    mmi_frm_scrn_close (GRP_ID_CERTMAN_IMPORT, SCR_ID_CERTMAN_POPUP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_handle_error_with_callback
 * DESCRIPTION
 *  common function to handle error with callback
 * PARAMETERS
 *  error           [IN]        
 *  callback        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_handle_error_with_callback(certman_error_enum error, FuncPtr callback, MMI_ID grp)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_event_notify_enum event_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (error)
    {
        case CERTMAN_ERR_MEMFULL:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_MEMORY_FULL;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_INVALID_CONTEXT:
        case CERTMAN_ERR_ACCESS_DENIED:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_CONTEXT;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_FILE_NOT_FOUND:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_FILE_NOT_FOUND;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_FS_ERROR:
            g_mmi_certman_context.popup_string_id = STR_GLOBAL_DRM_FS_ERROR;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_INVALID_ENCODING:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_ENCODING;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_UNSUPPORTED_CONTENT:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CORRUPTED_FILE;
            event_id = MMI_EVENT_PROPLEM;
            break;
	case CERTMAN_ERR_INVALID_PASSWORD:
        case CERTMAN_ERR_INCORRECT_PASSWORD:
        {
	    g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INCORRECT_PASSWORD;
            event_id = MMI_EVENT_ERROR;
	}
            break;
        case CERTMAN_ERR_NEED_PASSWORD:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_NEED_PASSWORD;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_INVALID_JOB:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_JOB;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_INVALID_CERT_ID:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_CERT_ID;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_LABEL_EXISTS:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_LABEL_EXISTS;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_DISK_FULL:
            g_mmi_certman_context.popup_string_id = FMGR_FS_DISK_FULL_TEXT;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_INVALID_LABEL:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_LABEL;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_INVALID_CERT_GROUP:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_CERT_GROUP;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_INVALID_KEY_PURPOSE:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_KEY_PURPOSE;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_CERT_NOT_FOUND:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CERTIFICATE_NOT_FOUND;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_INVALID_INPUT:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_INVALID_INPUT;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_INVALID_FILENAME:
            g_mmi_certman_context.popup_string_id = STR_GLOBAL_INVALID_FILENAME;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_ID_ALREADY_EXISTS:
        case   CERTMAN_ERR_CERT_EXISTS:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CERT_EXISTS;
            event_id = MMI_EVENT_ERROR;
            break;
        case CERTMAN_ERR_TOO_MANY_CERTS:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_TOO_MANY_CERT;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_READ_ONLY:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_READ_ONLY;
            event_id = MMI_EVENT_ERROR; 
            break;
        case CERTMAN_ERR_CORRUPTED_DATA:
        case CERTMAN_ERR_FILE_CORRUPTED:
	case CERTMAN_ERR_INVALID_DATA:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CORRUPTED_FILE;
            event_id = MMI_EVENT_PROPLEM;
            break;
       case CERTMAN_ERR_FILE_TOO_LARGE:
            g_mmi_certman_context.popup_string_id = STR_GLOBAL_ERROR;
            event_id = MMI_EVENT_PROPLEM;
            break;
        case CERTMAN_ERR_CERT_IN_USE:
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CERT_IN_USE;
            event_id = MMI_EVENT_PROPLEM;
            break;
        default:
            return;
    }

    if (callback)
    {
        mmi_certman_displaypop_with_callback(
            (PU8) GetString(g_mmi_certman_context.popup_string_id),
            event_id,
            callback,
            grp);
    }
    else
    {
        mmi_popup_display_simple((WCHAR*)((UI_string_type) GetString((U16)g_mmi_certman_context.popup_string_id)), event_id, grp, NULL);
    }
}
/*****************************************************************************
 * FUNCTION
 *  mmi_certman_dummy_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_dummy_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_certman_context.popup_handler_callback != NULL)
    {
         g_mmi_certman_context.popup_handler_callback();
         g_mmi_certman_context.popup_handler_callback = NULL;
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_general_error_handler_if_screen_in_history
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_general_error_handler_if_screen_in_history(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter((MMI_ID)g_mmi_certman_context.g_mmi_certman_active_grp, (MMI_ID)SCR_ID_CERTMAN_GENERAL_POPUP_SCREEN,
       NULL, (FuncPtr)mmi_certman_general_error_handler_if_screen_in_history, (mmi_frm_scrn_type_enum)0))
    {    
        ShowCategory2Screen(
            STR_ID_CERTIFICATE_MANAGER,
            IMG_ID_CERTMAN_CERT_MANAGER,
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            0,
            0,
            g_mmi_certman_context.popup_string_id,
            NULL);
        if (g_mmi_certman_context.popup_handler_callback == NULL)
        {
            SetLeftSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
            ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            SetCenterSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
        }
        else
        {
            SetLeftSoftkeyFunction(mmi_certman_general_error_handler_rsk, KEY_EVENT_UP);
            ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            SetCenterSoftkeyFunction(mmi_certman_general_error_handler_rsk, KEY_EVENT_UP);
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_general_error_handler_rsk
 * DESCRIPTION
 *  general error handler rsk function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_general_error_handler_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_certman_context.popup_handler_callback();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_handle_error
 * DESCRIPTION
 *  common function to handle error
 * PARAMETERS
 *  error       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_handle_error(certman_error_enum error, mmi_id grp)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_handle_error_with_callback(error, NULL, grp);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_popup_exit_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_popup_exit_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PopupFunc = NULL;
    if (g_mmi_certman_context.display_popup_timeout_complete == MMI_CERTMAN_POPUP_CALLBACK_NOT_EXECUTED)
    {
        /*this means popup was interrupted by an async event*/
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_POP_UP_EXIT_WITH_ASYNC);
        g_mmi_certman_context.display_popup_timeout_complete = MMI_CERTMAN_POPUP_CALLBACK_EXECUTED_BY_ASYNC_EVENT;
        StopTimer(MMI_CERTMAN_TIMER_ID);
        if (g_mmi_certman_context.display_popup_tone)
        {
            srv_prof_stop_tone((srv_prof_tone_enum)g_mmi_certman_context.display_popup_tone);
            g_mmi_certman_context.display_popup_tone = 0;
        }
        g_mmi_certman_context.popup_handler_callback = g_mmi_certman_context.display_popup_callback;
        g_mmi_certman_context.display_popup_callback = NULL;
        if (mmi_frm_scrn_get_active_id() == SCR_ID_CERTMAN_POPUP)	
        {
            /*this means the event doesn't have a screen, for example key press*/
            /*So call dummy screen entry function directly*/
            MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_POP_UP_EXIT_WITH_NON_SCREEN_ASYNC);
            mmi_certman_dummy_screen();		
        }
        else
        {
            /*this means the event have a screen, for example charger pluggin*/
            /*So put dummy screen in history. This would popup when 
            ExecutePopHistory is called*/
//            GenericExitScreen(SCR_ID_CERTMAN_DUMMY_SCREEN, mmi_certman_dummy_screen);

            /* check this case is during IT. Need to do this on the latest load */
            mmi_frm_node_struct node;
            node.id = SCR_ID_CERTMAN_DUMMY_SCREEN;
            node.entry_proc = NULL;
            node.user_data = NULL;
            MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_POP_UP_EXIT_WITH_SCREEN_ASYNC);
            mmi_frm_scrn_insert ((MMI_ID)g_mmi_certman_context.g_mmi_certman_active_grp, (MMI_ID)SCR_ID_CERTMAN_DUMMY_SCREEN, &node, (mmi_scenario_node_flag)0);
        }
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_popup_execute_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_popup_execute_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_POP_UP_EXEC_CALLBACK);
    StopTimer(MMI_CERTMAN_TIMER_ID);
    if (g_mmi_certman_context.display_popup_tone)
    {
        srv_prof_stop_tone((srv_prof_tone_enum)g_mmi_certman_context.display_popup_tone);
        g_mmi_certman_context.display_popup_tone = 0;
    }
    if (g_mmi_certman_context.display_popup_callback != NULL)
    {
        g_mmi_certman_context.display_popup_callback();
    }
    g_mmi_certman_context.display_popup_callback = NULL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_popup_timeout
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_popup_timeout(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_POP_UP_TIMEOUT);
    PopupFunc = NULL;
    if (g_mmi_certman_context.display_popup_timeout_complete == MMI_CERTMAN_POPUP_CALLBACK_NOT_EXECUTED)
    {
        g_mmi_certman_context.display_popup_timeout_complete = MMI_CERTMAN_POPUP_CALLBACK_EXECUTED_BY_TIMEOUT;
        mmi_certman_popup_execute_callback();
    }
}

#ifdef __MMI_TOUCH_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  mmi_certman_Cat65ImagePenDownHdlr
 * DESCRIPTION
 *  Function called when pen is put down on the screen in between a popup
 * PARAMETERS
 *  point: ignored
 * RETURNS
 *  True always
 *****************************************************************************/
MMI_BOOL mmi_certman_Cat65ImagePenDownHdlr(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_popup_exit_handler();
    return MMI_TRUE;
}
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_certman_displaypop_with_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  string              [IN]        
 *  image_id            [IN]        
 *  image_on_bottom     [IN]        
 *  popup_duration      [IN]        
 *  tone_id             [IN]        
 *  f                   [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_displaypop_with_callback(
        U8 *string,
        mmi_event_notify_enum event_id,
        FuncPtr f,
        MMI_ID grp)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
      U16 image_id;
      U32 popup_duration;
      srv_prof_tone_enum tone_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (mmi_frm_scrn_enter(grp, (MMI_ID)SCR_ID_CERTMAN_POPUP,
        mmi_certman_popup_exit_handler, mmi_certman_displaypop_with_callback, MMI_FRM_FG_ONLY_SCRN))
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISPLAY_POP_UP);

        /* Becasue DisplayPoup will not be added into history, it will not set small screen flag */
        force_no_small_screen();

	PopupFunc = mmi_certman_popup_timeout;
        image_id = mmi_get_event_based_image(event_id);
        tone_id = mmi_get_event_based_sound(event_id);
        popup_duration = mmi_get_event_based_duration(event_id);
        ClearKeyEvents();
        ShowCategory65Screen(string, image_id, NULL);
        SetGroupKeyHandler(mmi_certman_popup_exit_handler, (PU16) PresentAllKeys, TOTAL_KEYS, KEY_EVENT_DOWN);
        SetGroupKeyHandler(mmi_certman_popup_exit_handler, (PU16) PresentAllKeys, TOTAL_KEYS, KEY_EVENT_UP);
        SetGroupKeyHandler(mmi_certman_popup_exit_handler, (PU16) PresentAllKeys, TOTAL_KEYS, KEY_REPEAT);
#ifdef __MMI_TOUCH_SCREEN__
        wgui_register_category_screen_control_area_pen_handlers(mmi_certman_Cat65ImagePenDownHdlr, MMI_PEN_EVENT_DOWN);
#endif
        g_mmi_certman_context.display_popup_timeout_complete = MMI_CERTMAN_POPUP_CALLBACK_NOT_EXECUTED;
        StartTimer(MMI_CERTMAN_TIMER_ID, popup_duration, mmi_certman_popup_timeout);
        g_mmi_certman_context.display_popup_callback = f;
        g_mmi_certman_context.display_popup_tone = tone_id;
        if (g_mmi_certman_context.display_popup_tone)
        {
            if(!srv_prof_is_tone_playing((srv_prof_tone_enum)g_mmi_certman_context.display_popup_tone))
            {
                mmi_certman_play_requeseted_tone(g_mmi_certman_context.display_popup_tone);
            }
        }
        srv_backlight_turn_on(SRV_BACKLIGHT_SHORT_TIME);
    }
    else
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISPLAY_POP_UP_DIRECT_CALLBACK);
        mmi_frm_scrn_close(grp, SCR_ID_CERTMAN_POPUP);
        f();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_message_with_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  message         [IN]        
 *  image_id        [IN]        
 *  tone_id         [IN]        
 *  callback        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_message_with_callback(U16 message, mmi_event_notify_enum event_id, FuncPtr callback, MMI_ID grp)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_certman_context.popup_string_id = message;
    g_mmi_certman_context.popup_handler_callback = callback;

    if (callback)
    {
        mmi_certman_displaypop_with_callback(
            (PU8) GetString(g_mmi_certman_context.popup_string_id),
            event_id,
            callback,
            grp);
    }
    else
    {
        mmi_popup_display_simple((WCHAR*)((UI_string_type)GetString((U16)message)), event_id, GRP_ID_CERTMAN_LAUNCH, NULL);
    }
}

#ifdef __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__
/*****************************************************************************
 * FUNCTION
 *  mmi_certman_confirm_without_client_cert_prompt
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_confirm_without_client_cert_prompt(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_select_user_certificate_lsk();
}
#endif /* __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__*/

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_entry_display_user_certificate_list_by_issuer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_entry_display_user_certificate_list_by_issuer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__
    if(g_mmi_certman_context.user_cert_list_context_p->cert_count < 1)
    {
        /* Please wait screen is current and no client certificate has been found
           so send response*/
        mmi_certman_confirm_without_client_cert_prompt();
    }
    else
    {
        /* Please wait screen is current and atleast one client certificate has been found
           so display certificate list screen*/
        mmi_certman_display_user_certificate_list_by_issuer();
    }
#else  /*__MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__*/
    mmi_certman_display_user_certificate_list_by_issuer();
    mmi_frm_scrn_close(GRP_ID_CERTMAN_SELECT_USER, SCR_ID_CERTMAN_PROGRESS_SCREEN);
#endif  /*__MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__*/
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_display_user_certificate_list_by_issuer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_display_user_certificate_list_by_issuer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter(
            (MMI_ID)GRP_ID_CERTMAN_SELECT_USER, (MMI_ID)SCR_ID_CERTMAN_USER_CERTIFICATE_LIST_BY_ISSUER,
            NULL, mmi_certman_display_user_certificate_list_by_issuer, NULL))
    {
        MMI_TRACE(MMI_INET_TRC_G3_CER_MAN, MMI_CERTMAN_DISPLAY_USER_CERTIFCATE_LIST_BY_ISSUER);
        gui_buffer = mmi_frm_scrn_get_gui_buf (GRP_ID_CERTMAN_SELECT_USER, SCR_ID_CERTMAN_USER_CERTIFICATE_LIST_BY_ISSUER);
        RegisterHighlightHandler(mmi_certman_user_certificate_list_highlight_handler);
        if (g_mmi_certman_context.user_cert_list_context_p->mod_name == 0)
        {
            g_mmi_certman_context.popup_string_id = STR_ID_CERTMAN_CERTIFICATES;
        } 
        else
        {
            g_mmi_certman_context.popup_string_id = g_mmi_certman_context.user_cert_list_context_p->mod_name;
        }
#ifndef __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__
        if(g_mmi_certman_context.user_cert_list_context_p->cert_count)
        {
#endif /* __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__ */
            ShowCategory184Screen(
                g_mmi_certman_context.popup_string_id,
                IMG_ID_CERTMAN_CERT_MANAGER,
                STR_GLOBAL_OK,
                IMG_GLOBAL_OK,
                STR_GLOBAL_CANCEL,
                NULL,
                g_mmi_certman_context.user_cert_list_context_p->cert_count,
                mmi_certman_get_personal_certificates,
                NULL,
                0,
                gui_buffer);
#ifndef __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__
        /* If this macro is on, then this else case would not occur */    
        }
        else
        {
            ShowCategory7Screen(
                g_mmi_certman_context.popup_string_id,
                IMG_ID_CERTMAN_CERT_MANAGER,
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U8*) GetString(STR_ID_CERTMAN_NO_USER_CERT_CONFIRM),
                NULL);

        }
#endif /* __MMI_CERTMAN_DONT_SHOW_CLIENT_CERT_PROMPT__ */
        SetLeftSoftkeyFunction(mmi_certman_select_user_certificate_lsk, KEY_EVENT_UP);
        SetRightSoftkeyFunction(mmi_certman_select_user_certificate_rsk, KEY_EVENT_UP);
        ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        SetCenterSoftkeyFunction(mmi_certman_select_user_certificate_lsk, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_get_personal_certificates
 * DESCRIPTION
 *  
 * PARAMETERS
 *  item_index          [IN]        
 *  str_buff            [IN]        
 *  img_buff_p          [IN]        
 *  str_img_mask        [IN]        
 * RETURNS
 *  
 *****************************************************************************/
pBOOL mmi_certman_get_personal_certificates(S32 item_index, UI_string_type str_buff, PU8 *img_buff_p, U8 str_img_mask)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((item_index < 0) || (item_index >= MMI_CERTMAN_CERTIFICATES_MAX))
    {
        return FALSE;
    }

    mmi_certman_cert_strncpy(
        (PU8) str_buff,
        g_mmi_certman_context.user_cert_list_context_p->certificate_list[item_index].cert_label,
        (certman_dcs_enum)g_mmi_certman_context.user_cert_list_context_p->certificate_list[item_index].certificate_dcs,
        CERTMAN_LABEL_SIZE * ENCODING_LENGTH);

    if (g_mmi_certman_context.user_cert_list_context_p->certificate_list[item_index].cert_group ==
        CERTMAN_CERTGRP_PERSONAL)
    {
        *img_buff_p = NULL;
        return TRUE;
    }
    *img_buff_p = NULL;
    return TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_select_user_certificate_lsk
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_select_user_certificate_lsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index = g_mmi_certman_context.user_cert_list_context_p->selected_index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_certman_context.user_cert_list_context_p->cert_count == 0)
    {
        index = g_mmi_certman_context.user_cert_list_context_p->selected_index = 0;
        g_mmi_certman_context.user_cert_list_context_p->certificate_list[index].cert_id = 0;
    }
    mmi_certman_select_user_certificates_rsp(
        g_mmi_certman_context.user_cert_list_context_p->certificate_list[index].cert_id,
        MMI_TRUE,
        g_mmi_certman_context.user_cert_list_context_p->trans_id);
    mmi_certman_user_certificates_list_deinit();
    mmi_certman_read_queue_task_if_present();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_select_user_certificate_rsk
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_select_user_certificate_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_certman_exit_user_certificates_list_with_goback_history();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_user_certificate_list_highlight_handler
 * DESCRIPTION
 *  highlight handler for certificate
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_user_certificate_list_highlight_handler(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_certman_context.user_cert_list_context_p->selected_index = index;
}

void mmi_certman_install_handler(mmi_menu_id item_id, const WCHAR* filepath, 
                     const srv_fmgr_fileinfo_struct* fileinfo)
{
    mmi_certman_install_certificates_ind((module_type)MOD_MMI, (kal_bool)MMI_CERTMAN_OPEN, 1, (kal_wchar*) filepath);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_certman_pre_enter_install
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_pre_enter_install(void)
{
    /* FMGR_Revise start */
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_fmgr_fileinfo_struct file_info;
    const WCHAR* filepath;
    S32 fs_result;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    filepath = srv_fmgr_types_query_fileinfo(&file_info);

    fs_result = srv_fmgr_fs_path_exist(filepath);
    if (fs_result < FS_NO_ERROR)
    {
        mmi_popup_display((WCHAR*)((PU16) GetString(srv_fmgr_fs_error_get_string(fs_result))), MMI_EVENT_PROPLEM, NULL);
        return;
    }
    mmi_certman_install_certificates_ind((module_type)MOD_MMI, (kal_bool)MMI_CERTMAN_OPEN, 1, (kal_wchar*) filepath);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_launch_certficate_manager
 * DESCRIPTION
 *  Function to launch certificate manager
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_launch_certficate_manager(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_certman_launch_cert_ind_struct data;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data.action = (kal_bool)MMI_CERTMAN_OPEN;
    data.trans_id = 1;
    g_mmi_certman_context.src_module = MOD_MMI;
    mmi_certman_launch_certificates_ind_handler(&data);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_certman_play_requeseted_tone
 * DESCRIPTION
 *  Function to play request
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_certman_play_requeseted_tone(U8 tone_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_BACKGROUND_CALL__
     if(!srv_ucm_is_background_call())
#endif /*__MMI_BACKGROUND_CALL__*/
     {
         srv_prof_play_tone((srv_prof_tone_enum)tone_id, NULL);
     }
}


mmi_id mmi_certman_fseditor_scr_entry(void* arg)
{
    mmi_certman_fseditor_struct *fseditor = (mmi_certman_fseditor_struct*)arg;
    if ((fseditor->id = cui_fseditor_create(fseditor->grp_id)) != NULL)
    {
        cui_fseditor_set_title(fseditor->id, fseditor->title, fseditor->title_icon);
        cui_fseditor_set_buffer(fseditor->id, (PU8) fseditor->buffer, 
            fseditor->buffer_len, fseditor->input_len);
        cui_fseditor_set_input_method(fseditor->id, fseditor->input_mode, NULL, 0);
        cui_fseditor_run(fseditor->id);
    }
    return fseditor->id;
}

void mmi_certman_launch_key_usage_done_callback(void)
{
    mmi_frm_scrn_close (GRP_ID_CERTMAN_LAUNCH, SCR_ID_CERTMAN_POPUP);

    mmi_frm_scrn_multiple_close(
        GRP_ID_CERTMAN_LAUNCH, 
        SCR_ID_CERTMAN_CERTIFICATE_SET_KEY_USAGES,
        MMI_TRUE,
        0,
        SCR_ID_CERTMAN_CERTIFICATE_LIST,
        MMI_FALSE);
}


#endif /* __CERTMAN_SUPPORT__ */ 
#endif /* __PLUTO_MMI_PACKAGE__ */
/* Shrikant */

