/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * ToDoList.c
 *
 * Project:
 * --------
 * MAUI
 *
 * Description:
 * ------------
 * This file implements To Do List application.
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
/**
 * Copyright Notice
 * ?2002 - 2003, Pixtel Communications, Inc., 1489 43rd Ave. W.,
 * Vancouver, B.C. V6M 4K8 Canada. All Rights Reserved.
 *  (It is illegal to remove this copyright notice from this software or any
 *  portion of it)
 */
/**************************************************************

   FILENAME : ToDoList.c

   PURPOSE     : To Do List Application

   REMARKS     : nil

   AUTHOR      : Arvind

   DATE     : 29th Oct, 2003

**************************************************************/

#include "MMI_features.h"
#if defined(__MMI_CALENDAR_EVENT__) || defined(__MMI_TODOLIST__)

#include "MMI_common_app_trc.h"
#include "DebugInitDef_Int.h"
#include "MMIDataType.h"
#include "ToDoListProt.h"
#include "mmi_rp_app_todolist_def.h"
#include "GlobalResDef.h"
#include "custom_mmi_default_value.h"
#include "mmi_frm_mem_gprot.h"
#include "mmi_frm_nvram_gprot.h"
#include "nvram_common_defs.h"
#include "string.h"
#include "TodolistSrvGprot.h"
#include "mmi_frm_scenario_gprot.h"
#include "NotificationGprot.h"
#include "mmi_frm_events_gprot.h"
#include "kal_trace.h"
#include "DateTimeType.h"
#include "wgui_categories_util.h"
#include "GlobalConstants.h"
#include "AlertScreen.h"
#include "wgui_datetime.h"
#include "Unicodexdcl.h"
#include "CustDataRes.h"
#include "wgui_categories_list.h"
#include "wgui_categories.h"
#include "mmi_frm_input_gprot.h"
#include "mmi_frm_history_gprot.h"
#include "mmi_rp_app_organizer_def.h"
#include "gui_data_types.h"
#include "vcalsrvgprot.h"
#include "gui_typedef.h"
#include "mmi_rp_app_alarm_def.h"
#include "wgui_categories_popup.h"
#include "custom_events_notify.h"
#include "stdio.h"
#include "TimerEvents.h"
#include "mmi_frm_timer_gprot.h"
#include "AlarmDef.h"
#include "wgui_categories_text_viewer.h"
#include "ImeGprot.h"
#include "PhoneBookGprot.h"
#include "CustDataProts.h"
#include "CustMenuRes.h"
#include "wgui_inputs.h"
#include "SettingGenum.h"
#include "wgui_touch_screen.h"
#include "CommonScreens.h"
#include "kal_general_types.h"
#include "kal_public_api.h"
#include "mmi_common_app_trc.h"
#include "IndianCalendarDef.h"
#include "gui_effect_oem.h"
#include "SmsSrvGprot.h"
#include "Fseditorcuigprot.h" 
#include "AlarmFrameworkProt.h"
#include "AlarmProt.h"
#include "BirthdayProt.h"
#include "ToDoListGprot.h"
#include "AlarmGprot.h"
#include "vCalendar.h"
#include "vObjects.h"
#include "BootupSrvGprot.h"
#include "app_datetime.h"
#include "mmi_rp_app_calendar_def.h"
#include "mmi_rp_srv_vcalendar_def.h"
#include "mmi_rp_srv_vobject_def.h"
#include "Menucuigprot.h"
#include "ToDoListDB.h"
#include "CalendarProt.h"
#include "AlarmProt.h"
#include "BirthdayProt.h"
#include "Inlinecuigprot.h"
#ifdef __SYNCML_SUPPORT__
#include "Mmi_rp_srv_syncml_def.h" 
#endif
#ifdef __J2ME__
#include "j2me_custom_option.h"
#endif
#ifdef __SYNCML_SUPPORT__
#include "SyncMLGProt.h"
#endif 
#include "SettingDefs.h"
#ifdef __MMI_VCALENDAR__
#include "mmi_rp_srv_vcalendar_def.h"
#endif
#include "mdi_audio.h"
#include "SecSetCuiGprot.h"

#include "remindersrvgprot.h"
#include "mmi_rp_srv_reminder_def.h"
#ifdef __MMI_SCREEN_LOCK_ANY_TIME__
#include "ScrLockerGprot.h"
#endif  


/*****************************************************************************
 * Define
 *****************************************************************************/
#define MMI_TDL_TRACE0(sub_grp) \
		MMI_TRACE(MMI_COMMON_TRC_G2_ORG, sub_grp)

#define MMI_TDL_TRACE1(sub_grp, arg) \
		MMI_TRACE(MMI_COMMON_TRC_G2_ORG, sub_grp, arg)
		
#define MMI_TDL_TRACE2(sub_grp, arg1, arg2) \
		MMI_TRACE(MMI_COMMON_TRC_G2_ORG, sub_grp, arg1, arg2)

#define MMI_TDL_TRACE3(sub_grp, arg1, arg2, arg3) \
		MMI_TRACE(MMI_COMMON_TRC_G2_ORG, sub_grp, arg1, arg2, arg3)



tdl_context_struct g_tdl_cntx;

static mmi_ret mmi_tdl_reminder_group_proc(mmi_event_struct* evt);
static void mmi_tdl_copy_reminder_content(CHAR *buffer, U16 reminder_type);
static void mmi_tdl_entry_reminder_int(void);

#ifdef __MMI_TODOLIST__

/***************************************************************************** 
* Global Variable
*****************************************************************************/


/*****************************************************************************
 * Local Variable
 *****************************************************************************/ 


/*****************************************************************************
 * Local Function
 *****************************************************************************/
static void mmi_tdl_entry_jump_to_date(void);
static void mmi_tdl_validate_input(mmi_id inline_gid);
static void mmi_tdl_entry_jump_date_task_list(void);
static void mmi_tdl_entry_goto_date_option(void);
static void mmi_tdl_view_undone_task(void);
static void mmi_tdl_entry_view_undone_option(void);
static void mmi_tdl_entry_task_view_all_int(void);
#ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
static void mmi_tdl_entry_task_popup_callback(mmi_id parent_id);
#endif/*__MMI_SYNCML_SYNC_TASK_SUPPORT__*/
static void mmi_tdl_jump_date_back(void);
static mmi_ret mmi_tdl_option_group_proc(mmi_event_struct* evt);
static void mmi_tdl_option_menu_cui_entry_hdlr(cui_menu_event_struct *menu_evt);
static void mmi_tdl_option_menu_cui_select_hdlr(cui_menu_event_struct *menu_evt);
static void mmi_tdl_option_menu_cui_highlight_hdlr(cui_menu_event_struct *menu_evt);
static mmi_ret mmi_tdl_view_undone_option_group_proc(mmi_event_struct* evt);
static void mmi_tdl_view_undone_opt_menu_select_hdlr(cui_menu_event_struct *menu_evt);
static mmi_ret mmi_tdl_goto_date_option_group_proc(mmi_event_struct* evt);
static mmi_ret mmi_tdl_jump_proc(mmi_event_struct *evt);
static void mmi_tdl_goto_date_opt_menu_select_hdlr(cui_menu_event_struct *menu_evt);
/*****************************************************************************
 * Global Variable
 *****************************************************************************/

extern const cui_inline_set_item_struct cui_jump_to_date;

/*****************************************************************************
 * Global Function
 *****************************************************************************/
/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_menu
 * DESCRIPTION
 *  Highlight handler of To Do List menu item.
 *  Register key handlers.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    SetLeftSoftkeyFunction(mmi_tdl_entry_task_view_all, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(mmi_tdl_entry_task_view_all, KEY_EVENT_UP);    
    SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_view
 * DESCRIPTION
 *  Highlight handler of View option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_VIEW;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_edit
 * DESCRIPTION
 *  Highlight handler of Edit option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_edit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_EDIT;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_add
 * DESCRIPTION
 *  Highlight handler of Add option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_add(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_ADD;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_delete
 * DESCRIPTION
 *  Highlight handler of Delete option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_delete(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_delete_all
 * DESCRIPTION
 *  Highlight handler of Delete All option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_delete_all(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE_ALL;
    if (mmi_frm_scrn_is_present(GRP_ID_TDL_MAIN, SCR_ID_TDL_VIEW_UNDONE, MMI_FRM_NODE_ALL_FLAG) ||
        mmi_frm_scrn_is_present(GRP_ID_TDL_MAIN, SCR_ID_TDL_JUMP_TO_DATE_TASK_LIST, MMI_FRM_NODE_ALL_FLAG) ||
        mmi_frm_scrn_is_present(GRP_ID_TDL_MAIN, SCR_ID_TDL_SEARCH_RES_LIST, MMI_FRM_NODE_ALL_FLAG))
    {
//        SetLeftSoftkeyFunction(mmi_tdl_delete_all_searched_confirm, KEY_EVENT_UP);
//        SetCenterSoftkeyFunction(mmi_tdl_delete_all_searched_confirm, KEY_EVENT_UP);                            
    }
    else
    {
//        SetLeftSoftkeyFunction(mmi_tdl_delete_all_confirm, KEY_EVENT_UP);
//        SetCenterSoftkeyFunction(mmi_tdl_delete_all_confirm, KEY_EVENT_UP);                                    
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_task_view_all
 * DESCRIPTION
 *  Entry function of task view all application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_entry_task_view_all(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/ 
    mmi_tdl_main_group_data_struct *main_group_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
#ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
    if (mmi_syncml_is_task_sync_now())
    {
        mmi_popup_display_simple(
            (WCHAR*)(get_string(STR_ID_SYNC_CODE_FORBIDDEN)), 
            MMI_EVENT_FAILURE, 
            GRP_ID_ROOT, 
            NULL);
        return;
    }
#endif /* __MMI_SYNCML_SYNC_TASK_SUPPORT__ */

    set_inline_date_boundary(MMI_TDL_END_YEAR_SUPPORT, MMI_TDL_START_YEAR_SUPPORT, 12, 1);

    main_group_cntx = (mmi_tdl_main_group_data_struct*)OslMalloc(sizeof(mmi_tdl_main_group_data_struct));
    mmi_frm_group_create_ex(GRP_ID_ROOT,GRP_ID_TDL_MAIN,
        mmi_tdl_task_main_group_proc,main_group_cntx,MMI_FRM_NODE_SMART_CLOSE_FLAG);
    mmi_tdl_entry_task_view_all_int();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_launch
 * DESCRIPTION
 *  Entry function of task view all application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_ID mmi_tdl_launch(void* param, U32 param_size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/ 
    mmi_tdl_main_group_data_struct *main_group_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
#ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
    if (mmi_syncml_is_task_sync_now())
    {
        mmi_popup_display_simple(
            (WCHAR*)(get_string(STR_ID_SYNC_CODE_FORBIDDEN)), 
            MMI_EVENT_FAILURE, 
            GRP_ID_ROOT, 
            NULL);
        return GRP_ID_INVALID;
    }
#endif /* __MMI_SYNCML_SYNC_TASK_SUPPORT__ */

    set_inline_date_boundary(MMI_TDL_END_YEAR_SUPPORT, MMI_TDL_START_YEAR_SUPPORT, 12, 1);

    main_group_cntx = (mmi_tdl_main_group_data_struct*)OslMalloc(sizeof(mmi_tdl_main_group_data_struct));
    mmi_frm_group_create_ex(GRP_ID_ROOT,GRP_ID_TDL_MAIN,
        mmi_tdl_task_main_group_proc,main_group_cntx,MMI_FRM_NODE_SMART_CLOSE_FLAG);
    mmi_tdl_entry_task_view_all_int();
    
    return GRP_ID_TDL_MAIN;
}


static MMI_BOOL  mmi_tdl_get_task_flags(S32 index, U32* flag, U32* flag_ext)
{
	/*----------------------------------------------------------------*/
	/* Local Variables												  */
	/*----------------------------------------------------------------*/	
	srv_tdl_task_short_struct *ptask;
    //U16  ret;

	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
    mmi_tdl_make_all_list(
                    g_tdl_cntx.sorted_list, 
                    NUM_OF_TDL, 
                    &g_tdl_cntx.total, 
                    SRV_TDL_VCAL_TASK);
	//ret = srv_tdl_get_cache(
	srv_tdl_get_cache(
			(void*)&ptask, 
			sizeof(srv_tdl_task_short_struct), 
			SRV_TDL_VCAL_TASK,
			g_tdl_cntx.sorted_list[index].index);
	if(ptask->status != 0)
	{
	     *flag_ext |= UI_MENUITEM_EXT_SHOW_DISABLED;
		 return MMI_TRUE;
	}
	return MMI_FALSE;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_task_view_all_int
 * DESCRIPTION
 *  Exit function of task view all application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_entry_task_view_all_int(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    U8 *gui_buff;
    U16 lsk_string = STR_GLOBAL_OPTIONS;
    S32 highlight_item = 0;
    U16 j, curr_index;
#ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
    mmi_popup_property_struct arg;  
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
    if (mmi_syncml_is_task_sync_now())
    {
        mmi_popup_property_init(&arg);  
        arg.parent_id = GRP_ID_TDL_MAIN; 
        arg.callback = (mmi_proc_func)mmi_tdl_popup_proc; 

        mmi_tdl_popup_user_data_init(&g_tdl_popup_user_data);
        g_tdl_popup_user_data.sg_id = GRP_ID_TDL_MAIN;
        g_tdl_popup_user_data.callback_function = mmi_tdl_entry_task_popup_callback;
        arg.user_tag = (void*)&g_tdl_popup_user_data;
        mmi_popup_display((WCHAR*)(get_string(STR_ID_SYNC_CODE_FORBIDDEN)), MMI_EVENT_FAILURE, &arg);
        return;
    }
#endif /* __MMI_SYNCML_SYNC_TASK_SUPPORT__ */
    
    if (!mmi_frm_scrn_enter(
             GRP_ID_TDL_MAIN,
             SCR_TDL_TASK_ALL_LIST,
             NULL,
             mmi_tdl_entry_task_view_all_int,
             MMI_FRM_FULL_SCRN))
    {
        return;
    }
        
    gui_buff = mmi_frm_scrn_get_active_gui_buf();    
    SetParentHandler(0);
    RegisterHighlightHandler(mmi_list_highlight_hdlr);
    mmi_frm_scrn_set_leave_proc(GRP_ID_TDL_MAIN, SCR_TDL_TASK_ALL_LIST, mmi_tdl_task_main_leave_proc);
    
    g_tdl_cntx.vcal_filter = SRV_TDL_VCAL_TASK;
    
    mmi_tdl_make_all_list(
                        g_tdl_cntx.sorted_list, 
                        NUM_OF_TDL, 
                        &g_tdl_cntx.total, 
                        SRV_TDL_VCAL_TASK);
       

    if (g_tdl_cntx.total == 0) /* Display <Empty> */
    {    
        lsk_string = STR_GLOBAL_ADD;        
    }
    else /* Display list of task */
    {
        if (g_tdl_cntx.curr_option == TODO_LIST_TASK_OPTION_ADD && 
            g_tdl_cntx.add_finish_flag)
        {
            gui_buff = NULL;
            curr_index = g_tdl_cntx.curr_store_idx;

            for (j = 0; j < g_tdl_cntx.total; j++)
            {
                if (g_tdl_cntx.sorted_list[j].index == curr_index)
                {
                    g_tdl_cntx.curr_selected = j;
                    break;
                }
            }

            highlight_item = g_tdl_cntx.curr_selected;
            g_tdl_cntx.curr_option = TODO_LIST_OPTION_TOTAL;
            g_tdl_cntx.add_finish_flag =  MMI_FALSE;
        }    
    }

    mmi_ucs2ncpy(g_tdl_edit_cntx.title_buff, 
                 GetString(STR_ID_TDL_TASKS), 
                 MMI_TDL_MAX_TITLE_BUF_SIZE - 1);

    g_tdl_cntx.async_item_type = MMI_TDL_ASYNC_ALL;

    EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);

    wgui_fixed_list_register_get_flags_handler(mmi_tdl_get_task_flags);

#ifdef __MMI_FTE_SUPPORT__  
    ShowCategory85Screen(
        (U8*)g_tdl_edit_cntx.title_buff,
        GetRootTitleIcon(ORGANIZER_TODOLIST_MENU),
        lsk_string,
        0,
        STR_GLOBAL_BACK,
        0,
        g_tdl_cntx.total,
        mmi_tdl_get_async_items,
        NULL,
        highlight_item,
        IMG_TODO_LIST_ICON_REMINDER,
        IMG_TODO_LIST_ICON_REMINDER,
        IMG_TODO_LIST_ICON_ALARM,
        gui_buff);
#else
	ShowCategory85Screen(
		(U8*)g_tdl_edit_cntx.title_buff,
		GetRootTitleIcon(ORGANIZER_TODOLIST_MENU),
		lsk_string,
		0,
		STR_GLOBAL_BACK,
		0,
		g_tdl_cntx.total,
		mmi_tdl_get_async_items,
		NULL,
		highlight_item,
		IMG_TODO_LIST_ICON_REMINDER,
		IMG_TODO_LIST_ICON_REMINDER,	
		0,
		gui_buff);
#endif

    if (g_tdl_cntx.total == 0)
    {
        SetLeftSoftkeyFunction(mmi_tdl_entry_add_hdlr, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(mmi_tdl_entry_add_hdlr, KEY_EVENT_UP);          
    }
    else
    {
    #ifdef __MMI_TOUCH_SCREEN__
        wgui_register_tap_callback(mmi_tdl_tap_list_callback);
    #endif
        ChangeLeftSoftkey(STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);
        SetCenterSoftkeyFunction(mmi_tdl_entry_view_hdlr, KEY_EVENT_UP); 
        SetLeftSoftkeyFunction(mmi_tdl_entry_option_list, KEY_EVENT_UP);        
    }
    SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_task_popup_callback
 * DESCRIPTION
 *  Show task type list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
static void mmi_tdl_entry_task_popup_callback(mmi_id parent_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_close(parent_id);
}
#endif/*__MMI_SYNCML_SYNC_TASK_SUPPORT__*/


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_task_main_group_proc
 * DESCRIPTION
 *  Exit function of task view all application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_tdl_task_main_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_tdl_main_group_data_struct *main_group_cntx;
    cui_tdl_save_result_struct *tdl_save_evt = (cui_tdl_save_result_struct*)evt;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    main_group_cntx = (mmi_tdl_main_group_data_struct*)mmi_frm_group_get_user_data(GRP_ID_TDL_MAIN);
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_FIRST_ENTRY:
            break;
            
        case EVT_ID_GROUP_INACTIVE:
            break;
            
        case EVT_ID_GROUP_ACTIVE:
            break;
            
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_DELETE_REQ:
            break;
            
        case EVT_ID_GROUP_DEINIT:
        {
            if (main_group_cntx)
            {
                OslMfree(main_group_cntx);
            }
            break;
        }   
        case EVT_ID_GROUP_FOCUSED:
            break;
            
        case EVT_ID_TDL_SAVE_SUCCESS:
        case EVT_ID_TDL_SAVE_CANCEL:        
        case EVT_ID_TDL_SAVE_FAIL:
        {
            cui_tdl_save_close(tdl_save_evt->sender_id);
            break;
        }
    #ifdef __MMI_VCALENDAR__        
        case EVT_ID_CUI_VCAL_FAIL:
        case EVT_ID_CUI_VCAL_SUCCESS:
        case EVT_ID_CUI_VCAL_FAIL_NOT_ENOUGH_MEMORY:
        case EVT_ID_CUI_VCAL_USER_CANCEL:
        {
            mmi_group_event_struct *evt_send = (mmi_group_event_struct*)evt;
            cui_vcal_save_to_file_close(evt_send->sender_id);
            break;
        }
    #endif /* __MMI_VCALENDAR__ */  
        default:
            break;
    }
 
    return MMI_RET_OK;    
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_option_list
 * DESCRIPTION
 *  Show option list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_entry_option_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_id parent_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    parent_id = mmi_tdl_sg_mgr_get_current_sg_id();
    if ((GRP_ID_CAL_MAIN != parent_id) && (GRP_ID_TDL_MAIN != parent_id))
    {
        return;
    }
    
    mmi_clndr_set_swith_mode_flag(MMI_FALSE);
    mmi_entry_list_option(parent_id, MITEM_TODO_LIST_TASK_OPTION_1, mmi_tdl_option_group_proc);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_option_group_proc
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_tdl_option_group_proc(mmi_event_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
    mmi_tdl_common_group_data_struct *opt_user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    opt_user_data = (mmi_tdl_common_group_data_struct*)evt->user_data;
    switch(menu_evt->evt_id)
    {
        case EVT_ID_GROUP_DEINIT:
        {
            OslMfree(opt_user_data);
            break;
        }
        case EVT_ID_CUI_MENU_LIST_ENTRY:
            mmi_tdl_option_menu_cui_entry_hdlr(menu_evt);
            break;
        case EVT_ID_CUI_MENU_ITEM_HILITE:
            mmi_tdl_option_menu_cui_highlight_hdlr(menu_evt);
            break;
            
        case EVT_ID_CUI_MENU_ITEM_SELECT:
            mmi_tdl_option_menu_cui_select_hdlr(menu_evt);
            break;

        case EVT_ID_CUI_MENU_CLOSE_REQUEST:
            cui_menu_close(opt_user_data->child_id);
            mmi_frm_group_close(opt_user_data->group_id);
            break;
    }
    return MMI_RET_OK;        
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_option_menu_cui_entry_hdlr
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_option_menu_cui_entry_hdlr(cui_menu_event_struct *menu_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/  
    mmi_tdl_common_group_data_struct *opt_user_data = menu_evt->user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (menu_evt->parent_menu_id)
    {
#ifdef __MMI_VCALENDAR__
        case MENU_VCLNDR_FORWARD:
            cui_menu_set_default_title(
                        opt_user_data->child_id, 
                        get_string(STR_ID_VCLNDR_FORWARD),
                        get_image(ORGANIZER_TITLE_IMAGEID));
            break;
#endif 
#ifdef __MMI_TODO_SEARCH__
        case MITEM_TODO_LIST_SEARCH:
            cui_menu_set_default_title(
                        opt_user_data->child_id, 
                        get_string(STR_GLOBAL_SEARCH),
                        get_image(ORGANIZER_TITLE_IMAGEID));
            break;
#endif
        default:
            cui_menu_set_default_title(
                menu_evt->sender_id, 
                (WCHAR*)get_string(STR_GLOBAL_OPTIONS), 
                (UI_image_type)get_image(GetRootTitleIcon(ORGANIZER_TODOLIST_MENU)));
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_option_menu_cui_highlight_hdlr
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_option_menu_cui_highlight_hdlr(cui_menu_event_struct *menu_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/  
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_TODO_SEARCH__

    switch (menu_evt->highlighted_menu_id)
    {
        case MITEM_TODO_LIST_SEARCH:
            cui_menu_set_item_hidden(
                    menu_evt->sender_id, 
                    MITEM_TODO_LIST_SEARCH_BY_LOC, 
                    MMI_TRUE);
            break;
            
        default:
            break;
    }
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_option_menu_cui_select_hdlr
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_option_menu_cui_select_hdlr(cui_menu_event_struct *menu_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    mmi_tdl_common_group_data_struct *opt_user_data = menu_evt->user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 
    g_tdl_cntx.curr_store_idx = mmi_tdl_get_curr_store_idx(); 

    srv_tdl_get(&g_tdl_cntx.curr_task, sizeof(srv_tdl_task_struct), SRV_TDL_VCAL_TASK, g_tdl_cntx.curr_store_idx);

    switch (menu_evt->highlighted_menu_id)
    {
        case MITEM_TODO_LIST_VIEW:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_VIEW;

            mmi_tdl_view_with_sg(
                        opt_user_data->parent_id, 
                        g_tdl_cntx.vcal_filter, 
                        0,
                        g_tdl_cntx.curr_store_idx);        
            break;
        }   
        case MITEM_TODO_LIST_ADD:
        {        
            MYTIME curr_time;
            mmi_tdl_main_group_data_struct *tdl_main_group_cntx;

            tdl_main_group_cntx = mmi_frm_group_get_user_data(GRP_ID_TDL_MAIN);
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_ADD;
            GetDateTime(&curr_time);
            curr_time.nMin = 0;
            curr_time.nSec = 0;
            tdl_main_group_cntx->cui_tdl_save_gid = cui_tdl_save_create(GRP_ID_TDL_MAIN);
            cui_tdl_save_set_due_time(tdl_main_group_cntx->cui_tdl_save_gid, &curr_time);
            cui_tdl_save_set_operation_type(tdl_main_group_cntx->cui_tdl_save_gid, MMI_TDL_OP_TYPE_ADD);
            cui_tdl_save_set_title(tdl_main_group_cntx->cui_tdl_save_gid, STR_GLOBAL_ADD);
            cui_tdl_save_run(tdl_main_group_cntx->cui_tdl_save_gid);
            break;
        }   
        case MITEM_TODO_LIST_EDIT:
        {
            mmi_tdl_main_group_data_struct *tdl_main_group_cntx;
        
            tdl_main_group_cntx = mmi_frm_group_get_user_data(GRP_ID_TDL_MAIN);
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_EDIT;
          
            tdl_main_group_cntx->cui_tdl_save_gid = cui_tdl_save_create(GRP_ID_TDL_MAIN);
            cui_tdl_save_set_operation_type(tdl_main_group_cntx->cui_tdl_save_gid, MMI_TDL_OP_TYPE_EDIT);
            cui_tdl_save_set_title(tdl_main_group_cntx->cui_tdl_save_gid, STR_GLOBAL_EDIT);
            cui_tdl_save_set_task(tdl_main_group_cntx->cui_tdl_save_gid, &g_tdl_cntx.curr_task);                
            cui_tdl_save_run(tdl_main_group_cntx->cui_tdl_save_gid);
            break;
        }       
        case MITEM_TODO_LIST_DELETE:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE;
            mmi_tdl_entry_delete_confirm(opt_user_data->parent_id);        
            break;
        }   
        case MITEM_TODO_LIST_DELETE_ALL_OVERDUE:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE_OVERDUE;
            mmi_tdl_delete_overdue_confirm(opt_user_data->parent_id);        
            break;
        }   
        case MITEM_TODO_LIST_DELETE_ALL:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE_ALL;
            mmi_tdl_delete_all_confirm(opt_user_data->parent_id);
            break;
        }   
        case MITEM_TODO_LIST_JUMP_TO_DATE:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_JUMP_TO_DATE;
            mmi_frm_scrn_close(GRP_ID_TDL_GOTO_DATE, SCR_TDL_CAL_DAILY_LIST);
            mmi_tdl_entry_jump_to_date();
            break;
        }   
        case MITEM_TODO_LIST_VIEW_UNDONE:
        {
            mmi_tdl_view_undone_task();
            break;
        }   
    #ifdef __MMI_VCALENDAR__
    #ifndef __MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__
        case MENU_VCLNDR_SEND_BY_SMS:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_SMS;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_MMS__
        case MENU_VCLNDR_SEND_BY_MMS:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_MMS;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_EMAIL__
        case MENU_VCLNDR_SEND_BY_EMAIL:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_EMAIL;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_OPP_SUPPORT__
        case MENU_VCLNDR_SEND_BY_BT:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_OPP;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif        
    #ifdef __MMI_FILE_MANAGER__
        case MENU_VCLNDR_SEND_BY_FILEMGR:
        {
            mmi_id sg_id;
            cui_vcal_save_to_file_param_struct param;
            sg_id = cui_vcal_save_to_file_create(opt_user_data->parent_id); 
            param.para_type = MMI_VCAL_TYPE_BUFF;
            param.u.obj.vcal_type = SRV_VCAL_VTODO;
            param.u.obj.buff = &g_tdl_cntx.curr_task;
            cui_vcal_save_to_file_set_para(sg_id, param);            
            cui_vcal_save_to_file_run(sg_id);
            break;
        }
    #endif /* __MMI_FILE_MANAGER__ */
    #endif /* __MMI_VCALENDAR__ */
#ifdef __MMI_TODO_SEARCH__

        case MITEM_TODO_LIST_SEARCH_BY_TIME:
            mmi_tdl_entry_search_by_time();
            break;
            
        case MITEM_TODO_LIST_SEARCH_BY_NOTE:
            mmi_tdl_entry_search_by_note();
            break;
            
        case MITEM_TODO_LIST_SEARCH_BY_LOC:
            mmi_tdl_entry_search_by_location();
            break;
#endif
        default:
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_add_hdlr
 * DESCRIPTION
 *  Show task type list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_entry_add_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_id sg_id, parent_id = mmi_tdl_sg_mgr_get_current_sg_id();
    MYTIME curr_time;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_ADD;
    if (srv_tdl_is_full(SRV_TDL_VCAL_TASK))
    {  
        mmi_popup_display_simple(
            (WCHAR*)(get_string(STR_TODO_LIST_LIST_FULL_MSG)), 
            MMI_EVENT_FAILURE, 
            GRP_ID_ROOT, 
            NULL);
        return;
    }
    
    GetDateTime(&curr_time);
    curr_time.nMin = 0;
    curr_time.nSec = 0;
    
    sg_id = cui_tdl_save_create(parent_id);
    cui_tdl_save_set_due_time(sg_id, &curr_time);
    cui_tdl_save_set_operation_type(sg_id, MMI_TDL_OP_TYPE_ADD);
    cui_tdl_save_set_title(sg_id, STR_GLOBAL_ADD);
    cui_tdl_save_run(sg_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_delete_overdue
 * DESCRIPTION
 *  Highlight handler of Delete overdue option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_delete_overdue(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE_OVERDUE;
    
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
//    SetLeftSoftkeyFunction(mmi_tdl_delete_overdue_confirm, KEY_EVENT_UP);
//    SetCenterSoftkeyFunction(mmi_tdl_delete_overdue_confirm, KEY_EVENT_UP);    
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP); 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_jump_to_date
 * DESCRIPTION
 *	Entry function for jump to date menu 
 * PARAMETERS
 *  
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_tdl_entry_jump_to_date(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    cui_inline_struct inline_data;
    cui_inline_item_date_time_struct date;
    mmi_tdl_jump_group_data_struct *jump_group_data;
    MYTIME curr_time;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_group_is_present(GRP_ID_TDL_GOTO_DATE))
    {
        mmi_frm_group_close(GRP_ID_TDL_GOTO_DATE);
    }
    jump_group_data = (mmi_tdl_jump_group_data_struct*)OslMalloc(sizeof(mmi_tdl_jump_group_data_struct));
    jump_group_data->parent_id = GRP_ID_TDL_MAIN;
    jump_group_data->group_id = mmi_frm_group_create(
                                            GRP_ID_TDL_MAIN,
                                            GRP_ID_TDL_GOTO_DATE,
                                            mmi_tdl_jump_proc,
                                            jump_group_data);
    mmi_frm_group_enter(
                    GRP_ID_TDL_GOTO_DATE,
                    MMI_FRM_NODE_SMART_CLOSE_FLAG);

    inline_data.items_count = 2;
    inline_data.title = STR_CLNDR_JUMP_TO;
    inline_data.title_icon = GetRootTitleIcon(ORGANIZER_TODOLIST_MENU);
    inline_data.screen_flag = CUI_INLINE_SCREEN_DISABLE_DONE;
    inline_data.softkey = NULL;
    inline_data.items = &cui_jump_to_date;

    jump_group_data->cui_inline_gid = cui_inline_create(
                                            GRP_ID_TDL_GOTO_DATE,
                                            &inline_data);

    if (jump_group_data->cui_inline_gid != GRP_ID_INVALID)
    {
        GetDateTime(&curr_time);
        memset(&date, 0, sizeof(cui_inline_item_date_time_struct));
        date.year = curr_time.nYear;
        date.month = curr_time.nMonth;
        date.day = curr_time.nDay;
        
        cui_inline_set_value(
                jump_group_data->cui_inline_gid, 
                CUI_INLINE_ITEM_ID_BASE + 1, 
                &date);
        cui_inline_run(jump_group_data->cui_inline_gid);
    }
    else
    {
        mmi_frm_group_close(GRP_ID_TDL_GOTO_DATE);

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_jump_proc
 * DESCRIPTION
 *  Exit function of task view all application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_tdl_jump_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    mmi_tdl_jump_group_data_struct *jump_group_data = evt->user_data;
    cui_tdl_save_result_struct *tdl_save_evt = (cui_tdl_save_result_struct*)evt;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_CUI_INLINE_SUBMIT:
        case EVT_ID_CUI_INLINE_CSK_PRESS:
        {
            mmi_tdl_validate_input(jump_group_data->cui_inline_gid);
            cui_inline_close(jump_group_data->cui_inline_gid);
            break;
        }   
        case EVT_ID_CUI_INLINE_ABORT:
        {
            mmi_frm_group_close(GRP_ID_TDL_GOTO_DATE);
            break;
        }   
        case EVT_ID_TDL_SAVE_FAIL:
        case EVT_ID_TDL_SAVE_CANCEL:        
        case EVT_ID_TDL_SAVE_SUCCESS:
        {
            cui_tdl_save_close(tdl_save_evt->sender_id);
            cui_cal_save_close(tdl_save_evt->sender_id);
            break;
        }
    #ifdef __MMI_VCALENDAR__
        case EVT_ID_CUI_VCAL_FAIL:
        case EVT_ID_CUI_VCAL_SUCCESS:
        case EVT_ID_CUI_VCAL_FAIL_NOT_ENOUGH_MEMORY:
        case EVT_ID_CUI_VCAL_USER_CANCEL:
        {
            mmi_group_event_struct *evt_send = (mmi_group_event_struct*)evt;
            cui_vcal_save_to_file_close(evt_send->sender_id);
            break;
        }        
    #endif /* __MMI_VCALENDAR__ */
        case EVT_ID_GROUP_GOBACK:
        case EVT_ID_GROUP_DELETE_REQ:
            break;
            
        case EVT_ID_GROUP_DEINIT:
            break;
            
        case EVT_ID_GROUP_FOCUSED:
            break;
        default:
            break;
    }
 
    return MMI_RET_OK;    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_validate_input
 * DESCRIPTION
 *	Check if the date out of boundary
 * PARAMETERS
 *  
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_tdl_validate_input(mmi_id inline_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_inline_item_date_time_struct date;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(inline_gid, CUI_INLINE_ITEM_ID_BASE + 1, &date);
            
    g_tdl_cntx.date.nDay = (U8)date.day;
    g_tdl_cntx.date.nMonth = (U8)date.month;
    g_tdl_cntx.date.nYear = date.year;
    g_tdl_cntx.date.nHour = 23;
    g_tdl_cntx.date.nMin = 59;
    g_tdl_cntx.date.nSec = 59;
    mmi_tdl_entry_jump_date_task_list();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_jump_date_task_list
 * DESCRIPTION
 *  Show the task list for special date.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_entry_jump_date_task_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer;
    U16 lsk_string = STR_GLOBAL_OPTIONS;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!mmi_frm_scrn_enter(
                    GRP_ID_TDL_GOTO_DATE,
                    SCR_ID_TDL_JUMP_TO_DATE_TASK_LIST,
                    NULL,
                    mmi_tdl_entry_jump_date_task_list,
                    MMI_FRM_FULL_SCRN))
    {
        return;
    }
    gui_buffer = mmi_frm_scrn_get_active_gui_buf();
    
    SetParentHandler(0);
    
    mmi_tdl_make_daily_list_ext( 
                            g_tdl_cntx.sorted_list, 
                            &g_tdl_cntx.total,
                            NUM_OF_TDL, 
                            g_tdl_cntx.date,
                            SRV_TDL_VCAL_TASK);

    mmi_tdl_get_date_string(
                    &g_tdl_cntx.date,
                    g_tdl_edit_cntx.title_buff,
                    MMI_TDL_MAX_TITLE_BUF_SIZE * ENCODING_LENGTH);
    
	RegisterHighlightHandler(mmi_list_highlight_hdlr);
	
	if (g_tdl_cntx.total == 0) /* display <Empty> */
    {
        lsk_string = 0;
    }

    g_tdl_cntx.async_item_type = MMI_TDL_ASYNC_DAILY;

    EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK); 
	
#ifdef __MMI_FTE_SUPPORT__  
    ShowCategory85Screen(
            (U8*)g_tdl_edit_cntx.title_buff,
            GetRootTitleIcon(ORGANIZER_TODOLIST_MENU),
            lsk_string,
            0,
            STR_GLOBAL_BACK,
            0,
            g_tdl_cntx.total,
            mmi_tdl_get_async_items,
            NULL,
            0,
            IMG_TODO_LIST_ICON_REMINDER,
            IMG_TODO_LIST_ICON_REMINDER,
            IMG_TODO_LIST_ICON_ALARM,
            gui_buffer);
#else
	ShowCategory85Screen(
			(U8*)g_tdl_edit_cntx.title_buff,
			GetRootTitleIcon(ORGANIZER_TODOLIST_MENU),
			lsk_string,
			0,
			STR_GLOBAL_BACK,
			0,
			g_tdl_cntx.total,
			mmi_tdl_get_async_items,
			NULL,
			0,
			IMG_TODO_LIST_ICON_REMINDER,
			IMG_TODO_LIST_ICON_REMINDER,	 
			0,		 
			gui_buffer);
#endif

    if (g_tdl_cntx.total > 0)
    {
#ifdef __MMI_TOUCH_SCREEN__
        wgui_register_tap_callback(mmi_tdl_tap_list_callback);
#endif /* __MMI_TOUCH_SCREEN__ */
        ChangeLeftSoftkey(STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);
        SetLeftSoftkeyFunction(mmi_tdl_entry_goto_date_option, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(mmi_tdl_entry_view_hdlr, KEY_EVENT_UP);     
    }
    else
    {
        ChangeCenterSoftkey(0, 0);
    }

    SetRightSoftkeyFunction(mmi_tdl_jump_date_back, KEY_EVENT_UP);
}
     

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_jump_date_back
 * DESCRIPTION
 *  Jump date task list highlight handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_jump_date_back(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_close(GRP_ID_TDL_GOTO_DATE);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_goto_date_option
 * DESCRIPTION
 *  Entry task list option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_entry_goto_date_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_entry_list_option(GRP_ID_TDL_GOTO_DATE,
                          MITEM_TODO_LIST_TASK_OPTION_GOTO_DATE,
                          mmi_tdl_goto_date_option_group_proc);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_goto_date_option_group_proc
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_tdl_goto_date_option_group_proc(mmi_event_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
    mmi_tdl_common_group_data_struct *opt_user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    opt_user_data = (mmi_tdl_common_group_data_struct*)evt->user_data;
    switch(menu_evt->evt_id)
    {
        case EVT_ID_GROUP_DEINIT:
        {
            OslMfree(opt_user_data);
            break;
        }    
        case EVT_ID_CUI_MENU_ITEM_SELECT:
            mmi_tdl_goto_date_opt_menu_select_hdlr(menu_evt);
            break;

        case EVT_ID_CUI_MENU_CLOSE_REQUEST:
            cui_menu_close(opt_user_data->child_id);
            mmi_frm_group_close(opt_user_data->group_id);
            break;
    }
    return MMI_RET_OK;        
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_goto_date_opt_menu_select_hdlr
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_goto_date_opt_menu_select_hdlr(cui_menu_event_struct *menu_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    mmi_tdl_common_group_data_struct *opt_user_data = menu_evt->user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 
    g_tdl_cntx.curr_store_idx = mmi_tdl_get_curr_store_idx();
	srv_tdl_get(
		(void*)&g_tdl_cntx.curr_task, 
		sizeof(srv_tdl_task_struct), 
		SRV_TDL_VCAL_TASK,
		g_tdl_cntx.curr_store_idx);

    switch (menu_evt->highlighted_menu_id)
    {
        case MITEM_TODO_LIST_VIEW:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_VIEW;
            mmi_tdl_view_with_sg(
                        opt_user_data->parent_id, 
                        SRV_TDL_VCAL_TASK, 
                        0,
                        g_tdl_cntx.curr_store_idx);        
            break;
        }   
        case MITEM_TODO_LIST_EDIT:
        {
            mmi_tdl_jump_group_data_struct *tdl_goto_date_group_cntx;
        
            tdl_goto_date_group_cntx = mmi_frm_group_get_user_data(GRP_ID_TDL_GOTO_DATE);
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_EDIT;
            tdl_goto_date_group_cntx->cui_tdl_save_gid = cui_tdl_save_create(GRP_ID_TDL_GOTO_DATE);
            cui_tdl_save_set_operation_type(tdl_goto_date_group_cntx->cui_tdl_save_gid, MMI_TDL_OP_TYPE_EDIT);
            cui_tdl_save_set_title(tdl_goto_date_group_cntx->cui_tdl_save_gid, STR_GLOBAL_EDIT);
            cui_tdl_save_set_task(tdl_goto_date_group_cntx->cui_tdl_save_gid, &g_tdl_cntx.curr_task);                
            cui_tdl_save_run(tdl_goto_date_group_cntx->cui_tdl_save_gid);
            break;
        }       
        case MITEM_TODO_LIST_DELETE:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE;
            mmi_tdl_entry_delete_confirm(opt_user_data->parent_id);        
            break;
        }   
        case MITEM_TODO_LIST_DELETE_ALL:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE_ALL;
            mmi_tdl_delete_all_searched_confirm(opt_user_data->parent_id);
            break;
        }   
        case MITEM_TODO_LIST_JUMP_TO_DATE:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_JUMP_TO_DATE;
            mmi_tdl_entry_jump_to_date();
            break;
        }      
    #ifdef __MMI_VCALENDAR__
    #ifndef __MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__
        case MENU_VCLNDR_SEND_BY_SMS:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_SMS;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_MMS__
        case MENU_VCLNDR_SEND_BY_MMS:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_MMS;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_EMAIL__
        case MENU_VCLNDR_SEND_BY_EMAIL:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_EMAIL;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_OPP_SUPPORT__
        case MENU_VCLNDR_SEND_BY_BT:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_OPP;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif        
    #ifdef __MMI_FILE_MANAGER__
        case MENU_VCLNDR_SEND_BY_FILEMGR:
        {
            mmi_id sg_id;
            cui_vcal_save_to_file_param_struct param;
            
            sg_id = cui_vcal_save_to_file_create(opt_user_data->parent_id);
            param.para_type = MMI_VCAL_TYPE_BUFF;
            param.u.obj.vcal_type = SRV_VCAL_VTODO;
            param.u.obj.buff = &g_tdl_cntx.curr_task;
            cui_vcal_save_to_file_set_para(sg_id, param);            
            cui_vcal_save_to_file_run(sg_id);
            break;
        }
    #endif /* __MMI_FILE_MANAGER__ */
    #endif /* __MMI_VCALENDAR__ */
	     default:
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_highlight_view_undone
 * DESCRIPTION
 *  Highlight handler on view uncompleted option.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_highlight_view_undone(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
//    SetLeftSoftkeyFunction(mmi_tdl_view_undone_task, KEY_EVENT_UP);
//    SetCenterSoftkeyFunction(mmi_tdl_view_undone_task, KEY_EVENT_UP);    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_view_undone_task
 * DESCRIPTION
 *  Entry function of view uncompleted option.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_view_undone_task(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_tdl_search_filter_struct search_filter;
    U16 error_code;
    U8 *gui_buffer;
    GetAsyncItemFuncPtr create_menu_ptr;
    U16 lsk_string = STR_GLOBAL_OPTIONS; 
    U16 main_icon = IMG_TODO_LIST_ICON_REMINDER;
    U16 sub_icon = IMG_TODO_LIST_ICON_ALARM;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    search_filter.type = SRV_TDL_SEARCH_TYPE_STATUS;
    search_filter.u.status = MMI_TDL_STATUS_UNDONE;
    
    error_code = srv_tdl_search(
                        g_tdl_cntx.sorted_list,
                        NUM_OF_TDL,
                        SRV_TDL_VCAL_TASK,
                        search_filter,
                        &g_tdl_cntx.total);
                        
    if (error_code != SRV_TDL_RESULT_OK)                        
    {
        return;
    }
    g_tdl_cntx.search.type = search_filter.type;
    g_tdl_cntx.search.u.status = search_filter.u.status;

    error_code = srv_tdl_sort(
                        g_tdl_cntx.sorted_list,
                        g_tdl_cntx.total, 
                        SRV_TDL_SORT_TYPE_ENTRY_TIME);
                        
    if (error_code != SRV_TDL_RESULT_OK)
    {
        return;
    }

    g_tdl_cntx.async_item_type = MMI_TDL_ASYNC_ALL;
    create_menu_ptr = mmi_tdl_get_async_items;

    if (!mmi_frm_scrn_enter(
            GRP_ID_TDL_MAIN,
            SCR_ID_TDL_VIEW_UNDONE,
            NULL,
            mmi_tdl_view_undone_task,
            MMI_FRM_FULL_SCRN))
    {
        return;
    }
    gui_buffer = mmi_frm_scrn_get_active_gui_buf();
    SetParentHandler(0);
	mmi_ucs2ncpy(g_tdl_edit_cntx.title_buff, 
                 GetString(STR_TODO_LIST_VIEW_UNDONE), 
                 MMI_TDL_MAX_TITLE_BUF_SIZE - 1);	
                 
    RegisterHighlightHandler(mmi_list_highlight_hdlr);
    
    if (g_tdl_cntx.total == 0)
    {
        lsk_string = 0;
        main_icon = IMG_GLOBAL_OK;
        sub_icon = IMG_GLOBAL_OK;
	}

    EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);

#ifdef __MMI_FTE_SUPPORT__     
    ShowCategory85Screen(
            (U8*)g_tdl_edit_cntx.title_buff,
            GetRootTitleIcon(ORGANIZER_TODOLIST_MENU),
            lsk_string,
            0,
            STR_GLOBAL_BACK,
            0,
            g_tdl_cntx.total,
            create_menu_ptr,
            NULL,
            0,
            main_icon,
            main_icon,
            sub_icon,
            gui_buffer);
#else
	ShowCategory85Screen(
			(U8*)g_tdl_edit_cntx.title_buff,
			GetRootTitleIcon(ORGANIZER_TODOLIST_MENU),
			lsk_string,
			0,
			STR_GLOBAL_BACK,
			0,
			g_tdl_cntx.total,
			create_menu_ptr,
			NULL,
			0,
			main_icon,
			main_icon,
			0,
			gui_buffer);
#endif

    if (g_tdl_cntx.total > 0)
    {
#ifdef __MMI_TOUCH_SCREEN__
        wgui_register_tap_callback(mmi_tdl_tap_list_callback);
#endif /* __MMI_TOUCH_SCREEN__ */
        SetCenterSoftkeyFunction(mmi_tdl_entry_view_hdlr, KEY_EVENT_UP); 
    }
    else
    {
        ChangeCenterSoftkey(0, 0);
    }

    SetLeftSoftkeyFunction(mmi_tdl_entry_view_undone_option, KEY_EVENT_UP);
    SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
    return;                   
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_view_undone_option
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_entry_view_undone_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_entry_list_option(GRP_ID_TDL_MAIN,
                          MITEM_TODO_LIST_TASK_OPTION_VIEW_UNDONE,
                          mmi_tdl_view_undone_option_group_proc);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_view_undone_option_group_proc
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_tdl_view_undone_option_group_proc(mmi_event_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
    mmi_tdl_common_group_data_struct *opt_user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    opt_user_data = (mmi_tdl_common_group_data_struct*)evt->user_data;
    switch(menu_evt->evt_id)
    {
        case EVT_ID_GROUP_DEINIT:
        {
            OslMfree(opt_user_data);
            break;
        }    
        case EVT_ID_CUI_MENU_ITEM_SELECT:
        {
            mmi_tdl_view_undone_opt_menu_select_hdlr(menu_evt);
            break;
        }
        case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        {
            cui_menu_close(opt_user_data->child_id);
            mmi_frm_group_close(opt_user_data->group_id);
            break;
        }
        default:
            break;
    }
    return MMI_RET_OK;        
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_view_undone_opt_menu_select_hdlr
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_view_undone_opt_menu_select_hdlr(cui_menu_event_struct *menu_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    mmi_tdl_common_group_data_struct *opt_user_data = menu_evt->user_data;     
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/   
    g_tdl_cntx.curr_store_idx = mmi_tdl_get_curr_store_idx(); 
	srv_tdl_get(
		(void*)&g_tdl_cntx.curr_task, 
		sizeof(srv_tdl_task_struct), 
		SRV_TDL_VCAL_TASK,
		g_tdl_cntx.curr_store_idx);

    switch (menu_evt->highlighted_menu_id)
    {
        case MITEM_TODO_LIST_VIEW:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_VIEW;
            mmi_tdl_view_with_sg(
                        opt_user_data->parent_id, 
                        g_tdl_cntx.vcal_filter, 
                        0,
                        g_tdl_cntx.curr_store_idx);        
            break;
        }   
        case MITEM_TODO_LIST_EDIT:
        {
            mmi_tdl_main_group_data_struct *tdl_main_group_cntx;
        
            tdl_main_group_cntx = mmi_frm_group_get_user_data(GRP_ID_TDL_MAIN);
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_EDIT;
            tdl_main_group_cntx->cui_tdl_save_gid = cui_tdl_save_create(GRP_ID_TDL_MAIN);
            cui_tdl_save_set_operation_type(tdl_main_group_cntx->cui_tdl_save_gid, MMI_TDL_OP_TYPE_EDIT);
            cui_tdl_save_set_title(tdl_main_group_cntx->cui_tdl_save_gid, STR_GLOBAL_EDIT);
            cui_tdl_save_set_task(tdl_main_group_cntx->cui_tdl_save_gid, &g_tdl_cntx.curr_task);                
            cui_tdl_save_run(tdl_main_group_cntx->cui_tdl_save_gid);
            break;
        }       
        case MITEM_TODO_LIST_DELETE:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE;
            mmi_tdl_entry_delete_confirm(opt_user_data->parent_id);        
            break;
        }   
        case MITEM_TODO_LIST_DELETE_ALL:
        {
            g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_DELETE_ALL;
            mmi_tdl_delete_all_searched_confirm(opt_user_data->parent_id);
            break;
        }   
    #ifdef __MMI_VCALENDAR__
    #ifndef __MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__
        case MENU_VCLNDR_SEND_BY_SMS:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_SMS;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_MMS__
        case MENU_VCLNDR_SEND_BY_MMS:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_MMS;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_EMAIL__
        case MENU_VCLNDR_SEND_BY_EMAIL:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_EMAIL;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif
    #ifdef __MMI_OPP_SUPPORT__
        case MENU_VCLNDR_SEND_BY_BT:
        {
            cui_vcal_send_param_struct para;
            mmi_id sg_id;
            para.send_type = MMI_VCAL_SEND_BY_OPP;
            para.vcal_type = SRV_VCAL_VTODO;
            para.buff = &g_tdl_cntx.curr_task;
            sg_id = cui_vcal_send_create(opt_user_data->parent_id);
            cui_vcal_send_set_para(sg_id, para);
            cui_vcal_send_run(sg_id);
            break;
        }
    #endif        
    #ifdef __MMI_FILE_MANAGER__
        case MENU_VCLNDR_SEND_BY_FILEMGR:
        {
            mmi_id sg_id;
            cui_vcal_save_to_file_param_struct param;
            
            sg_id = cui_vcal_save_to_file_create(opt_user_data->parent_id);
            param.para_type = MMI_VCAL_TYPE_BUFF;
            param.u.obj.vcal_type = SRV_VCAL_VTODO;
            param.u.obj.buff = &g_tdl_cntx.curr_task;
            cui_vcal_save_to_file_set_para(sg_id, param);            
            cui_vcal_save_to_file_run(sg_id);
            break;
        }
    #endif /* __MMI_FILE_MANAGER__ */
    #endif /* __MMI_VCALENDAR__ */
        default:
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_view_vcalendar
 * DESCRIPTION
 *  type  [IN]  :
 *  index [IN]  :
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_view_vcalendar(U16 vcal_type, U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_create_ex(GRP_ID_ROOT,GRP_ID_TDL_MAIN,mmi_tdl_task_main_group_proc,
        NULL,MMI_FRM_NODE_SMART_CLOSE_FLAG);
    mmi_tdl_view_with_sg(GRP_ID_TDL_MAIN, (srv_tdl_vcal_enum)vcal_type, 0, index);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_conv_repeat_type
 * DESCRIPTION
 *  todolist repeat
 * PARAMETERS
 *  void
 * RETURNS
 *  alarm framework repeat
 *****************************************************************************/
U8 mmi_tdl_conv_repeat_type(U8 repeat)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(repeat < MMI_TDL_MAX_FREQ_ITEM);
    return g_tdl_freq_set[repeat].repeat_type;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_get_event_node
 * DESCRIPTION
 *  todolist repeat
 * PARAMETERS
 *  void
 * RETURNS
 *  alarm framework repeat
 *****************************************************************************/
void *mmi_tdl_get_event_node(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_tdl_event_short_struct *pevent = NULL;
    //U16 ret;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(index < NUM_OF_CAL);
    //ret = srv_tdl_get_cache(
    srv_tdl_get_cache(
                    (void*)&pevent, 
                    sizeof(srv_tdl_event_short_struct), 
                    SRV_TDL_VCAL_EVENT,
                    index);
    //MMI_ASSERT(ret == SRV_TDL_RESULT_OK);
    return pevent;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_task_view_group_proc
 * DESCRIPTION
 *  Proc function of view group.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_tdl_task_view_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_tdl_view_group_data_struct *view_group_cntx;
    mmi_id sg_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    view_group_cntx = (mmi_tdl_view_group_data_struct*)mmi_frm_group_get_user_data(GRP_ID_TDL_VIEW);
    
    switch(evt->evt_id)
    {
        case EVT_ID_GROUP_FIRST_ENTRY:
            break;

        case EVT_ID_GROUP_DEINIT:
        {
            OslMfree(view_group_cntx);
            break;
        }
        case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        {
            break;
        }
        case EVT_ID_CUI_INLINE_SUBMIT:
        case EVT_ID_CUI_INLINE_CSK_PRESS:
        {
            cui_event_inline_submit_struct *event = (cui_event_inline_submit_struct*)evt;     
            sg_id = cui_tdl_save_create(view_group_cntx->parent_id);
            cui_tdl_save_set_task(sg_id, &g_tdl_cntx.curr_task);
            cui_tdl_save_set_operation_type(sg_id, MMI_TDL_OP_TYPE_EDIT);
            cui_tdl_save_set_highlight_item(sg_id, event->item_id);                
            cui_tdl_save_run(sg_id);
            mmi_frm_group_close(view_group_cntx->group_id);
            break;
        }
        case EVT_ID_CUI_INLINE_ABORT:
        {
            mmi_frm_group_close(view_group_cntx->group_id);
            break;
        }
        case EVT_ID_CUI_INLINE_NOTIFY:
        {        
            cui_event_inline_notify_struct *event = (cui_event_inline_notify_struct*)evt;        
            if (CUI_INLINE_NOTIFY_HIGHLIGHT_ITEM == event->event_type)
            {
                switch(event->item_id)
                {
                    case CUI_INLINE_ITEM_SUBJECT_TEXT:
                    {
                        cui_inline_set_softkey_text(
                                        view_group_cntx->cui_inline_gid,
                                        CUI_INLINE_ITEM_SUBJECT_TEXT,
                                        MMI_LEFT_SOFTKEY,
                                        STR_GLOBAL_EDIT);
                        break;
                    }
                    
                    default:
                        break;
                }
            }
            else if (CUI_INLINE_NOTIFY_ITEM_ACTIVATED == event->event_type)
            {
                sg_id = cui_tdl_save_create(view_group_cntx->parent_id);
                cui_tdl_save_set_task(sg_id, &g_tdl_cntx.curr_task);
                cui_tdl_save_set_operation_type(sg_id, MMI_TDL_OP_TYPE_EDIT);
                cui_tdl_save_set_highlight_item(sg_id, event->item_id);                
                cui_tdl_save_run(sg_id);            
            }
            break;
        }
        default:
            break;
    }
    return MMI_RET_OK;

}

#endif /* __MMI_TODOLIST__ */
#ifdef __MMI_CALENDAR_EVENT__

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_view_group_proc
 * DESCRIPTION
 *  Proc function of view group.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
mmi_ret mmi_tdl_event_view_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_tdl_view_group_data_struct *view_group_cntx;
    mmi_id sg_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    view_group_cntx = (mmi_tdl_view_group_data_struct*)mmi_frm_group_get_user_data(GRP_ID_TDL_VIEW);
    
    switch(evt->evt_id)
    {
        case EVT_ID_GROUP_FIRST_ENTRY:
            break;

        case EVT_ID_GROUP_DEINIT:
        {
            OslMfree(view_group_cntx);
            break;
        }
        case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        {
            break;
        }
        case EVT_ID_CUI_INLINE_SUBMIT:
        case EVT_ID_CUI_INLINE_CSK_PRESS:
        {
            cui_event_inline_submit_struct *event = (cui_event_inline_submit_struct*)evt;     
            sg_id = cui_cal_save_create(view_group_cntx->parent_id);
            cui_cal_save_set_event(sg_id, &g_tdl_cntx.curr_event);
            cui_cal_save_set_operation_type(sg_id, MMI_TDL_OP_TYPE_EDIT);
            cui_cal_save_set_highlight_item(sg_id, event->item_id);                
            cui_cal_save_run(sg_id);

            mmi_frm_group_close(view_group_cntx->group_id);
            break;
        }
        case EVT_ID_CUI_INLINE_ABORT:
        {
            mmi_frm_group_close(view_group_cntx->group_id);
            break;
        }
        case EVT_ID_CUI_INLINE_NOTIFY:
        {        
            cui_event_inline_notify_struct *event = (cui_event_inline_notify_struct*)evt;        
            if (CUI_INLINE_NOTIFY_HIGHLIGHT_ITEM == event->event_type)
            {
                switch(event->item_id)
                {
                    case CUI_INLINE_ITEM_ID_BASE + 5:
                    {                    
                        if (MMI_TDL_CATEGORY_ANNIVERSARY == g_tdl_cntx.curr_event.category ||
							MMI_TDL_CATEGORY_BIRTHDAY == g_tdl_cntx.curr_event.category)
                        {
                            cui_inline_set_softkey_text(
                                            view_group_cntx->cui_inline_gid,
                                            CUI_INLINE_ITEM_ID_BASE + 5,
                                            MMI_LEFT_SOFTKEY,
                                            STR_GLOBAL_EDIT);
                        }
                        break;
                    }
                    case CUI_INLINE_ITEM_ID_BASE + 9:
                    {
                        if (MMI_TDL_CATEGORY_ANNIVERSARY != g_tdl_cntx.curr_event.category &&
							MMI_TDL_CATEGORY_BIRTHDAY != g_tdl_cntx.curr_event.category)
                        {
                            cui_inline_set_softkey_text(
                                            view_group_cntx->cui_inline_gid,
                                            CUI_INLINE_ITEM_ID_BASE + 9,
                                            MMI_LEFT_SOFTKEY,
                                            STR_GLOBAL_EDIT);
                        }
                        break;
                    }
                    default:
                        break;
                }
            }
            else if (CUI_INLINE_NOTIFY_ITEM_ACTIVATED == event->event_type)
            {
                sg_id = cui_cal_save_create(view_group_cntx->parent_id);
                cui_cal_save_set_event(sg_id, &g_tdl_cntx.curr_event);
                cui_cal_save_set_operation_type(sg_id, MMI_TDL_OP_TYPE_EDIT);
                cui_cal_save_set_highlight_item(sg_id, event->item_id);                
                cui_cal_save_run(sg_id);         
            }
            break;
        }
        default:
            break;
    }
    return MMI_RET_OK;

}

#endif /* __MMI_CALENDAR_EVENT__ */
/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_stop_reminder
 * DESCRIPTION
 *  Exit from To Do List Reminder Screen.
 *  Decrease the Alarm id and Go To Previous Screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_stop_reminder(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //U16 error_code;
	MYTIME curr_time, inc_time;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_nmgr_unblock_sound_vid_stop(MMI_FRM_NMGR_SOUND | MMI_FRM_NMGR_VIB);
#ifndef __MMI_PROF_BEEP_WHEN_BGPLAYING__
    mdi_audio_resume_background_play();
#endif
    mmi_frm_nmgr_control_end(); /* 
                                 * When not press key and no tough, shoult use it to tell
                                 * Framework the scenario is end
                                 */
                                 
    
    StopTimer(ALARM_ALERT_NOTIFYDURATION_TIMER);
    if (g_tdl_cntx.reminder_type == SRV_TDL_VCAL_EVENT)
    {
#ifdef __MMI_CALENDAR_EVENT__
        srv_tdl_event_get(
                (void*)&g_tdl_cntx.event_reminder, 
                sizeof(srv_tdl_event_struct), 
                (srv_tdl_event_source_enum)g_tdl_cntx.reminder_sns_source,
                g_tdl_cntx.reminder_id);

        g_tdl_cntx.event_reminder.alarm.snooze = 0;
        //error_code = mmi_tdl_save_adjust_field(
                mmi_tdl_save_adjust_field(
                &g_tdl_cntx.event_reminder,                    
                sizeof(srv_tdl_event_struct), 
                SRV_TDL_VCAL_EVENT);
		
		// modify SNS birthday reminder time to next year			
		if(g_tdl_cntx.event_reminder.src_id != SRV_TDL_EVENT_SOURCE_LOCAL && 
		g_tdl_cntx.event_reminder.category == MMI_TDL_CATEGORY_BIRTHDAY &&
		g_tdl_cntx.event_reminder.alarm.type != MMI_TDL_ALARM_OFF)
		{
			DTGetRTCTime(&curr_time);
			if (CompareTime(g_tdl_cntx.event_reminder.start_time, curr_time, NULL) <= 0)
			{
				memset(&inc_time, 0, sizeof(MYTIME));
				inc_time.nYear = 1;
				IncrementTime(g_tdl_cntx.event_reminder.alarm.first_launch, inc_time, &curr_time);
				memcpy(&g_tdl_cntx.event_reminder.alarm.first_launch, &curr_time, sizeof(MYTIME));
			}
		}
        srv_tdl_event_update(
                &g_tdl_cntx.event_reminder, 
                (srv_tdl_event_source_enum)g_tdl_cntx.reminder_sns_source, 
                g_tdl_cntx.reminder_id);

    #ifdef __MMI_SYNCML_SYNC_CALENDAR_SUPPORT__
	    if(g_tdl_cntx.reminder_sns_source == SRV_TDL_VCAL_EVENT)
	    {
	        mmi_syncml_calendar_data_changed_notification(
	                SYNCML_RECORD_MODIFY, 
	                (U16)(g_tdl_cntx.reminder_id));
	    }
    #endif
#endif
    }
    else
    {
#ifdef __MMI_TODOLIST__
        srv_tdl_get(
                (void*)&g_tdl_cntx.task_reminder, 
                sizeof(srv_tdl_task_struct), 
                SRV_TDL_VCAL_TASK,
                (U16)(g_tdl_cntx.reminder_id));
        g_tdl_cntx.task_reminder.alarm.snooze = 0;
        //error_code = mmi_tdl_save_adjust_field(
        mmi_tdl_save_adjust_field(
                &g_tdl_cntx.task_reminder,                    
                sizeof(srv_tdl_task_struct), 
                SRV_TDL_VCAL_TASK);
        srv_tdl_update(
                &g_tdl_cntx.task_reminder, 
                SRV_TDL_VCAL_TASK, 
                (U16)(g_tdl_cntx.reminder_id));

    #ifdef __MMI_SYNCML_SYNC_TASK_SUPPORT__
        mmi_syncml_task_data_changed_notification(
                SYNCML_RECORD_MODIFY, 
                (U16)(g_tdl_cntx.reminder_id));
    #endif
#endif
    }

    srv_reminder_notify_finish(MMI_TRUE);
	mmi_frm_group_close(GRP_ID_TDL_REMINDER);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_reminder_end_key
 * DESCRIPTION
 *  End key handler of todolist reminder screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_reminder_end_key(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_nmgr_unblock_sound_vid_stop(MMI_FRM_NMGR_SOUND | MMI_FRM_NMGR_VIB);
#ifndef __MMI_PROF_BEEP_WHEN_BGPLAYING__
    mdi_audio_resume_background_play();
#endif
    mmi_frm_nmgr_control_end(); /* 
                                 * When not press key and no tough, shoult use it to tell
                                 * Framework the scenario is end
                                 */
                                 
    if (g_tdl_cntx.reminder_type == SRV_TDL_VCAL_EVENT)
    {
#ifdef __MMI_CALENDAR_EVENT__
        g_tdl_cntx.event_reminder.alarm.snooze = 0;
        
        if (g_tdl_cntx.event_reminder.repeat.rule == MMI_TDL_RULE_ONCE)/* reset the alarm state */
        {
            g_tdl_cntx.event_reminder.alarm.type = MMI_TDL_ALARM_OFF;
        }
        
        srv_tdl_update(
                &g_tdl_cntx.event_reminder, 
                SRV_TDL_VCAL_EVENT, 
                g_tdl_cntx.reminder_id);
#endif
    }
    else
    {
#ifdef __MMI_TODOLIST__
        g_tdl_cntx.task_reminder.alarm.snooze = 0;

        if (g_tdl_cntx.task_reminder.repeat.rule == MMI_TDL_RULE_ONCE)/* reset the alarm state */
        {
            g_tdl_cntx.task_reminder.alarm.type = MMI_TDL_ALARM_OFF;
        }
        
        srv_tdl_update(
                &g_tdl_cntx.task_reminder, 
                SRV_TDL_VCAL_TASK, 
                g_tdl_cntx.reminder_id);
#endif
    }
}

/*****************************************************************************
* FUNCTION
 *  mmi_alm_key_proc
 * DESCRIPTION
 *  key proc
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_tdl_reminder_key_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	mmi_frm_key_evt_struct *evt = (mmi_frm_key_evt_struct *)param;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if (evt->evt_id == EVT_ID_PRE_KEY)
	{
		if (evt->key_code == KEY_END && evt->key_type == KEY_EVENT_DOWN)
		{
			mmi_tdl_stop_reminder();
		}
	}
	
	return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_reminder_int
 * DESCRIPTION
 *  End key handler of todolist reminder screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_entry_reminder_int(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 note_len;
    U8 *gui_buffer;
    U16 title_id = 0;
    U16 lsk_string = STR_GLOBAL_OK;
    srv_tdl_alarm_struct alarm;    
#if 0
#ifdef __MMI_OP11_TODOLIST_DIARY_SUPPORT__
/* under construction !*/
#else
/* under construction !*/
#endif /* __MMI_OP11_TODOLIST_DIARY_SUPPORT__ */
#endif /* __MMI_OP11_TODOLIST_DIARY_SUPPORT__ */

    U16 rsk_string = ALARMS_SNOOZE_STRINGID;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!mmi_frm_scrn_enter(
                GRP_ID_TDL_REMINDER, 
                SCR_TDL_REMINDER, 
                NULL, 
                mmi_tdl_entry_reminder_int, 
                MMI_FRM_FULL_SCRN))
    {
        return;
    }

    mmi_frm_nmgr_block_sound_vib_stop(MMI_FRM_NMGR_SOUND | MMI_FRM_NMGR_VIB);
    
    gui_buffer = mmi_frm_scrn_get_active_gui_buf();
    note_len = mmi_ucs2strlen(g_tdl_edit_cntx.reminder_buff);
    if (SRV_TDL_VCAL_EVENT == g_tdl_cntx.reminder_type)
    {
#ifdef __MMI_CALENDAR_EVENT__
        memcpy(&alarm, &g_tdl_cntx.event_reminder.alarm, sizeof(srv_tdl_alarm_struct)); 
        title_id = STR_TODO_REMINDER + g_tdl_cntx.event_reminder.category;
#endif
    }
    else
    {
#ifdef __MMI_TODOLIST__
        memcpy(&alarm, &g_tdl_cntx.task_reminder.alarm, sizeof(srv_tdl_alarm_struct)); 
        title_id = ORGANIZER_MENU_TODOLIST_STRINGID;
#endif
    }
    
#if 0    
#ifdef __MMI_OP11_TODOLIST_DIARY_SUPPORT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else /* __MMI_OP11_DIARY_SUPPORT__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_OP11_DIARY_SUPPORT__ */
#endif

    if (alarm.snooze >= MAX_SNOOZE_CHANCES ||
		g_tdl_cntx.event_reminder.src_id != SRV_TDL_EVENT_SOURCE_LOCAL)
    {
        rsk_string = 0;
        MMI_TDL_TRACE1(MMI_TDL_ENTRY_REMINDER_LSK, 5);
    }
    EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    ShowCategory74Screen(
        title_id,
        GetRootTitleIcon(ORGANIZER_CALENDER_MENU),
        lsk_string,
        IMG_GLOBAL_OK,
        rsk_string,
        0,
        (U8*)g_tdl_edit_cntx.reminder_buff,
        note_len,
        gui_buffer);

#if 0
#ifdef __MMI_OP11_TODOLIST_DIARY_SUPPORT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else /* __MMI_OP11_DIARY_SUPPORT__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_OP11_DIARY_SUPPORT__ */
#endif

    if (alarm.snooze < MAX_SNOOZE_CHANCES)
    {
        SetRightSoftkeyFunction(mmi_tdl_reminder_snooze_handler, KEY_EVENT_UP);
    }
    SetLeftSoftkeyFunction(mmi_tdl_stop_reminder, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(get_left_softkey_function(KEY_EVENT_UP), KEY_EVENT_UP);
    mmi_frm_scrn_set_key_proc(GRP_ID_TDL_REMINDER, SCR_TDL_REMINDER, mmi_tdl_reminder_key_proc);

#ifdef __MMI_SCREEN_LOCK_ANY_TIME__
		 mmi_frm_cb_reg_event(EVT_ID_SCREEN_LOCK_KEY_PRE_LOCK_EVT_ROUTING, mmi_tdl_reminder_group_proc, NULL);
#endif

    if (g_tdl_cntx.reminder_pow_off)
    {
        if (mmi_frm_kbd_is_key_supported(KEY_POWER) == MMI_TRUE)
        {
            ClearKeyHandler(KEY_POWER, KEY_EVENT_UP);
            ClearKeyHandler(KEY_POWER, KEY_EVENT_DOWN);
            SetKeyHandler(mmi_tdl_reminder_end_key, KEY_POWER, KEY_LONG_PRESS);
        }
        else
        {
            SetKeyHandler(mmi_tdl_reminder_end_key, KEY_END, KEY_LONG_PRESS);
        }
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_reminder_group_proc
 * DESCRIPTION
 *  Generate the menus.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_tdl_reminder_group_proc(mmi_event_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_tdl_save_result_struct *tdl_save_evt = (cui_tdl_save_result_struct*)evt;
#ifdef __MMI_SCREEN_LOCK_ANY_TIME__	
	mmi_scr_locker_pre_lock_evt_struct *lock_event;
#endif    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    switch(evt->evt_id)
    {
        case EVT_ID_TDL_SAVE_FAIL:
        case EVT_ID_TDL_SAVE_SUCCESS:
        case EVT_ID_TDL_SAVE_CANCEL:
        {
            if (g_tdl_cntx.reminder_type == SRV_TDL_VCAL_TASK)
            {
            #ifdef __MMI_TODOLIST__
                cui_tdl_save_close(tdl_save_evt->sender_id);
            #endif
            }
            else
            {
                cui_cal_save_close(tdl_save_evt->sender_id);
            }
            break;
        }
		case EVT_ID_GROUP_DEINIT:
		    mmi_frm_end_scenario(MMI_SCENARIO_ID_REMINDER_OTHER);
#ifdef __MMI_SCREEN_LOCK_ANY_TIME__
	        mmi_frm_cb_dereg_event(EVT_ID_SCREEN_LOCK_KEY_PRE_LOCK_EVT_ROUTING, mmi_tdl_reminder_group_proc, NULL);
#endif
			break;
#ifdef __MMI_SCREEN_LOCK_ANY_TIME__
         case EVT_ID_SCREEN_LOCK_KEY_PRE_LOCK_EVT_ROUTING:
		 	lock_event = (mmi_scr_locker_pre_lock_evt_struct *)evt;
			
			if(lock_event->lock_mode == MMI_SCR_LOCKER_LOCK_MODE_POWER_KEY)
			{		
				mmi_tdl_reminder_snooze_handler();
				return MMI_RET_OK;
			}			
			else if(lock_event->lock_mode == MMI_SCR_LOCKER_LOCK_MODE_AUTO_LOCK)
			{
				return MMI_RET_ERR;
			}
		 	break;
#endif	
        default:
            break;
    }
    return MMI_RET_OK;        
}

/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_copy_reminder_content
 * DESCRIPTION
 *  End key handler of todolist reminder screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_tdl_copy_reminder_content(CHAR *buffer, U16 reminder_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_string_type time_buff = NULL;
    UI_string_type date_buff = NULL;        
    MYTIME curr_time;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (reminder_type > SRV_TDL_VCAL_TASK)
    {
        return;
    }    
    time_buff = (UI_string_type)OslMalloc(MMI_TDL_MAX_TIME_FORMAT_BUFF_EN_SIZE);
    date_buff = (UI_string_type)OslMalloc(MMI_TDL_MAX_DATE_FORMAT_BUFF_EN_SIZE);  
    GetDateTime(&curr_time);
    if (SRV_TDL_VCAL_TASK == reminder_type)
    {
#ifdef __MMI_TODOLIST__
        //subject
        mmi_ucs2cpy(buffer, GetString(STR_GLOBAL_SUBJECT));
        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
        mmi_ucs2cat(buffer, (CHAR*)L"\n");
        mmi_ucs2cat(buffer, (CHAR*)g_tdl_cntx.task_reminder.subject);
		mmi_ucs2cat(buffer, (CHAR*)L"\n");
		
		//due time
        mmi_ucs2cat(buffer, GetString(STR_GLOBAL_TIME));
        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));  
		mmi_ucs2cat(buffer, (CHAR*)L"\n");
        date_string(&g_tdl_cntx.task_reminder.due_time, date_buff, DT_IDLE_SCREEN);
        time_string(&g_tdl_cntx.task_reminder.due_time, time_buff, DT_IDLE_SCREEN);
        mmi_ucs2cat(buffer, (CHAR*)date_buff);
        mmi_ucs2cat(buffer, (CHAR*)L"  ");
        mmi_ucs2cat(buffer, (CHAR*)time_buff);    
        mmi_ucs2cat(buffer, (CHAR*)L"\n");

		//details
		if(0 != mmi_ucs2strlen((CHAR*)g_tdl_cntx.task_reminder.details))
		{	
			mmi_ucs2cat(buffer, GetString(STR_GLOBAL_DETAILS));
	        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
	        mmi_ucs2cat(buffer, (CHAR*)g_tdl_cntx.task_reminder.details);
			mmi_ucs2cat(buffer, (CHAR*)L"\n");
		}
#endif
    }
    else
    {
#ifdef __MMI_CALENDAR_EVENT__
 		//subject
        mmi_ucs2cpy(buffer, GetString(STR_GLOBAL_SUBJECT));
        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
        mmi_ucs2cat(buffer, (CHAR*)L"\n");
        mmi_ucs2ncat(buffer, (CHAR*)g_tdl_cntx.event_reminder.subject, MAX_TODO_NOTE_LEN); 
        mmi_ucs2cat(buffer, (CHAR*)L"\n");

        if(g_tdl_cntx.event_reminder.category != MMI_TDL_CATEGORY_ANNIVERSARY &&
			g_tdl_cntx.event_reminder.category != MMI_TDL_CATEGORY_BIRTHDAY)
        {
	        //start time
	        mmi_ucs2cat(buffer, GetString(STR_TODO_START_TIME));
	        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
	        date_string(&g_tdl_cntx.event_reminder.start_time, date_buff, DT_IDLE_SCREEN);
	        time_string(&g_tdl_cntx.event_reminder.start_time, time_buff, DT_IDLE_SCREEN);
	        mmi_ucs2cat(buffer, (CHAR*)date_buff);
	        mmi_ucs2cat(buffer, (CHAR*)L"  ");
	        mmi_ucs2cat(buffer, (CHAR*)time_buff); 
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
	        //end time
	        mmi_ucs2cat(buffer, GetString(STR_TODO_END_TIME));
	        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
	        date_string(&g_tdl_cntx.event_reminder.end_time, (UI_string_type)date_buff, DT_IDLE_SCREEN);
	        time_string(&g_tdl_cntx.event_reminder.end_time, (UI_string_type)time_buff, DT_IDLE_SCREEN);        
	        mmi_ucs2cat(buffer, (CHAR*)date_buff);
	        mmi_ucs2cat(buffer, (CHAR*)L"  ");
	        mmi_ucs2cat(buffer, (CHAR*)time_buff);  
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
        }
        else
        {
        	//date time
	        mmi_ucs2cat(buffer, GetString(STR_GLOBAL_TIME));
	        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
	        date_string(&g_tdl_cntx.event_reminder.start_time, date_buff, DT_IDLE_SCREEN);
	        time_string(&g_tdl_cntx.event_reminder.start_time, time_buff, DT_IDLE_SCREEN);
	        mmi_ucs2cat(buffer, (CHAR*)date_buff);
	        mmi_ucs2cat(buffer, (CHAR*)L"  ");
	        mmi_ucs2cat(buffer, (CHAR*)time_buff); 
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
        }

		// location
        if (0 != mmi_ucs2strlen((CHAR*)g_tdl_cntx.event_reminder.location))
        {
            mmi_ucs2cat(buffer, GetString(STR_TODO_LOCATION));
            mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
            mmi_ucs2cat(buffer, (CHAR*)L"\n");
            mmi_ucs2cat(buffer, (CHAR*) g_tdl_cntx.event_reminder.location);
			mmi_ucs2cat(buffer, (CHAR*)L"\n");
        }

		//details
		if(0 != mmi_ucs2strlen((CHAR*)g_tdl_cntx.event_reminder.details))
		{
		    mmi_ucs2cat(buffer, GetString(STR_GLOBAL_DETAILS));
	        mmi_ucs2cat(buffer, GetString(STR_ID_CAL_COLON));
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
	        mmi_ucs2cat(buffer, (CHAR*) g_tdl_cntx.event_reminder.details);
	        mmi_ucs2cat(buffer, (CHAR*)L"\n");
		}
#endif
    }
    
    if (time_buff != NULL)
    { 
        OslMfree(time_buff);
    }
    if (date_buff != NULL)
    { 
        OslMfree(date_buff);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_entry_reminder
 * DESCRIPTION
 *  Display reminder screen when TDL alarm expires.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
//MMI_BOOL mmi_tdl_entry_reminder(void)
MMI_BOOL mmi_tdl_entry_reminder(mmi_scenario_id scen_id, void *arg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 result;
    srv_tdl_alarm_struct alarm;    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TDL_TRACE2(MMI_TDL_ENTRY_REMINDER, g_tdl_cntx.reminder_id, g_tdl_cntx.reminder_type);
    /* MUST */
    mmi_tdl_delete_all_history();

#ifdef __MMI_BACKGROUND_CALL__
	if (g_tdl_cntx.reminder_id == 0xFF)
	{
		goto MMI_TDL_ERROR_CLEAN;
	}
#endif /* __MMI_BACKGROUND_CALL__ */

#ifdef __MMI_SCREEN_SWITCH_EFFECT__
    gui_screen_switch_effect_block(MMI_TRUE);  /* Block the switch effect */
#endif

    if (SRV_TDL_VCAL_EVENT == g_tdl_cntx.reminder_type)
    {
#ifdef __MMI_CALENDAR_EVENT__
        result = srv_tdl_event_get(
                    (void*)&g_tdl_cntx.event_reminder, 
                    sizeof(srv_tdl_event_struct), 
                    (srv_tdl_event_source_enum)g_tdl_cntx.reminder_sns_source,
                    g_tdl_cntx.reminder_id);
                    
        if (result != SRV_TDL_RESULT_OK)
        {
            memset(&g_tdl_cntx.event_reminder, 0, sizeof(srv_tdl_event_struct));
            goto MMI_TDL_ERROR_CLEAN;
        }        
        memcpy(&alarm, &g_tdl_cntx.event_reminder.alarm, sizeof(srv_tdl_alarm_struct));
        
	#if 0
    #ifdef __MMI_OP11_TODOLIST_DIARY_SUPPORT__
/* under construction !*/
    #endif
    #endif
#endif
    }
    else
    {
#ifdef __MMI_TODOLIST__
        result = srv_tdl_get(
                    (void*)&g_tdl_cntx.task_reminder, 
                    sizeof(srv_tdl_task_struct), 
                    SRV_TDL_VCAL_TASK,
                    g_tdl_cntx.reminder_id);
                    
        if (result != SRV_TDL_RESULT_OK)
        {
            memset(&g_tdl_cntx.task_reminder, 0, sizeof(srv_tdl_task_struct));
            goto MMI_TDL_ERROR_CLEAN;
        }        
	#if 0
    #ifdef __MMI_OP11_TODOLIST_DIARY_SUPPORT__
/* under construction !*/
    #endif
    #endif
#endif
    }
    if (!IsMyTimerExist(ALARM_ALERT_NOTIFYDURATION_TIMER))
    {
        StartTimer(ALARM_ALERT_NOTIFYDURATION_TIMER, MMI_TDL_REMINDER_DURATION, mmi_tdl_reminder_snooze_handler);
    }

#ifndef __MMI_PROF_BEEP_WHEN_BGPLAYING__
    /* for OG, do not suspend due to it will play short ring */
    mdi_audio_suspend_background_play();
#endif

    mmi_tdl_copy_reminder_content(g_tdl_edit_cntx.reminder_buff, g_tdl_cntx.reminder_type);
    mmi_frm_group_create_ex(GRP_ID_ROOT, GRP_ID_TDL_REMINDER, 
        mmi_tdl_reminder_group_proc, NULL,MMI_FRM_NODE_SMART_CLOSE_FLAG);
    mmi_frm_start_scenario(MMI_SCENARIO_ID_REMINDER_OTHER);
    mmi_tdl_entry_reminder_int();
    
MMI_TDL_ERROR_CLEAN:
    return MMI_TRUE;
}


#ifdef __MMI_TOUCH_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  mmi_tdl_tap_list_callback
 * DESCRIPTION
 *  tap on vcalendar item. view it
 * PARAMETERS
 *  mmi_tap_type_enum   [IN] tap type.
 *  S32                 [IN] item index.
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_tdl_tap_list_callback(mmi_tap_type_enum tap_type, S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (tap_type == ENUM_TAP_ON_NONHIGHLIGHTED_ITEM)
    {
        // only change the highlight
        return;
    }
    
    g_tdl_cntx.curr_option = TODO_LIST_TASK_OPTION_VIEW;
    mmi_tdl_entry_view_hdlr();
}
#endif /* __MMI_TOUCH_SCREEN__ */

#endif

