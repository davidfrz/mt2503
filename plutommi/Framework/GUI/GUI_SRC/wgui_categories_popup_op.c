/*******************************************************************************
*  Modification Notice:
*  --------------------------
*  This software is modified by MediaTek Inc. and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*******************************************************************************/

 /*******************************************************************************
 * Filename:
 * ---------
 *   wgui_categories_popup_op.c
 *
 * Project:
 * --------
 *   Maui
 *
 * Description:
 * ------------
 *  Operator related categories for popup
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
 
#include "MMI_features.h"

#include "gui_data_types.h"
#include "MMIDataType.h"
#include "wgui_draw_manager.h"
#include "mmi_frm_history_gprot.h"
#include "gui.h"
#include "wgui_categories_util.h"
#include "wgui_inputs.h"
#include "gui_inputs.h"
#include "gui_typedef.h"
#include "wgui_categories_popup.h"
#include "mmi_frm_events_gprot.h"
#include "wgui_categories_enum.h"
#include "kal_general_types.h"
#include "gdi_include.h"
#include "gui_themes.h"
#include "wgui_categories_popup_op.h"
#include "gdi_const.h"

#if defined(__MMI_OP11_HOMESCREEN__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined(__MMI_OP11_HOMESCREEN__) */


#if defined(__MMI_OP01_DCD_V30__)
#include "mmi_rp_app_calibration_def.h"

static U8    *g_wgui_cat9004_op01_str_p = NULL;
static U8      *g_wgui_cat9004_op01_image_path = NULL;


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9004_multiline_hide_callback
 * DESCRIPTION
 *  hide mulitline background
 * PARAMETERS
 *  x1       [IN]     start x position
 *  y1       [IN]     start y position
 *  x2       [IN]     end x position
 *  y2       [IN]     end y position
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat9004_multiline_hide_callback(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_filled_area wgui_cat9004_normal_filler;
    extern UI_filled_area wgui_pop_up_dialog_background;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	wgui_cat9004_normal_filler = wgui_pop_up_dialog_background;
	if(wgui_cat9004_normal_filler.b != NULL)
	{
		wgui_cat9004_normal_filler.flags = UI_FILLED_AREA_TYPE_BITMAP;
		wgui_cat9004_normal_filler.transparent_color = UI_NULL_TRANSPARENT_COLOR;
	}
	else
	{
		wgui_cat9004_normal_filler.flags = UI_FILLED_AREA_TYPE_COLOR;
	}
    gdi_layer_push_clip();
    gdi_layer_set_clip(x1, y1, x2, y2);
    if(wgui_cat9004_normal_filler.b != NULL)
    {
    #if !defined (__MMI_FTE_SUPPORT__)
	    gui_show_transparent_image(MMI_POP_UP_DIALOG_X, MMI_POP_UP_DIALOG_Y, wgui_cat9004_normal_filler.b, 0);
    #else
        {
            dm_coordinates dm_popup_background_info;
            GDI_HANDLE scr_bg_layer;

            scr_bg_layer = dm_get_scr_bg_layer();
            dm_get_popup_bg_coordinate(&dm_popup_background_info);
			if(scr_bg_layer != GDI_NULL_HANDLE)
			{
                gdi_push_and_set_alpha_blending_source_layer(scr_bg_layer);
			}
            gdi_image_draw_resized(
                dm_popup_background_info.s16X, 
                dm_popup_background_info.s16Y,
                dm_popup_background_info.s16Width,
                dm_popup_background_info.s16Height,
                wgui_pop_up_dialog_background.b);
			if(scr_bg_layer != GDI_NULL_HANDLE)
			{
                gdi_pop_and_restore_alpha_blending_source_layer();
            }
        }
    #endif
    }
    else
    {
        gui_fill_rectangle(x1, y1, x2, y2, wgui_cat9004_normal_filler.c);
    } 
    gdi_layer_pop_clip();
}


static void wgui_cat9004_op01_draw_ctrl_area(dm_coordinates *coordinate)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	S32 ix, iy, iw, ih;
    S32 sx, sy, sw, sh;
    S32 x, y, w, h;
    
    U8 *str;
    S32 l;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    str = g_wgui_cat9004_op01_str_p;

    x = coordinate->s16X;
    y = coordinate->s16Y;
    w = coordinate->s16Width;
    h = coordinate->s16Height;

	gdi_layer_lock_frame_buffer();
    gdi_layer_push_clip();
    gdi_layer_set_clip(x, y, x + w, y + h);

    /* draw icon */
    //gdi_image_get_dimension(icon, &iw, &ih);
    ix = x + GUI_CAT9004_OP01_MARGIN_GAP + GUI_CAT9004_OP01_IMAGE_OFFSET_X;
    iy = y + GUI_CAT9004_OP01_MARGIN_GAP + GUI_CAT9004_OP01_IMAGE_OFFSET_Y;
    iw = GUI_CAT9004_OP01_IMAGE_WIDTH;
    ih = iw;
    gdi_layer_push_clip();
    gdi_layer_set_clip(ix, iy, ix + iw, iy + ih);
    gdi_image_draw_resized_file(ix, iy, iw, ih, g_wgui_cat9004_op01_image_path);    
    gdi_layer_pop_clip();

    /*draw multiline text*/
    l = gui_strlen((UI_string_type)str);
    create_multiline_inputbox_set_buffer((UI_string_type)str, l, l, 0);

#if (defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__))
    MMI_multiline_inputbox.text_font = &MMI_small_font;
#endif

    MMI_multiline_inputbox.normal_text_color = *current_MMI_theme->popup_text_color;

    MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW
        | UI_MULTI_LINE_INPUT_BOX_AUTO_DISABLE_SCROLLBAR
        | UI_MULTI_LINE_INPUT_BOX_VIEW_MODE;
    MMI_multiline_inputbox.ext_flags |= GUI_MULTI_LINE_INPUT_BOX_DISABLE_CLIPBOARD;

    MMI_multiline_inputbox.hide_callback = wgui_cat9004_multiline_hide_callback;
    gui_vertical_scrollbar_register_hide_callback(&MMI_multiline_inputbox.vbar, wgui_cat9004_multiline_hide_callback);

    sx = ix + iw + GUI_CAT9004_OP01_MARGIN_GAP + GUI_CAT9004_OP01_IMAGE_OFFSET_X;
    sw = w - iw - GUI_CAT9004_OP01_IMAGE_OFFSET_X - GUI_CAT9004_OP01_MARGIN_GAP * 3;
    sh = h - (GUI_CAT9004_OP01_MARGIN_GAP << 1) - GUI_CAT9004_OP01_STRING_OFFSET_Y - GUI_CAT9004_OP01_STRING_BOTTOM_GAP;
    sy = y + GUI_CAT9004_OP01_MARGIN_GAP + GUI_CAT9004_OP01_STRING_OFFSET_Y;
#ifdef __MMI_CLIPBOARD__
    mmi_imc_clipboard_connect(INPUTBOX_MULTILINE);
#endif /* __MMI_CLIPBOARD__ */
    resize_multiline_inputbox(sw, sh);

    move_multiline_inputbox(sx, sy);
    show_multiline_inputbox_no_draw();
    //fh = get_multiline_inputbox_line_height();

    show_multiline_inputbox();

    gdi_layer_pop_clip();
    gdi_layer_unlock_frame_buffer();
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9004_op01_get_history_size
 * DESCRIPTION
 *  Gets the size of the history buffer for category9004 screen
 * PARAMETERS
 *  void
 * RETURNS
 *  size in U8s of the history buffer
 *****************************************************************************/
static S32 wgui_cat9004_op01_get_history_size(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (sizeof(multiline_inputbox_category_history));
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9004_op01_get_history
 * DESCRIPTION
 *  Gets the history buffer for category9004 screen
 * PARAMETERS
 *  history_buffer      [IN]        Is the buffer into which the history data is stored (pre-allocated)
 * RETURNS
 *  Pointer to the history buffer
 *****************************************************************************/
static U8 *wgui_cat9004_op01_get_history(U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    get_multiline_inputbox_category_history(MMI_CAT9004_OP01_ID, history_buffer);
    return (history_buffer);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_cat9004_op01_exit
 * DESCRIPTION
 *  Exits the category9004 screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_cat9004_op01_exit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CLIPBOARD__
    mmi_imc_clipboard_disconnect();
#endif /* __MMI_CLIPBOARD__ */

    reset_small_screen();
}


void wgui_cat9004_op01_show(
        WCHAR *left_softkey,
        PU8 left_softkey_icon,
        WCHAR *right_softkey,
        PU8 right_softkey_icon,
        U8 *buffer,
        S8* image_path,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    dm_data_struct dm_data;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    set_small_screen();

    if((left_softkey == 0) && (left_softkey_icon == 0) && (right_softkey == 0) && (right_softkey_icon == 0))
    {
        dm_data.s32flags = DM_NO_SOFTKEY;
    }
    else
    {
        dm_data.s32flags = 0;
    }

    g_wgui_cat9004_op01_str_p = buffer;
    g_wgui_cat9004_op01_image_path = image_path;

    gdi_layer_lock_frame_buffer();
    dm_add_softkey(left_softkey, left_softkey_icon, right_softkey, right_softkey_icon);
    gdi_layer_unlock_frame_buffer();

    ExitCategoryFunction = wgui_cat9004_op01_exit;
    dm_setup_category_functions(dm_redraw_category_screen, wgui_cat9004_op01_get_history, wgui_cat9004_op01_get_history_size);
    dm_register_category_controlled_callback(wgui_cat9004_op01_draw_ctrl_area);

    dm_data.s32ScrId = (S32) GetActiveScreenId();
    dm_data.s32CatId = MMI_CAT9004_OP01_ID;
    dm_data.s32flags |= DM_NO_TITLE | DM_SET_NEW_LAYER_ACTIVE;
    dm_setup_data(&dm_data);
    //dm_redraw_category_screen();
    
    gdi_layer_lock_frame_buffer();
    dm_redraw_category_screen();
    set_multiline_inputbox_category_history(MMI_CAT9004_OP01_ID, history_buffer);
    show_multiline_inputbox();
    gdi_layer_unlock_frame_buffer();

    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
#endif /*(__MMI_OP01_DCD_V30__)*/
