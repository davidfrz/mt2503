/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE.
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*******************************************************************************
 * Filename:
 * ---------
 * MMSAppUIPlugin.c
 *
 * Project:
 * --------
 * MAUI
 *
 * Description:
 * ------------
 *
 *
 * Author:
 * -------
 * 
 *
 *==============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *==============================================================================
 *******************************************************************************/
// #include "MMI_include.h"
#include "MMI_features.h"
#ifdef __MMI_MMS_2__

// #include "mmsadp.h"
#include "MMSAppResDef.h"
#include "mmi_rp_app_umms_mms_def.h"
#include "mmi_rp_app_unifiedmessage_def.h"
#include "App_usedetails.h"
#include "MMSAppUICommon.h"
#include "MMSAppInterfaceGProt.h"
#include "MMSAppInterfaceProt.h"
#include "inlineCuiGprot.h"
#include "MMSAppDataManager.h"
#include "MMSAppScrHdlr.h"
#include "MMSAppUIPlugin.h"
#include "MMSAppUIdrawEx.h"
#include "MMSAppScrHdlrEx.h"
#include "MMSAppResourceDB.h"
#include "MMSAppUIdraw.h"
#include "MMSAppUICallback.h"
#include "MMSAppOp.h"
#include "MMSMemoryManagerSrv.h"
//#include "Custom_events_notify.h"
//#include "SimDetectionGprot.h"
#include "PhoneBookGprot.h"
#include "PhbCuiGprot.h"
#include "MMSAppUtil.h"
#include "UcAppGprot.h"
#ifdef __MMI_MMS_POSTCARD__
#include "app_oppostcard.h"
#endif 
// #include "DateTimeGprot.h"
#include "CommonScreens.h"
//#include "Med_global.h"
//#include "Resource_audio.h"
#include "mma_api.h"
#include "MMSAppSrvHdlr.h"
#include "MmsSrvGprot.h"
// #include "MessagesResourceData.h"
#include "UCMGProt.h"
#ifdef __MMI_USB_SUPPORT__
#include "USBDeviceGprot.h"
#include "USBSrvGProt.h"
#endif /* __MMI_USB_SUPPORT__ */ 
#ifdef __MMI_MMS_IN_UM__
// #include "UnifiedMessageResDef.h"
#endif 
#include "EmailAppGProt.h"
#include "UCMGProt.h"
#include "UcmSrvGprot.h"
#include "SmsSrvGProt.h"
#include "SmsAppGprot.h"
#include "SmsGuiInterfaceProt.h"
#include "wgui_categories_mms_viewer.h"
#include "wgui_categories_mms_viewer_int.h"

#include "MmsSrvProt.h"
#include "BookmarkCuiGprot.h"
#include "FileMgrSrvGProt.h"
#include "MMIDataType.h"
#include "mma_struct.h"
#include "GlobalResDef.h"
#include "ImeGprot.h"
#include "wgui_categories_inputs.h"
#include "MMI_features_switch.h"
#include "MMI_features_type.h"
#include "mmi_frm_history_gprot.h"
#include "mmi_frm_scenario_gprot.h"
#include "kal_public_api.h"
#include "string.h"
#include "CustDataRes.h"
#include "mmi_frm_events_gprot.h"
#include "kal_general_types.h"
#include "DebugInitDef_Int.h"
// #include "SimDetectionStruct.h"
#include "WAPProfileSrvGProt.h"
#include "WAPProfileSrvType.h"
#include "wgui_categories_util.h"
#include "GlobalConstants.h"
#include "UmSrvDefs.h"
#include "UMDefs.h"
#include "MMI_inet_app_trc.h"
#include "kal_trace.h"
#include "UcSrvGprot.h"
#include "mmi_rp_app_sms_def.h"
#include "MessagesMiscell.h"
#include "mmi_frm_input_gprot.h"
#include "mmi_rp_srv_mms_def.h"
#include "mmi_frm_timer_gprot.h"
#include "wgui_inline_edit.h"
#include "fs_type.h"
#include "fs_func.h"
#include "fs_errcode.h"
#include "Unicodexdcl.h"
#include "gui_data_types.h"
#include "gui.h"
#include "AlertScreen.h"
#include "custom_wap_config.h"
#include "PhbSrvGprot.h"
#include "ps_public_enum.h"
#include "customer_email_num.h"
#include "mmi_res_range_def.h"
#include "wap_adp.h"
#include "browser_api.h"
#include "app_mem.h"
#include "custom_phb_config.h"
#include "tcm_common.h"
#include "MmsXMLDefSrv.h"
#include "mms_api.h"
#include "mmi_frm_mem_gprot.h"
// #include "app_buff_alloc.h"
#include "wgui_categories.h"
#include "UMGProt.h"
#include "mmi_cb_mgr_gprot.h"
#include "IdleHomescreenGProt.h"
#include "mms_sap_struct.h"
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
#include "MMSAppComposerUILE.h"
#endif

#include "MenuCuiGprot.h"
#include"MMSTemplateGenSrv.h"

#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
extern srv_mms_uc_main_struct g_srv_mms_uc_supp;
#endif 
kal_bool mma_get_home_directory(kal_wchar *buffer, kal_uint32 buffer_size, kal_uint8 storage);
extern kal_uint64 mma_get_mms_avaliable_file_space(kal_uint32 *usedBytes, U8 storage);
extern kal_uint32 applib_get_file_size(kal_wchar *filename);

#ifdef __MMI_MMS_REPORT_BOX_SUPPORT__
extern mma_result_enum mma_mms_get_report_address(kal_uint32 report_id, mma_msg_addr_info_struct *addr);
#endif 
static void mmi_umms_app_plug_in_setting_show_content_mode_confrm_pop_up(U16 str_id,
                                                                         void (*lsk_function) (void),
                                                                         void (*rsk_function) (void));

// MMI_BOOL g_filters_change_done = MMI_FALSE;  /*api from dtmgr to set and get the value*/

static mmi_ret mmi_umms_save_contacts_proc(mmi_event_struct *evt);
#ifdef __MMI_MMS_TEMPLATE_SUPPORT__
static mmi_ret mmi_umms_app_core_save_template_file_callback_proc(mmi_event_struct *msg);
#endif
#ifdef __MMI_BRW_BKM_INTERFACE_SUPPORT__
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static mmi_ret mmi_umms_save_bookmark_proc(mmi_event_struct *evt);
#endif
#endif
#if defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__) 
static void  mmi_umms_app_ui_plug_in_launch_slim_edit (void);
static void mmi_umms_app_ui_plug_in_launch_slim_forward (void);
#endif

static cui_inline_item_softkey_struct mmi_umms_inline_softkeys = 
{
    {
     {CUI_INLINE_SOFTKEY_DEFAULT_VALUE, CUI_INLINE_SOFTKEY_DEFAULT_VALUE},
     {CUI_INLINE_SOFTKEY_DEFAULT_VALUE, CUI_INLINE_SOFTKEY_DEFAULT_VALUE},
     {CUI_INLINE_SOFTKEY_DEFAULT_VALUE, CUI_INLINE_SOFTKEY_DEFAULT_VALUE}
     }
};

/* For compose settings */
#if defined (__MMI_MMS_2_RETRIVAL_MODE_SETTING__) || defined(__MMI_OP12_MMS_SUPPORT_SETTINGS__)
static U16 on_off_list[] = {STR_GLOBAL_NO, STR_GLOBAL_YES};
#else 
static U16 on_off_list[] = {STR_GLOBAL_OFF, STR_GLOBAL_ON};
#endif 
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static U16 creation_mode_list[] = 
{
    STR_ID_UMMS_SETTINGS_RESTRICTED,
    STR_ID_UMMS_SETTINGS_FREE,
#ifdef __MMI_MMS_2_CREATION_MODE_WARNING_SUPPORT__
    STR_ID_UMMS_SETTINGS_WARNING
#endif 
};
#else
static U16 creation_mode_list[] = 
{
    NULL,
    NULL,
#ifdef __MMI_MMS_2_CREATION_MODE_WARNING_SUPPORT__
    NULL
#endif 
};
#endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct slide_time_caption = {STR_ID_UMMS_SETTINGS_DEFAULT_SLIDE_TIMING};
#else
static const cui_inline_item_caption_struct slide_time_caption = {NULL};
#endif
static const cui_inline_item_text_edit_struct slide_time_text =
    {0, STR_GLOBAL_EDIT, UMMS_MAX_DEFAULT_SLIDE_TIME_INPUT + 1, IMM_INPUT_TYPE_NUMERIC,
INPUT_TYPE_EXT_NO_SHOW_NEW_LINE_SYMBOL, NULL};
#ifdef __LAYOUT_SUPPORT__
static const cui_inline_item_caption_struct layout_caption = {STR_ID_UMMS_SETTINGS_LAYOUT};
static U16 layout_string[] = {STR_ID_UMMS_SETTINGS_POTRAIT, STR_ID_UMMS_SETTINGS_LANDSCAPE};
static const cui_inline_item_select_struct layout_select = {2, 0, layout_string};
#endif /* __LAYOUT_SUPPORT__ */ 
#ifdef __DRM_SUPPORT__
#ifdef __UMMS_DRM_SUPPORT__
static const cui_inline_item_caption_struct add_drm_caption = {STR_ID_UMMS_SETTINGS_ADD_DRM};
static const cui_inline_item_select_struct add_drm_select = {2, 0, on_off_list};
#endif /* __UMMS_DRM_SUPPORT__ */ 
#endif /* __DRM_SUPPORT__ */ 
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct creation_mode_caption = {STR_ID_UMMS_SETTINGS_CREATION_MODES};
#else
static const cui_inline_item_caption_struct creation_mode_caption = {NULL};
#endif
static const cui_inline_item_select_struct creation_mode_select = {SET_CREATION_MODES_TOTAL, 0, creation_mode_list};

#ifdef __MMI_MMS_MEGA_PIXEL_SUPPORT__
static const cui_inline_item_caption_struct image_resize_caption = {STR_ID_UMMS_SETTINGS_IMAGE_RESIZE};
static U16 image_resize_list[] = 
{
    STR_GLOBAL_OFF,
#ifndef __MMI_UC_AUTO_RESIZE_IMG_BASED_ON_LEFT_MMS_SIZE__
#if defined(__MMI_MMS_MAX_IMAGE_RESIZING_RESOLUTION__) && (__MMI_MMS_MAX_IMAGE_RESIZING_RESOLUTION__ == __160x120__)
    STR_ID_UMMS_SETTINGS_160_X_120
#elif defined(__MMI_MMS_MAX_IMAGE_RESIZING_RESOLUTION__) && (__MMI_MMS_MAX_IMAGE_RESIZING_RESOLUTION__ == __320x240__)
    STR_ID_UMMS_SETTINGS_160_X_120,
    STR_ID_UMMS_SETTINGS_320_X_240
#elif defined(__MMI_MMS_MAX_IMAGE_RESIZING_RESOLUTION__) && (__MMI_MMS_MAX_IMAGE_RESIZING_RESOLUTION__ == __640x480__)
    STR_ID_UMMS_SETTINGS_160_X_120,
    STR_ID_UMMS_SETTINGS_320_X_240,
    STR_ID_UMMS_SETTINGS_640_X_480
#endif 
#else /* __MMI_UC_AUTO_RESIZE_IMG_BASED_ON_LEFT_MMS_SIZE__ */ 
    STR_ID_UMMS_IMG_RESIZE_AUTO
#endif /* __MMI_UC_AUTO_RESIZE_IMG_BASED_ON_LEFT_MMS_SIZE__ */ 
};
static const cui_inline_item_select_struct image_resize_select = {IMAGE_RESIZE_TOTAL, 0, image_resize_list};
#endif /* __MMI_MMS_MEGA_PIXEL_SUPPORT__ */ 
#ifdef __MAX_PAGE_SUPPORTED__
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct no_pages_caption = {STR_ID_UMMS_SETTINGS_CREATION_MODES};
#else
static const cui_inline_item_caption_struct no_pages_caption = {NULL};
#endif
static const cui_inline_item_text_edit_struct no_pages_textedit =
    {0, STR_GLOBAL_EDIT, (UMMS_MAX_NO_PAGES_INPUT + 1), IMM_INPUT_TYPE_NUMERIC, INPUT_TYPE_EXT_NO_SHOW_NEW_LINE_SYMBOL,
NULL};
#endif /* __MAX_PAGE_SUPPORTED__ */ 
#ifdef __MMI_MMS_BEST_PAGE_UISETTING_OPTION_SUPPORT__
static const cui_inline_item_caption_struct best_page_caption = {STR_ID_UMMS_SETTINGS_BEST_PAGE_DURATION};
static const cui_inline_item_select_struct best_page_select = {2, 0, on_off_list};
#endif /* __MMI_MMS_BEST_PAGE_UISETTING_OPTION_SUPPORT__ */ 
#ifdef __MMI_MMS_SIGNATURE__
static const cui_inline_item_caption_struct signature_caption = {STR_ID_UMMS_SETTINGS_AUTO_SIGNATURE};
static const cui_inline_item_select_struct signature_select = {2, 0, on_off_list};
static const cui_inline_item_display_only_struct signature_content_display_only = {STR_ID_UMMS_SETTINGS_SIGNATURE};

#endif /* __MMI_MMS_SIGNATURE__ */ 

const cui_inline_set_item_struct compose_settings_inline[] = 
{
    {E_COMPOSE_DEFAULT_SLIDE_TIME_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&slide_time_caption)},
    {E_COMPOSE_DEFAULT_SLIDE_TIME, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void *)(&slide_time_text)},
#ifdef __LAYOUT_SUPPORT__
    {E_COMPOSE_LAYOUT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&layout_caption)},
    {E_COMPOSE_LAYOUT, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&layout_select)},
#endif /* __LAYOUT_SUPPORT__ */ 
#ifdef __DRM_SUPPORT__
#ifdef __UMMS_DRM_SUPPORT__
    {E_COMPOSE_ADD_DRM_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&add_drm_caption)},
    {E_COMPOSE_ADD_DRM, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&add_drm_select)},
#endif /* __UMMS_DRM_SUPPORT__ */ 
#endif /* __DRM_SUPPORT__ */ 
    {E_COMPOSE_CREATION_MODES_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&creation_mode_caption)},
    {E_COMPOSE_CREATION_MODES, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&creation_mode_select)},
#ifdef __MMI_MMS_MEGA_PIXEL_SUPPORT__
    {E_COMPOSE_IMAGE_RESIZE_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&image_resize_caption)},
    {E_COMPOSE_IMAGE_RESIZING, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&image_resize_select)},
#endif /* __MMI_MMS_MEGA_PIXEL_SUPPORT__ */ 
#ifdef __MAX_PAGE_SUPPORTED__
    {E_COMPOSE_MAX_NO_PAGES_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&no_pages_caption)},
    {E_COMPOSE_MAX_NO_PAGES, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void *)(&no_pages_textedit)},
#endif /* __MAX_PAGE_SUPPORTED__ */ 
#ifdef __MMI_MMS_BEST_PAGE_UISETTING_OPTION_SUPPORT__
    {E_COMPOSE_BEST_PAGE_DURATION_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&best_page_caption)},
    {E_COMPOSE_BEST_PAGE_DURATION, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&best_page_select)},
#endif /* __MMI_MMS_BEST_PAGE_UISETTING_OPTION_SUPPORT__ */ 
#ifdef __MMI_MMS_SIGNATURE__
    {E_COMPOSE_AUTO_SIGNATURE_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&signature_caption)},
    {E_COMPOSE_AUTO_SIGNATURE, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&signature_select)},
    {E_COMPOSE_AUTO_SIGNATURE_CONTENT, CUI_INLINE_ITEM_TYPE_DISPLAY_ONLY, 0, (void *)(&signature_content_display_only)}
#endif /* __MMI_MMS_SIGNATURE__ */ 
};

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
cui_inline_struct compose_settings_initial_data = {COMPOSE_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    STR_ID_UMMS_MESSAGE_SETTINGS_COMPOSE,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    compose_settings_inline
};
#else
cui_inline_struct compose_settings_initial_data = {COMPOSE_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    NULL,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    compose_settings_inline
};
#endif

#ifdef __MMI_MMS_SETTINGS_VALIDITY_PERIOD_VISIBILITY__
static const cui_inline_item_caption_struct validity_period_caption = {STR_ID_UMMS_SETTINGS_VALIDITY_PERIOD};
static U16 validity_period_list[] = {STR_GLOBAL_MAXIMUM,
    STR_ID_UMMS_SETTINGS_1_HR,
#ifndef __MMI_OP12_MMS_SUPPORT_SETTINGS__
    STR_ID_UMMS_SETTINGS_6_HRS,
#endif 
    STR_ID_UMMS_SETTINGS_12_HRS,
    STR_ID_UMMS_SETTINGS_1_DAY,
    STR_ID_UMMS_SETTINGS_1_WEEK
};
static const cui_inline_item_select_struct validity_period_select =
    {SET_VALIDITY_PERIOD_TOTAL, 0, validity_period_list};
#endif /* __MMI_MMS_SETTINGS_VALIDITY_PERIOD_VISIBILITY__ */ 
#ifndef __MMI_MMS_NO_REPORT_SUPPORT__
static const cui_inline_item_caption_struct delivery_report_caption = {STR_ID_UMMS_DELIVERY_REPORT};
#else
static const cui_inline_item_caption_struct delivery_report_caption = {NULL};
#endif
static const cui_inline_item_select_struct delivery_report_select = {2, 0, on_off_list};
#ifndef __MMI_MMS_NO_REPORT_SUPPORT__	
static const cui_inline_item_caption_struct read_report_caption = {STR_ID_UMMS_SETTINGS_READ_REPORT};
#else
static const cui_inline_item_caption_struct read_report_caption = {NULL};
#endif
static const cui_inline_item_select_struct read_report_select = {2, 0, on_off_list};

static const cui_inline_item_caption_struct priority_caption = {STR_GLOBAL_PRIORITY};
static U16 priority_list[] = {STR_GLOBAL_LOW, STR_GLOBAL_MEDIUM, STR_GLOBAL_HIGH};
static const cui_inline_item_select_struct priority_select = {PRIORITY_TOTAL, 0, priority_list};
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct delivery_time_caption = {STR_ID_UMMS_SETTINGS_DELIVERY_TIME};
#else
static const cui_inline_item_caption_struct delivery_time_caption = {NULL};
#endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static U16 delivery_time_list[] = 
{
    STR_ID_UMMS_SETTINGS_IMMEDIATE,
    STR_ID_UMMS_SETTINGS_DELV_1_HR,
    STR_ID_UMMS_SETTINGS_DELV_12_HRS,
    STR_ID_UMMS_SETTINGS_DELV_24_HRS
};
#else
static U16 delivery_time_list[] = 
{
    0,
    0,
    0,
    0
};
#endif
static const cui_inline_item_select_struct delivery_time_select = {DELIEVERY_TOTAL, 0, delivery_time_list};

#ifdef __MMI_MMS_HIDE_SENDER_SUPPORT__
static const cui_inline_item_caption_struct hide_sender_caption = {STR_ID_UMMS_SETTINGS_HIDE_SENDER};
static const cui_inline_item_select_struct hide_sender_select = {2, 0, on_off_list};
#endif /* __MMI_MMS_HIDE_SENDER_SUPPORT__ */ 

static const cui_inline_item_caption_struct send_save_caption = {STR_ID_UMMS_SETTINGS_SEND_AND_SAVE};
static const cui_inline_item_select_struct send_save_select = {2, 0, on_off_list};

#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
static const cui_inline_item_caption_struct sending_size_caption = {STR_ID_UMMS_SETTINGS_SIZE_LIMIT};
static U16 sending_size_list[] = 
{
    STR_ID_UMMS_SETTINGS_100K,
    STR_ID_UMMS_SETTINGS_300K,
    STR_ID_UMMS_SETTINGS_600K
};
static const cui_inline_item_select_struct sending_size_select = {SENDING_SIZE_LIMIT_TOTAL, 0, sending_size_list};
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 
const cui_inline_set_item_struct sending_settings_inline[] = 
{
#ifdef __MMI_MMS_SETTINGS_VALIDITY_PERIOD_VISIBILITY__
    {E_SENDING_VALIDITY_PERIOD_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &validity_period_caption},
    {E_SENDING_VALIDITY_PERIOD, CUI_INLINE_ITEM_TYPE_SELECT, 0, &validity_period_select},
#endif /* __MMI_MMS_SETTINGS_VALIDITY_PERIOD_VISIBILITY__ */ 
    {E_SENDING_DELIVERY_REPORT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &delivery_report_caption},
    {E_SENDING_DELIVERY_REPORT, CUI_INLINE_ITEM_TYPE_SELECT, 0, &delivery_report_select},
    {E_SENDING_READ_REPORT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &read_report_caption},
    {E_SENDING_READ_REPORT, CUI_INLINE_ITEM_TYPE_SELECT, 0, &read_report_select},
    {E_SENDING_PRIORITY_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &priority_caption},
    {E_SENDING_PRIORITY, CUI_INLINE_ITEM_TYPE_SELECT, 0, &priority_select},
    {E_SENDING_DELIVERY_TIME_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &delivery_time_caption},
    {E_SENDING_DELIVERY_TIME, CUI_INLINE_ITEM_TYPE_SELECT, 0, &delivery_time_select},
#ifdef __MMI_MMS_HIDE_SENDER_SUPPORT__
    {E_SENDING_HIDE_SENDER_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &hide_sender_caption},
    {E_SENDING_HIDE_SENDER, CUI_INLINE_ITEM_TYPE_SELECT, 0, &hide_sender_select},
#endif /* __MMI_MMS_HIDE_SENDER_SUPPORT__ */ 
    {E_SENDING_SEND_AND_SAVE_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &send_save_caption},
    {E_SENDING_SEND_AND_SAVE, CUI_INLINE_ITEM_TYPE_SELECT, 0, &send_save_select},
#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
    {E_SENDING_SIZE_LIMIT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, &sending_size_caption},
    {E_SENDING_SIZE_LIMIT, CUI_INLINE_ITEM_TYPE_SELECT, 0, &sending_size_select},
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 

};

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
cui_inline_struct sending_settings_initial_data = {SENDING_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    STR_ID_UMMS_MESSAGE_SETTINGS_SENDING,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    sending_settings_inline
};
#else
cui_inline_struct sending_settings_initial_data = {SENDING_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    NULL,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    sending_settings_inline
};
#endif

static const cui_inline_item_caption_struct home_network_caption = {STR_ID_UMMS_SETTINGS_HOME_NETWORK};
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct roaming_caption = {STR_ID_UMMS_SETTINGS_ROAMING};
#else
static const cui_inline_item_caption_struct roaming_caption = {NULL};
#endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct filter_caption = {STR_ID_UMMS_SETTINGS_FILTERS};
#else
static const cui_inline_item_caption_struct filter_caption = {NULL};
#endif
#ifdef __MMI_MMS_2_RETRIVAL_MODE_SETTING__
static U16 home_network_list[] = 
{
    STR_GLOBAL_YES,
    STR_ID_UMMS_DEFFERED,
    STR_GLOBAL_NO
};

static const cui_inline_item_select_struct home_network_select = {3, 0, home_network_list};
static U16 roaming_list[] = 
{
    STR_GLOBAL_NO,
    STR_GLOBAL_YES
};

static const cui_inline_item_select_struct roaming_select = {2, 0, roaming_list};
static const cui_inline_item_select_struct r_read_report_select = {2, 0, on_off_list};

#elif defined(__MMI_OP12_MMS_SUPPORT_SETTINGS__)
static U16 home_network_list[] = 
{
    STR_GLOBAL_AUTOMATIC,
    STR_ID_UMMS_MMS_RETRIEVAL_ALWAYS_ASK
};
static const cui_inline_item_select_struct home_network_select = {2, 0, home_network_list};
static U16 roaming_list[] = 
{
    STR_GLOBAL_AUTOMATIC,
    STR_ID_UMMS_MMS_RETRIEVAL_RESTRICTED
};

static const cui_inline_item_select_struct roaming_select = {2, 0, roaming_list};
#ifndef __MMI_MMS_NO_REPORT_SUPPORT__
static U16 r_read_report_select_list[] = 
{
    STR_ID_UMMS_SETTINGS_ON_REQUEST,
    STR_GLOBAL_SEND,
    STR_ID_UMMS_SETTINGS_NEVER_SEND
};
#else
static U16 r_read_report_select_list[] = 
{
    0,
    0,
    0
};
#endif
static const cui_inline_item_select_struct r_read_report_select = {3, 0, r_read_report_select_list};
#else 
static U16 home_network_list[] = 
{
    STR_ID_UMMS_SETTINGS_IMMEDIATE,
    STR_ID_UMMS_DEFFERED,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    STR_ID_UMMS_SETTINGS_REJECTIVE
#else
	0
#endif
};
static const cui_inline_item_select_struct home_network_select = {3, 0, home_network_list};
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static U16 roaming_list[] = 
{
    STR_ID_UMMS_SETTINGS_AS_HOME,
    STR_ID_UMMS_SETTINGS_IMMEDIATE,
    STR_ID_UMMS_DEFFERED,
    STR_ID_UMMS_SETTINGS_REJECTIVE
};
#else
static U16 roaming_list[] = 
{
    0,
    0,
    0,
    0
};
#endif
static const cui_inline_item_select_struct roaming_select = {4, 0, roaming_list};
#ifndef __MMI_MMS_NO_REPORT_SUPPORT__
static U16 r_read_report_list[] = 
{
    STR_ID_UMMS_SETTINGS_ON_REQUEST,
    STR_GLOBAL_SEND,
    STR_ID_UMMS_SETTINGS_NEVER_SEND
};
#else
static U16 r_read_report_list[] = 
{
    0,
    0,
    0
};
#endif
static const cui_inline_item_select_struct r_read_report_select = {3, 0, r_read_report_list};

#endif 
const cui_inline_set_item_struct retrieval_settings_inline[] = 
{
    {E_RETRIEVAL_HOME_NETWORK_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&home_network_caption)},
    {E_RETRIEVAL_HOME_NETWORK, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&home_network_select)},
    {E_RETRIEVAL_ROAMING_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&roaming_caption)},
    {E_RETRIEVAL_ROAMING, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&roaming_select)},
    {E_RETRIEVAL_FILTERS_CAPTION, CUI_INLINE_ITEM_TYPE_DISPLAY_ONLY, 0, (void *)(&filter_caption)},
    {E_RETRIEVAL_READ_REPORT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&read_report_caption)},
    {E_RETRIEVAL_READ_REPORT, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&r_read_report_select)},
    {E_RETRIEVAL_DELIVERY_REPORT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&delivery_report_caption)},
    {E_RETRIEVAL_DELIVERY_REPORT, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&delivery_report_select)},
};

cui_inline_set_item_struct retrieval_settings_inline_roam_capt =
    {E_RETRIEVAL_ROAMING_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&roaming_caption) };

cui_inline_set_item_struct retrieval_settings_inline_roaming =
    {E_RETRIEVAL_ROAMING, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&roaming_select) };
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
cui_inline_struct retrieval_settings_initial_data = {RETRIEVAL_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    STR_ID_UMMS_MESSAGE_SETTINGS_RETRIEVAL,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    retrieval_settings_inline
};
#else
cui_inline_struct retrieval_settings_initial_data = {RETRIEVAL_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    NULL,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    retrieval_settings_inline
};
#endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static const cui_inline_item_caption_struct anonymous_caption = {STR_ID_UMMS_SETTINGS_ANNONYMOUS};
static const cui_inline_item_caption_struct advertisment_caption = {STR_ID_UMMS_SETTINGS_ADVERTISMENT};
static U16 allow_reject_list[] = 
{
    STR_ID_UMMS_SETTINGS_ALLOW,
    STR_ID_UMMS_SETTINGS_REJECT
};
#else
static const cui_inline_item_caption_struct anonymous_caption = {0};
static const cui_inline_item_caption_struct advertisment_caption = {0};
static U16 allow_reject_list[] = 
{
    0,
    0
};
#endif
static const cui_inline_item_select_struct allow_reject_selection = {2, 0, allow_reject_list};

const cui_inline_set_item_struct retrieval_filters_settings_inline[] = 
{
    {E_RETRIEVAL_FILTERS_ANONYMOUS_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&anonymous_caption)},
    {E_RETRIEVAL_FILTERS_ANONYMOUS, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&allow_reject_selection)},
    {E_RETRIEVAL_FILTERS_ADVERTISEMENT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&advertisment_caption)},
    {E_RETRIEVAL_FILTERS_ADVERTISEMENT, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void *)(&allow_reject_selection)},
};

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
cui_inline_struct retrieval_filters_settings_initial_data = {RETRIEVAL_FILTER_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    STR_ID_UMMS_SETTINGS_FILTERS,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    retrieval_filters_settings_inline
};
#else
cui_inline_struct retrieval_filters_settings_initial_data = {RETRIEVAL_FILTER_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    0,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    retrieval_filters_settings_inline
};
#endif
#ifdef __MMI_MMS_SIGNATURE__
static const cui_inline_item_caption_struct signature_text_caption = {STR_GLOBAL_TEXT};

#ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
static const cui_inline_item_caption_struct signature_image_caption = {STR_GLOBAL_PICTURE};
#endif 
#ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
static const cui_inline_item_caption_struct signature_video_caption = {STR_GLOBAL_VIDEO};
#endif 
#ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
static const cui_inline_item_caption_struct signature_audio_caption = {STR_ID_UMMS_SETTINGS_SIGNATURE_AUDIO};
#endif 

cui_inline_item_fullscreen_edit_struct signature_text_full_screen =
    {0, STR_ID_UMMS_SETTINGS_EDIT_CONTENT, STR_ID_UMMS_SETTINGS_EDIT_CONTENT, 0, 0, IMM_INPUT_TYPE_SENTENCE,
UMMS_MAX_AUTO_SIGN_LENGTH + 1, NULL};
#if defined (__MMI_MMS_UMMS_IMAGE_FEATURE__) || defined (__MMI_MMS_UMMS_VIDEO_FEATURE__) || defined(__MMI_MMS_UMMS_AUDIO_FEATURE__)
static const cui_inline_item_caption_struct signature_display_only = {STR_ID_UMMS_SIGNATURE_SELECT_MEDIA};
#endif 

const cui_inline_set_item_struct compose_signature_settings_inline[] = 
{
    {E_COMPOSE_SIGNATURE_TEXT_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&signature_text_caption)},
    {E_COMPOSE_SIGNATURE_TEXT, CUI_INLINE_ITEM_TYPE_FULLSCREEN_EDIT, 0, (void *)(&signature_text_full_screen)},
#ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
    {E_COMPOSE_SIGNATURE_IMAGE_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&signature_image_caption)},
    {E_COMPOSE_SIGNATURE_IMAGE, CUI_INLINE_ITEM_TYPE_DISPLAY_ONLY, 0, (void *)(&signature_display_only)},
#endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
#ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
    {E_COMPOSE_SIGNATURE_VIDEO_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&signature_video_caption)},
    {E_COMPOSE_SIGNATURE_VIDEO, CUI_INLINE_ITEM_TYPE_DISPLAY_ONLY, 0, (void *)(&signature_display_only)},
#endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
#ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
    {E_COMPOSE_SIGNATURE_AUDIO_CAPTION, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void *)(&signature_audio_caption)},
    {E_COMPOSE_SIGNATURE_AUDIO, CUI_INLINE_ITEM_TYPE_DISPLAY_ONLY, 0, (void *)(&signature_display_only)},
#endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
};

cui_inline_struct compose_signature_settings_initial_data = {COMPOSE_SIGNATURE_INLINE_TOTAL - CUI_INLINE_ITEM_ID_BASE,
    STR_ID_UMMS_SETTINGS_SIGNATURE,
    0,
    CUI_INLINE_SCREEN_LOOP,
    &mmi_umms_inline_softkeys,
    compose_signature_settings_inline
};

#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_delete_option_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  folder_id       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_delete_option_screen(U8 folder_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_sh_delete_option_screen(folder_id);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_notification_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_notification_pre_func(U16 scr_id)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_notification_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_notification_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ForceSubLCDScreen(mmi_msg_start_msg_sub_anm);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_full_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_full_pre_func(U16 scr_id)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_full_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_full_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_draft_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_draft_options_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_draft_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_draft_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_progress_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_progress_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_progress_screen_struct *prgs;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    prgs = (mmi_umms_app_ui_draw_progress_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (prgs == NULL)
    {
        prgs =
            (mmi_umms_app_ui_draw_progress_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_progress_screen_struct));
        ASSERT(prgs);
        memset(prgs, 0, sizeof(mmi_umms_app_ui_draw_progress_screen_struct));
        prgs->scrn_id = scr_id;
        prgs->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
        /* prgs->get_message_cb = mmi_umms_app_ui_callback_get_progress_screen_data; */

        mmi_umms_app_sh_set_screen_context(scr_id, (void*)prgs);
        return MMI_UMMS_TRUE;
    }

    return MMI_UMMS_FALSE;  /* from history   */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_progress_scrn_data
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void *mmi_umms_app_ui_plug_in_progress_scrn_data(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_umms_app_dtmgr_get_progress_data();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_delete_confirm_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_delete_confirm_func(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    U16 message;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((srv_mms_bgsr_is_rr_pending(info->msg_id) && (info->folder_id != MMA_FOLDER_OUTBOX)) ||
        (mmi_frm_scrn_is_present
         (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER, MMI_FRM_NODE_ALL_FLAG)) &&
        info->msg_info->need_read_report)
    {
        message = STR_ID_CONFM_DELETE_READ_REPORT_MMS;
    }
#ifdef __MMI_MMS_REPORT_BOX_SUPPORT__
    else if (info->folder_id == MMA_FOLDER_REPORT_BOX)
    {
        message = STR_ID_UMMS_DELETE_REPORT_CONRM;
    }
#endif /* __MMI_MMS_REPORT_BOX_SUPPORT__ */ 
    else
    {
        message = STR_ID_UMMS_DELETE_CONRM;
    }
    mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) GetString(message),
        MMI_EVENT_QUERY,
        MMI_FALSE,
        MMI_FALSE,
        mmi_umms_app_sh_mms_option_delete_lsk_handler,  /* mmi_umms_entry_cancel_dwnld, */
        mmi_frm_scrn_close_active_id,
        NULL,
        NULL);
    return MMI_UMMS_TRUE;

}

#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__ */ 
    #ifdef __MMI_MMS_TEMPLATE_SUPPORT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_mms_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_mms_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_mms_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_mms_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_notification_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_notification_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_notification_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_notification_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_read_delivery_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_read_delivery_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_read_delivery_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_read_delivery_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_java_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_java_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_inbox_java_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_inbox_java_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sent_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sent_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sent_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sent_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_properties_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_properties_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_abnormal_view_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_abnormal_view_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_is_present
        (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_READ_DELIVERY_REPORT_VIEW_SCREEN,
         MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
    {
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_READ_DELIVERY_REPORT_VIEW_SCREEN);
    }
    if (mmi_frm_scrn_is_present
        (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_DELIVERY_READ_OPTION, MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
    {
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_DELIVERY_READ_OPTION);
    }
    if (mmi_frm_scrn_is_present
        (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_HANDLE_ABNORMAL_VIEW_SCREEN, MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
    {
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_HANDLE_ABNORMAL_VIEW_SCREEN);
    }
    info->is_already_viewed = MMI_TRUE;
    if (info->msg_info->is_read == KAL_FALSE
        && (info->msg_info->msg_type == MMA_MSG_TYPE_READ_REPORT ||
            info->msg_info->msg_type == MMA_MSG_TYPE_DELIVERY_REPORT))
    {
#ifdef __MMI_MMS_ITERATOR_VIEWER__
        srv_mms_um_refresh_ind_struct req;
#endif
        mmi_umms_app_dtmgr_set_readmark(info->msg_id, MMI_TRUE);
        info->msg_info->is_read = KAL_TRUE;
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        req.msg_box_type = info->folder_id;
        srv_mms_um_refresh_msg_list(&req);
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    }
#if defined  (__MMI_MMS_ITERATOR_VIEWER__) && defined(__MMI_FTE_SUPPORT__)
    if (info->msg_info->msg_type == MMA_MSG_TYPE_NOTIFICATION && srv_mms_bgsr_get_downloading_msg_id() == info->msg_id)
    {
        wgui_icon_bar_set_item_enable_state(0, MMI_FALSE);
        wgui_icon_bar_update();
    }
#endif /* defined  (__MMI_MMS_ITERATOR_VIEWER__) && defined(__MMI_FTE_SUPPORT__) */ 
    mmi_umms_app_sh_delete_progress_screen();
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_outbox_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_outbox_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_confirm_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void *mmi_umms_app_ui_plug_in_get_confirm_func(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_umms_app_dtmgr_get_confirm_screen_data();
}

#if(MMI_MAX_SIM_NUM == 2)


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sim_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sim_options_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sim_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sim_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}
#endif /* (MMI_MAX_SIM_NUM == 2) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_outbox_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_outbox_options_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sim_option_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 *  scr_id          [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sim_option_handling(U16 hilite_menu, U16 scr_id)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (hilite_menu)
    {
        #if((MMI_MAX_SIM_NUM == 2) || ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__)))
        case MENU_ID_UMMS_FROM_SIM1:
        {
            srv_mms_set_selected_sim_id((U8) MMI_SIM1);
            /* mmi_umms_app_plug_in_pre_entry_send_msg(); */
        }
            break;
        case MENU_ID_UMMS_FROM_SIM2:
        {
            srv_mms_set_selected_sim_id((U8) MMI_SIM2);
            /* mmi_umms_app_plug_in_pre_entry_send_msg(); */
        }
            break;

        #if((MMI_MAX_SIM_NUM >= 3) && defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__))
        case MENU_ID_UMMS_FROM_SIM3:
        {
            srv_mms_set_selected_sim_id((U8) MMI_SIM3);
            /* mmi_umms_app_plug_in_pre_entry_send_msg(); */
        }
            break;
        #endif
        #if((MMI_MAX_SIM_NUM >= 4) && defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__))
        case MENU_ID_UMMS_FROM_SIM4:
        {
            srv_mms_set_selected_sim_id((U8) MMI_SIM4);
            /* mmi_umms_app_plug_in_pre_entry_send_msg(); */
        }
            break;
        #endif
        #endif
        default:
            break;
       
    }
    mmi_umms_app_plug_in_pre_entry_send_msg();
    return MMI_UMMS_TRUE;
}

#ifdef __MMI_MMS_TEMPLATE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_user_defined_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_user_defined_options_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_user_defined_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_user_defined_options_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_settings_sim_selection_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_settings_sim_selection_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_settings_sim_selection_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_settings_sim_selection_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_sim_profile
 * DESCRIPTION
 *  
 * PARAMETERS
 *  sim_id      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_show_sim_profile(mmi_sim_enum sim_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_wap_prof_sim_id_enum wap_sim_id = SRV_WAP_PROF_SIMID_DEFAULT;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wap_sim_id = (srv_wap_prof_sim_id_enum)mmi_umms_app_util_convert_to_wap_sim_id(sim_id);
    srv_wap_prof_display_profile_list(
        wap_sim_id,
        SRV_WAP_PROF_APPID_MMS,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        MENU_ID_UMMS_MESSAGE_SETTINGS_FOR_COMMON_SETTINGS,
        mmi_umms_dtmgr_get_group_id());
}

#ifdef __MMI_MMS_TEMPLATE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_default_template_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_default_template_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *dynamic_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dynamic_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (dynamic_scr == NULL)
    {
        dynamic_scr =
            (mmi_umms_app_ui_draw_dynamic_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        ASSERT(dynamic_scr);
        memset(dynamic_scr, 0, sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        dynamic_scr->scrn_id = scr_id;
        dynamic_scr->get_item_cb = mmi_umms_app_ui_callback_template_get_data;
        dynamic_scr->number_of_item = mmi_umms_app_dtmgr_get_template_count()/*Hardcode*/;
        dynamic_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

        mmi_umms_app_sh_set_screen_context(scr_id, (void*)dynamic_scr);

        return MMI_UMMS_TRUE;
    }
    dynamic_scr->number_of_item = mmi_umms_app_dtmgr_get_template_count()/*Hardcode*/;
    dynamic_scr->hilighted_item = mmi_umms_app_dtmgr_get_current_message_index();
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_default_template_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_default_template_post_func(U16 scr_id)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 icon_id = mmi_umms_app_dtmgr_get_template_list_csk_icon_id();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeCenterSoftkey(0, icon_id);

    if (icon_id)
    {
        SetCenterSoftkeyFunction(mmi_umms_app_ui_plug_in_template_view_by_csk, KEY_EVENT_UP);
        //#if defined(__MMI_TOUCH_SCREEN__)
        //     register_center_softkey_to_enter_key();
        //        #endif
        //SetKeyHandler(mmi_umms_app_ui_plug_in_template_view_by_csk, KEY_CSK, KEY_EVENT_UP);
    }
    else
    {
        SetCenterSoftkeyFunction(NULL, KEY_EVENT_UP);
        //        #if defined(__MMI_TOUCH_SCREEN__)
        //                register_center_softkey_to_enter_key();
        //        #endif
        //SetKeyHandler(NULL, KEY_CSK, KEY_EVENT_UP);
    }


    //      SetKeyHandler(mmi_umms_app_ui_plug_in_handle_mms_template_option, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    //   SetKeyHandler(mmi_frm_scrn_close_active_id, KEY_LEFT_ARROW, KEY_EVENT_DOWN);    
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS_TMPLT);
    SetLeftSoftkeyFunction(mmi_umms_app_ui_plug_in_handle_mms_template_option, KEY_EVENT_UP);

#if (defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__))

    wgui_register_tap_callback(mmi_umms_app_ui_template_list_fte_tap_callback);

#endif /* __MMI_FTE_SUPPORT__ */ 
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_template_view_by_csk
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_template_view_by_csk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 msg_id;
    MMI_BOOL flag = 0;
    U16 box_type = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    flag = mmi_umms_app_dtmgr_get_current_template_type();
    msg_id = mmi_umms_app_dtmgr_get_current_hilighted_msg_id();
    if (flag == MMI_UMMS_DEFAULT_TYPE)
    {
        box_type = SRV_UM_MSG_BOX_PREDEF_TEMPLATES;
    }
    else if (flag == MMI_UMMS_USER_DEFINED_TYPE)
    {
        box_type = SRV_UM_MSG_BOX_USRDEF_TEMPLATES;
    }

    mmi_umms_app_interface_entry_from_um(MMI_UM_UI_ENTRY_KEY_CSK, msg_id, NULL, GRP_ID_UMMS_LIST_TEMPLATES);
}

#endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_progress_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_progress_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_confirm_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_confirm_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_confirm_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_confirm_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_popup_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_popup_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_popup_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_popup_post_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_preview_option_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 *  scr_id          [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_preview_option_handling(U16 hilite_menu, U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (hilite_menu)
    {
    #ifdef __MMI_UMMS_PREVIEW_SEND__
        case MENU_ID_UMMS_PREVIEW_SEND:
            mmi_umms_app_if_preview_uc_send();
            break;
    #endif /* __MMI_UMMS_PREVIEW_SEND__ */ 
        case MENU_ID_UMMS_PREVIEW_GO_TO:
            mmi_umms_app_if_show_preview_slide_list();
            break;
    }
    return MMI_UMMS_TRUE;
}

#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_create_dynamic_scrn_data
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_create_dynamic_scrn_data(U16 hilite_menu)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *use_detail_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    use_detail_scr =
        (mmi_umms_app_ui_draw_dynamic_screen_struct*)
        srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
    ASSERT(use_detail_scr);
    memset(use_detail_scr, 0, sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
    use_detail_scr->highlighted_menu = hilite_menu;
    mmi_umms_app_sh_set_screen_context(SCR_ID_UMMS_ADD_RECIPIENT, (void*)use_detail_scr);

}
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_option_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 *  scr_id          [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_option_handling(U16 hilite_menu, U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_dtmgr_option_scr_data_struct *scr_info;
#endif

    mma_mms_description_struct *desc;
    mmi_umms_start_uc_struct uc_start;
    mmi_ucm_make_call_para_struct make_call_para;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
#ifndef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    U32 max_msg_size = 0;
#elif defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)
    U32 max_msg_size = 0;
#endif 
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 
#if(MMI_MAX_SIM_NUM >= 3)

    MMI_ID sim_sel_cui_id;
    MMI_ID sim_sel_parent_id;
    mmi_umms_action_type_struct *data;
    U32 valid_sim_id_info;
#endif /* (MMI_MAX_SIM_NUM >= 3) */ 
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_dtmgr_context *cntx = mmi_umms_app_dtmgr_get_current_cntx(MMI_UMMS_APP_DTMGR_REQ_VIEWER_INFO);

    /* mmi_umms_app_dtmgr_viewer_info_data *data; */
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    scr_info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
#endif
    desc = srv_mms_get_desc_pointer();
    switch (hilite_menu)
    {

    #ifdef __MMI_OP11_MMS_SUPPORT_AUDIO_MSG__
/* under construction !*/
    #endif 

    #ifdef __MMI_OP11_MMS_SUPPORT_PHOTO_MSG__
/* under construction !*/
    #endif 

    #ifdef __MMI_OP11_MMS_SUPPORT_VIDEO_MSG__
/* under construction !*/
    #endif 
        case MENU_ID_UMMS_OPTIONS_VIEW:
        {

            if ((info->msg_info->msg_type == MMA_MSG_TYPE_DELIVERY_REPORT) ||
                (info->msg_info->msg_type == MMA_MSG_TYPE_READ_REPORT))
            {
                if (mmi_frm_scrn_is_present
                    (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_READ_DELIVERY_REPORT_VIEW_SCREEN,
                     MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
                {
                    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_READ_DELIVERY_REPORT_VIEW_SCREEN);
                }
                mmi_umms_app_if_show_rr_dr_view_screen();
                break;
            }

            if ((srv_mms_bgsr_get_msg_status(info->msg_id) == SRV_MMS_BGSR_STATUS_SENDING))
            {
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_ID_UMMS_MESSAGE_IS_IN_SEND),
                    MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
                mmi_umms_app_sh_delete_umms_screens();
                break;

            }
        }
            {
                if (info->is_already_viewed == MMI_FALSE)
                {
                #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    mmi_umms_app_start_struct msg;

                    memset(&msg, 0, sizeof(mmi_umms_app_start_struct));
                    msg.action = MMI_UMMS_OPEN_MMS_VIEWER;
                    msg.msg_box_type = srv_mms_convert_mma_folder_to_umbox_type(scr_info->folder_id);
                    msg.parent_grp_id = mmi_umms_app_dtmgr_get_parent_grp_id();
                    msg.msg_id = scr_info->msg_id;
                    mmi_umms_app_if_show_mms_view_screen(&msg);
                #else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
                    srv_mms_set_open_mode(MMA_MODE_VIEW);
                    mmi_umms_app_if_show_viewer_screen();
                #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
                }
                else
                {
                    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr = NULL;

                    /* GetPreviousScrnIdOf(scrDB->scrn_id, &previous_id); */
                    viewer_scr =
                        (mmi_umms_app_ui_draw_viewer_screen_struct*)
                        mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);
                    ASSERT(viewer_scr);
                    viewer_scr->is_review = MMI_TRUE;
                    mmi_umms_app_if_show_viewer_screen();
                }

            }
            break;
        #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
        case MENU_ID_UMMS_OPTIONS_MANUAL_PLAY:
        {

            U16 current_slide = desc->body->curr_slide->slide_num;

            mmi_umms_app_ui_plug_in_goto_slide((U16) current_slide);

        }
            break;
        case MENU_ID_UMMS_OPTIONS_MANUAL_PLAY_VIEW_FROM_START:
        {

            mmi_umms_app_ui_plug_in_goto_slide((U16) 1);

        }
            break;
        #endif /* __MMI_MMS2_MV_MANUAL_PLAY__ */ 
    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
        case MENU_ID_UMMS_OPTIONS_MANUAL_PLAY:
        {

            mmi_umms_app_ui_plug_in_goto_slide((U16) (1));

        }
            break;
    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 

    #ifdef __MMI_MMS_REPORT_BOX_SUPPORT__
        case MENU_ID_UMMS_CALL:
        {
            U8 result = 0;
            mma_msg_addr_info_struct addr;

            result = mma_mms_get_report_address(info->msg_id, &addr);

            MMI_TRACE(
                MMI_INET_TRC_G6_MMS,
                MMI_TRC_UMMS_MSG_CALL,
                info->msg_id,
                result,
                addr.addr_len,
                addr.addr_group,
                addr.addr_type);
            if (result == MMA_RESULT_OK)
            {
                if (addr.addr_type == MMA_ADDR_TYPE_PHONE_NUMBER && srv_mms_num_valid_sim())
                {
                    mmi_umms_app_ui_draw_dummy_screen();
                    /* mmi_ucm_app_entry_dial_option((U8*) (info->msg_info->from_address), NULL, NULL); */
                    mmi_ucm_init_call_para(&make_call_para);
                    make_call_para.dial_type = SRV_UCM_CALL_TYPE_ALL;
                    make_call_para.adv_para.after_make_call_callback = NULL;
                    make_call_para.ucs2_num_uri = (U16*) addr.address;
                    mmi_ucm_call_launch(0, &make_call_para);
                }
                else
                {
                    mmi_umms_app_dtmgr_set_popup_screen_para(
                        (U16*) GetString(STR_GLOBAL_INVALID_NUMBER),
                        MMI_EVENT_PROPLEM);
                    mmi_umms_app_if_show_display_popup_screen();
                }
            }
            else
            {
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_GLOBAL_BUSY_TRY_LATER /* STR_GLOBAL_UNAVAILABLE */ ),
                    MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
            }
            if (mmi_frm_scrn_is_present
                (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER, MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
            {
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_MMS_OPTION);
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_NOTIFICATION_OPTION);
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_DELIVERY_READ_OPTION);
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_JAVA_OPTIONS);
            }
            else
            {
                mmi_umms_app_sh_delete_umms_screens();
            }
            break;
        }
    #endif /* __MMI_MMS_REPORT_BOX_SUPPORT__ */ 
    #ifdef __MMI_MMS_REPORT_STATUS_MENU_SUPPORT__
        case MENU_ID_UMMS_OPTIONS_DELIVERY_STATUS:
            mmi_umms_app_if_show_delivery_status();
            break;
        case MENU_ID_UMMS_OPTIONS_READ_STATUS:
            mmi_umms_app_if_show_read_status();
            break;
    #endif /* __MMI_MMS_REPORT_STATUS_MENU_SUPPORT__ */ 

    #if (defined (__MMS_STANDALONE_COMPOSER_SUPPORT__) || defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__) ||  defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__))
        case MENU_ID_UMMS_OPTION_REPLY_SMS:
            /* call api */
            mmi_umms_app_ui_plug_in_reply_as_sms();
            break;
    #endif /* (defined (__MMS_STANDALONE_COMPOSER_SUPPORT__) || defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)) */ /* (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined (__MMS_STANDALONE_COMPOSER_SUPPORT__) || defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)) */

    #if (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined (__MMS_STANDALONE_COMPOSER_SUPPORT__) || defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__) ||  defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__))
        case MENU_ID_UMMS_OPTIONS_REPLY:
        {
            mmi_umms_app_ui_plug_in_reply();
            break;

        }
    #endif /* (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined (__MMS_STANDALONE_COMPOSER_SUPPORT__) || defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)) */ 
    #if 0
    #ifdef __UNIFIED_MESSAGE_SORT_MESSAGE_LIST__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* __UNIFIED_MESSAGE_SORT_MESSAGE_LIST__ */ 
    #endif /* 0 */ 
    #ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
        case MENU_ID_UMMS_OPTIONS_MOVE_TO_ARCHIVE:
        {
        #if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
        #endif /* 0 */ 
            mmi_umms_app_sh_move_to_archive_confirm_lsk_handler();

            break;
        }
    #endif /* __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__ */ 
    #if 0
    #ifdef __UNIFIED_MESSAGE_MARK_SEVERAL_SUPPORT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* __UNIFIED_MESSAGE_MARK_SEVERAL_SUPPORT__ */ 
    #endif /* 0 */ 
    #ifdef __MMI_MMS_SWITCH_MSG_READ_STATUS__
        case MENU_ID_UMMS_INBOX_OPTION_MARK_AS_READ:
        {
            U8 srv_result = 0;
            U8 error = 0;

            srv_result = srv_mms_set_read_status(info->msg_id, MMI_TRUE, &error);
            mmi_umms_app_dtmgr_update_read_status(info->msg_id, MMI_TRUE);

            if (srv_result != SRV_MMS_RESULT_OK)
            {
                mmi_umms_app_if_show_error_pop_up(MMA_RESULT_FAIL);
                mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
                break;
            }

            mmi_umms_app_if_show_error_pop_up(error);
            srv_mms_show_status_icon();
            mmi_umms_app_sh_delete_umms_screens();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        }
            break;
        case MENU_ID_UMMS_INBOX_OPTION_MARK_AS_UNREAD:
        {
            U8 srv_result = 0;
            U8 error = 0;

        #ifdef __MMI_MMS_ITERATOR_VIEWER__
            mmi_um_iter_viewer_result_struct other_msg_data;
            U8 folder_id;
            MMI_UMMS_ERROR ret_val = MMI_UMMS_FALSE;
            void *um_data = NULL;
            mmi_id parent_id;
        #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

            srv_result = srv_mms_set_read_status(info->msg_id, MMI_FALSE, &error);
            mmi_umms_app_dtmgr_update_read_status(info->msg_id, MMI_FALSE);

        #ifdef __MMI_MMS_ITERATOR_VIEWER__
            ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
            parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();

        #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
            if (srv_result != SRV_MMS_RESULT_OK)
            {
                mmi_umms_app_if_show_error_pop_up(MMA_RESULT_FAIL);
                mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
                break;
            }

            mmi_umms_app_if_show_error_pop_up(error);
            srv_mms_show_status_icon();
            mmi_umms_app_sh_delete_umms_screens();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        #ifdef __MMI_MMS_ITERATOR_VIEWER__
            if (ret_val == MMI_UMMS_TRUE)
            {
                mmi_umms_app_dtmgr_handle_action_on_curr_msg(other_msg_data, folder_id, um_data, parent_id);
            }
        #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

        }
            break;
    #endif /* __MMI_MMS_SWITCH_MSG_READ_STATUS__ */ 

    #ifdef __MMI_OP11_HOMESCREEN__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* __MMI_OP11_HOMESCREEN__ */ 

    #ifdef __MMI_MMS_BGSR_CANCEL_PROHIBIT__
        case MENU_ID_UMMS_INBOX_OPTIONS_CANCEL_DOWNLOAD:

            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_CANCEL_DWNLD_CNFRM),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_sh_cancel_dwnld_lsk_handler,   /* mmi_umms_entry_cancel_dwnld, */
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
            break;
    #endif /* __MMI_MMS_BGSR_CANCEL_PROHIBIT__ */ 

        case MENU_ID_UMMS_OPTIONS_REPLY_ALL:
        {

            memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
            uc_start.msg_id = info->msg_id;
            uc_start.uc_mode = MMA_MODE_REPLY_ALL;
            uc_start.sim_id = info->msg_info->msg_sim_id;
            uc_start.storage_type = info->msg_info->msg_storage;
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
            }
        #endif /* __MMI_MMS_POSTCARD__ */ 

            mmi_umms_start_uc(&uc_start);
            mmi_umms_app_sh_delete_option_screen(info->folder_id);
        }
            break;
    
        case MENU_ID_UMMS_CALL_SENDER:
            if (info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER && srv_mms_num_valid_sim())
            {
                mmi_umms_app_ui_draw_dummy_screen();
                /* mmi_ucm_app_entry_dial_option((U8*) (info->msg_info->from_address), NULL, NULL); */
                mmi_ucm_init_call_para(&make_call_para);
                make_call_para.dial_type = SRV_UCM_CALL_TYPE_ALL;
                make_call_para.adv_para.after_make_call_callback = NULL;
                make_call_para.ucs2_num_uri = (U16*) info->msg_info->from_address;
                mmi_ucm_call_launch(0, &make_call_para);
            }
            else
            {
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_GLOBAL_INVALID_NUMBER),
                    MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
            }
            if (mmi_frm_scrn_is_present
                (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER, MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
            {
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_MMS_OPTION);
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_NOTIFICATION_OPTION);
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_DELIVERY_READ_OPTION);
                mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_JAVA_OPTIONS);
            }
            else
            {
                mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            }
            break;

        case MENU_ID_UMMS_OPTIONS_FORWARD:
        #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            mmi_umms_app_ui_plug_in_forward();
        #else 
            mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_FORWARD);
        #endif 
            break;
        #ifndef __MMI_SLIM_MMS_2__
        case MENU_ID_UMMS_OPTIONS_LOCK:
            mmi_umms_app_ui_plug_in_set_lock_mode_req();
            break;

        case MENU_ID_UMMS_OPTIONS_UNLOCK:
            mmi_umms_app_ui_plug_in_set_lock_mode_req();
            break;
        #endif /* __MMI_SLIM_MMS_2__ */ 
        case MENU_ID_UMMS_OPTIONS_DELETE:
            mmi_umms_app_ui_plug_in_delete_confirm_func();
            mmi_umms_app_if_show_display_confirm_screen();
            break;
        #if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
        #endif /* 0 */ 
        case MENU_ID_UMMS_SAVE_CONTACT:
            mmi_umms_app_ui_plug_in_save_to_contacts();
            break;
        #ifdef __MMI_MMS_TEMPLATE_SUPPORT__
        case MENU_ID_UMMS_SAVE_TO_TEMPLATE:
            MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_ENTRY_SAVE_AS_TEMPLATE, info->msg_id);
            if (srv_mms_get_userdef_template_num() >= MAX_USERDEF_TEMPLATE)
            {
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_ID_UMMS_MAX_TEMPLATE_ALREADY_PRESENT),
                    MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
            }
            else
            {
                mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_SAVING);
                mmi_umms_app_if_show_progress_screen();
                mmi_umms_app_ui_plug_in_save_as_template(info->msg_id);
            }
            break;
        #endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 

        case MENU_ID_UMMS_OPTIONS_USE_DETAILS:
            /* mmi_umms_app_if_show_use_details_menu(); */
            break;

        case MENU_ID_UMMS_OPTIONS_SAVE_OBJECTS:
            mmi_umms_app_ui_callback_save_objects_items_check_for_empty();
            break;

        case MENU_ID_UMMS_OPTIONS_PROPERTIES:
            mmi_umms_app_if_show_property_screen();
            break;

        case MENU_ID_UMMS_OPTIONS_SEND:
            mmi_umms_app_plug_in_pre_entry_send_msg();
            break;

		#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case MENU_ID_UMMS_PREVIEW_MMS:
            srv_mms_set_open_mode(MMA_MODE_VIEW);
			#if defined(__MMI_FTE_SUPPORT__)
			srv_mms_set_is_preview_from_cui(MMI_TRUE);
            #endif
            info->is_preview = MMI_TRUE;
            mmi_umms_app_core_handle_view();
            break;
        case MENU_ID_UMMS_EDIT_CONTENT:
            srv_mms_set_open_mode(MMA_MODE_EDIT);
			#if defined(__MMI_FTE_SUPPORT__)
			srv_mms_set_is_preview_from_cui(MMI_FALSE);
            #endif
            info->is_preview = MMI_TRUE;
            mmi_umms_app_core_handle_view();
            break;
        #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
#ifdef __MMI_MMS_TEMPLATE_SUPPORT__
        case MENU_ID_UMMS_TEMPLATES_OPTIONS_WRITE_MESSAGE:
#endif
        #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case MENU_ID_UMMS_OPTIONS_EDIT_MESSAGE:
        #endif 
            MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_ENTRY_EDIT, info->msg_id);
        #ifndef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
        #ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    
            if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
                SRV_WAP_PROF_CONN_TYPE_HTTP)

            {
                max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
                if (info->msg_info->user_element_size > max_msg_size)
                {
                    mmi_umms_app_plug_in_wap_connection_error_popup(
                        info->msg_info->user_element_size,
                        max_msg_size,
                        STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
                    return;
                }
            }
        #elif defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)
    
            if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
                SRV_WAP_PROF_CONN_TYPE_HTTP)
    
            {
                max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
                if (info->msg_info->msg_size > max_msg_size)
                {
                    mmi_umms_app_plug_in_wap_connection_error_popup(
                        info->msg_info->msg_size,
                        max_msg_size,
                        STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
                    return;
                }
            }
        #endif 
        #endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 
		#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            if (info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)
            {
                mma_creation_mode_enum creation_mode;

                creation_mode = srv_mms_compose_settings_creation_mode();
                /* info->uc_mode = MMA_MODE_EDIT; */
                if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                {
                    mmi_umms_app_dtmgr_set_confirm_screen_para(
                        STR_GLOBAL_YES,
                        IMG_GLOBAL_YES,
                        STR_GLOBAL_NO,
                        IMG_GLOBAL_NO,
                        (U16*) GetString(STR_ID_UMMS_RESTRICTED_MODE),
                        MMI_EVENT_QUERY,
                        MMI_FALSE,
                        MMI_FALSE,
                        mmi_umms_app_ui_plug_in_final_edit,
                        mmi_frm_scrn_close_active_id,
                        NULL,
                        NULL);
                    mmi_umms_app_if_show_display_confirm_screen();

                }
                else if (creation_mode == MMA_CREATION_MODE_WARNING)
                {

                    mmi_umms_app_dtmgr_set_confirm_screen_para(
                        STR_GLOBAL_YES,
                        IMG_GLOBAL_YES,
                        STR_GLOBAL_NO,
                        IMG_GLOBAL_NO,
                        (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                        MMI_EVENT_QUERY,
                        MMI_FALSE,
                        MMI_TRUE,
                        mmi_umms_app_ui_plug_in_final_edit,
                        mmi_frm_scrn_close_active_id,
                        NULL,
                        NULL);
                    mmi_umms_app_if_show_display_confirm_screen();
                }
                else
                {
                #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
                    uc_start.msg_id = info->msg_id;
                    uc_start.uc_mode = MMA_MODE_EDIT;
                    uc_start.sim_id = MMI_SIM1;
                    uc_start.storage_type = info->msg_info->msg_storage;
                #ifdef __MMI_MMS_POSTCARD__
                    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
                    {
                        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
                    }
                #endif /* __MMI_MMS_POSTCARD__ */ 

                    mmi_umms_start_uc(&uc_start);
                    mmi_umms_app_sh_delete_option_screen(info->folder_id);
                    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
                #else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
                    mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_EDIT);
                #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
                }
            }
            else
#endif/*#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
            {
            #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
                uc_start.msg_id = info->msg_id;
                uc_start.uc_mode = MMA_MODE_EDIT;
                uc_start.sim_id = MMI_SIM1;
            #ifdef __MMI_MMS_POSTCARD__
                if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
                {
                    uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
                }
            #endif /* __MMI_MMS_POSTCARD__ */ 
                uc_start.storage_type = info->msg_info->msg_storage;
                mmi_umms_start_uc(&uc_start);
                mmi_umms_app_sh_delete_option_screen(info->folder_id);
                mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            #else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
                mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_EDIT);
            #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
            }
            break;
        #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        #if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
        #endif /* 0 */ 
        #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        case MENU_ID_UMMS_INBOX_OPTIONS_DOWNLOAD:
            mmi_umms_app_ui_plug_in_download();
            break;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case MENU_ID_UMMS_OUTBOX_OPTIONS_MESSAGE_STATUS:
            mmi_umms_app_if_show_message_status_screen();
            break;
#endif

        case MENU_ID_UMMS_OPTIONS_RESEND:

        #if(MMI_MAX_SIM_NUM >= 2)
            srv_mms_set_selected_sim_id(0);

            if (srv_mms_num_valid_sim() > 1)
            {
            #if ((MMI_MAX_SIM_NUM >= 3) && !defined(__MMI_DYNAMIC_SIM_DYNAMIC_UI__))
                /* LAUNCH SIM SELECTOR CUI */
                data =
                    (mmi_umms_action_type_struct*) srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_action_type_struct));
                MMI_ASSERT(data);
                sim_sel_parent_id = mmi_frm_group_create_ex(
                                        mmi_umms_app_dtmgr_get_parent_grp_id(),
                                        GRP_ID_AUTO_GEN,
                                        mmi_umms_app_ui_callback_sim_sel_post_action_decide,
                                        NULL,
                                        MMI_FRM_NODE_SMART_CLOSE_FLAG);
                data->msg_action = UMMS_ACTION_RESEND;
                sim_sel_cui_id = cui_sim_sel_create(sim_sel_parent_id, srv_mms_get_sim_valid_flag(), (void*)data);
                if (sim_sel_cui_id != GRP_ID_INVALID)
                {
                    mmi_umms_app_dtmgr_set_sim_sel_cui_id(sim_sel_cui_id);
                    cui_sim_sel_set_highlight_sim(info->msg_info->msg_sim_id);
                    cui_sim_sel_run(sim_sel_cui_id);
                }

            #endif /* (MMI_MAX_SIM_NUM >= 3) */ /* (MMI_MAX_SIM_NUM >= 3) */
            }
            else
            {
                mmi_umms_app_plug_in_pre_entry_send_msg();
            }
        #else /* (MMI_MAX_SIM_NUM >= 2) */ /* (MMI_MAX_SIM_NUM >= 2) */
            mmi_umms_app_plug_in_pre_entry_send_msg();
        #endif /* (MMI_MAX_SIM_NUM >= 2) */ /* (MMI_MAX_SIM_NUM >= 2) */
            break;
        case MENU_ID_UMMS_OUTBOX_OPTIONS_CANCEL_SEND:
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_CANCEL_SEND_CNFRM),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_plug_in_entry_cancel_send,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();

            break;
        #if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) && !defined(__MMI_MMS_ONLY_MEMORY_CARD_STORAGE_SUPPORT__)
        #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case MENU_ID_UMMS_OPTIONS_MOVE_TO_PHONE:

            mmi_umms_app_plug_in_move_done();

            break;
        case MENU_ID_UMMS_OPTIONS_MOVE_TO_CARD:
            mmi_umms_app_plug_in_move_done();

            break;
        #endif
#ifndef __MMI_MMS_ONLY_MEMORY_CARD_STORAGE_SUPPORT__
        case MENU_ID_UMMS_OPTIONS_COPY_TO_PHONE:
            mmi_umms_app_plug_in_copy_done();

            break;
        case MENU_ID_UMMS_OPTIONS_COPY_TO_CARD:
            mmi_umms_app_plug_in_copy_done();
#endif

            break;
        #endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
        default:
            break;

    }

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_rr_yes_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_rr_yes_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if(MMI_MAX_SIM_NUM >= 2)
    U16 str_id = 0;
#endif 
    mmi_umms_app_dtmgr_option_scr_data_struct *data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data->msg_info->need_read_report = KAL_TRUE;
#if(MMI_MAX_SIM_NUM >= 2)
    if (MMI_FALSE == srv_mms_is_sim_valid((mmi_sim_enum) data->msg_info->msg_sim_id))
    {
        str_id = STR_ID_UMMS_SIM_INVALID;
        data->msg_info->need_read_report = KAL_FALSE;
        if (data->set_read_mark == 1)
        {
#ifdef __MMI_MMS_ITERATOR_VIEWER__
            srv_mms_um_refresh_ind_struct req;
#endif
            mmi_umms_app_dtmgr_set_readmark(data->msg_id, MMI_TRUE);
            data->set_read_mark = 0;
        #ifdef __MMI_MMS_ITERATOR_VIEWER__
            req.msg_box_type = data->folder_id;
            srv_mms_um_refresh_msg_list(&req);
        #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

        }
        mmi_umms_app_dtmgr_set_callback_popup_screen_para(
            (U16*) GetString(str_id),
            MMI_EVENT_FAILURE,
            mmi_umms_app_if_show_viewer_screen,
            mmi_umms_app_if_deinit_viewer);
        mmi_umms_app_if_show_display_callback_popup_screen();
        return MMI_UMMS_TRUE;
    }
#endif /* (MMI_MAX_SIM_NUM >= 2) */ /* ( defined (__MMI_MMS_DUAL_SIM__) || defined (__GEMINI__) || (GEMINI_PLUS > 2)) */
    mmi_umms_app_if_show_viewer_screen();
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_rr_no_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_rr_no_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data->msg_info->need_read_report = KAL_FALSE;
    mmi_umms_ui_plug_in_read_report_cancel_hdlr();
    if (data->set_read_mark == 1)
    {
#ifdef __MMI_MMS_ITERATOR_VIEWER__
        srv_mms_um_refresh_ind_struct req;
#endif
        mmi_umms_app_dtmgr_set_readmark(data->msg_id, MMI_TRUE);
        data->set_read_mark = 0;
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        req.msg_box_type = data->folder_id;
        srv_mms_um_refresh_msg_list(&req);
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    }
    mmi_umms_app_if_show_viewer_screen();
    return MMI_UMMS_TRUE;
}

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_viewer_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_viewer_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_description_struct *desc;
    wgui_mv_initialize_struct init;
    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr;
    MMI_BOOL is_review = MMI_FALSE;
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    S32 *parent_fh;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    viewer_scr = (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    desc = srv_mms_get_desc_pointer();
    if (viewer_scr == NULL)
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_ENTRY_FIRST_TIME);
        //      ASSERT(viewer_data->cat_info);
        //((viewer_data->cat_info)->msg_cntx)->current_slide = ((viewer_data->cat_info)->msg_cntx)->slide_head;

        /* Callbacks to APP */
        memset(&init, 0, sizeof(wgui_mv_initialize_struct));
        init.get_filename_by_id_cb = mmi_umms_app_ui_callback_get_filename_by_id;
        init.load_slide_txt_cb = mmi_umms_app_ui_callback_load_ucs2_txt_to_buffer;
        init.check_rights_cb = mmi_umms_app_ui_callback_check_rights_by_id;
        init.consume_rights_cb = mmi_umms_app_ui_callback_start_consume_rights;
        init.stop_consume_rights_cb = mmi_umms_app_ui_callback_stop_consume_rights;
        init.update_rights_cb = mmi_umms_app_ui_callback_update_rights_by_id;
        init.stop_app_cb = mmi_umms_app_ui_callback_exit_viewer_application;
        init.allow_audio_cb = mmi_umms_app_ui_callback_allow_audio_playing;
        init.best_page_duration_cb = mmi_umms_app_ui_callback_best_page_duration;
    #ifdef __MMI_MV_SUPPORT_USE_DETAIL_HIGHLIGHT__
        init.mid_slides_cb = mmi_umms_app_ui_callback_viewer_mid_slides_cb;     /* app logic will ask dtmanager which will start service and keep use_details_list with it */
        init.get_highlighted_items = mmi_umms_app_ui_callback_viewer_get_use_details_on_slide;
        init.highlight_handler = mmi_umms_app_sh_viewer_hilitte_hdlr;
    #ifdef __MMI_TOUCH_SCREEN__
        init.highlight_click_handler = mmi_umms_app_sh_viewer_hilitte_click_hdlr;
    #endif 
    #endif /* __MMI_MV_SUPPORT_USE_DETAIL_HIGHLIGHT__ */ 
        init.finish_playing = mmi_umms_app_ui_callback_viewer_stop_callback;
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        init.left_iterate_func = mmi_umms_app_ui_callback_display_previous_mms;
        init.right_iterate_func = mmi_umms_app_ui_callback_display_next_mms;
        init.get_index_func = mmi_umms_app_ui_callback_get_index_data;
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    #ifdef __MMI_MSG_FTE_ENHANCE__
        init.app_fte_common_cb = mmi_umms_app_ui_callback_viewer_fte2_common_cb;
    #endif 
		
		init.app_common_action_callback = mmi_umms_app_ui_callback_app_common_action;
        
        #ifdef __MMI_MMS_IMAGE_VIEW_ENHANCEMENT__  
		init.decode_image_for_clear_image = mmi_umms_app_ui_callback_decode_image ;
        #endif
        /* Callbacks to APP */

        /* Data Members */

        init.current_msg.slide_head = desc->body->slides;
        desc->body->curr_slide = desc->body->slides;
        init.current_msg.background_color = desc->body->bgColor;
        init.current_msg.current_slide = &(desc->body->curr_slide);
        init.current_msg.current_slide_num = 0;
        init.current_msg.foreground_color = desc->body->fgColor;
        init.current_msg.is_best_paging = FALSE;
        init.current_msg.layout = desc->body->layout;
    #ifdef __MMI_MSG_FTE_ENHANCE__
        if (option_scr_data->is_preview == MMI_TRUE)
        {
            init.current_msg.show_attachment_icon = WGUI_MV_VIEW_PREVIEW;
        }
    #else /* __MMI_MSG_FTE_ENHANCE__ */ 
        init.current_msg.show_attachment_icon = srv_mms_viewer_is_attachment_in_mms();
    #endif /* __MMI_MSG_FTE_ENHANCE__ */ 
        init.current_msg.slide_timing = desc->body->slides->duration;
        init.current_msg.total_slide_num = desc->body->slide_no;

        init.ptxtbuffer = srv_mms_get_slide_txt_buffer();
        init.ptxtbuffersize = srv_mms_get_ptxt_buffer_size();
        init.pinputboxbuffer = srv_mms_get_pinputbox_buffer();
        /* Data Members */
    #ifdef __MMI_MMS_BEST_PAGE_SUPPORT__
        /* Making Best Page Flag True */
        init.current_msg.is_best_paging = MMI_TRUE;
    #endif /* __MMI_MMS_BEST_PAGE_SUPPORT__ */ 

        init.csk_icon = mmi_umms_app_ui_plug_in_get_csk_icon();
        init.csk_func = mmi_umms_app_ui_plug_in_exec_csk_func;
        Category630Initialize(&init);
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        mmi_frm_cb_reg_event(
            EVT_ID_MMI_UM_REFRESH,
            (mmi_proc_func) mmi_umms_app_dtmgr_update_indexing_data_from_um,
            NULL);
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    }
    if (viewer_scr && viewer_scr->is_review == MMI_TRUE)
    {
        mmi_umms_app_screenDB_struct *scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_ENTRY_REVIEW);
        mmi_frm_scrn_set_leave_proc(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER, (mmi_proc_func) NULL);
        mmi_umms_app_sh_delete_screen_context(SCR_ID_UMMS_MMS_VIEWER);
        viewer_scr = NULL;
        is_review = MMI_TRUE;
        mmi_frm_display_dummy_screen();
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER);
    }
    if (viewer_scr == NULL)
    {
        viewer_scr =
            (mmi_umms_app_ui_draw_viewer_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_viewer_screen_struct));
        ASSERT(viewer_scr);
        memset(viewer_scr, 0, sizeof(mmi_umms_app_ui_draw_viewer_screen_struct));
        viewer_scr->scrn_id = scr_id;
        viewer_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
        viewer_scr->current_hilited = NULL;
        viewer_scr->lsk_str_id = mmi_umms_app_ui_plug_in_get_lsk_str();
        viewer_scr->lsk_func = mmi_umms_app_ui_plug_in_get_lsk_fn();
    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
        if (viewer_scr->lsk_str_id == STR_GLOBAL_PLAY || is_review == MMI_TRUE)
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_PLAY;
            viewer_scr->full_scrn = MMI_UMMS_TRUE;
        }
        else
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
            viewer_scr->full_scrn = MMI_UMMS_FALSE;
        }
    #elif defined(__MMI_MMS_VOICE_MESSAGE_HANDLING__)       /* __MMI_MMS2_MV_MANUAL_PLAY__ */
        if (option_scr_data->msg_info->media_type == MMA_MEDIA_MSG_AUDIO && is_review == MMI_FALSE)
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
            viewer_scr->full_scrn = MMI_UMMS_FALSE;
        }
        else
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_PLAY;
            viewer_scr->full_scrn = MMI_UMMS_TRUE;
        }
    #elif defined(__MMI_MMS_ITERATOR_VIEWER__)
        if (is_review == MMI_FALSE && option_scr_data->is_preview == MMI_FALSE)
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
            viewer_scr->full_scrn = MMI_UMMS_FALSE;
        }
        else
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_PLAY;
            viewer_scr->full_scrn = MMI_UMMS_TRUE;
        }
    #else 
        viewer_scr->mode = WGUI_MV_DISPLAY_MODE_PLAY;
        viewer_scr->full_scrn = MMI_UMMS_TRUE;
    #endif 
    #ifdef __MMI_MSG_FTE_ENHANCE__
        viewer_scr->full_scrn = MMI_UMMS_FALSE;
    #endif 
        viewer_scr->set_send_key_cb = mmi_umms_app_ui_callback_set_send_key;
        viewer_scr->call_number = mmi_umms_app_sh_highlighted_number_call;
        viewer_scr->launch_url = mmi_umms_app_sh_entry_use_url_go_to;
    #ifdef __MMI_EMAIL__
        viewer_scr->launch_email = mmi_umms_app_sh_use_email_send_email;
    #endif 
    #ifdef __MMI_FTE_SUPPORT__
        memset(&(viewer_scr->fte_data), 0, sizeof(mmi_umms_app_ui_fte_struct));
     
    #ifndef __MMI_MSG_FTE_ENHANCE__
		if(viewer_scr->mode == WGUI_MV_DISPLAY_MODE_PLAY)
		{
		viewer_scr->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE - 2;
		viewer_scr->fte_data.string[0] = (PU8)GetString(STR_GLOBAL_STOP);
       
		viewer_scr->fte_data.callback = mmi_umms_app_sh_viewer_toolbar_cb;
		}
		else
    #endif
    
        if (viewer_scr->mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            viewer_scr->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE;
#ifdef __MMI_ICON_BAR_SUPPORT__ 
            mmi_umms_app_ui_plug_in_decide_toolbar_icon_and_string(&(viewer_scr->fte_data));
#endif
            viewer_scr->fte_data.callback = mmi_umms_app_sh_viewer_toolbar_cb;
        }
    #endif /* __MMI_FTE_SUPPORT__ */ 
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)viewer_scr);
        return MMI_UMMS_TRUE;
    }
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_FROM_HISTORY);
#ifdef __MMI_FTE_SUPPORT__
    memset(&(viewer_scr->fte_data), 0, sizeof(mmi_umms_app_ui_fte_struct));
    viewer_scr->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE;
#ifdef __MMI_ICON_BAR_SUPPORT__ 
    mmi_umms_app_ui_plug_in_decide_toolbar_icon_and_string(&(viewer_scr->fte_data));
#endif
    viewer_scr->fte_data.callback = mmi_umms_app_sh_viewer_toolbar_cb;
#endif /* __MMI_FTE_SUPPORT__ */ 
    viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
    viewer_scr->full_scrn = MMI_UMMS_FALSE;
#ifdef __MMI_MSG_FTE_ENHANCE__
    parent_fh = mmi_umms_app_dtmgr_get_parent_file_hdl();
    if (parent_fh && *parent_fh)
    {
        FS_Close(*parent_fh);
        *parent_fh = 0;
    }
#endif /* __MMI_MSG_FTE_ENHANCE__ */ 
	#if defined(__OP01__)  && defined(__MMI_TOUCH_SCREEN__)
	mmi_umms_app_sh_use_detail_delete_options_hdlr() ;
    #endif
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_viewer_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_viewer_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_CONFIRM);
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PREVIEW_SLIDE_LIST);
    if (option_scr_data)
    {
        mmi_umms_app_sh_delete_option_screen(option_scr_data->folder_id);
    }

    return MMI_UMMS_TRUE;
}

#else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_viewer_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_viewer_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_description_struct *desc;
    wgui_mv_initialize_struct init;
    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr;
    MMI_BOOL is_review = MMI_FALSE;
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    viewer_scr = (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    desc = srv_mms_get_desc_pointer();
    if (viewer_scr == NULL || option_scr_data->open_mode == MMA_MODE_EDIT)
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_ENTRY_FIRST_TIME);
        /* Callbacks to APP */
        memset(&init, 0, sizeof(wgui_mv_initialize_struct));
        init.get_filename_by_id_cb = mmi_umms_app_ui_callback_get_filename_by_id;
        init.load_slide_txt_cb = mmi_umms_app_ui_callback_load_ucs2_txt_to_buffer;
        init.stop_app_cb = mmi_umms_app_ui_callback_exit_viewer_application;
        init.allow_audio_cb = mmi_umms_app_ui_callback_allow_audio_playing;
        init.best_page_duration_cb = mmi_umms_app_ui_callback_best_page_duration;
        init.finish_playing = mmi_umms_app_ui_callback_viewer_stop_callback;

		init.app_common_action_callback = mmi_umms_app_ui_callback_app_common_action;
        
        #ifdef __MMI_MMS_IMAGE_VIEW_ENHANCEMENT__  
		init.decode_image_for_clear_image = mmi_umms_app_ui_callback_decode_image ;
        #endif

        /* Callbacks to APP */

        /* Data Members */

        init.current_msg.slide_head = desc->body->slides;
        if (option_scr_data->open_mode != MMA_MODE_EDIT)
            desc->body->curr_slide = desc->body->slides;
		if (option_scr_data->open_mode == MMA_MODE_EDIT)
        {
         init.current_msg.background_color = mma_get_default_smil_bg_color() ;
         init.current_msg.foreground_color = mma_get_default_smil_fg_color() ;
        }
		else
		{
        init.current_msg.background_color = desc->body->bgColor;
        init.current_msg.foreground_color = desc->body->fgColor;
		}
        
        init.current_msg.current_slide = &(desc->body->curr_slide);
        init.current_msg.current_slide_num = 0;
        init.current_msg.is_best_paging = MMI_FALSE;
        init.current_msg.layout = (srv_mms_viewer_slide_layout_enum)desc->body->layout;
        init.current_msg.show_attachment_icon = srv_mms_viewer_is_attachment_in_mms();
        init.current_msg.slide_timing = desc->body->slides->duration;
        init.current_msg.total_slide_num = desc->body->slide_no;
        init.ptxtbuffer = srv_mms_get_slide_txt_buffer();
        init.ptxtbuffersize = srv_mms_get_ptxt_buffer_size();
        init.pinputboxbuffer = srv_mms_get_pinputbox_buffer();
        /* Data Members */
        if (option_scr_data->open_mode == MMA_MODE_VIEW)
        {
            init.csk_icon = mmi_umms_app_ui_plug_in_get_csk_icon();
            init.csk_func = mmi_umms_app_ui_plug_in_exec_csk_func;
        }
        else
        {
            init.current_msg.msg_size = g_srv_mms_uc_supp.srv_msg.total_msg_size;
            init.ptxtbuffersize = MMI_MMS_TXT_BUF_UCS2_SIZE;
            /* In Edit mode always open category in image top layout,as S* */
			desc->body->layout = SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_TOP;
            init.current_msg.layout = (srv_mms_viewer_slide_layout_enum)desc->body->layout;
			init.csk_func = mmi_umms_app_ui_plugin_viewer_lsk_hdlr;
            init.csk_icon = mmi_umms_app_ui_plug_in_get_csk_icon(); 
        }

        Category630Initialize(&init);
    }
    if (viewer_scr && viewer_scr->is_review == MMI_TRUE)
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_ENTRY_REVIEW);
        mmi_frm_scrn_set_leave_proc(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER, (mmi_proc_func) NULL);
        mmi_umms_app_sh_delete_screen_context(SCR_ID_UMMS_MMS_VIEWER);
        viewer_scr = NULL;
        is_review = MMI_TRUE;
        mmi_frm_display_dummy_screen();
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER);
    }
    if (viewer_scr == NULL)
    {
        viewer_scr =
            (mmi_umms_app_ui_draw_viewer_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_viewer_screen_struct));
        ASSERT(viewer_scr);
        memset(viewer_scr, 0, sizeof(mmi_umms_app_ui_draw_viewer_screen_struct));
        viewer_scr->scrn_id = scr_id;
        viewer_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
        viewer_scr->current_hilited = NULL;
        viewer_scr->lsk_str_id = mmi_umms_app_ui_plug_in_get_lsk_str();
        viewer_scr->lsk_func = mmi_umms_app_ui_plug_in_get_lsk_fn();
        if (option_scr_data->open_mode == MMA_MODE_VIEW)
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_PLAY;
        else
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
        if (option_scr_data->open_mode == MMA_MODE_VIEW)
            viewer_scr->full_scrn = MMI_UMMS_TRUE;
        else
            viewer_scr->full_scrn = MMI_FALSE;

		#ifdef __MMI_MMS2_MV_MANUAL_PLAY__
        if (viewer_scr->lsk_str_id == STR_GLOBAL_PLAY || is_review == MMI_TRUE)
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_PLAY;
            viewer_scr->full_scrn = MMI_UMMS_TRUE;
        }
        else
        {
            viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
            viewer_scr->full_scrn = MMI_UMMS_FALSE;
        }
       #endif
      
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        viewer_scr->set_send_key_cb = mmi_umms_app_ui_callback_set_send_key;
        viewer_scr->call_number = mmi_umms_app_sh_highlighted_number_call;
        viewer_scr->launch_url = mmi_umms_app_sh_entry_use_url_go_to;
    #ifdef __MMI_EMAIL__
        viewer_scr->launch_email = mmi_umms_app_sh_use_email_send_email;
    #endif 
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
		#ifdef __MMI_FTE_SUPPORT__
        memset(&(viewer_scr->fte_data), 0, sizeof(mmi_umms_app_ui_fte_struct));
		#ifndef __MMI_MSG_FTE_ENHANCE__
		if(viewer_scr->mode == WGUI_MV_DISPLAY_MODE_PLAY)
		{
		viewer_scr->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE - 2;
		viewer_scr->fte_data.string[0] = (PU8)GetString(STR_GLOBAL_STOP);
       
		viewer_scr->fte_data.callback = mmi_umms_app_sh_viewer_toolbar_cb;
		}
		else
      #endif
      if (viewer_scr->mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            viewer_scr->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE;
#ifdef __MMI_ICON_BAR_SUPPORT__ 
            mmi_umms_app_ui_plug_in_decide_toolbar_icon_and_string(&(viewer_scr->fte_data));
#endif
            viewer_scr->fte_data.callback = mmi_umms_app_sh_viewer_toolbar_cb;
        }
    #endif /* __MMI_FTE_SUPPORT__ */ 
        
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)viewer_scr);
        return MMI_UMMS_TRUE;
    }
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_FROM_HISTORY);
	#ifdef __MMI_FTE_SUPPORT__
    memset(&(viewer_scr->fte_data), 0, sizeof(mmi_umms_app_ui_fte_struct));
    viewer_scr->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE;
#ifdef __MMI_ICON_BAR_SUPPORT__ 
    mmi_umms_app_ui_plug_in_decide_toolbar_icon_and_string(&(viewer_scr->fte_data));
#endif
    viewer_scr->fte_data.callback = mmi_umms_app_sh_viewer_toolbar_cb;
#endif /* __MMI_FTE_SUPPORT__ */ 
    viewer_scr->mode = WGUI_MV_DISPLAY_MODE_SHOW;
    viewer_scr->full_scrn = MMI_UMMS_FALSE;
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_viewer_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_viewer_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_CONFIRM);
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PREVIEW_SLIDE_LIST);
    if (option_scr_data)
    {
        mmi_umms_app_sh_delete_option_screen(option_scr_data->folder_id);
    }

    return MMI_UMMS_TRUE;
}

#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_call_sender_viewer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_call_sender_viewer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_plug_in_use_number_as_make_call_viewer((PU8) option_scr_data->msg_info->from_address);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_csk_icon
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_umms_app_ui_plug_in_get_csk_icon(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 img_id = 0;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (info->is_preview)
    {
    #ifdef __MMI_UMMS_PREVIEW_SEND__
        return IMG_GLOBAL_SEND_MSG_CSK;
    #elif defined(__MMI_MMS_PREVIEW_GOTO__)
        return IMG_GLOBAL_COMMON_CSK;
    #else 
        return IMG_GLOBAL_COMMON_CSK;
    #endif 
    }
    switch (info->folder_id)
    {
        case MMA_FOLDER_INBOX:
            if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL
                || info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
            {
                img_id = IMG_GLOBAL_REPLY_MSG_CSK;
            }
            else
            {
                img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
            }
            break;
        case MMA_FOLDER_OUTBOX:
        case MMA_FOLDER_DRAFT:
        case MMA_FOLDER_TEMPLATE:
        case MMA_FOLDER_USRDEF_TEMPLATE:
            img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
            break;
        case MMA_FOLDER_SENT:
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
            }
            else
        #endif /* __MMI_MMS_POSTCARD__ */ 
            {
                if ((info->msg_info->is_forward_lock) || ((info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)))
                {
                    mma_creation_mode_enum creation_mode;

                    creation_mode = srv_mms_compose_settings_creation_mode();
                    if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                    {
                        img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
                    }
                    else
                    {
                        img_id = IMG_GLOBAL_FORWARD_MSG_CSK;
                    }
                }
                else
                {
                    img_id = IMG_GLOBAL_FORWARD_MSG_CSK;
                }
            }
            break;
        #ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
        case MMA_FOLDER_ARCHIVE:
            switch (info->msg_info->prev_folder)
            {
                case MMA_FOLDER_INBOX:
                    if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL
                        || info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
                    {
                        img_id = IMG_GLOBAL_REPLY_MSG_CSK;
                    }
                    else
                    {
                        img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
                    }
                    break;
                case MMA_FOLDER_OUTBOX:
                case MMA_FOLDER_DRAFT:
                case MMA_FOLDER_TEMPLATE:
                case MMA_FOLDER_USRDEF_TEMPLATE:
                    img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
                    break;
                case MMA_FOLDER_SENT:
                #ifdef __MMI_MMS_POSTCARD__
                    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
                    {
                        img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
                    }
                    else
                #endif /* __MMI_MMS_POSTCARD__ */ 
                    {
                        if ((info->msg_info->is_forward_lock) || ((info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)))
                        {
                            mma_creation_mode_enum creation_mode;

                            creation_mode = srv_mms_compose_settings_creation_mode();
                            if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                            {
                                img_id = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
                            }
                            else
                            {
                                img_id = IMG_GLOBAL_FORWARD_MSG_CSK;
                            }
                        }
                        else
                        {
                            img_id = IMG_GLOBAL_FORWARD_MSG_CSK;
                        }
                    }
                    break;
            }
            break;
        #endif /* __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__ */ 
        default:
            ASSERT(0);
    }
    return img_id;
}

#if defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__) 
void  mmi_umms_app_ui_plug_in_launch_slim_edit ()
{
  mmi_umms_app_ui_plug_in_launch_slim (MMA_MODE_EDIT) ; 

}
void mmi_umms_app_ui_plug_in_launch_slim_forward()
{
  mmi_umms_app_ui_plug_in_launch_slim (MMA_MODE_FORWARD) ; 
}
#endif
#ifdef __MMI_FTE_SUPPORT__

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_resend_mms_from_toolbar
 * DESCRIPTION
 *  resend a mms from toolbar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_resend_mms_from_toolbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if(MMI_MAX_SIM_NUM == 2)
    srv_mms_set_selected_sim_id(0);
    if (srv_mms_num_valid_sim() > 1)
    {
        mmi_umms_app_if_show_sim_option();
    }
    else
    {
        mmi_umms_app_plug_in_pre_entry_send_msg();
    }
#else /* (MMI_MAX_SIM_NUM == 2) */ 
    mmi_umms_app_plug_in_pre_entry_send_msg();
#endif /* (MMI_MAX_SIM_NUM == 2) */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_edit_mms_from_toolbar
 * DESCRIPTION
 *  resend a mms from toolbar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_edit_mms_from_toolbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_start_uc_struct uc_start;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_ENTRY_EDIT, info->msg_id);
#ifndef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)

    {
        U32 max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (info->msg_info->user_element_size > max_msg_size)
        {
            mmi_umms_app_plug_in_wap_connection_error_popup(
                info->msg_info->user_element_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            return;
        }
    }
#elif defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)
    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)
    {
        U32 max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (info->msg_info->msg_size > max_msg_size)
        {
            mmi_umms_app_plug_in_wap_connection_error_popup(
                info->msg_info->msg_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            return;
        }
    }
#endif 
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 

    if (info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)
    {
        mma_creation_mode_enum creation_mode;

        creation_mode = srv_mms_compose_settings_creation_mode();
        info->uc_mode = MMA_MODE_EDIT;
        if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
        {
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_RESTRICTED_MODE),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_FALSE,
                mmi_umms_app_ui_plug_in_final_edit,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
        }
        else if (creation_mode == MMA_CREATION_MODE_WARNING)
        {
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_ui_plug_in_final_edit,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
        }
        else
        {
            memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
            uc_start.msg_id = info->msg_id;
            uc_start.uc_mode = MMA_MODE_EDIT;
            uc_start.sim_id = MMI_SIM1;
            uc_start.storage_type = info->msg_info->msg_storage;
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
            }
        #endif /* __MMI_MMS_POSTCARD__ */ 

            mmi_umms_start_uc(&uc_start);
            mmi_umms_app_sh_delete_option_screen(info->folder_id);
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        }
    }
    else
    {
        memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
        uc_start.msg_id = info->msg_id;
        uc_start.uc_mode = MMA_MODE_EDIT;
        uc_start.sim_id = MMI_SIM1;
    #ifdef __MMI_MMS_POSTCARD__
        if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
        {
            uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
        }
    #endif /* __MMI_MMS_POSTCARD__ */ 
        uc_start.storage_type = info->msg_info->msg_storage;
        mmi_umms_start_uc(&uc_start);
        mmi_umms_app_sh_delete_option_screen(info->folder_id);
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    }
}

#ifdef __MMI_ICON_BAR_SUPPORT__ 

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_decide_toolbar_icon_and_string
 * DESCRIPTION
 *  decide toolbar icon and string for FTE
 * PARAMETERS
 *  fte_data        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_decide_toolbar_icon_and_string(void *fte_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    mmi_umms_app_ui_fte_struct *data = (mmi_umms_app_ui_fte_struct*) fte_data;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (info->is_preview)
    {
      #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
		if (info->open_mode == MMA_MODE_EDIT)
		{
			data->item_count = MMI_UMMS_APP_MAX_ICON_FTE ;
			data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_ADD);
			data->disabled_content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_ADD_DISABLED);
			data->string[1] = (PU8) GetString(STR_UMMS_ADD_OBJECT);
            data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE);
			data->content_icon[2] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
			data->disabled_content_icon[0] = NULL;
			data->disabled_content_icon[2] = NULL;
			data->string[0] = (PU8) GetString(STR_GLOBAL_SEND);
			data->string[2] = (PU8) GetString(STR_GLOBAL_PREVIEW);
			#ifndef __MMI_UMMS_PREVIEW_SEND__
				data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE_DISABLED);
			#else
				if(srv_mms_is_resend_on(info->msg_id) == FALSE)
				 {
				  data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE_DISABLED);
				 }
			#endif   
		}
		else
      #endif
		{
        data->item_count = MMI_UMMS_APP_MAX_ICON_FTE - 1;
        data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE);
        data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
        data->disabled_content_icon[0] = NULL;
        data->disabled_content_icon[1] = NULL;
        data->string[0] = (PU8) GetString(STR_GLOBAL_SEND);
        data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
    #ifndef __MMI_UMMS_PREVIEW_SEND__
        data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE_DISABLED);
    #else
		if(srv_mms_is_resend_on(info->msg_id) == FALSE)
		 {
          data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE_DISABLED);
		 }
    #endif 
		}
        return;
    }
    data->content_icon[2] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_DELETE);
    data->disabled_content_icon[2] = NULL;
    data->string[2] = (PU8) GetString(STR_GLOBAL_DELETE);
    switch (info->folder_id)
    {
        case MMA_FOLDER_INBOX:
            data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_REPLY_MESSAGE);
            data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
            data->disabled_content_icon[0] = NULL;
            data->disabled_content_icon[1] = NULL;
            data->string[0] = (PU8) GetString(STR_GLOBAL_REPLY);
            data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
            if (info->msg_info->from_address_type != MMA_ADDR_TYPE_EMAIL
                && info->msg_info->from_address_type != MMA_ADDR_TYPE_PHONE_NUMBER)
            {
                data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_REPLY_MESSAGE_DISABLED);
            }
            break;
        case MMA_FOLDER_OUTBOX:
            data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
            data->content_icon[1] = (PU8) GetImage( /* IMG_GLOBAL_RESEND_TOOLBAR */ IMG_GLOBAL_TOOLBAR_SEND_MESSAGE);
            data->disabled_content_icon[0] = NULL;
            data->disabled_content_icon[1] = NULL;
			data->string[0] = (PU8) GetString(STR_GLOBAL_PLAY);
            data->string[1] = (PU8) GetString(STR_ID_UMMS_RESEND);
            if(srv_mms_is_resend_on(info->msg_id) == FALSE)
			 {
			    data->disabled_content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE_DISABLED);
			 } 
            break;
        case MMA_FOLDER_DRAFT:
            data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
            data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT);
            data->disabled_content_icon[0] = NULL;
            data->disabled_content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT_DISABLED);
            data->string[0] = (PU8) get_string(STR_GLOBAL_PLAY);
            data->string[1] = (PU8) get_string(STR_GLOBAL_EDIT);
            break;
        case MMA_FOLDER_TEMPLATE:
        case MMA_FOLDER_USRDEF_TEMPLATE:
            data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT);
            data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
            data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT_DISABLED);
            data->disabled_content_icon[1] = NULL;
            data->string[0] = (PU8) GetString(STR_GLOBAL_EDIT);
            data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
            if (info->folder_id == MMA_FOLDER_TEMPLATE)
            {
                data->string[0] = (PU8) GetString(STR_ID_UMMS_WRITE_MESSAGE);
                data->item_count = MMI_UMMS_APP_MAX_ICON_FTE - 1;
                data->content_icon[2] = NULL;   /* As default template can not be deleted */
                data->string[2] = NULL;
            }
            break;
        case MMA_FOLDER_SENT:
            data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_FORWARD_MESSAGE);
            data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
            data->disabled_content_icon[0] = NULL;
            data->disabled_content_icon[1] = NULL;
            data->string[0] = (PU8) GetString(STR_GLOBAL_FORWARD);
            data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
            if ((info->msg_info->is_forward_lock) || ((info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)))
            {
                mma_creation_mode_enum creation_mode;

                creation_mode = srv_mms_compose_settings_creation_mode();
                if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                {
                    data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_FORWARD_MESSAGE_DISABLED);
                }
            }

        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_FORWARD_MESSAGE_DISABLED);
            }
        #endif /* __MMI_MMS_POSTCARD__ */ 
            break;
        #ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
        case MMA_FOLDER_ARCHIVE:
            switch (info->msg_info->prev_folder)
            {
                case MMA_FOLDER_INBOX:
                    data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_REPLY_MESSAGE);
                    data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
                    data->disabled_content_icon[0] = NULL;
                    data->disabled_content_icon[1] = NULL;
                    data->string[0] = (PU8) GetString(STR_GLOBAL_REPLY);
                    data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
                    if (info->msg_info->from_address_type != MMA_ADDR_TYPE_EMAIL
                        && info->msg_info->from_address_type != MMA_ADDR_TYPE_PHONE_NUMBER)
                    {
                        data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_REPLY_MESSAGE_DISABLED);
                    }
                    break;
                case MMA_FOLDER_OUTBOX:
                    data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
                    data->content_icon[1] =
                        (PU8) GetImage( /* IMG_GLOBAL_RESEND_TOOLBAR */ IMG_GLOBAL_TOOLBAR_SEND_MESSAGE);
                    data->disabled_content_icon[0] = NULL;
                    data->disabled_content_icon[1] = NULL;
					if(srv_mms_is_resend_on(info->msg_id) == FALSE)
					{
					   data->disabled_content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_SEND_MESSAGE_DISABLED);
					}
                    data->string[0] = (PU8) GetString(STR_GLOBAL_PLAY);
                    data->string[1] = (PU8) GetString(STR_ID_UMMS_RESEND);
                    break;
                case MMA_FOLDER_DRAFT:
                    data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
                    data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT);
                    data->disabled_content_icon[0] = NULL;
                    data->disabled_content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT_DISABLED);
                    data->string[0] = (PU8) GetString(STR_GLOBAL_PLAY);
                    data->string[1] = (PU8) GetString(STR_GLOBAL_EDIT);
                    break;
                case MMA_FOLDER_TEMPLATE:
                case MMA_FOLDER_USRDEF_TEMPLATE:
                    data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT);
                    data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
                    data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_EDIT_DISABLED);
                    data->disabled_content_icon[1] = NULL;
                    data->string[0] = (PU8) GetString(STR_GLOBAL_EDIT);
                    data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
                    if (info->folder_id == MMA_FOLDER_TEMPLATE)
                    {
                        data->string[0] = (PU8) GetString(STR_ID_UMMS_WRITE_MESSAGE);
                        data->item_count = MMI_UMMS_APP_MAX_ICON_FTE - 1;
                        data->content_icon[2] = NULL;   /* As default template can not be deleted */
                        data->string[2] = NULL;
                    }
                    break;
                case MMA_FOLDER_SENT:
                    data->content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_FORWARD_MESSAGE);
                    data->content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
                    data->disabled_content_icon[0] = NULL;
                    data->disabled_content_icon[1] = NULL;
                    data->string[0] = (PU8) GetString(STR_GLOBAL_FORWARD);
                    data->string[1] = (PU8) GetString(STR_GLOBAL_PLAY);
                    if ((info->msg_info->is_forward_lock) || ((info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)))
                    {
                        mma_creation_mode_enum creation_mode;

                        creation_mode = srv_mms_compose_settings_creation_mode();
                        if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                        {
                            data->disabled_content_icon[0] =
                                (PU8) GetImage(IMG_GLOBAL_TOOLBAR_FORWARD_MESSAGE_DISABLED);
                        }
                    }

                #ifdef __MMI_MMS_POSTCARD__
                    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
                    {
                        data->disabled_content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_FORWARD_MESSAGE_DISABLED);
                    }
                #endif /* __MMI_MMS_POSTCARD__ */ 
                    break;
            }
            break;
        #endif /* __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__ */ 
        default:
            ASSERT(0);
    }

}

#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plugin_viewer_toolbar_hdlr
 * DESCRIPTION
 *  execute toolbar function
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plugin_viewer_toolbar_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    FuncPtr func = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index == 2)
    {
        func = mmi_umms_app_ui_plug_in_delete_mms_from_toolbar;
    }
    if (info->is_preview)
    {
        switch (index)
        {
			
            case 0:
        #ifdef __MMI_UMMS_PREVIEW_SEND__
                func = mmi_umms_app_if_preview_uc_send;
				#endif 
				 #ifdef	__MMI_MMS_SIMPLIFIED_UI_SUPPORT__
				if(info->open_mode == MMA_MODE_EDIT)
				{
				  func = mmi_umms_app_if_slim_send ;
				}
				else
				{
					#ifdef __MMI_UMMS_PREVIEW_SEND__
					func = mmi_umms_app_if_slim_send ;
                    #endif
				}
                 #endif
                break;
                   
            case 1:
                func = mmi_umms_app_if_show_viewer_screen;
                #ifdef	__MMI_MMS_SIMPLIFIED_UI_SUPPORT__
				if (info->open_mode == MMA_MODE_EDIT)
				{
					func = mmi_umms_app_slim_insert_object ;
		        }
				else
				{
				info->open_mode = MMA_MODE_VIEW ;
				func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list ;
				}
                #endif
                break;
            #ifdef	__MMI_MMS_SIMPLIFIED_UI_SUPPORT__
			case 2 :
				info->open_mode = MMA_MODE_VIEW ;
				func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list ;
				 break;
             #endif
            default:
                break;
        }
        goto EXEC;
    }
    switch (info->folder_id)
    {
        case MMA_FOLDER_INBOX:

            if (index == 0)
            {

          #if defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)
                if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL
                    || info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
                {
                    func = mmi_umms_app_ui_plug_in_reply;
                }
          #else
			switch (info->msg_info->from_address_type)
                    {
                case MMA_ADDR_TYPE_EMAIL:
                    func = mmi_umms_app_ui_plug_in_reply;
                 break;
                case MMA_ADDR_TYPE_PHONE_NUMBER:
                    func = mmi_umms_app_ui_plug_in_reply_as_sms;
					break;
    			    }
           #endif
            }
            else if (index == 1)
            {
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                {
                    func = mmi_umms_ui_plug_in_audio_msg_view;
                }
                else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                {
                    func = mmi_umms_app_if_show_viewer_screen;
                }
            #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif 
            }
            break;
        case MMA_FOLDER_OUTBOX:
            if (index == 0)
            {
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                {
                    func = mmi_umms_ui_plug_in_audio_msg_view;
                }
                else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                {
                    func = mmi_umms_app_if_show_viewer_screen;
                }
            #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif 
            }
            else if (index == 1)
            {
                func = mmi_umms_app_ui_plug_in_resend_mms_from_toolbar;
            }
            break;
        case MMA_FOLDER_DRAFT:
            if (index == 0)
            {
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                {
                    func = mmi_umms_ui_plug_in_audio_msg_view;
                }
                else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                {
                    func = mmi_umms_app_if_show_viewer_screen;
                }
            #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif 
            }
            else if (index == 1)
            {
			    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
				func = mmi_umms_app_ui_plug_in_launch_slim_edit ;
                #else
                func = mmi_umms_app_ui_plug_in_edit_mms_from_toolbar;
                #endif
            }
            break;
        case MMA_FOLDER_TEMPLATE:
        case MMA_FOLDER_USRDEF_TEMPLATE:
            if (index == 0)
            {
                func = mmi_umms_app_ui_plug_in_edit_mms_from_toolbar;
            }
            else if (index == 1)
            {
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                {
                    func = mmi_umms_ui_plug_in_audio_msg_view;
                }
                else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                {
                    func = mmi_umms_app_if_show_viewer_screen;
                }
            #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif 

            }
            break;
        case MMA_FOLDER_SENT:
            if (index == 0)
            {
			   #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
				func =  mmi_umms_app_ui_plug_in_launch_slim_forward ;
               #else
                func = mmi_umms_app_ui_plug_in_forward;
              #endif
            }
            else if (index == 1)
            {
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                {
                    func = mmi_umms_ui_plug_in_audio_msg_view;
                }
                else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                {
                    func = mmi_umms_app_if_show_viewer_screen;
                }
            #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif 
            }
            break;
        #ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
        case MMA_FOLDER_ARCHIVE:
            switch (info->msg_info->prev_folder)
            {
                case MMA_FOLDER_INBOX:

                    if (index == 0)
                    {

          #if defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)
                        if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL
                            || info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
                        {
                            func = mmi_umms_app_ui_plug_in_reply;
                        }
          #else
			switch (info->msg_info->from_address_type)
                    {
                case MMA_ADDR_TYPE_EMAIL:
                    func = mmi_umms_app_ui_plug_in_reply;
                 break;
                case MMA_ADDR_TYPE_PHONE_NUMBER:
                    func = mmi_umms_app_ui_plug_in_reply_as_sms;
					break;
    			    }
           #endif

                    }
                    else if (index == 1)
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
                    break;
                case MMA_FOLDER_OUTBOX:
                    if (index == 0)
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
                    else if (index == 1)
                    {
                        func = mmi_umms_app_ui_plug_in_resend_mms_from_toolbar;
                    }
                    break;
                case MMA_FOLDER_DRAFT:
                    if (index == 0)
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
                    else if (index == 1)
                    {
                        func = mmi_umms_app_ui_plug_in_edit_mms_from_toolbar;
                    }
                    break;
                case MMA_FOLDER_TEMPLATE:
                case MMA_FOLDER_USRDEF_TEMPLATE:
                    if (index == 0)
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
                    else if (index == 1)
                    {
                        func = mmi_umms_app_ui_plug_in_edit_mms_from_toolbar;
                    }
                    break;
                case MMA_FOLDER_SENT:
                    if (index == 0)
                    {
                        func = mmi_umms_app_ui_plug_in_forward;
                    }
                    else if (index == 1)
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
                    break;
            }
            break;
        #endif /* __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__ */ 
        default:
            ASSERT(0);

    }
  EXEC:
    if (func == mmi_umms_app_if_show_viewer_screen)
    {
       #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        mmi_umms_app_screenDB_struct *scrDB = mmi_frm_scrn_get_user_data(mmi_umms_dtmgr_get_group_id(), mmi_frm_scrn_get_active_id());
        mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
            (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(scrDB->scrn_id);
    #else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
            (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        viewer_scr->is_review = MMI_TRUE;
    }
    func();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_delete_mms_from_toolbar
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_delete_mms_from_toolbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    U32 status = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    status = srv_mms_bgsr_get_msg_status(info->msg_id);
    if (status == SRV_MMS_BGSR_STATUS_SENDING)
    {
        if (info->folder_id == MMA_FOLDER_INBOX)
        {
#ifndef __MMI_MMS_NO_REPORT_SUPPORT__	
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_ID_UMMS_READ_REPORT_IS_IN_SEND),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
#endif

        }
        else if (info->folder_id == MMA_FOLDER_OUTBOX)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_ID_UMMS_MESSAGE_IS_IN_SEND),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
        }
        return;
    }

    if (status == SRV_MMS_BGSR_STATUS_DOWNLOADING)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_ID_UMMS_DOWNLOAD_IN_PROGRESS), MMI_EVENT_INFO);
        mmi_umms_app_if_show_display_popup_screen();
        return;
    }
    mmi_umms_app_ui_plug_in_delete_confirm_func();
    mmi_umms_app_if_show_display_confirm_screen();
}

#endif /* __MMI_FTE_SUPPORT__ */ 

#if 0
#ifdef __MMI_MMS_AUTO_SWITCH_TO_FIRST_SLIDE__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /*__MMI_MMS_AUTO_SWITCH_TO_FIRST_SLIDE__*/
#endif /* 0 */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_exec_csk_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_exec_csk_func(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    FuncPtr func = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (info->is_preview)
    {
    #ifdef __MMI_UMMS_PREVIEW_SEND__
        func = mmi_umms_app_if_preview_uc_send;
    #elif defined(__MMI_MMS_PREVIEW_GOTO__)
        func = mmi_umms_app_if_show_preview_slide_list;
    #else 
        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
    #endif 
        func();
        return;
    }
    switch (info->folder_id)
    {
        case MMA_FOLDER_INBOX:
    #if defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)
            if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL
                || info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
            {
                func = mmi_umms_app_ui_plug_in_reply;
            }
            else
            {
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                {
                    func = mmi_umms_ui_plug_in_audio_msg_view;
                }
                else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                {
                    func = mmi_umms_app_if_show_viewer_screen;
                }
            #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif 
            }
    #else /* defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__) */ 
            switch (info->msg_info->from_address_type)
            {
                case MMA_ADDR_TYPE_EMAIL:
                    func = mmi_umms_app_ui_plug_in_reply;
                    break;
                case MMA_ADDR_TYPE_PHONE_NUMBER:
                    func = mmi_umms_app_ui_plug_in_reply_as_sms;
                    break;
                default:
            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                    if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                    {
                        func = mmi_umms_ui_plug_in_audio_msg_view;
                    }
                    else
            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                    {
                        func = mmi_umms_app_if_show_viewer_screen;
                    }
                #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                    func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                #endif 
            }
    #endif /* defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__) */ 
            break;
        case MMA_FOLDER_OUTBOX:
        case MMA_FOLDER_DRAFT:
        case MMA_FOLDER_TEMPLATE:
        case MMA_FOLDER_USRDEF_TEMPLATE:
        #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
            if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
            {
                func = mmi_umms_ui_plug_in_audio_msg_view;
            }
            else
        #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
            {
                func = mmi_umms_app_if_show_viewer_screen;
            }
        #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
            func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
        #endif 
            break;
        case MMA_FOLDER_SENT:
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                func = mmi_umms_app_if_show_viewer_screen;
            }
        #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
            func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
        #endif 
            else
        #endif /* __MMI_MMS_POSTCARD__ */ 
            {
                if ((info->msg_info->is_forward_lock) ||
                    ((info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)))
                {
                    mma_creation_mode_enum creation_mode;

                    creation_mode = srv_mms_compose_settings_creation_mode();
                    if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    }
                    else
                    {
                        func = mmi_umms_app_ui_plug_in_forward;
						// key rule to follow intutuive order if CSK is pressed 
						/*#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
						func = mmi_umms_app_ui_plug_in_launch_slim_forward;
                        #endif*/
                    }
                }
                else
                {
                    func = mmi_umms_app_ui_plug_in_forward;
					// key rule to follow intutuive order if CSK is pressed 
					/*#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
					func = mmi_umms_app_ui_plug_in_launch_slim_forward;
                    #endif*/
                }
            }
            break;
        #ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
        case MMA_FOLDER_ARCHIVE:
            switch (info->msg_info->prev_folder)
            {
                case MMA_FOLDER_INBOX:
            #if defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__)
                    if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL
                        || info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
                    {
                        func = mmi_umms_app_ui_plug_in_reply;
                    }
                    else
                    {
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                        if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                        {
                            func = mmi_umms_ui_plug_in_audio_msg_view;
                        }
                        else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                        {
                            func = mmi_umms_app_if_show_viewer_screen;
                        }
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
            #else /* defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__) */ 
                    switch (info->msg_info->from_address_type)
                    {
                        case MMA_ADDR_TYPE_EMAIL:
                            func = mmi_umms_app_ui_plug_in_reply;
                            break;
                        case MMA_ADDR_TYPE_PHONE_NUMBER:
                            func = mmi_umms_app_ui_plug_in_reply_as_sms;
                            break;
                        default:
                    #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                            if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                            {
                                func = mmi_umms_ui_plug_in_audio_msg_view;
                            }
                            else
                    #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                            {
                                func = mmi_umms_app_if_show_viewer_screen;
                            }
                        #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                            func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                        #endif 
                    }
            #endif /* defined(__MMI_UNIFIED_COMPOSER__) && !defined(__MMI_OP01_202_MMS_REPLY_BY_SMS_MMS_SUPPORT__) */ 
                    break;
                case MMA_FOLDER_OUTBOX:
                case MMA_FOLDER_DRAFT:
                case MMA_FOLDER_TEMPLATE:
                case MMA_FOLDER_USRDEF_TEMPLATE:
                #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                    if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                    {
                        func = mmi_umms_ui_plug_in_audio_msg_view;
                    }
                    else
                #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                    {
                        func = mmi_umms_app_if_show_viewer_screen;
                    }
                #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                    func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                #endif 
                    break;
                case MMA_FOLDER_SENT:
                #ifdef __MMI_MMS_POSTCARD__
                    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
                    {
                        func = mmi_umms_app_if_show_viewer_screen;
                    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
                        func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
                    #endif 
                    }
                    else
                #endif /* __MMI_MMS_POSTCARD__ */ 
                    {
                        if ((info->msg_info->is_forward_lock) || ((info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)))
                        {
                            mma_creation_mode_enum creation_mode;

                            creation_mode = srv_mms_compose_settings_creation_mode();
                            if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
                            {
                            #ifdef __MMI_MMS_VOICE_MESSAGE_HANDLING__
                                if (info->msg_info->media_type == MMA_MEDIA_MSG_AUDIO)
                                {
                                    func = mmi_umms_ui_plug_in_audio_msg_view;
                                }
                                else
                            #endif /* __MMI_MMS_VOICE_MESSAGE_HANDLING__ */ 
                                {
                                    func = mmi_umms_app_if_show_viewer_screen;
                                }
                            }
                            else
                            {
                                func = mmi_umms_app_ui_plug_in_forward;
								// key rule to follow intutuive order if CSK is pressed 
								/*#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
					            func = mmi_umms_app_ui_plug_in_launch_slim_forward;
                                #endif  */
                            }
                        }
                        else
                        {
                            func = mmi_umms_app_ui_plug_in_forward;
							// key rule to follow intutuive order if CSK is pressed 
								/*#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
					        func = mmi_umms_app_ui_plug_in_launch_slim_forward;
                                #endif  */
                        }
                    }
                    break;
                default:
                    ASSERT(0);
            }
            break;
        #endif /* __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__ */ 
        default:
            ASSERT(0);

    }
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    func = mmi_umms_app_if_show_viewer_screen;
    #endif
    if (func == mmi_umms_app_if_show_viewer_screen)
    {
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        mmi_umms_app_screenDB_struct *scrDB = mmi_frm_scrn_get_user_data(mmi_umms_dtmgr_get_group_id(), mmi_frm_scrn_get_active_id());
        mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
            (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(scrDB->scrn_id);
    #else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
            (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        viewer_scr->is_review = MMI_TRUE;
    }
    func();
}

// #ifdef __MMI_MMS2_MV_MANUAL_PLAY__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_manual_play_slide_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_show_manual_play_slide_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    mma_mms_description_struct *desc;
    U16 current_slide;

    /*----------------------------------------------------------------*/
    desc = srv_mms_get_desc_pointer();
    current_slide = desc->body->curr_slide->slide_num;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_plug_in_goto_slide((U16) current_slide);
}

// #endif /* __MMI_MMS2_MV_MANUAL_PLAY__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_ui_plug_in_audio_msg_view
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_ui_plug_in_audio_msg_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_plug_in_goto_slide((U16) 1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_lsk_str
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_umms_app_ui_plug_in_get_lsk_str(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 lsk_str = STR_GLOBAL_OPTIONS;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (info->is_preview)
    {
    #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
    #ifdef __MMI_MMS_POSTCARD__
        if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
        {
            lsk_str = STR_GLOBAL_SEND;
        }
        else
    #endif /* __MMI_MMS_POSTCARD__ */ 
        {
            lsk_str = STR_GLOBAL_PLAY;
        }
    #else /* __MMI_MMS2_MV_MANUAL_PLAY__ */ 
    #ifdef __MMI_MMS_POSTCARD__
        if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
        {
            lsk_str = STR_GLOBAL_SEND;
        }
        else
    #endif /* __MMI_MMS_POSTCARD__ */ 
        {
        #ifdef __MMI_MMS_PREVIEW_GOTO__
            {
                lsk_str = STR_GLOBAL_OPTIONS;
            }
        #else /* __MMI_MMS_PREVIEW_GOTO__ */ 
            lsk_str = STR_GLOBAL_PLAY;
        #endif /* __MMI_MMS_PREVIEW_GOTO__ */ 
        }
    #endif /* __MMI_MMS2_MV_MANUAL_PLAY__ */ 
    }

#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    if (info->open_mode == MMA_MODE_VIEW && info->is_preview == MMI_TRUE)
    {
        lsk_str = STR_GLOBAL_PLAY;
    }
    else
    {
        lsk_str = STR_GLOBAL_OPTIONS;
    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    return lsk_str;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_lsk_fn
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
FuncPtr mmi_umms_app_ui_plug_in_get_lsk_fn(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FuncPtr func = mmi_umms_app_sh_viewer_lsk_hdlr;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    if (info->open_mode == MMA_MODE_VIEW)
    {
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        if (info->is_preview)
        {
        #ifdef __MMI_MMS2_MV_MANUAL_PLAY__
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                func = mmi_umms_app_if_preview_uc_send;
            }
            else
        #endif /* __MMI_MMS_POSTCARD__ */ 
            {
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            }
        #else /* __MMI_MMS2_MV_MANUAL_PLAY__ */ 
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                func = mmi_umms_app_if_preview_uc_send;
            }
            else
        #endif /* __MMI_MMS_POSTCARD__ */ 
            {
            #ifdef __MMI_MMS_PREVIEW_GOTO__
                {
                    func = mmi_umms_app_if_show_preview_option;
                }
            #else /* __MMI_MMS_PREVIEW_GOTO__ */ 
                func = mmi_umms_app_ui_plug_in_show_manual_play_slide_list;
            #endif /* __MMI_MMS_PREVIEW_GOTO__ */ 
            }
        #endif /* __MMI_MMS2_MV_MANUAL_PLAY__ */ 
        }
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    }
    #endif 
    return func;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plugin_viewer_lsk_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
void mmi_umms_app_ui_plugin_viewer_lsk_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    mmi_menu_id menu_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_LSK_HDLR, info->folder_id);
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    menu_id = umms_menu_query_function(info->msg_id);
    if (info->open_mode == MMA_MODE_EDIT)
    {
        mmi_umms_app_ui_draw_set_current_opt_menu_id(MENU_ID_UMMS_COMPOSER_OPTIONS);
        mmi_umms_app_if_show_composer_option();
        return;
    }
    mmi_umms_app_ui_draw_set_current_opt_menu_id(menu_id);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    switch (info->folder_id)
    {
        case MMA_FOLDER_INBOX:
            mmi_umms_app_if_show_inbox_mms_option();
            break;
        case MMA_FOLDER_OUTBOX:
            mmi_umms_app_if_show_outbox_option();
            break;
        case MMA_FOLDER_SENT:
            mmi_umms_app_if_show_sent_option();
            break;
        case MMA_FOLDER_DRAFT:
            mmi_umms_app_if_show_draft_option();
            break;
        case MMA_FOLDER_ARCHIVE:
            switch (info->msg_info->prev_folder)
            {
                case MMA_FOLDER_INBOX:
                    mmi_umms_app_if_show_inbox_mms_option();
                    break;
                case MMA_FOLDER_SENT:
                    mmi_umms_app_if_show_sent_option();
                    break;
                case MMA_FOLDER_DRAFT:
                    mmi_umms_app_if_show_draft_option();
                    break;
            }
            break;
        #ifdef __MMI_MMS_TEMPLATE_SUPPORT__
        case MMA_FOLDER_TEMPLATE:
        case MMA_FOLDER_USRDEF_TEMPLATE:
            mmi_umms_app_if_show_mms_template_option();
            break;
        #endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 
    }
}

#ifdef __MMI_MMS_PREVIEW_GOTO__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_preview_slide_list_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_preview_slide_list_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *slide_list_scr;
    mma_mms_description_struct *desc = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_DISPLAY_SLIDE_LIST);
    slide_list_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (slide_list_scr == NULL)
    {
        desc = srv_mms_get_desc_pointer();
        slide_list_scr =
            (mmi_umms_app_ui_draw_dynamic_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        ASSERT(slide_list_scr);
        memset(slide_list_scr, 0, sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        slide_list_scr->scrn_id = scr_id;
        slide_list_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
        slide_list_scr->number_of_item = desc->body->slide_no;
        slide_list_scr->hilighted_item = desc->body->curr_slide->slide_num - 1;
        slide_list_scr->get_item_cb = mmi_umms_app_ui_callback_get_slide_list;
        slide_list_scr->get_item_hint_cb = NULL;
        slide_list_scr->hilite_notify_cb = NULL;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)slide_list_scr);
        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_preview_slide_list_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_preview_slide_list_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_umms_app_sh_preview_slide_list_lsk_hdlr, KEY_EVENT_UP);

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_preview_slide_list_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_preview_slide_list_hdlr(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *slide_list_scr =
        (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(slide_list_scr);
    mmi_umms_app_ui_plug_in_goto_slide((U16) slide_list_scr->hilighted_item + 1);
}
#endif /* __MMI_MMS_PREVIEW_GOTO__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_goto_slide
 * DESCRIPTION
 *  
 * PARAMETERS
 *  slide_num       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_goto_slide(U16 slide_num)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);
    mmi_umms_app_dtmgr_viewer_info_data *viewer_data =
        (mmi_umms_app_dtmgr_viewer_info_data*) mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_VIEWER_INFO);
	/*mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);*/
    mma_mms_description_struct *desc;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_GO_TO_SLIDE, slide_num);
    ASSERT(viewer_scr);
    desc = srv_mms_get_desc_pointer();
    ASSERT(slide_num <= desc->body->slide_no);

    if (desc->body->curr_slide->slide_num < slide_num)
    {
        do
        {
            desc->body->curr_slide = desc->body->curr_slide->next;
        } while (desc->body->curr_slide->slide_num != slide_num);
    }
    else if (desc->body->curr_slide->slide_num > slide_num)
    {
        do
        {
            desc->body->curr_slide = desc->body->curr_slide->prev;
        } while (desc->body->curr_slide->slide_num != slide_num);
    }
    ClearAllKeyHandler();
    viewer_scr->is_review = MMI_TRUE;
    mmi_umms_app_if_show_viewer_screen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_viewer_handover_to_category
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_viewer_handover_to_category(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(MMS_VIEWER_TIMER);
    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_MMS_VIEWER)
    {
        /* handover_to_category; */
        Category630MidSlidesCBDoneNotify();
    }
#ifdef __MMI_MMS_UNLIMITED_USE_DETAILS_SUPPORT__
    if (srv_mms_is_use_detail_parsing_going_on() == MMI_TRUE)
    {
        srv_mms_compute_rest_use_details();
    }
#endif /* __MMI_MMS_UNLIMITED_USE_DETAILS_SUPPORT__ */ 
}

#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_recipient_items_number
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_umms_app_ui_plug_in_recipient_items_number()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_header_struct *header = srv_mms_container_get_header();
    mmi_umms_app_ui_draw_dynamic_screen_struct *use_detail_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    use_detail_scr =
        (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_ADD_RECIPIENT);

    switch (use_detail_scr->highlighted_menu)
    {
        case MENU_ID_UMMS_ADD_RECIPIENT_TO:
            return header->to_num;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case MENU_ID_UMMS_ADD_RECIPIENT_CC:
            return header->cc_num;
        case MENU_ID_UMMS_ADD_RECIPIENT_BCC:
            return header->bcc_num;
#endif
        default:
            ASSERT(FALSE);
			return 0;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_hilite_item
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_umms_app_ui_plug_in_get_hilite_item(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *use_detail_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    use_detail_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (use_detail_scr)
        return use_detail_scr->hilighted_item;
    else
    {
        ASSERT(0);
        return 0;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_set_hilite_item
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 *  temp        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_set_hilite_item(U16 scr_id, U16 temp)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *use_detail_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    use_detail_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    use_detail_scr->hilighted_item = temp;;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_add_recipient_list_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_add_recipient_list_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *use_detail_scr;
    U8 *guiBuffer = mmi_frm_scrn_get_gui_buf(mmi_umms_dtmgr_get_group_id(), scr_id);
    mmi_umms_app_ui_draw_dynamic_screen_struct *dynamic_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dynamic_scr =
        (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_ADD_RECIPIENT);

    use_detail_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (use_detail_scr != NULL && guiBuffer == NULL)
    {
        use_detail_scr->scrn_id = scr_id;
        use_detail_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
        use_detail_scr->number_of_item = mmi_umms_app_ui_plug_in_recipient_items_number();
        use_detail_scr->hilighted_item = mmi_umms_app_ui_plug_in_get_hilite_item(scr_id);
        use_detail_scr->get_item_cb = mmi_umms_app_ui_callback_get_recipient_list;
        use_detail_scr->get_item_hint_cb = NULL;
        use_detail_scr->hilite_notify_cb = NULL;
        use_detail_scr->change_title = NULL;

        use_detail_scr->scrDB = (mmi_umms_app_screenDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_screenDB_struct));
        ASSERT(use_detail_scr->scrDB);
        memset(use_detail_scr->scrDB, 0, sizeof(mmi_umms_app_screenDB_struct));
        use_detail_scr->scrDB->scrn_id = scr_id;
        use_detail_scr->scrDB->exit_screen = mmi_umms_app_sh_mms_options_exit_func;
        use_detail_scr->scrDB->EntryFunction = mmi_umms_app_if_show_recipient_list;
        use_detail_scr->scrDB->lsk_func = mmi_umms_app_sh_show_recipient_list_lsk_handler;
        use_detail_scr->scrDB->rsk_func = mmi_umms_app_sh_static_list_rsk_handler;
        use_detail_scr->scrDB->hilite_handler = mmi_umms_app_sh_show_recipient_list_hilite_handler;
        use_detail_scr->scrDB->delete_screen_handler = mmi_umms_app_sh_show_recipient_list_delete_scr_handler;
        use_detail_scr->scrDB->RObj = (mmi_umms_app_resourceDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_resourceDB_struct));
        ASSERT(use_detail_scr->scrDB->RObj);
        memset(use_detail_scr->scrDB->RObj, 0, sizeof(mmi_umms_app_resourceDB_struct));
        use_detail_scr->scrDB->RObj->menu_item_id = MENU_ID_UMMS_OPTIONS_USE_DETAILS_NUMBER;
        if (dynamic_scr->highlighted_menu == MENU_ID_UMMS_ADD_RECIPIENT_TO)
            use_detail_scr->scrDB->RObj->title_str_id = STR_ID_UMMS_OPTIONS_RECIPIENT_TO_LIST;  /* String id of title */
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        else if (dynamic_scr->highlighted_menu == MENU_ID_UMMS_ADD_RECIPIENT_CC)
            use_detail_scr->scrDB->RObj->title_str_id = STR_ID_UMMS_OPTIONS_RECIPIENT_CC_LIST;
        else
            use_detail_scr->scrDB->RObj->title_str_id = STR_ID_UMMS_OPTIONS_RECIPIENT_BCC_LIST;
#endif
        use_detail_scr->scrDB->RObj->lsk_str_id = STR_GLOBAL_OPTIONS;   /* String id of LSK */
        use_detail_scr->scrDB->RObj->lsk_icon_id = IMG_GLOBAL_OPTIONS;  /* Icon id of LSK */
        use_detail_scr->scrDB->RObj->rsk_str_id = STR_GLOBAL_BACK;      /* String id of RSK */
        use_detail_scr->scrDB->RObj->rsk_icon_id = IMG_GLOBAL_OPTIONS;
        use_detail_scr->scrDB->RObj->title_icon_id =  MAIN_MENU_MESSAGES_MENUID;
        return MMI_UMMS_TRUE;
    }
    else
    {
        use_detail_scr->number_of_item = mmi_umms_app_ui_plug_in_recipient_items_number();
        use_detail_scr->hilighted_item = mmi_umms_app_ui_plug_in_get_hilite_item(scr_id);
        return MMI_UMMS_TRUE;
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_add_recipient_list_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_add_recipient_list_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *dynamic_scr =
        (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(dynamic_scr->scrDB->lsk_func, KEY_EVENT_UP);
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_list_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_use_details_list_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_ui_draw_dynamic_screen_struct *use_detail_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    use_detail_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (use_detail_scr == NULL)
    {
        use_detail_scr =
            (mmi_umms_app_ui_draw_dynamic_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        ASSERT(use_detail_scr);
        memset(use_detail_scr, 0, sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        use_detail_scr->scrn_id = scr_id;
        use_detail_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
        use_detail_scr->number_of_item = mmi_umms_app_dtmgr_get_use_details_total_items();
        if (use_detail_scr->number_of_item == 0)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(mmi_umms_app_dtmgr_get_use_details_list_no_data_string ()),
                MMI_EVENT_FAILURE);
            mmi_umms_app_if_show_display_popup_screen();
            mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
            srv_mms_mem_mgr_app_adm_free(use_detail_scr);
            mmi_umms_app_dtmgr_reset_use_details_list_data(scr_id);
            use_detail_scr = NULL;
            return MMI_UMMS_FAIL;
        }
        use_detail_scr->hilighted_item = 0;
        use_detail_scr->get_item_cb = mmi_umms_app_ui_callback_get_address_list;
        use_detail_scr->get_item_hint_cb = NULL;
        use_detail_scr->hilite_notify_cb = NULL;
        use_detail_scr->change_title = mmi_umms_app_dtmgr_change_use_detail_title;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)use_detail_scr);
        return MMI_UMMS_TRUE;
    }
    use_detail_scr->number_of_item = mmi_umms_app_dtmgr_get_use_details_total_items();
    return MMI_UMMS_FALSE;
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_list_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_use_details_list_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_dtmgr_use_details_struct *data =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (APPLIB_ADDR_TYPE_PHONENUMBER == data->applib_addr_type)
    {
        ChangeCenterSoftkey(0, IMG_GLOBAL_CALL_CSK);    /* image id for call */
    }
    else if (APPLIB_ADDR_TYPE_EMAIL == data->applib_addr_type)
    {
    #ifdef __MMI_PHB_OPTIONAL_FIELD__
        ChangeCenterSoftkey(0, IMG_GLOBAL_SAVE_CSK);    /* image id for save to phone book */
    #else 
        ChangeCenterSoftkey(0, IMG_GLOBAL_OPTION_CSK);
    #endif 
    }
    else if (APPLIB_ADDR_TYPE_URL == data->applib_addr_type)
    {
        ChangeCenterSoftkey(0, IMG_GLOBAL_WEB_BROWSER_CSK); /* image id for goto UrL */
    }
    else
    {
        MMI_ASSERT(0);
        return;
    }

    SetCenterSoftkeyFunction(mmi_umms_app_ui_plug_in_entry_use_details_csk, KEY_EVENT_UP);
    //  SetKeyHandler(mmi_umms_app_ui_plug_in_entry_use_details_csk, KEY_ENTER, KEY_EVENT_UP);

    if (APPLIB_ADDR_TYPE_PHONENUMBER == data->applib_addr_type)
    {
        SetKeyHandler(mmi_umms_app_ui_plug_in_use_number_as_make_call, KEY_SEND, KEY_EVENT_DOWN);
    }
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
#if (defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__))
    wgui_register_tap_callback(mmi_umms_app_ui_use_details_list_fte_tap_callback);
#endif 
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    return MMI_UMMS_TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_entry_use_details_csk
 * DESCRIPTION
 *  This function decides where to go when CSK is pressed on number ,email , URL
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_entry_use_details_csk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_dtmgr_use_details_struct *data =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (APPLIB_ADDR_TYPE_PHONENUMBER == data->applib_addr_type)
    {
     if (srv_mms_num_valid_sim())
	 {
        mmi_umms_app_ui_plug_in_use_number_as_make_call();
    }
	 else
	 {
		 mmi_umms_app_sh_use_number_list_lsk_handler();
	 }
    }
    else if (APPLIB_ADDR_TYPE_EMAIL == data->applib_addr_type)
    {
    #if (defined(__MMI_PHB_OPTIONAL_FIELD__))
        mmi_umms_app_ui_plug_in_use_email_as_save_to_phb();
    #else 
        mmi_umms_app_if_show_use_details_addresses_options();
    #endif 

    }
    else if (APPLIB_ADDR_TYPE_URL == data->applib_addr_type)
    {
        mmi_umms_app_ui_plug_in_use_url_as_browser_launch();
    }
    else
    {
        MMI_ASSERT(0);
        return;
    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_reset_use_details_list_data
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_reset_use_details_list_data(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_dtmgr_reset_use_details_list_data(scr_id);
#endif 
    return MMI_UMMS_TRUE;
}

/*******************************Niraj Added*************************************/

/************common settings******************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_message_settings_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_message_settings_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!srv_mms_is_ready())
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_NOT_AVAILABLE), MMI_EVENT_FAILURE);
        mmi_umms_app_if_show_display_popup_screen();
        return MMI_UMMS_FAIL;

    }

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_message_settings_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_message_settings_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}

/********************mms message settings*****************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_message_settings_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_message_settings_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_message_settings_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_message_settings_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* reset all the flags */
    mmi_umms_app_dtmgr_set_change_in_compose_signature(0);
    mmi_umms_app_dtmgr_set_flag_for_signature_remove_objects(0);
    mmi_umms_app_dtmgr_set_recieve_filters_done(0);
    mmi_umms_app_dtmgr_set_current_object_hilighted_in_signature(0);
    return MMI_UMMS_TRUE;
}

/*******************compose settings*************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_compose_settings_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_compose_settings_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_inline_cui_selection_screen_struct *setting_scr;
    mmi_umms_app_screenDB_struct *scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    setting_scr = (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    //mmi_umms_update_file_information();
    //g_compose_signature_done = E_OFF;

    if (setting_scr == NULL)
    {
        setting_scr =
            (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        ASSERT(setting_scr);
        memset(setting_scr, 0, sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        setting_scr->scrn_id = scr_id;
        setting_scr->hilighted_item = 0;
        setting_scr->inline_initial_data = compose_settings_initial_data;
        setting_scr->image_list_icons = mmi_umms_app_ui_callback_compose_settings_list_of_icon;
        setting_scr->set_item_list = mmi_umms_app_ui_callback_compose_settings_item_list;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)setting_scr);
        return MMI_UMMS_TRUE;
    }

    return MMI_UMMS_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_compose_settings_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_compose_settings_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetCategory57RightSoftkeyFunctions(
        mmi_umms_app_ui_plug_in_confirm_save_compose_settings,
        mmi_frm_scrn_close_active_id);

    return MMI_UMMS_TRUE;
}

/*****************************retrieval settings***********************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_retrieval_settings_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_retrieval_settings_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_inline_cui_selection_screen_struct *setting_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    setting_scr = (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (setting_scr == NULL)
    {
        /* g_recieve_filter_done = E_OFF; */
        setting_scr =
            (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        ASSERT(setting_scr);
        memset(setting_scr, 0, sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        setting_scr->scrn_id = scr_id;
        setting_scr->hilighted_item = 0;
        setting_scr->inline_initial_data = retrieval_settings_initial_data;
        setting_scr->image_list_icons = mmi_umms_app_ui_callback_retrieval_settings_list_of_icon;
        setting_scr->set_item_list = mmi_umms_app_ui_callback_retrieval_settings_item_list;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)setting_scr);
        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_retrieval_settings_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_retrieval_settings_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetCategory57RightSoftkeyFunctions(
        mmi_umms_app_ui_plug_in_confirm_save_retrieval_settings,
        mmi_frm_scrn_close_active_id);
    return MMI_UMMS_TRUE;
}

/**************************retrieval filter settings***********************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_retrieval_filters_settings_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_retrieval_filters_settings_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_inline_cui_selection_screen_struct *setting_scr;
    mmi_umms_app_screenDB_struct *scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    setting_scr = (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (setting_scr == NULL)
    {
        setting_scr =
            (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        ASSERT(setting_scr);
        memset(setting_scr, 0, sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        setting_scr->scrn_id = scr_id;
        setting_scr->hilighted_item = 0;
        setting_scr->inline_initial_data = retrieval_filters_settings_initial_data;
        setting_scr->image_list_icons = mmi_umms_app_ui_callback_retrieval_filters_settings_list_of_icon;
        setting_scr->set_item_list = mmi_umms_app_ui_callback_retrieval_filters_settings_item_list;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)setting_scr);
        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_retrieval_filters_settings_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_retrieval_filters_settings_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetCategory57RightSoftkeyFunctions(mmi_umms_app_ui_plug_in_filter_done_handler, mmi_frm_scrn_close_active_id);
    return MMI_UMMS_TRUE;
}

/***********************sending settings**********************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sending_settings_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sending_settings_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_umms_app_ui_draw_inline_cui_selection_screen_struct *setting_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    setting_scr = (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (setting_scr == NULL)
    {
        setting_scr =
            (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        ASSERT(setting_scr);
        memset(setting_scr, 0, sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        setting_scr->scrn_id = scr_id;
        setting_scr->hilighted_item = 0;
        setting_scr->inline_initial_data = sending_settings_initial_data;
        setting_scr->set_item_list = mmi_umms_app_ui_callback_sending_settings_item_list;
        setting_scr->image_list_icons = mmi_umms_app_ui_callback_sending_settings_list_of_icon;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)setting_scr);
        return MMI_UMMS_TRUE;

    }
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sending_settings_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sending_settings_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetCategory57RightSoftkeyFunctions(
        mmi_umms_app_ui_plug_in_check_sending_settings_check_before_save,
        mmi_frm_scrn_close_active_id);
    return MMI_UMMS_TRUE;
}

/**********************compose signature settings************************/

#ifdef __MMI_MMS_SIGNATURE__
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_compose_signature_settings_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_compose_signature_settings_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_umms_app_ui_draw_inline_cui_selection_screen_struct *setting_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    setting_scr = (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (setting_scr == NULL)
    {
        setting_scr =
            (mmi_umms_app_ui_draw_inline_cui_selection_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        ASSERT(setting_scr);
        memset(setting_scr, 0, sizeof(mmi_umms_app_ui_draw_inline_cui_selection_screen_struct));
        setting_scr->scrn_id = scr_id;
        setting_scr->hilighted_item = 0;
        setting_scr->inline_initial_data = compose_signature_settings_initial_data;
        setting_scr->image_list_icons = mmi_umms_app_ui_callback_compose_signature_settings_list_of_icon;
        setting_scr->set_item_list = mmi_umms_app_ui_callback_compose_signature_settings_item_list;
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)setting_scr);
        return MMI_UMMS_TRUE;

    }
    return MMI_UMMS_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_compose_signature_settings_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_compose_signature_settings_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetCategory57RightSoftkeyFunctions(mmi_umms_signature_done_handler, mmi_frm_scrn_close_active_id);
    return MMI_UMMS_TRUE;
}

/****************************signature options*********************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_signature_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_signature_options_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_signature_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_signature_options_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}
#endif/*ifdef __MMI_MMS_SIGNATURE__*/

/********************************Amit added ************************************/
#if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_memory_status_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_memory_status_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
            mmi_usb_app_unavailable_popup(0);   /* pass 0 will show default string */
            return MMI_UMMS_FAIL;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_memory_status_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_memory_status_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_memory_status_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_memory_status_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_property_screen_struct *property_screen;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
            mmi_usb_app_unavailable_popup(0);   /* pass 0 will show default string */
            return MMI_UMMS_FAIL;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 
#if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 
    if (SCR_ID_UMMS_MMS_MESSAGE_STATUS_CARD == scr_id)
    {
        if (FS_GetDevStatus(SRV_FMGR_CARD_DRV, FS_MOUNT_STATE_ENUM) != FS_NO_ERROR)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_ID_UMMS_MMS_NO_MEM_CARD), MMI_EVENT_FAILURE);
            mmi_umms_app_if_show_display_popup_screen();
            return MMI_UMMS_FAIL;
        }
    }
#endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
    property_screen = (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (property_screen == NULL)
    {
        property_screen =
            (mmi_umms_app_ui_draw_property_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        ASSERT(property_screen);
        memset(property_screen, 0, sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        property_screen->scrn_id = scr_id;
        property_screen->get_string_buffer = mmi_umms_app_ui_callback_memory_status_get_data;
        property_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        property_screen->scrDB = (mmi_umms_app_screenDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_screenDB_struct));
        ASSERT(property_screen->scrDB);
        memset(property_screen->scrDB, 0, sizeof(mmi_umms_app_screenDB_struct));
        property_screen->scrDB->scrn_id = scr_id;
        property_screen->scrDB->exit_screen = mmi_umms_app_sh_memory_status_exit_func;
        property_screen->scrDB->EntryFunction = mmi_umms_app_if_show_phone_memory_status_screen;
        property_screen->scrDB->rsk_func = mmi_umms_app_sh_property_status_rsk_handler;
        property_screen->scrDB->delete_screen_handler = mmi_umms_app_sh_property_status_delete_scr_handler;
        property_screen->scrDB->RObj = (mmi_umms_app_resourceDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_resourceDB_struct));
        ASSERT(property_screen->scrDB->RObj);
        memset(property_screen->scrDB->RObj, 0, sizeof(mmi_umms_app_resourceDB_struct));
        property_screen->scrDB->RObj->menu_item_id = MENU_ID_UMMS_MMS_SETTINGS_MEMORY_STATUS_PHONE;
        property_screen->scrDB->RObj->title_str_id = STR_ID_UMMS_MMS_PREFER_STORAGE_PHONE;      /* String id of title */
        property_screen->scrDB->RObj->rsk_str_id = STR_GLOBAL_BACK;     /* String id of RSK */
        property_screen->scrDB->RObj->rsk_icon_id = IMG_GLOBAL_BACK;
    #if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 
        if (scr_id == SCR_ID_UMMS_MMS_MESSAGE_STATUS_CARD)
        {
            property_screen->scrDB->EntryFunction = mmi_umms_app_if_show_card_memory_status_screen;
            property_screen->scrDB->RObj->title_str_id = STR_ID_UMMS_MMS_PREFER_STORAGE_CARD;
            property_screen->scrDB->RObj->menu_item_id = MENU_ID_UMMS_MMS_SETTINGS_MEMORY_STATUS_CARD;
        }
    #endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)property_screen);

        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_memory_status_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_memory_status_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_objects_attachment_list_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_save_objects_attachment_list_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *dynamic_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dynamic_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (dynamic_scr == NULL)
    {
        dynamic_scr =
            (mmi_umms_app_ui_draw_dynamic_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        ASSERT(dynamic_scr);
        memset(dynamic_scr, 0, sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        dynamic_scr->scrn_id = scr_id;
        dynamic_scr->get_item_cb = mmi_umms_app_ui_callback_get_attachment_data;
        dynamic_scr->number_of_item = mmi_umms_app_ui_callback_get_save_objects_attachment_count();
        dynamic_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        dynamic_scr->scrDB = (mmi_umms_app_screenDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_screenDB_struct));
        ASSERT(dynamic_scr->scrDB);
        memset(dynamic_scr->scrDB, 0, sizeof(mmi_umms_app_screenDB_struct));
        dynamic_scr->scrDB->scrn_id = scr_id;
        dynamic_scr->scrDB->exit_screen = mmi_umms_app_sh_save_objects_attachment_list_exit_func;
        dynamic_scr->scrDB->EntryFunction = mmi_umms_app_if_show_save_objects_attchement_list;
        dynamic_scr->scrDB->lsk_func = mmi_umms_app_sh_save_objects_attachment_list_lsk_handler;
        dynamic_scr->scrDB->rsk_func = mmi_umms_app_sh_save_objects_attachment_list_rsk_handler;
        dynamic_scr->scrDB->delete_screen_handler = mmi_umms_app_sh_dynamic_list_delete_scr_handler;
        dynamic_scr->scrDB->hilite_handler = mmi_umms_app_sh_save_objects_attachment_list_hilite_handler;
        dynamic_scr->scrDB->RObj = (mmi_umms_app_resourceDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_resourceDB_struct));
        ASSERT(dynamic_scr->scrDB->RObj);
        memset(dynamic_scr->scrDB->RObj, 0, sizeof(mmi_umms_app_resourceDB_struct));
        dynamic_scr->scrDB->RObj->menu_item_id = MENU_ID_UMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS;
        dynamic_scr->scrDB->RObj->title_str_id = STR_ID_UMMS_OBJECTS_ATTACHMENT_LIST;   /* String id of title */
        dynamic_scr->scrDB->RObj->lsk_str_id = STR_GLOBAL_OK;   /* String id of LSK */
        dynamic_scr->scrDB->RObj->lsk_icon_id = IMG_GLOBAL_OK;  /* Icon id of LSK */
        dynamic_scr->scrDB->RObj->rsk_str_id = STR_GLOBAL_BACK; /* String id of RSK */
        dynamic_scr->scrDB->RObj->rsk_icon_id = IMG_GLOBAL_BACK;
        dynamic_scr->scrDB->RObj->title_icon_id =  MAIN_MENU_MESSAGES_MENUID;
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)dynamic_scr);

        return MMI_UMMS_TRUE;
    }
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    dynamic_scr->number_of_item = mmi_umms_app_ui_callback_get_save_objects_attachment_count();
#endif 
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_objects_attachment_list_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_save_objects_attachment_list_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
    SetCenterSoftkeyFunction(mmi_umms_app_sh_save_objects_attachment_list_lsk_handler, KEY_EVENT_UP);

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_objects_list_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_save_objects_list_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL count_present = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    count_present = mmi_umms_app_dtmgr_check_save_object_count();
    if (count_present == MMI_FALSE)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_EMPTY), MMI_EVENT_FAILURE);
        mmi_umms_app_if_show_display_popup_screen();
        return MMI_UMMS_FAIL;
    }

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_objects_list_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  static_scr      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_save_objects_list_post_func(U16 static_scr)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_properties_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
//MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_properties_pre_func(U16 scr_id)
//{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
/* mmi_umms_app_ui_draw_property_screen_struct *property_screen; */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
/* property_screen = (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id); */

 //   if (property_screen == NULL)
 //   {
 //       property_screen =
//            (mmi_umms_app_ui_draw_property_screen_struct*)
 //           srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_property_screen_struct));
//        property_screen->scrn_id = scr_id;
 //       property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_property_screen_get_data;
  //      property_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

/* mmi_umms_app_sh_set_screen_context(scr_id, (void*)property_screen); */

  //      return MMI_UMMS_TRUE;
  //  }
//   return MMI_UMMS_FALSE; /* From history  */
//}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_properties_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_properties_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_recipient_screen_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 *  scr_id          [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_recipient_screen_hdlr(U16 hilite_menu, U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_dtmgr_use_details_struct *data =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (data == NULL)
    {
        data =
            (mmi_umms_app_dtmgr_use_details_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_dtmgr_use_details_struct));
        ASSERT(data);
        memset(data, 0, sizeof(mmi_umms_app_dtmgr_use_details_struct));
    #ifdef __MMI_MMS_UNLIMITED_USE_DETAILS_SUPPORT__
        data->curr_index = 0;
        data->is_more = MMI_FALSE;
    #endif /* __MMI_MMS_UNLIMITED_USE_DETAILS_SUPPORT__ */ 
        data->mms_umms_app_slide = SRV_MMS_GET_USE_DETAILS_RECIPIENT;
    }
    switch (hilite_menu)
    {
        case MENU_ID_UMMS_OPTIONS_USE_DETAILS_REC_NUMBER:
            data->applib_addr_type = (U8) APPLIB_ADDR_TYPE_PHONENUMBER;
            mmi_umms_app_dtmgr_update_data_for_use_details((void*)data);
            mmi_umms_app_if_show_use_number();

            break;
        case MENU_ID_UMMS_OPTIONS_USE_DETAILS_REC_EMAIL:
            data->applib_addr_type = (U8) APPLIB_ADDR_TYPE_EMAIL;
            mmi_umms_app_dtmgr_update_data_for_use_details((void*)data);
            mmi_umms_app_if_show_use_email();
            break;
        default:
            ASSERT(0);
    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    return MMI_UMMS_TRUE;
}

#ifdef __UNIFIED_MESSAGE_SORT_MESSAGE_LIST__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sort_by_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sort_by_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sort_by_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sort_by_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}
#endif /* __UNIFIED_MESSAGE_SORT_MESSAGE_LIST__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_use_details_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_use_details_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}

#ifdef __MMI_MMS_PREVIEW_GOTO__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_preview_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_preview_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_mms_preview_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_mms_preview_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_PREVIEW_GOTO__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_java_options_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_java_options_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_java_options_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_java_options_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sim_selection_profile_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sim_selection_profile_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_app_ui_plug_in_sim_selection_profile_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_app_ui_plug_in_sim_selection_profile_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_notification_option_screen_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_notification_option_screen_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_notification_option_screen_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_notification_option_screen_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_report_options_screen_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_report_options_screen_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_report_options_screen_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_report_options_screen_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_sim_options_resend_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_sim_options_resend_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_sim_options_resend_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_sim_options_resend_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_use_details_addresses_options_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_use_details_addresses_options_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U16 menuid = 0;
    mmi_umms_app_resourceDB_struct *resource = NULL;
    mmi_umms_app_screenDB_struct *scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

    mmi_umms_app_dtmgr_use_details_struct *data =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    resource = scrDB->RObj;
    if (APPLIB_ADDR_TYPE_PHONENUMBER == data->applib_addr_type)
    {
        menuid = MENU_ID_UMMS_USE_DETAILS_ADDRESSES_USE_NUMBER;
    }
    else if (APPLIB_ADDR_TYPE_EMAIL == data->applib_addr_type)
    {
        menuid = MENU_ID_UMMS_USE_DETAILS_ADDRESSES_USE_EMAIL;
    }
    else if (APPLIB_ADDR_TYPE_URL == data->applib_addr_type)
    {
#ifdef __MMI_BRW_BKM_INTERFACE_SUPPORT__
        menuid = MENU_ID_UMMS_USE_DETAILS_ADDRESSES_USE_URL;
#endif
    }
    else
    {
        MMI_ASSERT(0);
        return MMI_TRUE;
    }
    resource->menu_item_id = menuid;
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_use_details_addresses_options_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_use_details_addresses_options_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_message_status_screen_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_message_status_screen_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_property_screen_struct *property_screen;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    property_screen = (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (property_screen == NULL)
    {
        property_screen =
            (mmi_umms_app_ui_draw_property_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        ASSERT(property_screen);
        memset(property_screen, 0, sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        property_screen->scrn_id = scr_id;
        property_screen->get_string_buffer = mmi_umms_app_ui_callback_message_status_get_data;
        property_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        property_screen->scrDB = (mmi_umms_app_screenDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_screenDB_struct));
        ASSERT(property_screen->scrDB);
        memset(property_screen->scrDB, 0, sizeof(mmi_umms_app_screenDB_struct));
        property_screen->scrDB->scrn_id = scr_id;
        property_screen->scrDB->exit_screen = mmi_umms_app_sh_message_status_screen_exit_func;
        property_screen->scrDB->EntryFunction = mmi_umms_app_if_show_message_status_screen;
        property_screen->scrDB->rsk_func = mmi_umms_app_sh_property_status_rsk_handler;
        property_screen->scrDB->delete_screen_handler = mmi_umms_app_sh_property_status_delete_scr_handler;
        property_screen->scrDB->RObj = (mmi_umms_app_resourceDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_resourceDB_struct));
        ASSERT(property_screen->scrDB->RObj);
        memset(property_screen->scrDB->RObj, 0, sizeof(mmi_umms_app_resourceDB_struct));
        //property_screen->scrDB->RObj->menu_item_id = MENU_ID_UMMS_OUTBOX_OPTIONS_MESSAGE_STATUS;
        //property_screen->scrDB->RObj->title_str_id = STR_ID_UMMS_MESSAGE_STATUS;        /* String id of title */
        property_screen->scrDB->RObj->rsk_str_id = STR_GLOBAL_BACK;     /* String id of RSK */
        property_screen->scrDB->RObj->rsk_icon_id = IMG_GLOBAL_BACK;
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)property_screen);

        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_message_status_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_message_status_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_new_message_popup_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_new_message_popup_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_infinite_time_screen_struct *infinite_time_screen;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    infinite_time_screen = (mmi_umms_app_ui_draw_infinite_time_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (infinite_time_screen == NULL)
    {
        infinite_time_screen =
            (mmi_umms_app_ui_draw_infinite_time_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_infinite_time_screen_struct));
        ASSERT(infinite_time_screen);
        memset(infinite_time_screen, 0, sizeof(mmi_umms_app_ui_draw_infinite_time_screen_struct));
        infinite_time_screen->image_id = mmi_umms_app_ui_callback_sh_new_message_popup_get_image_id(scr_id);
        infinite_time_screen->str_id = mmi_umms_app_ui_callback_sh_new_message_popup_get_data(scr_id);
        infinite_time_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

        mmi_umms_app_sh_set_screen_context(scr_id, (void*)infinite_time_screen);

        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_new_message_popup_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_show_new_message_popup_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_sending_settings_check_before_save
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_check_sending_settings_check_before_save(void)
{
#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 connection_type;
    S8 tmp_str[UMMS_CONVERT_INDEX] = {0, };
    U32 max_msg_size = 0;
    umms_inline_sending_items_struct *inline_sending_settings;
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
    inline_sending_settings =
        (umms_inline_sending_items_struct*) mmi_umms_app_dtmgr_get_current_sending_settings_list();
    connection_type = srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS);


    if ((connection_type > SRV_WAP_PROF_CONN_TYPE_HTTP) && (inline_sending_settings->size == E_SENDING_SIZE_LIMIT_600))
    {
        max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        max_msg_size = max_msg_size / 1024;
        memset(subMenuData, 0, sizeof(subMenuData));
        mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_WAP_MAX_SIZE_ALLOWED));
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        gui_itoa(max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
        mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));
        {
            mmi_popup_property_struct arg;

            mmi_popup_property_init(&arg);
            arg.parent_id = mmi_umms_dtmgr_get_group_id();
            arg.user_tag = (void*)(mmi_umms_app_ui_plug_in_confirm_save_sending_settings);
            mmi_popup_display((WCHAR*) ((UI_string_type) subMenuData), MMI_EVENT_INFO, &arg);
        }
    }
    else
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 

    {
        mmi_umms_app_ui_plug_in_confirm_save_sending_settings();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_confirm_save_sending_settings
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_confirm_save_sending_settings(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) GetString(STR_GLOBAL_SAVE_ASK),
        MMI_EVENT_QUERY,
        MMI_FALSE,
        MMI_TRUE,
        mmi_umms_app_ui_plug_in_set_inline_sending_settings_to_nvram,
        mmi_umms_app_ui_plug_in_exit_confirm_screen,
        NULL,
        NULL);

    mmi_umms_app_if_show_display_confirm_screen();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_set_inline_sending_settings_to_nvram
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_set_inline_sending_settings_to_nvram(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_SAVING);
       mmi_umms_app_if_show_progress_screen(); */
    mmi_umms_app_dtmgr_set_inline_sending_settings_to_nvram();
    mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_SAVED), MMI_EVENT_EXPLICITLY_SAVED);
    mmi_umms_app_if_show_display_popup_screen();
    mmi_frm_group_close(GRP_ID_UMMS_LIST_INLINE_CUI);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_confirm_save_compose_settings
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_confirm_save_compose_settings(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL result = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    result = mmi_umms_app_ui_callback_check_compose_settings();
    if (result == MMI_FALSE)
    {
        return; /* popup will be displayed as per result fail */
    }
    mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) GetString(STR_GLOBAL_SAVE_ASK),
        MMI_EVENT_QUERY,
        MMI_FALSE,
        MMI_TRUE,
        mmi_umms_app_ui_plug_in_set_inline_compose_settings_to_nvram,
        mmi_umms_app_ui_plug_in_exit_confirm_screen,
        NULL,
        NULL);

    mmi_umms_app_if_show_display_confirm_screen();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_set_inline_compose_settings_to_nvram
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_set_inline_compose_settings_to_nvram(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_SAVING);
       mmi_umms_app_if_show_progress_screen(); */
    mmi_umms_app_dtmgr_set_inline_compose_settings_to_nvram();
    mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_SAVED), MMI_EVENT_EXPLICITLY_SAVED);
    mmi_umms_app_if_show_display_popup_screen();
    mmi_frm_group_close(GRP_ID_UMMS_LIST_INLINE_CUI);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_confirm_save_retrieval_settings
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_confirm_save_retrieval_settings(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) GetString(STR_GLOBAL_SAVE_ASK),
        MMI_EVENT_QUERY,
        MMI_FALSE,
        MMI_TRUE,
        mmi_umms_app_ui_plug_in_set_inline_retrieval_settings_to_nvram,
        mmi_umms_app_ui_plug_in_exit_confirm_screen,
        NULL,
        NULL);

    mmi_umms_app_if_show_display_confirm_screen();
    mmi_umms_app_dtmgr_set_recieve_filters_done(MMI_FALSE);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_set_inline_retrieval_settings_to_nvram
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_set_inline_retrieval_settings_to_nvram(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_SAVING);
    //mmi_umms_app_if_show_progress_screen();

    mmi_umms_app_dtmgr_set_inline_retrieval_settings_to_nvram();
    mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_SAVED), MMI_EVENT_EXPLICITLY_SAVED);
    mmi_umms_app_if_show_display_popup_screen();
    mmi_frm_group_close(GRP_ID_UMMS_LIST_INLINE_CUI);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_exit_confirm_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_exit_confirm_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* read nvram compose_settings */

    srv_mms_read_nvarm_compose_settings();
    mmi_frm_group_close(GRP_ID_UMMS_LIST_INLINE_CUI);
    mmi_frm_scrn_close_active_id();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_compose_inline_custom_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_compose_inline_custom_func(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);
    SetLeftSoftkeyFunction(EntryScrForInputMethodAndDone, KEY_EVENT_UP);
    SetInputMethodAndDoneCaptionIcon(GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID));

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_filter_done_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_filter_done_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set one global variable and go back history */
    mmi_umms_app_dtmgr_set_recieve_filters_done(MMI_TRUE);
    mmi_frm_group_close(GRP_ID_UMMS_LIST_INLINE_CUI_EXT);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_get_app_ui_plug_in_change_in_filters
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U8 mmi_umms_get_app_ui_plug_in_change_in_filters(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_umms_app_dtmgr_get_recieve_filters_done();
}

#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_option_slim_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_option_slim_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_description_struct *desc = srv_mms_get_desc_pointer();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (desc != NULL)
    {
        /* Just Make Sure In Edit Mode Media Should be on top */
        desc->body->layout = MMA_LAYOUT_IMAGE_ON_TOP;
    }
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_option_slim_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_option_slim_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
#ifdef __MMI_MMS_TEMPLATE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_template_menu_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_template_menu_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!srv_mms_is_ready())
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_NOT_AVAILABLE), MMI_EVENT_FAILURE);
        mmi_umms_app_if_show_display_popup_screen();
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        return MMI_UMMS_FAIL;

    }

#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
            mmi_usb_app_unavailable_popup(0);   /* pass 0 will show default string */
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            return MMI_UMMS_FAIL;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 
    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_template_menu_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_template_menu_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_reset_template_list_data();
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_final_edit
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_final_edit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_start_uc_struct uc_start;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = info->msg_id;
    uc_start.uc_mode = MMA_MODE_EDIT;
    uc_start.sim_id = MMI_SIM1;
    uc_start.storage_type = info->msg_info->msg_storage;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 

    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(info->folder_id);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_properties_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_properties_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_umms_app_ui_draw_property_screen_struct *property_screen;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    property_screen = (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (property_screen == NULL)
    {
        property_screen =
            (mmi_umms_app_ui_draw_property_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        ASSERT(property_screen);
        memset(property_screen, 0, sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        property_screen->scrn_id = scr_id;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_property_screen_get_data;
#else
        property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_property_screen_get_data_slim;
#endif
        property_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        property_screen->scrDB = (mmi_umms_app_screenDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_screenDB_struct));
        ASSERT(property_screen->scrDB);
        memset(property_screen->scrDB, 0, sizeof(mmi_umms_app_screenDB_struct));
        property_screen->scrDB->scrn_id = scr_id;
        property_screen->scrDB->exit_screen = mmi_umms_app_sh_mms_options_exit_func;
        property_screen->scrDB->EntryFunction = mmi_umms_app_if_show_property_screen;
        property_screen->scrDB->rsk_func = mmi_umms_app_sh_static_list_rsk_handler;
        property_screen->scrDB->delete_screen_handler = mmi_umms_app_sh_property_status_delete_scr_handler;
        property_screen->scrDB->RObj = (mmi_umms_app_resourceDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_resourceDB_struct));
        ASSERT(property_screen->scrDB->RObj);
        memset(property_screen->scrDB->RObj, 0, sizeof(mmi_umms_app_resourceDB_struct));
        property_screen->scrDB->RObj->menu_item_id = MENU_ID_UMMS_OPTIONS_PROPERTIES;
        property_screen->scrDB->RObj->title_str_id = STR_GLOBAL_DETAILS;        /* String id of title */
        property_screen->scrDB->RObj->rsk_str_id = STR_GLOBAL_BACK;     /* String id of RSK */
        property_screen->scrDB->RObj->rsk_icon_id = IMG_GLOBAL_BACK;
        if (info->is_already_viewed == MMI_FALSE)
        {
            property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_property_screen_get_data_slim;
        }
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)property_screen);

        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;   /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_redraw_dr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_redraw_dr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dummy_screen();
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_READ_DELIVERY_REPORT_VIEW_SCREEN);
    mmi_umms_app_if_show_rr_dr_view_screen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_abnormal_view_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  MMI_UMMS_SCR_ID     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_abnormal_view_pre_func(U16 MMI_UMMS_SCR_ID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_umms_app_ui_draw_property_screen_struct *property_screen;
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    property_screen = (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (property_screen == NULL)
    {
        property_screen =
            (mmi_umms_app_ui_draw_property_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        ASSERT(property_screen);
        memset(property_screen, 0, sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        property_screen->scrn_id = scr_id;
        property_screen->csk_func = mmi_umms_app_ui_plug_in_redraw_dr;
        property_screen->csk_icon = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
    #ifdef __MMI_FTE_SUPPORT__
        memset(&(property_screen->fte_data), 0, sizeof(mmi_umms_app_ui_fte_struct));
    #endif 
        if (option_scr_data->msg_info->result == MMA_RESULT_FAIL_FILE_CORRUPTED
            || option_scr_data->msg_info->result == MMA_RESULT_FAIL_UNSUPPORT_MMS_TYPE)
        {
            property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_get_error_print_data;
            property_screen->lsk_delete = MMI_TRUE;
            property_screen->csk_func = NULL;
            property_screen->csk_icon = 0 /* IMG_GLOBAL_READ_MSG_CSK */ ;
        }
        else
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
        {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_property_screen_get_data;
#else
        property_screen->get_string_buffer = mmi_umms_app_ui_callback_mms_property_screen_get_data_slim;
#endif
        }
        property_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);
    #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        property_screen->scrDB = (mmi_umms_app_screenDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_screenDB_struct));
        ASSERT(property_screen->scrDB);
        memset(property_screen->scrDB, 0, sizeof(mmi_umms_app_screenDB_struct));
        property_screen->scrDB->scrn_id = scr_id;
        property_screen->scrDB->exit_screen = mmi_umms_app_sh_read_delivery_report_view_exit_func;
        property_screen->scrDB->EntryFunction = mmi_umms_app_if_show_rr_dr_view_screen;
        property_screen->scrDB->rsk_func = mmi_umms_app_sh_read_delivery_report_view_rsk_handler;
        property_screen->scrDB->lsk_func = mmi_umms_app_sh_read_delivery_report_view_lsk_handler;
        property_screen->scrDB->delete_screen_handler = mmi_umms_app_sh_property_status_delete_scr_handler;
        property_screen->scrDB->RObj = (mmi_umms_app_resourceDB_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_resourceDB_struct));
        ASSERT(property_screen->scrDB->RObj);
        memset(property_screen->scrDB->RObj, 0, sizeof(mmi_umms_app_resourceDB_struct));
        property_screen->scrDB->RObj->menu_item_id = MENU_ID_UMMS_OPTIONS_PROPERTIES;
        property_screen->scrDB->RObj->title_str_id = STR_GLOBAL_DETAILS;        /* String id of title */
        property_screen->scrDB->RObj->rsk_str_id = STR_GLOBAL_BACK;     /* String id of RSK */
        property_screen->scrDB->RObj->rsk_icon_id = IMG_GLOBAL_BACK;
        property_screen->scrDB->RObj->lsk_str_id = STR_GLOBAL_OPTIONS;  /* String id of RSK */
        property_screen->scrDB->RObj->lsk_icon_id = IMG_GLOBAL_OPTIONS;
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        property_screen->rnk_func = mmi_umms_app_ui_callback_display_next_mms;
        property_screen->lnk_func = mmi_umms_app_ui_callback_display_previous_mms;
        if (option_scr_data->msg_info->result == MMA_RESULT_OK)
        {
            switch (option_scr_data->msg_info->msg_type)
            {
                case MMA_MSG_TYPE_READ_REPORT:
                case MMA_MSG_TYPE_DELIVERY_REPORT:

            #ifdef __MMI_FTE_SUPPORT__
                    property_screen->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE - 1;
                    property_screen->fte_data.content_icon[0] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_OPEN);
                    property_screen->fte_data.content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_DELETE);
                    property_screen->fte_data.disabled_content_icon[0] = NULL;
                    property_screen->fte_data.disabled_content_icon[1] = NULL;
                    property_screen->fte_data.string[0] = (PU8) GetString(STR_GLOBAL_VIEW);
                    property_screen->fte_data.string[1] = (PU8) GetString(STR_GLOBAL_DELETE);
                    property_screen->fte_data.callback = mmi_umms_app_ui_callback_tb_rr_dr;
            #endif /* __MMI_FTE_SUPPORT__ */ 
                    break;
                case MMA_MSG_TYPE_NOTIFICATION:
                    property_screen->csk_func = mmi_umms_app_ui_plug_in_download;
                    property_screen->csk_icon = IMG_GLOBAL_COMMON_CSK /* IMG_GLOBAL_DOWNLOAD_CSK */ ;
                    if (option_scr_data->msg_info->msg_type == MMA_MSG_TYPE_NOTIFICATION &&
                        srv_mms_bgsr_get_downloading_msg_id() == option_scr_data->msg_id)
                    {
                        property_screen->csk_func = mmi_umms_app_sh_abnormal_view_lsk_handler;
                        property_screen->csk_icon = IMG_GLOBAL_OPTION_CSK;
                    }
                #ifdef __MMI_FTE_SUPPORT__
                    property_screen->fte_data.item_count = MMI_UMMS_APP_MAX_ICON_FTE - 1;
                    property_screen->fte_data.content_icon[0] = (PU8) GetImage(IMG_ID_UMMS_TOOLBAR_IMAGE_DOWNLOAD);
                    property_screen->fte_data.content_icon[1] = (PU8) GetImage(IMG_GLOBAL_TOOLBAR_DELETE);
                    property_screen->fte_data.disabled_content_icon[0] =
                        (PU8) GetImage(IMG_ID_UMMS_TOOLBAR_IMAGE_DOWNLOAD_DIS);
                    property_screen->fte_data.disabled_content_icon[1] = NULL;
                    property_screen->fte_data.string[0] = (PU8) GetString(STR_GLOBAL_DOWNLOAD);
                    property_screen->fte_data.string[1] = (PU8) GetString(STR_GLOBAL_DELETE);
                    property_screen->fte_data.callback = mmi_umms_app_ui_callback_tb_notification;
                #endif /* __MMI_FTE_SUPPORT__ */ 
                    break;
                case MMA_MSG_TYPE_JAVA:
                    property_screen->csk_func = mmi_umms_app_sh_abnormal_view_lsk_handler;
                    property_screen->csk_icon = IMG_GLOBAL_OPTION_CSK /* IMG_GLOBAL_READ_MSG_CSK */ ;
                    break;
                default:
                    break;
            }
            if (option_scr_data->folder_id == MMA_FOLDER_OUTBOX)
            {
                property_screen->csk_func = mmi_umms_app_if_show_outbox_option;
                property_screen->csk_icon = IMG_GLOBAL_OPTION_CSK;
            }
        }
        mmi_frm_cb_reg_event(
            EVT_ID_MMI_UM_REFRESH,
            (mmi_proc_func) mmi_umms_app_dtmgr_update_indexing_data_from_um,
            NULL);

    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
        mmi_umms_app_sh_set_screen_context(scr_id, (void*)property_screen);
        return MMI_UMMS_TRUE;
    }
#ifdef __MMI_MMS_ITERATOR_VIEWER__
    mmi_umms_app_dtmgr_update_indexing_data_from_um(NULL);
#endif 
    return MMI_UMMS_FALSE;   /* From history  */
}

#ifdef __MMI_MMS_ITERATOR_VIEWER__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_abnormal_screen_option
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_abnormal_screen_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_screenDB_struct *scrDB = mmi_frm_scrn_get_user_data(mmi_umms_dtmgr_get_group_id(), mmi_frm_scrn_get_active_id());
    mmi_umms_app_ui_draw_property_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scrDB->scrn_id);
    mmi_umms_app_dtmgr_option_scr_data_struct *option_scr_data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (option_scr_data->msg_info->result != MMA_RESULT_OK)
    {
        mmi_umms_app_ui_plug_in_delete_confirm_func();
        mmi_umms_app_if_show_display_confirm_screen();
        return;
    }
    else if (option_scr_data->folder_id == MMA_FOLDER_OUTBOX)
    {
        mmi_umms_app_if_show_outbox_option();
        return;
    }
    switch (option_scr_data->msg_info->msg_type)
    {
        case MMA_MSG_TYPE_READ_REPORT:
        case MMA_MSG_TYPE_DELIVERY_REPORT:
            mmi_umms_app_if_show_rr_dr_view_screen();
            break;
        case MMA_MSG_TYPE_NOTIFICATION:
            mmi_umms_app_if_show_inbox_notification_option();
            break;
        case MMA_MSG_TYPE_JAVA:
            mmi_umms_app_if_show_java_mms_options();
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_viewer_playing
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_check_viewer_playing(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (viewer_scr->mode == WGUI_MV_DISPLAY_MODE_PLAY)
    {
        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;
}
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

#ifdef __UNIFIED_MESSAGE_SORT_MESSAGE_LIST__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_sort_by_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_sort_by_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}

#endif /* __UNIFIED_MESSAGE_SORT_MESSAGE_LIST__ */ 

#ifdef __MMI_MMS_TEMPLATE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_user_template_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_user_template_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_dynamic_screen_struct *dynamic_scr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    dynamic_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);
    if (dynamic_scr != NULL)
    {
        dynamic_scr->number_of_item = mmi_umms_app_dtmgr_get_template_count()/*Hardcode*/;
        dynamic_scr->hilighted_item = mmi_umms_app_dtmgr_get_current_message_index();
    }
    /* this check is extera for delete a mms and going back */
    if (dynamic_scr == NULL)
    {
        dynamic_scr =
            (mmi_umms_app_ui_draw_dynamic_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        ASSERT(dynamic_scr);
        memset(dynamic_scr, 0, sizeof(mmi_umms_app_ui_draw_dynamic_screen_struct));
        dynamic_scr->scrn_id = scr_id;
        dynamic_scr->get_item_cb = mmi_umms_app_ui_callback_template_get_data;
        dynamic_scr->number_of_item = mmi_umms_app_dtmgr_get_template_count()/*Hardcode*/;
        dynamic_scr->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

        mmi_umms_app_sh_set_screen_context(scr_id, (void*)dynamic_scr);

        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;  /* From history  */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_user_template_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_user_template_post_func(U16 scr_id)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 icon_id = mmi_umms_app_dtmgr_get_template_list_csk_icon_id();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeCenterSoftkey(0, icon_id);

    if (icon_id)
    {
        SetCenterSoftkeyFunction(mmi_umms_app_ui_plug_in_template_view_by_csk, KEY_EVENT_UP);
        //        #if defined(__MMI_TOUCH_SCREEN__)
        //                register_center_softkey_to_enter_key();
        //        #endif
        //        SetKeyHandler(mmi_umms_app_ui_plug_in_template_view_by_csk, KEY_CSK, KEY_EVENT_UP);
    }
    else
    {
        SetCenterSoftkeyFunction(NULL, KEY_EVENT_UP);
        //#if defined(__MMI_TOUCH_SCREEN__)
        //     register_center_softkey_to_enter_key();
        //#endif
        //        SetKeyHandler(NULL, KEY_CSK, KEY_EVENT_UP);
    }

    //      SetKeyHandler(mmi_umms_app_ui_plug_in_handle_mms_template_option, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    //      SetKeyHandler(mmi_frm_scrn_close_active_id, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS_TMPLT);
    SetLeftSoftkeyFunction(mmi_umms_app_ui_plug_in_handle_mms_template_option, KEY_EVENT_UP);

#if (defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__))

    wgui_register_tap_callback(mmi_umms_app_ui_template_list_fte_tap_callback);

#endif /* __MMI_FTE_SUPPORT__ */ 
    return MMI_UMMS_TRUE;
}
#endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_delete_notif_yes_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_delete_notif_yes_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 error = 0;
    U8 srv_result = 0;

	mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	srv_result = srv_mms_delete_msg(info->msg_id, &error);

	mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        mmi_umms_app_sh_delete_umms_screens();
        return;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_delete_notif_no_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_delete_notif_no_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        mmi_umms_app_sh_delete_umms_screens();
        return;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_download
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_download(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 current_secs_since_1970 = 0;
#ifdef __MMI_OP01_202_DEFFERED_DOWNLOAD_AT_FULL_IND__
    U64 phone_size_available = 0;
#endif
    U32 time = 0;
    MMI_BOOL result = MMI_FALSE;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (info == NULL)
    {
        return;
    }
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_ENTRY_DWNL_MSG, info->msg_id);

    if (srv_mms_num_valid_sim() == 0)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_GLOBAL_NOT_AVAILABLE),
                MMI_EVENT_FAILURE);
        mmi_umms_app_if_show_display_popup_screen();

        return;
    }

#ifdef __MMI_MMS_NOT_ALLOW_USER_DOWNLOAD_CORRUPTED_MMS_MSG__

    switch (info->msg_info->notification_error_type)
    {
        case MMI_UMMS_STOP_CORRUPT_DWNLD:
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_ID_UMMS_NOTIFICATION_CORRUPT),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            mmi_umms_app_sh_delete_umms_screens();
            return;
        case MMI_UMMS_STOP_UNRECONIZED_NOTIFICATION:
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_ID_UMMS_NOTIFICATION_UNRECOGNIZED),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            mmi_umms_app_sh_delete_umms_screens();
            return;
    }

#endif /* __MMI_MMS_NOT_ALLOW_USER_DOWNLOAD_CORRUPTED_MMS_MSG__ */ 
    current_secs_since_1970 = srv_mms_get_current_utc_time();

    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_PROGRESS)
    {
        mmi_umms_app_ui_draw_dummy_screen();
    }

    mmi_umms_app_sh_delete_progress_screen();

    if (current_secs_since_1970 > info->msg_info->expiry_date)
    {
		
#ifndef __MMI_SMS_SLIM__
        mmi_umms_app_dtmgr_set_popup_screen_para(
            (U16*) GetString(STR_ID_UMMS_NOTIFICATION_EXPIRED),
            MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        mmi_umms_app_sh_delete_umms_screens();
        return;
#else
		U16 disp_string[MMI_UMMS_MAX_POPUP_LENGTH * ENCODING_LENGTH];
		memset(disp_string, 0, MMI_UMMS_MAX_POPUP_LENGTH * ENCODING_LENGTH);
		memcpy(disp_string, GetString(STR_ID_UMMS_NOTIFICATION_EXPIRED), MMI_UMMS_MAX_POPUP_LENGTH * ENCODING_LENGTH);

		mmi_ucs2cat((S8*) disp_string, (S8*)L", ");
		mmi_ucs2cat((S8*) disp_string, GetString(STR_GLOBAL_DELETE_ASK));

		mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) disp_string,
        MMI_EVENT_QUERY,
        MMI_FALSE,
        MMI_FALSE,
        mmi_umms_app_ui_plug_in_delete_notif_yes_hdlr,  
        mmi_umms_app_ui_plug_in_delete_notif_no_hdlr,
        NULL,
        NULL);

        mmi_umms_app_if_show_display_confirm_screen();

		return;

#endif
    }

    if (srv_mms_bgsr_get_msg_status(info->msg_id) != SRV_MMS_BGSR_STATUS_DOWNLOADING)
    {
    #ifndef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    #ifdef __MMI_WAP_MMS_NO_REJECT_NOTIFICATION_BY_SIZE__
        if (info->header_info->download_size >
            (wap_custom_get_max_mms_msg_size() + wap_custom_get_mms_delta_retrival_size()))
        {

            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_OPTIONS_MSG_SIZE_EXCEED_CONTINUE),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_ui_plug_in_download_continue,
                mmi_umms_app_ui_plug_in_download_cancel_by_pressing_no,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
            return;
        }
    #else /* __MMI_WAP_MMS_NO_REJECT_NOTIFICATION_BY_SIZE__ */ 
        if (info->header_info->download_size >
            (wap_custom_get_max_mms_msg_size() + wap_custom_get_mms_delta_retrival_size()))
        {
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_ID_UMMS_OPTIONS_MSG_SIZE_EXCEED),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            mmi_umms_app_sh_delete_umms_screens();
            return;
        }

    #endif /* __MMI_WAP_MMS_NO_REJECT_NOTIFICATION_BY_SIZE__ */ 
    #endif /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ /* __MMI_WAP_MMS_NO_REJECT_NOTIFICATION_BY_SIZE__ */
    #ifdef __MMI_OP01_202_DEFFERED_DOWNLOAD_AT_FULL_IND__
        phone_size_available = mma_get_mms_avaliable_file_space(NULL, MMA_MSG_STORAGE_PHONE);

    #if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 
        result = mmi_umms_app_ui_plug_in_check_downloading_with_memory_card_support();
        if (result == MMI_FALSE)
        {
            return;
        }
    #else /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
        if (phone_size_available < info->header_info->download_size)
        {

            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_GLOBAL_NOT_ENOUGH_MEMORY),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            mmi_umms_app_sh_delete_umms_screens();
            return;
        }
    #endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
    #else /* __MMI_OP01_202_DEFFERED_DOWNLOAD_AT_FULL_IND__ */ 
    #if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 
        result = mmi_umms_app_ui_plug_in_check_downloading_with_memory_card_support();
        if (result == MMI_FALSE)
        {
            return;
        }
    #endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
    #endif /* __MMI_OP01_202_DEFFERED_DOWNLOAD_AT_FULL_IND__ */ 

    }

    time =
        (info->msg_info->expiry_date - info->header_info->date) - (current_secs_since_1970 - info->header_info->date);
#ifndef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    mmi_umms_app_ui_plug_in_download_req(info->msg_id, time, info->msg_info->msg_size);
#else 
    mmi_umms_app_ui_plug_in_download_req(info->msg_id, time, info->msg_info->user_element_size);
#endif 

#ifdef __MMI_MMS_ROAMING_NO_ACCEPT_SUPPORT__
    srv_mms_delete_single_msg_from_notify_list(info->msg_id);
#endif 

}

#if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_downloading_with_memory_card_support
 * DESCRIPTION
 *  mmi_umms_app_ui_plug_in_check_downloading_with_memory_card_support
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_umms_app_ui_plug_in_check_downloading_with_memory_card_support()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
	srv_mms_card_usage_enum result = srv_mms_check_memory_usage(info->header_info->download_size);
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(result)
    {
#ifndef __MMI_MMS_ONLY_MEMORY_CARD_STORAGE_SUPPORT__
	case SRV_MMS_CARD_NOT_PRESENT_USE_PHONE:
        {
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_CARD_NOT_PRESENT_USE_PHONE),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_plug_in_download_in_other_memory,
                mmi_umms_app_ui_plug_in_download_cancel_by_pressing_no,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
            return MMI_FALSE;
        }
	case SRV_MMS_CARD_PHONE_FULL_USE_CARD_MEM:
    {
        mmi_umms_app_dtmgr_set_confirm_screen_para(
            STR_GLOBAL_YES,
            IMG_GLOBAL_YES,
            STR_GLOBAL_NO,
            IMG_GLOBAL_NO,
            (U16*) GetString(STR_ID_UMMS_PHONE_FULL_USE_CARD_MEM),
            MMI_EVENT_QUERY,
            MMI_FALSE,
            MMI_TRUE,
            mmi_umms_app_plug_in_download_in_other_memory,
            mmi_umms_app_ui_plug_in_download_cancel_by_pressing_no,
            NULL,
            NULL);
        mmi_umms_app_if_show_display_confirm_screen();
        return MMI_FALSE;
    }
	case SRV_MMS_CARD_FULL_USE_PHONE_MEM:
    {
        mmi_umms_app_dtmgr_set_confirm_screen_para(
            STR_GLOBAL_YES,
            IMG_GLOBAL_YES,
            STR_GLOBAL_NO,
            IMG_GLOBAL_NO,
            (U16*) GetString(STR_ID_UMMS_CARD_FULL_USE_PHONE_MEM),
            MMI_EVENT_QUERY,
            MMI_FALSE,
            MMI_TRUE,
            mmi_umms_app_plug_in_download_in_other_memory,
            mmi_umms_app_ui_plug_in_download_cancel_by_pressing_no,
            NULL,
            NULL);
        mmi_umms_app_if_show_display_confirm_screen();
        return MMI_FALSE;
    }
#endif
	case SRV_MMS_CARD_NOT_ENOUGH_MEMORY:
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_NOT_ENOUGH_MEMORY), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        return MMI_FALSE;
    }
	}
    return MMI_TRUE;
}
#endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_download_cancel_by_pressing_no
 * DESCRIPTION
 *  Entry Function for Download After MMS Size Check.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_download_cancel_by_pressing_no(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_is_present
        (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_NOTIFICATION_OPTION, MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
    {
        mmi_frm_scrn_close_active_id();
    }
    else
    {
        mmi_umms_app_dtmgr_reset_data();
        mmi_frm_scrn_close_active_id();
    }

}

#ifdef __MMI_WAP_MMS_NO_REJECT_NOTIFICATION_BY_SIZE__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_download_continue
 * DESCRIPTION
 *  Entry Function for Download After MMS Size Check.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_download_continue(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 current_secs_since_1970 = 0;
    U64 size_available = 0;
    U32 used_bytes = 0;
    U8 prefer_storage = 0;
    U32 time = 0;
    MMI_BOOL result = MMI_TRUE;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    current_secs_since_1970 = srv_mms_get_current_utc_time();
    prefer_storage = srv_mms_get_mms_prefer_storage();  /* mma enum not umms enum"carefully use" */
    size_available = mma_get_mms_avaliable_file_space(NULL, prefer_storage);
#if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) 
    result = mmi_umms_app_ui_plug_in_check_downloading_with_memory_card_support();
    if (result == MMI_FALSE)
    {
        return;
    }
#else /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
    if (size_available < info->header_info->download_size)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_NOT_ENOUGH_MEMORY), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        return;
    }
#endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 
    time =
        (info->msg_info->expiry_date ) - (current_secs_since_1970);
    mmi_umms_app_ui_plug_in_download_req(info->msg_id, time, info->msg_info->msg_size);
}
#endif /* __MMI_WAP_MMS_NO_REJECT_NOTIFICATION_BY_SIZE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_download_req
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg_id          [IN]        
 *  time            [IN]        
 *  msg_size        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_download_req(const U32 msg_id, U32 time, U32 msg_size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 sim_id = 0;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    MMI_UMMS_ERROR ret_val = MMI_UMMS_FALSE;
    mmi_um_iter_viewer_result_struct other_msg_data;
    U8 folder_id;
    void *um_data = NULL;
    mmi_id parent_id;
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    sim_id = info->msg_info->msg_sim_id;
#if(MMI_MAX_SIM_NUM >= 2)
    if (MMI_TRUE == srv_mms_is_sim_valid((mmi_sim_enum)sim_id))
#endif 
    {
        srv_mms_download_req_struct req;

 
        memset(&req, 0, sizeof(srv_mms_download_req_struct));

        req.sim_id = sim_id;
        req.msg_id = msg_id;
        req.storage_type = info->msg_info->msg_storage;
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
        parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
        mmi_umms_app_ui_draw_dummy_screen();
        mmi_umms_app_sh_delete_umms_screens();
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        srv_mms_download(&req);
    #ifdef __MMI_MMS_ITERATOR_VIEWER__
        if (ret_val == MMI_UMMS_TRUE)
        {
            mmi_umms_app_dtmgr_handle_action_on_curr_msg(other_msg_data, folder_id, um_data, parent_id);
        }
    #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    }
#if(MMI_MAX_SIM_NUM >= 2)
    else
    {
        srv_mms_dual_sim_set_download_msg_id((U32) msg_id);
        /* mmi_umms_dual_sim_set_download_size((U8) msg_size);
           mmi_umms_set_download_time((U32) time); */

    #if(MMI_MAX_SIM_NUM == 2)
        if (MMI_SIM2 == sim_id)
        {
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_DOWNLOAD_FROM_SIM1),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_ui_plug_in_download_using_other_sim,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
        }
        else
        {

            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_DOWNLOAD_FROM_SIM2),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_ui_plug_in_download_using_other_sim,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);

        }

    #endif /* (MMI_MAX_SIM_NUM == 2) */ 
    #if(MMI_MAX_SIM_NUM >=3)
        mmi_umms_app_dtmgr_set_confirm_screen_para(
            STR_GLOBAL_YES,
            IMG_GLOBAL_YES,
            STR_GLOBAL_NO,
            IMG_GLOBAL_NO,
            (U16*) GetString(STR_ID_UMMS_DOWNLOAD_FROM_ANOTHER_SIM),
            MMI_EVENT_QUERY,
            MMI_FALSE,
            MMI_TRUE,
            mmi_umms_app_ui_plug_in_download_using_other_sim,
            mmi_frm_scrn_close_active_id,
            NULL,
            NULL);

    #endif /* (MMI_MAX_SIM_NUM >=3) */ 
        mmi_umms_app_if_show_display_confirm_screen();
    }
#endif /* (MMI_MAX_SIM_NUM >= 2) */ /* __MMI_MMS_DUAL_SIM__ */
}

#if(MMI_MAX_SIM_NUM >= 2)


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_download_using_other_sim
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_download_using_other_sim(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
#if(MMI_MAX_SIM_NUM >= 3)
    mmi_umms_action_type msg_action;
    MMI_ID sim_sel_cui_id;
    MMI_ID sim_sel_parent_id;
    mmi_umms_action_type_struct *data =
        (mmi_umms_action_type_struct*) srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_action_type_struct));
#endif /* (MMI_MAX_SIM_NUM >= 3) */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if(MMI_MAX_SIM_NUM == 2)

    if (MMI_SIM2 == info->msg_info->msg_sim_id)
    {
        mmi_umms_app_ui_plug_in_download_with_sim_id(MMI_SIM1);
    }
    else
    {
        mmi_umms_app_ui_plug_in_download_with_sim_id(MMI_SIM2);
    }
#endif /* (MMI_MAX_SIM_NUM == 2) */ /* MMI_MAX_SIM_NUM == 2 */

#if(MMI_MAX_SIM_NUM >= 3)
    if (srv_mms_num_valid_sim() > 1)
    {
#ifdef __MMI_DYNAMIC_SIM_DYNAMIC_UI__
        sim_sel_cui_id = cui_menu_create(
                        mmi_umms_dtmgr_get_group_id(),
                        CUI_MENU_SRC_TYPE_RESOURCE,
                        CUI_MENU_TYPE_APPSUB,   /* Option menu */
                        MENU_ID_UMMS_SIM_SEL_DOWNLOAD,           /* parent menu */
                        MMI_TRUE,
                        NULL);

        mmi_umms_app_dtmgr_set_sim_sel_cui_id(sim_sel_cui_id);

        cui_menu_run(sim_sel_cui_id);
#else
        MMI_ASSERT(data);
        /* LAUNCH SIM SELECTOR CUI */

        sim_sel_parent_id = mmi_frm_group_create_ex(
                                mmi_umms_app_dtmgr_get_parent_grp_id(),
                                GRP_ID_AUTO_GEN,
                                mmi_umms_app_ui_callback_sim_sel_post_action_decide,
                                NULL,
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
        data->msg_action = UMMS_ACTION_DOWNLOAD;
        sim_sel_cui_id = cui_sim_sel_create(sim_sel_parent_id, srv_mms_get_sim_valid_flag(), (void*)data);
        if (sim_sel_cui_id != GRP_ID_INVALID)
        {
            mmi_umms_app_dtmgr_set_sim_sel_cui_id(sim_sel_cui_id);
            cui_sim_sel_set_highlight_sim(info->msg_info->msg_sim_id);
            cui_sim_sel_run(sim_sel_cui_id);
        }
#endif
    }
    else
    {
        mmi_umms_app_ui_plug_in_download_with_sim_id(srv_mms_get_sim_valid_flag());
    }
#endif /* (MMI_MAX_SIM_NUM >= 3) */ /* (MMI_MAX_SIM_NUM >= 3) */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_download_with_sim_id
 * DESCRIPTION
 *  
 * PARAMETERS
 *  sim_id      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_download_with_sim_id(mmi_sim_enum sim_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/


    srv_mms_download_req_struct req;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
#ifdef __MMI_MMS_ITERATOR_VIEWER__
    MMI_UMMS_ERROR ret_val = MMI_UMMS_FALSE;
    mmi_um_iter_viewer_result_struct other_msg_data;
    U8 folder_id;
    void *um_data = NULL;
    mmi_id parent_id;
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/


    memset(&req, 0, sizeof(srv_mms_download_req_struct));
    req.sim_id = sim_id;
    req.msg_id = srv_mms_dual_sim_get_download_msg_id();

    req.storage_type = info->msg_info->msg_storage;
#ifdef __MMI_MMS_ITERATOR_VIEWER__
    ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
    parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    mmi_umms_app_ui_draw_dummy_screen();
    mmi_umms_app_sh_delete_umms_screens();
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    srv_mms_download(&req);

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    if (ret_val == MMI_UMMS_TRUE)
    {
        mmi_umms_app_dtmgr_handle_action_on_curr_msg(other_msg_data, folder_id, um_data, parent_id);
    }
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

}
#endif /* (MMI_MAX_SIM_NUM >= 2) */ /* MMI_MAX_SIM_NUM >= 2 */


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_pre_entry_send_msg
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_pre_entry_send_msg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    // #ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__

#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
    S8 tmp_str[10] = {0, };
#endif 
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    // #endif /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PRE_ENTRY_SEND_REQ, info->msg_id);
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)

    {
        U32 max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (info->msg_info->user_element_size > max_msg_size)
        {

            mmi_umms_app_plug_in_wap_connection_error_popup(
                info->msg_info->user_element_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            return;
        }
    }
#elif defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)

    {
        U32 max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (info->msg_info->msg_size > max_msg_size)
        {
            mmi_umms_app_plug_in_wap_connection_error_popup(
                info->msg_info->msg_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            return;
        }
    }
#endif 
#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    if (info->msg_info->user_element_size > (U32) srv_mms_sending_mms_size_limit())
    {
        U32 max_msg_size = (U32) srv_mms_sending_mms_size_limit() / 1024;
        memset(subMenuData, 0, sizeof(subMenuData));
        /* MMS exceeds send limit XX KB  */
        mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_MMS_SEND_EXCEED_SIZE_LIMIT));
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        gui_itoa(max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
        mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));

        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        return;
    }
#else /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ 
    if (info->msg_info->msg_size > (U32) srv_mms_sending_mms_size_limit())
    {
        U32 max_msg_size = (U32) srv_mms_sending_mms_size_limit() / 1024;
        memset(subMenuData, 0, sizeof(subMenuData));
        /* MMS exceeds send limit XX KB  */
        mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_MMS_SEND_EXCEED_SIZE_LIMIT));
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        gui_itoa(max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
        mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));

        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        return;
    }

#endif /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ 
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 
    if ((info->folder_id == MMA_FOLDER_DRAFT) ||
        ((info->folder_id == MMA_FOLDER_ARCHIVE) && (info->msg_info->prev_folder == MMA_FOLDER_DRAFT)))
    {
        if (info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)
        {
            mma_creation_mode_enum creation_mode;

            creation_mode = srv_mms_compose_settings_creation_mode();
            if (creation_mode == MMA_CREATION_MODE_WARNING)
            {
                mmi_umms_app_plug_in_setting_show_content_mode_confrm_pop_up(
                    STR_ID_UMMS_MODE_WARNING_CONFIRM,
                    mmi_umms_app_plug_in_entry_send_msg_from_box_ext,
                    NULL);

            }
            else
            {
                mmi_umms_app_plug_in_entry_send_msg_from_box(info->msg_id);
            }
        }
        else
        {
            mmi_umms_app_plug_in_entry_send_msg_from_box(info->msg_id);
        }
    }
    else
    {
        mmi_umms_app_plug_in_entry_send_msg_from_box(info->msg_id);
    }
}

#ifdef __MMI_FTE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_reply_for_folder_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_reply_for_folder_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    

    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();
	mma_result_enum result_mma = MMA_RESULT_OK;
	#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
	mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = sync_info->msg_id;
    uc_start.uc_mode = MMA_MODE_REPLY;
    uc_start.sim_id = sync_info->msg_info.msg_sim_id;
#ifdef __MMI_MMS_POSTCARD__
    if (msg_sim_id->msg_info.msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 
    uc_start.storage_type = sync_info->msg_info.msg_storage;
    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    srv_mms_reset_sync_data();
	#else
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    result_mma = srv_mms_container_set_message_id(sync_info->msg_id);
	if(result_mma == MMA_RESULT_OK)
	{
     mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_REPLY);
	}
	else
	{
	 mmi_umms_app_if_show_error_pop_up(result_mma);
	}
    srv_mms_reset_sync_data();

	#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_delete_confirm_func_for_folder_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_delete_confirm_func_for_folder_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 message;
    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (srv_mms_bgsr_is_rr_pending(sync_info->msg_id) && (sync_info->msg_info.folder != MMA_FOLDER_OUTBOX))
    {
        message = STR_ID_CONFM_DELETE_READ_REPORT_MMS;
    }
    else
    {
        message = STR_ID_UMMS_DELETE_CONRM;
    }
    mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) GetString(message),
        MMI_EVENT_QUERY,
        MMI_FALSE,
        MMI_FALSE,
        mmi_umms_app_sh_mms_delete_lsk_handler_for_msg_list,    /* mmi_umms_entry_cancel_dwnld, */
        mmi_frm_scrn_close_active_id,
        NULL,
        NULL);
    return MMI_UMMS_TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_pre_entry_send_msg_from_folder_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_pre_entry_send_msg_from_folder_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
    S8 tmp_str[10] = {0, };
#endif 

    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PRE_ENTRY_SEND_REQ, g_current_mms_info_list->current_msg_id); */
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)


    {
        U32 max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (sync_info->msg_info.user_elements_size > max_msg_size)
        {

            mmi_umms_app_plug_in_wap_connection_error_popup(
                sync_info->msg_info.user_elements_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            srv_mms_reset_sync_data();
            return;
        }
    }
#elif defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)
 
    {
        U32 max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (sync_info->msg_info.msg_size > max_msg_size)
        {
            mmi_umms_app_plug_in_wap_connection_error_popup(
                sync_info->msg_info.msg_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            srv_mms_reset_sync_data();
            return;
        }
    }
#endif 
#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    if (sync_info->msg_info.user_elements_size > (U32) srv_mms_sending_mms_size_limit())
    {
        U32 max_msg_size = (U32) srv_mms_sending_mms_size_limit() / 1024;
        memset(subMenuData, 0, sizeof(subMenuData));
        /* MMS exceeds send limit XX KB  */
        mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_MMS_SEND_EXCEED_SIZE_LIMIT));
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        gui_itoa(max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
        mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));

        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        srv_mms_reset_sync_data();
        return;
    }
#else /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ 
    if (sync_info->msg_info.msg_size > (U32) srv_mms_sending_mms_size_limit())
    {
        U32 max_msg_size = (U32) srv_mms_sending_mms_size_limit() / 1024;
        memset(subMenuData, 0, sizeof(subMenuData));
        /* MMS exceeds send limit XX KB  */
        mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_MMS_SEND_EXCEED_SIZE_LIMIT));
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        gui_itoa(max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
        mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));

        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        srv_mms_reset_sync_data();
        return;
    }

#endif /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ 
#endif /* __MMI_OP12_MMS_MAX_SIZE_SUPPORT__ */ 

    mmi_umms_app_ui_plug_in_resend_msg_from_msg_list();

}
#endif /* __MMI_FTE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_entry_edit_fwd_mode
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_entry_edit_fwd_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = info->msg_id;
    uc_start.uc_mode = info->uc_mode;
    uc_start.sim_id = MMI_SIM1;
    uc_start.storage_type = info->msg_info->msg_storage;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 

    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(info->folder_id);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_entry_send_msg_from_box
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg_id      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_entry_send_msg_from_box(const U32 msg_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_ENTRY_SEND_MSG_FROM_BOX, msg_id);
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_app_ui_draw_dummy_screen();
#endif
    if ((info->folder_id == MMA_FOLDER_DRAFT) ||
        ((info->folder_id == MMA_FOLDER_ARCHIVE) && (info->msg_info->prev_folder == MMA_FOLDER_DRAFT)))
    {

        memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
        uc_start.msg_id = info->msg_id;
        uc_start.uc_mode = MMA_MODE_SEND;
        uc_start.sim_id = MMI_SIM1;
        uc_start.storage_type = info->msg_info->msg_storage;
    #ifdef __MMI_MMS_POSTCARD__
        if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
        {
            uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
        }
    #endif /* __MMI_MMS_POSTCARD__ */ 
        mmi_umms_start_uc(&uc_start);
        mmi_umms_app_sh_delete_option_screen(info->folder_id);
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    }
    else
    {

        mmi_umms_app_plug_in_send_mms_msg(msg_id);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_entry_send_msg_from_box_ext
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_entry_send_msg_from_box_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_plug_in_entry_send_msg_from_box(info->msg_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_send_mms_msg
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg_id      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_send_mms_msg(const U32 msg_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 is_send_and_save = 0;

    srv_mms_send_req_struct req;
    mmi_umms_app_dtmgr_option_scr_data_struct *info;
    U8 sim_selection_screen = 0;

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    MMI_UMMS_ERROR ret_val = MMI_UMMS_FALSE;
    mmi_um_iter_viewer_result_struct other_msg_data;
    U8 folder_id;
    void *um_data = NULL;
    mmi_id parent_id;
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&req, 0, sizeof(srv_mms_send_req_struct));
    info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    is_send_and_save = srv_mms_sending_settings_send_and_save();
#if(MMI_MAX_SIM_NUM >= 2)
    if (srv_mms_num_valid_sim() == 1)
    {
        sim_selection_screen = srv_mms_get_sim_valid_flag();
    }
    else
    {
        sim_selection_screen = srv_mms_get_selected_sim_id();
    }
#else /* (MMI_MAX_SIM_NUM >= 2) */ /* ( defined (__MMI_MMS_DUAL_SIM__) || defined (__GEMINI__) || (GEMINI_PLUS > 2)) */
    sim_selection_screen = MMI_SIM1;
#endif /* (MMI_MAX_SIM_NUM >= 2) */ /* ( defined (__MMI_MMS_DUAL_SIM__) || defined (__GEMINI__) || (GEMINI_PLUS > 2)) */
    if (is_send_and_save > 0)
    {
        if (MMI_TRUE == srv_mms_is_sim_valid((mmi_sim_enum)sim_selection_screen))
        {
            req.sim_id = sim_selection_screen;
            req.send_setting = SRV_MMS_SETTING_SAVE_AND_SEND;   /* SRV_MMS_SETTING_SAVE_AND_SEND; */
            req.msg_id = msg_id;
            req.is_rr = MMI_FALSE;
            req.storage_type = info->msg_info->msg_storage;
        #ifdef __MMI_MMS_ITERATOR_VIEWER__
            ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
            parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();
        #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
            mmi_umms_app_sh_delete_umms_screens();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            srv_mms_send(&req);
        }
    }
    else
    {
        if (MMI_TRUE == srv_mms_is_sim_valid((mmi_sim_enum)sim_selection_screen))
        {
            req.sim_id = sim_selection_screen;
            req.send_setting = SRV_MMS_SETTING_SEND_ONLY;   /* SRV_MMS_SETTING_SAVE_AND_SEND; */
            req.msg_id = msg_id;
            req.is_rr = MMI_FALSE;
            req.storage_type = info->msg_info->msg_storage;
        #ifdef __MMI_MMS_ITERATOR_VIEWER__
            ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
            parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();
        #endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
            mmi_umms_app_sh_delete_umms_screens();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            srv_mms_send(&req);
        }
    }

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    if (ret_val == MMI_UMMS_TRUE)
    {
        mmi_umms_app_dtmgr_handle_action_on_curr_msg(other_msg_data, folder_id, um_data, parent_id);
    }
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_entry_cancel_send
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_entry_cancel_send(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    srv_mms_cancel_send_req_struct req;

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    MMI_UMMS_ERROR ret_val = MMI_UMMS_FALSE;
    mmi_um_iter_viewer_result_struct other_msg_data;
    U8 folder_id;
    void *um_data = NULL;
    mmi_id parent_id;
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_ENTRY_CANCEL_SEND_REQ);

    req.msg_id = info->msg_id;
#ifdef __MMI_MMS_ITERATOR_VIEWER__
    ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
    parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    mmi_umms_app_sh_delete_umms_screens();
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    if (ret_val == MMI_UMMS_TRUE)
    {
        mmi_umms_app_dtmgr_handle_action_on_curr_msg(other_msg_data, folder_id, um_data, parent_id);
    }
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    srv_mms_cancel_send(&req);

}

#ifdef __MMI_PHB_SAVE_CONTACT_NOTIFY__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_add_contact_phonebook_notify
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_add_contact_phonebook_notify(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_set_data_for_phb_notify();
    mmi_umms_app_ui_plug_in_add_to_phb_list_and_deinit_umms();
    mmi_umms_app_dtmgr_reset_data_for_phb_notify();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_viewer_back_key_pressed
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 *  show_error(?)       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_viewer_back_key_pressed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_phb_notify_struct *app_phb_data = mmi_umms_app_dtmgr_get_data_for_phb_notify();

#if defined(__MMI_OP11_HOMESCREEN__) || defined(__MMI_VUI_HOMESCREEN__)
    mmi_umms_op_op11_struct *op_data;
#endif 
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__)
    mmi_umms_op_op11_hs32_struct *hs32_op_data;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_OP11_HOMESCREEN__) || defined(__MMI_VUI_HOMESCREEN__)
    op_data = mmi_umms_op_get_op11_data();
    /* if ((app_phb_data->is_hs_recent_event_active == MMI_TRUE) || (app_phb_data->is_hs_active == MMI_TRUE)) */
    if (srv_mms_get_hs_active() == MMI_TRUE || srv_mms_get_hs_event() == MMI_TRUE)
    {
        mmi_umms_app_ui_plug_in_check_phb_interface_for_num_add();
    }
    else
#endif /* defined(__MMI_OP11_HOMESCREEN__) || defined(__MMI_VUI_HOMESCREEN__) */ 
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__)
        hs32_op_data = mmi_umms_op_get_op11_hs32_data();
    /* if ((app_phb_data->is_hs_recent_event_active == MMI_TRUE) || (app_phb_data->is_hs_active == MMI_TRUE)) */
    if (hs32_op_data->hs_active == MMI_TRUE)
    {
        mmi_umms_app_ui_plug_in_check_phb_interface_for_num_add();
    }
    else
#endif /* defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) */ 
    {
        if (app_phb_data->current_selected_folde_type == MMA_FOLDER_INBOX ||
            (app_phb_data->current_selected_folde_type == MMA_FOLDER_ARCHIVE))

        {
            mmi_umms_app_ui_plug_in_check_phb_interface_for_num_add();
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_add_to_phb_list_and_deinit_umms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_add_to_phb_list_and_deinit_umms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_phb_notify_struct *app_phb_data = mmi_umms_app_dtmgr_get_data_for_phb_notify();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_reset_data();
    mmi_umms_app_if_deinit_viewer();
    mmi_frm_scrn_close_active_id();
    mmi_umms_app_ui_plug_in_viewer_back_key_pressed();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_phb_interface_for_num_add
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 *  show_error(?)       [IN](?)
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_check_phb_interface_for_num_add(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 str_sub_cmp_temp[MMA_MAX_ADDR_LEN] = {0x00, };
    mmi_umms_app_dtmgr_phb_notify_struct *app_phb_data = mmi_umms_app_dtmgr_get_data_for_phb_notify();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_ucs2ncmp((S8*) app_phb_data->current_selected_sender_address, (S8*) str_sub_cmp_temp, MMA_MAX_ADDR_LEN))
    {
        if ((app_phb_data->current_selected_sender_address != NULL) &&
            (app_phb_data->current_selected_sender_address_type == MMA_ADDR_TYPE_PHONE_NUMBER) &&
            (mmi_phb_is_save_contact_notify_on()))
        {
            if (!mmi_phb_is_num_in_phb((U16*) app_phb_data->current_selected_sender_address))
            {
                srv_phb_contact_data_struct phbData;

                mmi_phb_unsaved_data_init(&phbData);

                phbData.number = app_phb_data->current_selected_sender_address;

                mmi_phb_add_data_to_unsaved_list(PHB_STORAGE_MAX, SRV_PHB_ENTRY_FIELD_NUMBER, &phbData);
                if (mmi_phb_get_unsaved_data_num() > 0)
                {
                    mmi_phb_pre_entry_unsaved_data_confirm();
                }
            }

        }
    }
    mmi_umms_app_dtmgr_reset_data_for_phb_notify();
}
#endif /* __MMI_PHB_SAVE_CONTACT_NOTIFY__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_setting_show_content_mode_confrm_pop_up
 * DESCRIPTION
 *  
 * PARAMETERS
 *  str_id              [IN]        
 *  lsk_function        [IN]        
 *  rsk_function        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_setting_show_content_mode_confrm_pop_up(
        U16 str_id,
        void (*lsk_function) (void),
        void (*rsk_function) (void))
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    void (*rsk_handler) (void) = NULL;
    MMI_BOOL show_csk = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (lsk_function == NULL)
    {
        MMI_ASSERT(0);
    }
    if (str_id != STR_ID_UMMS_MODE_WARNING_CONFIRM)
    {
        show_csk = MMI_FALSE;
    }

    if (rsk_function == NULL)
    {
        rsk_handler = mmi_frm_scrn_close_active_id;

    }

    mmi_umms_app_dtmgr_set_confirm_screen_para(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (U16*) GetString(str_id),
        MMI_EVENT_QUERY,
        MMI_FALSE,
        show_csk,
        lsk_function,
        rsk_handler,
        NULL,
        NULL);
    mmi_umms_app_if_show_display_confirm_screen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_wap_connection_error_popup
 * DESCRIPTION
 *  
 * PARAMETERS
 *  element_size        [IN]        
 *  max_msg_size        [IN]        
 *  str_id              [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_wap_connection_error_popup(U32 element_size, U32 max_msg_size, U16 str_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 tmp_str[UMMS_CONVERT_INDEX] = {0, };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    max_msg_size = max_msg_size / 1024;
    memset(subMenuData, 0, sizeof(subMenuData));
    gui_itoa(max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
    mmi_ucs2cpy((S8*) subMenuData, (S8*) tmp_str);
    mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
    mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));
    mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(str_id));
    mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_PROPLEM);
    mmi_umms_app_if_show_display_popup_screen();
    return;
}

#ifndef __MMI_SLIM_MMS_2__
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_set_lock_mode_req
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_set_lock_mode_req(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    U8 lock_mode;
    U8 error = 0;
    U8 srv_result = 0;

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    MMI_UMMS_ERROR ret_val = MMI_UMMS_FALSE;
    mmi_um_iter_viewer_result_struct other_msg_data;
    U8 folder_id;
    void *um_data = NULL;
    mmi_id parent_id;
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (MMI_UMMS_LOCK_MODE_OFF == info->msg_info->is_lock_mode)
    {
        lock_mode = MMI_UMMS_LOCK_MODE_ON;
    }
    else if (MMI_UMMS_LOCK_MODE_ON == info->msg_info->is_lock_mode)
    {
        lock_mode = MMI_UMMS_LOCK_MODE_OFF;
    }
    else
    {
        MMI_ASSERT(0);
        return;
    }

    srv_result = srv_mms_set_lock_status(info->msg_id, lock_mode, 0, &error);

    if (srv_result != SRV_MMS_RESULT_OK)
    {
        mmi_umms_app_if_show_error_pop_up(MMA_RESULT_FAIL);
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        return;
    }

    if (MMA_RESULT_OK == error)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_DONE), MMI_EVENT_SUCCESS);
        mmi_umms_app_if_show_display_popup_screen();

    }
    else
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_ERROR), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
    }

#ifdef __MMI_MMS_ITERATOR_VIEWER__
    ret_val = mmi_umms_app_core_prepare_data_before_deinit(&other_msg_data, &folder_id, &um_data);
    parent_id = mmi_umms_app_dtmgr_get_parent_grp_id();
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
#ifdef __MMI_MMS_ITERATOR_VIEWER__
    if (ret_val == MMI_UMMS_TRUE)
    {
        mmi_umms_app_dtmgr_handle_action_on_curr_msg(other_msg_data, folder_id, um_data, parent_id);
    }
#endif /* __MMI_MMS_ITERATOR_VIEWER__ */ 
    return;
}

#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_to_contacts
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_save_to_contacts(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 temp[(MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH];
    U16 phb_cui_id_value = 0;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(temp, 0, (MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH);
    /* mmi_umms_app_ui_draw_dummy_screen(); */

    if (info->msg_info->from_address_type == MMA_ADDR_TYPE_PHONE_NUMBER)
    {
        if (applib_is_valid_number_unicode((kal_wchar*) info->msg_info->from_address))
        {
            /* mmi_frm_group_entry_ex(GRP_ID_ROOT, APP_UMMS_MMS, mmi_umms_save_contacts_proc, NULL, NULL); */
            mmi_frm_group_create_ex(
                mmi_umms_app_dtmgr_get_parent_grp_id(),
                APP_UMMS_MMS,
                mmi_umms_save_contacts_proc,
                NULL,
                MMI_FRM_NODE_SMART_CLOSE_FLAG);
            phb_cui_id_value = cui_phb_save_contact_create(APP_UMMS_MMS);
            if (phb_cui_id_value != GRP_ID_INVALID)
            {
                mmi_umms_app_dtmgr_set_phone_book_cui_id(phb_cui_id_value);
                cui_phb_save_contact_set_number(phb_cui_id_value, (U16*) info->msg_info->from_address);
                cui_phb_save_contact_run(phb_cui_id_value);
            }
        }
        else
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_INVALID_NUMBER), MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
        }
    }
#ifdef __MMI_PHB_OPTIONAL_FIELD__
    else if (info->msg_info->from_address_type == MMA_ADDR_TYPE_EMAIL)
    {
        /* mmi_frm_group_entry_ex(GRP_ID_ROOT, APP_UMMS_MMS, mmi_umms_save_contacts_proc, NULL, NULL); */
        mmi_frm_group_create_ex(
            mmi_umms_app_dtmgr_get_parent_grp_id(),
            APP_UMMS_MMS,
            mmi_umms_save_contacts_proc,
            NULL,
            MMI_FRM_NODE_SMART_CLOSE_FLAG);
        phb_cui_id_value = cui_phb_save_contact_create(APP_UMMS_MMS);
        if (phb_cui_id_value != GRP_ID_INVALID)
        {
            mmi_umms_app_dtmgr_set_phone_book_cui_id(phb_cui_id_value);
            cui_phb_save_contact_set_email(phb_cui_id_value, (U16*) info->msg_info->from_address);
            cui_phb_save_contact_run(phb_cui_id_value);
        }
    }
#endif /* __MMI_PHB_OPTIONAL_FIELD__ */ 
    if (mmi_frm_scrn_is_present
        (mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_MMS_VIEWER, MMI_FRM_NODE_EXCLUDE_ACTIVE_SCRN_FLAG))
    {
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_MMS_OPTION);
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_NOTIFICATION_OPTION);
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_INBOX_DELIVERY_READ_OPTION);
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_JAVA_OPTIONS);
    }
    else
    {
        /* mmi_frm_group_close(mmi_umms_dtmgr_get_group_id()); */
        mmi_umms_app_sh_delete_umms_screens();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_save_contacts_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  evt     [?]     
 * RETURNS
 *  
 *****************************************************************************/
mmi_ret mmi_umms_save_contacts_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 curr_phb_cui_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    curr_phb_cui_id = mmi_umms_app_dtmgr_get_phone_book_cui_id();

    switch (evt->evt_id)
    {
        case EVT_ID_PHB_SAVE_CONTACT:
        case EVT_ID_PHB_SAVE_CONTACT_CANCEL:
            cui_phb_save_contact_close(curr_phb_cui_id);
            mmi_umms_app_dtmgr_set_phone_book_cui_id(GRP_ID_INVALID);
            break;

        default:
            break;
    }

    return MMI_RET_OK;
}

#ifdef __MMI_MMS_TEMPLATE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_as_template
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msgId       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_save_as_template(U32 msgId)
{
        /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    U8 msg_file_path[(MMA_MAX_INTERNAL_FILENAME_LENGTH + 1) * ENCODING_LENGTH];
    PS8 file_name;
    S32 result;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (srv_mms_is_usb_mode())
    {
    #ifdef __USB_IN_NORMAL_MODE__
        mmi_usb_app_unavailable_popup(0);
    #endif 
        mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
        return;
    }
    result = mmi_umms_app_dtmgr_init_template_folder(MMI_FALSE);
    if (result != FS_NO_ERROR)
    {
        return;
    }
    info->msg_path = (U8*) srv_mms_mem_mgr_app_adm_alloc((MMA_MAX_INTERNAL_FILENAME_LENGTH + 1) * ENCODING_LENGTH);
    info->file_path = (U8*) srv_mms_mem_mgr_app_adm_alloc((MMA_MAX_INTERNAL_FILENAME_LENGTH + 1) * ENCODING_LENGTH);
    MMI_ASSERT(info->msg_path != NULL);
    MMI_ASSERT(info->file_path);
    memset(info->msg_path, 0, (MMA_MAX_INTERNAL_FILENAME_LENGTH + 1) * ENCODING_LENGTH);
    memset(info->file_path, 0, (MMA_MAX_INTERNAL_FILENAME_LENGTH + 1) * ENCODING_LENGTH);
    mma_get_home_directory((kal_wchar*) info->msg_path, MMA_MAX_INTERNAL_FILENAME_LENGTH, info->msg_info->msg_storage);
    mma_get_msg_file_name(msgId, (kal_wchar*) msg_file_path, MMA_MAX_INTERNAL_FILENAME_LENGTH);
    mmi_ucs2cat((S8*) info->msg_path, (S8*) "\\");
    mmi_ucs2cat((S8*) info->msg_path, (S8*) msg_file_path);

    MMI_UMMS_MAKE_TEMPLATE_FOLDER_PATH(info->file_path);
    mmi_ucs2cat((S8*) info->file_path, (S8*) "\\");
    file_name = (S8*) srv_fmgr_path_get_filename_ptr((WCHAR*) msg_file_path);
    if (file_name)
    {
        mmi_ucs2cat((S8*) info->file_path, (S8*) file_name);
    }
    else
    {
        mmi_ucs2cat((S8*) info->file_path, (S8*) msg_file_path);
    }
    srv_fmgr_async_copy(
        (WCHAR*) info->msg_path,
        (WCHAR*) info->file_path,
        0,
        mmi_umms_app_core_save_template_file_callback_proc,
        NULL);

}

#ifdef __MMI_MMS_TEMPLATE_SUPPORT__

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_core_save_template_file_callback_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg     [?]     
 * RETURNS
 *  
 *****************************************************************************/
mmi_ret mmi_umms_app_core_save_template_file_callback_proc(mmi_event_struct *msg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_fmgr_async_done_event_struct *async_evt;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (msg->evt_id)
    {
        case EVT_ID_SRV_FMGR_ASYNC_DONE:

            async_evt = (srv_fmgr_async_done_event_struct*) msg;
            /* ASSERT(async_evt->job_id == ctxt_a->job_id); */
            mmi_umms_app_core_save_template_file_callback(async_evt->result);
            /* ctxt_a->job_id = 0; */
            break;
    }
    return MMI_RET_OK;
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_handle_mms_template_option
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_handle_mms_template_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 msg_id;
    MMI_BOOL flag = 0;
    U16 box_type = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    flag = mmi_umms_app_dtmgr_get_current_template_type();
    msg_id = mmi_umms_app_dtmgr_get_current_hilighted_msg_id(); /* function to get current msg_id ke index pe jo hilight hai */
    if (flag == MMI_UMMS_DEFAULT_TYPE)
    {
        box_type = SRV_UM_MSG_BOX_PREDEF_TEMPLATES;
    }
    else if (flag == MMI_UMMS_USER_DEFINED_TYPE)
    {
        box_type = SRV_UM_MSG_BOX_USRDEF_TEMPLATES;
    }

    mmi_umms_app_interface_entry_from_um(MMI_UM_UI_ENTRY_KEY_LSK, msg_id, NULL, GRP_ID_UMMS_LIST_TEMPLATES);
}
#endif /* __MMI_MMS_TEMPLATE_SUPPORT__ */ 

#if defined(__MMI_MMS_UMMS_VIDEO_FEATURE__) || defined(__MMI_MMS_UMMS_AUDIO_FEATURE__) || defined(__MMI_MMS_UMMS_IMAGE_FEATURE__)


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_composer_signature_check_object
 * DESCRIPTION
 *  
 * PARAMETERS
 *  path            [?]         [?]
 *  object_type     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
BOOL mmi_umms_composer_signature_check_object(S8 *path, U8 object_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    umms_inline_compose_items_struct *compose_settings_inline_items;
    mma_insert_info_struct insert_info;
    mma_insert_check_struct check_result;
    S8 tmp_str[UMMS_CONVERT_INDEX] = {0, };
    U32 object_size = applib_get_file_size((U16*) path);
    U32 current_msg_size = 0;

#ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
    U32 current_selected_mms_size = srv_mms_sending_mms_size_limit();
#else 
    U32 current_selected_mms_size = wap_custom_get_max_mms_msg_size();
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    insert_info.max_msg_size = 0;

    insert_info.mms_type = MMA_MMS_TYPE_SMIL_MMS;
    insert_info.current_msg_size = (UMMS_MAX_AUTO_SIGN_LENGTH + 1) * ENCODING_LENGTH;   /* space reseved for text signature */

    insert_info.filepath = (kal_wchar*) path;

    if (mmi_ucs2strlen((S8*) path) > MMA_MAX_EXTERNAL_FILE_PATH_LEN)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para(
            (U16*) GetString(STR_ID_UMMS_SIGNATURE_PATH_TOO_LONG),
            MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        mmi_umms_app_reset_buffer_for_signature();
        return FALSE;
    }
    compose_settings_inline_items =
        (umms_inline_compose_items_struct*) mmi_umms_app_dtmgr_get_current_compose_settings_list();
    if (compose_settings_inline_items->creation_mode == E_SET_CREAT_MODE_RESTRICTED)
    {
        insert_info.creation_mode = MMA_CREATION_MODE_RESTRICTED;
    }
#ifdef __MMI_MMS_2_CREATION_MODE_WARNING_SUPPORT__
    else if (compose_settings_inline_items->creation_mode == E_SET_CREAT_MODE_WARNING)
    {
        insert_info.creation_mode = MMA_CREATION_MODE_WARNING;
    }
#endif /* __MMI_MMS_2_CREATION_MODE_WARNING_SUPPORT__ */ 
    else
    {
        insert_info.creation_mode = MMA_CREATION_MODE_FREE;
    }

    switch (object_type)
    {
    #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
        case UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED:
            if (compose_settings_inline_items->signature_flag & UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED)
            {
            #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
                current_msg_size += applib_get_file_size((U16*) compose_settings_inline_items->auto_signature_audio_file);
            #endif 
            }
            break;
    #endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 

        #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
        case UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED:
            if (compose_settings_inline_items->signature_flag & UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED)
            {
            #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
                current_msg_size += applib_get_file_size((U16*) compose_settings_inline_items->auto_signature_image_file);
            #endif 
            }
            break;
        #endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 

        #ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
        case UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED:
            /* No change in message size  */
            break;
        #endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
    }

#if defined(__MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__) || defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)

    {
        if (((current_msg_size + object_size) > MMA_MAX_WAP_CONN_MSG_SIZE) &&
            (insert_info.creation_mode != MMA_CREATION_MODE_RESTRICTED))
        {
            insert_info.max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
            insert_info.max_msg_size = insert_info.max_msg_size / 1024;
            memset(subMenuData, 0, sizeof(subMenuData));
            gui_itoa(insert_info.max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
            mmi_ucs2cpy((S8*) subMenuData, (S8*) tmp_str);
            mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
            mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));
            mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS));
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_ERROR);
            mmi_umms_app_if_show_display_popup_screen();
            mmi_umms_app_reset_buffer_for_signature();
            return FALSE;
        }
    }
#endif /* defined(__MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__) || defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__) */ 

    if (((current_msg_size + object_size) > current_selected_mms_size) &&
        (insert_info.creation_mode != MMA_CREATION_MODE_RESTRICTED))
    {
        insert_info.max_msg_size = current_selected_mms_size;
        insert_info.max_msg_size = insert_info.max_msg_size / 1024;
        memset(subMenuData, 0, sizeof(subMenuData));
        gui_itoa(insert_info.max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
        mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_OPTIONS_MSG_SIZE_EXCEED));
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
        mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
        mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));

        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_ERROR);
        mmi_umms_app_if_show_display_popup_screen();

        mmi_umms_app_reset_buffer_for_signature();
        return FALSE;
    }

    insert_info.insert_type = MMA_INSERT_UNKNOWN;
    insert_info.max_msg_size = current_selected_mms_size;

    mma_uc_insert_object_check(&insert_info, &check_result);

    if (check_result.detail_result == MMA_RESULT_OK_WITH_WARNING_CONTENT)
    {
        switch (object_type)
        {
        #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
            case UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED:
                mmi_umms_app_dtmgr_set_confirm_screen_para(
                    STR_GLOBAL_YES,
                    IMG_GLOBAL_YES,
                    STR_GLOBAL_NO,
                    IMG_GLOBAL_NO,
                    (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                    MMI_EVENT_QUERY,
                    MMI_FALSE,
                    MMI_TRUE,
                    mmi_umms_app_callback_lsk_funct_add_image,
                    mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                    NULL,
                    NULL);

                mmi_umms_app_if_show_display_confirm_screen();

                break;
        #endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
        #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
            case UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED:
                mmi_umms_app_dtmgr_set_confirm_screen_para(
                    STR_GLOBAL_YES,
                    IMG_GLOBAL_YES,
                    STR_GLOBAL_NO,
                    IMG_GLOBAL_NO,
                    (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                    MMI_EVENT_QUERY,
                    MMI_FALSE,
                    MMI_TRUE,
                    mmi_umms_app_callback_lsk_funct_add_audio,
                    mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                    NULL,
                    NULL);

                mmi_umms_app_if_show_display_confirm_screen();
                break;
        #endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
        #ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
            case UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED:
                mmi_umms_app_dtmgr_set_confirm_screen_para(
                    STR_GLOBAL_YES,
                    IMG_GLOBAL_YES,
                    STR_GLOBAL_NO,
                    IMG_GLOBAL_NO,
                    (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                    MMI_EVENT_QUERY,
                    MMI_FALSE,
                    MMI_TRUE,
                    mmi_umms_app_callback_lsk_funct_add_video,
                    mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                    NULL,
                    NULL);

                mmi_umms_app_if_show_display_confirm_screen();
                break;
        #endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
            default:
                break;
        }
        return FALSE;
    }

    if (!check_result.result)
    {
        switch (check_result.detail_result)
        {
            case MMA_RESULT_FAIL_FILE_EMPTY:
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_ID_UMMS_SIGNATURE_EMPTY_FILE),
                    MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
                break;

            case MMA_RESULT_FAIL_MAX_MSG_SIZE_REACHED:
        #ifdef __MMI_OP12_MMS_MAX_SIZE_SUPPORT__
                insert_info.max_msg_size = srv_mms_sending_mms_size_limit();
        #else 
                insert_info.max_msg_size = wap_custom_get_max_mms_msg_size();
        #endif 
                insert_info.max_msg_size = insert_info.max_msg_size / 1024;
                memset(subMenuData, 0, sizeof(subMenuData));
                gui_itoa(insert_info.max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
                mmi_ucs2cpy((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_OPTIONS_MSG_SIZE_EXCEED));
                mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
                mmi_ucs2cat((S8*) subMenuData, (S8*) tmp_str);
                mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
                mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));
                mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_ERROR);
                mmi_umms_app_if_show_display_popup_screen();
                mmi_umms_app_reset_buffer_for_signature();
                break;

            case MMA_RESULT_OK_WITH_WARNING_CONTENT:
                switch (object_type)
                {
                #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
                    case UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED:
                        mmi_umms_app_dtmgr_set_confirm_screen_para(
                            STR_GLOBAL_YES,
                            IMG_GLOBAL_YES,
                            STR_GLOBAL_NO,
                            IMG_GLOBAL_NO,
                            (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                            MMI_EVENT_QUERY,
                            MMI_FALSE,
                            MMI_TRUE,
                            mmi_umms_app_callback_lsk_funct_add_image,
                            mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                            NULL,
                            NULL);

                        mmi_umms_app_if_show_display_confirm_screen();
                        break;
                #endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
                #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
                    case UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED:
                        mmi_umms_app_dtmgr_set_confirm_screen_para(
                            STR_GLOBAL_YES,
                            IMG_GLOBAL_YES,
                            STR_GLOBAL_NO,
                            IMG_GLOBAL_NO,
                            (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                            MMI_EVENT_QUERY,
                            MMI_FALSE,
                            MMI_TRUE,
                            mmi_umms_app_callback_lsk_funct_add_audio,
                            mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                            NULL,
                            NULL);

                        mmi_umms_app_if_show_display_confirm_screen();

                        break;
                #endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
                #ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
                    case UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED:
                        mmi_umms_app_dtmgr_set_confirm_screen_para(
                            STR_GLOBAL_YES,
                            IMG_GLOBAL_YES,
                            STR_GLOBAL_NO,
                            IMG_GLOBAL_NO,
                            (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                            MMI_EVENT_QUERY,
                            MMI_FALSE,
                            MMI_TRUE,
                            mmi_umms_app_callback_lsk_funct_add_video,
                            mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                            NULL,
                            NULL);

                        mmi_umms_app_if_show_display_confirm_screen();

                        break;
                #endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
                    default:
                        break;
                }
                break;

            case MMA_RESULT_FAIL_UNSUPPORT_CONTENT:
            case MMA_RESULT_FAIL_CREATION_MODE_MAX_MSG_SIZE_REACHED:
                if (check_result.creation_mode_violate == TRUE)
                {
                    switch (insert_info.creation_mode)
                    {
                        case MMA_CREATION_MODE_RESTRICTED:
                            if ((check_result.oversize) &&
                                (check_result.detail_result == MMA_RESULT_FAIL_CREATION_MODE_MAX_MSG_SIZE_REACHED))
                            {

                                mmi_umms_app_dtmgr_set_popup_screen_para(
                                    (U16*) GetString (STR_ID_UMMS_RESTRICTED_MODE_MSG_SIZE_EXCEED),
                                    MMI_EVENT_ERROR);
                                mmi_umms_app_if_show_display_popup_screen();
                                mmi_umms_app_reset_buffer_for_signature();
                            }
                            else
                            {
                                mmi_umms_app_dtmgr_set_popup_screen_para(
                                    (U16*) GetString (STR_ID_UMMS_CREATION_MODE_PROHIBITED),
                                    MMI_EVENT_ERROR);
                                mmi_umms_app_if_show_display_popup_screen();
                                mmi_umms_app_reset_buffer_for_signature();
                            }
                            break;
                        case MMA_CREATION_MODE_WARNING:
                            switch (object_type)
                            {
                            #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
                                case UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED:
                                    mmi_umms_app_dtmgr_set_confirm_screen_para(
                                        STR_GLOBAL_YES,
                                        IMG_GLOBAL_YES,
                                        STR_GLOBAL_NO,
                                        IMG_GLOBAL_NO,
                                        (U16*) GetString (STR_ID_UMMS_MODE_WARNING_CONFIRM),
                                        MMI_EVENT_QUERY,
                                        MMI_FALSE,
                                        MMI_TRUE,
                                        mmi_umms_app_callback_lsk_funct_add_image,
                                        mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                                        NULL,
                                        NULL);

                                    mmi_umms_app_if_show_display_confirm_screen();

                                    break;
                            #endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
                            #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
                                case UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED:
                                    mmi_umms_app_dtmgr_set_confirm_screen_para(
                                        STR_GLOBAL_YES,
                                        IMG_GLOBAL_YES,
                                        STR_GLOBAL_NO,
                                        IMG_GLOBAL_NO,
                                        (U16*) GetString (STR_ID_UMMS_MODE_WARNING_CONFIRM),
                                        MMI_EVENT_QUERY,
                                        MMI_FALSE,
                                        MMI_TRUE,
                                        mmi_umms_app_callback_lsk_funct_add_audio,
                                        mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                                        NULL,
                                        NULL);

                                    mmi_umms_app_if_show_display_confirm_screen();

                                    break;
                            #endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
                            #ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
                                case UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED:
                                    mmi_umms_app_dtmgr_set_confirm_screen_para(
                                        STR_GLOBAL_YES,
                                        IMG_GLOBAL_YES,
                                        STR_GLOBAL_NO,
                                        IMG_GLOBAL_NO,
                                        (U16*) GetString (STR_ID_UMMS_MODE_WARNING_CONFIRM),
                                        MMI_EVENT_QUERY,
                                        MMI_FALSE,
                                        MMI_TRUE,
                                        mmi_umms_app_callback_lsk_funct_add_video,
                                        mmi_umms_app_sh_warning_object_signature_confirm_rsk_handler,
                                        NULL,
                                        NULL);

                                    mmi_umms_app_if_show_display_confirm_screen();

                                    break;
                            #endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
                                default:
                                    break;
                            }

                    }

                }

                if (check_result.drm_type == MMA_DRM_FL_CD)
                {
                    mmi_umms_app_dtmgr_set_popup_screen_para(
                        (U16*) GetString(STR_GLOBAL_DRM_PROHIBITED),
                        MMI_EVENT_PROPLEM);
                    mmi_umms_app_if_show_display_popup_screen();
                    mmi_umms_app_reset_buffer_for_signature();
                    break;
                }
                break;

            case MMA_RESULT_OK:
            case MMA_RESULT_FAIL_FILE_CORRUPTED:
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_ID_UMMS_SIGNATURE_FILE_CORRUPTED),
                    MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
                mmi_umms_app_reset_buffer_for_signature();
                break;

            #if defined(__MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__) || defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__)
            case MMA_RESULT_FAIL_WAP_CONN_MAX_MSG_SIZE_REACHED:
                insert_info.max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
                insert_info.max_msg_size = insert_info.max_msg_size / 1024;
                memset(subMenuData, 0, sizeof(subMenuData));
                gui_itoa(insert_info.max_msg_size, (UI_string_type) tmp_str, UMMS_CONVERT_INDEX);
                mmi_ucs2cpy((S8*) subMenuData, (S8*) tmp_str);
                mmi_ucs2cat((S8*) subMenuData, (S8*) " ");
                mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_KB));
                mmi_ucs2cat((S8*) subMenuData, (S8*) GetString(STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS));
                mmi_umms_app_dtmgr_set_popup_screen_para((U16*) subMenuData, MMI_EVENT_PROPLEM);
                mmi_umms_app_if_show_display_popup_screen();
                mmi_umms_app_reset_buffer_for_signature();
                break;
            #endif /* defined(__MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__) || defined(__MMI_MMS_WAP_CONNECTION_MAX_SIZE_SUPPORT__) */ 

            default:
                mmi_umms_app_if_show_error_pop_up(check_result.detail_result);
                mmi_umms_app_reset_buffer_for_signature();
                break;
        }

        return FALSE;
    }

    return TRUE;

}
#endif /* defined(__MMI_MMS_UMMS_VIDEO_FEATURE__) || defined(__MMI_MMS_UMMS_AUDIO_FEATURE__) || defined(__MMI_MMS_UMMS_IMAGE_FEATURE__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_compose_settings_signature_selection_lsk_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_compose_settings_signature_selection_lsk_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_callback_compose_settings_signature_selection_lsk_handler();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_forward
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_forward(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_start_uc_struct uc_start;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    U32 max_msg_size = 0;
    S8 tmp_str[10] = {0, };
#endif /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__

    if (srv_wap_prof_get_active_profile_connection_type((srv_wap_prof_app_id_enum) SRV_WAP_PROF_APPID_MMS) >
        SRV_WAP_PROF_CONN_TYPE_HTTP)

    {
        max_msg_size = MMA_MAX_WAP_CONN_MSG_SIZE;
        if (info->msg_info->user_element_size > max_msg_size)
        {

            mmi_umms_app_plug_in_wap_connection_error_popup(
                info->msg_info->user_element_size,
                max_msg_size,
                STR_ID_UMMS_WAP_MAX_SIZE_EXCEEDS);
            return;
        }
    }
#endif /* __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__ */ 
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    if (info->msg_info->is_follow_phone_mms_content_class == KAL_FALSE)
    {
        mma_creation_mode_enum creation_mode;

        creation_mode = srv_mms_compose_settings_creation_mode();
        info->uc_mode = MMA_MODE_FORWARD;
        if (creation_mode == MMA_CREATION_MODE_RESTRICTED)
        {
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_RESTRICTED_MODE),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_FALSE,
                mmi_umms_app_ui_plug_in_entry_edit_fwd_mode,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
        }
        else if (creation_mode == MMA_CREATION_MODE_WARNING)
        {
            mmi_umms_app_dtmgr_set_confirm_screen_para(
                STR_GLOBAL_YES,
                IMG_GLOBAL_YES,
                STR_GLOBAL_NO,
                IMG_GLOBAL_NO,
                (U16*) GetString(STR_ID_UMMS_MODE_WARNING_CONFIRM),
                MMI_EVENT_QUERY,
                MMI_FALSE,
                MMI_TRUE,
                mmi_umms_app_ui_plug_in_entry_edit_fwd_mode,
                mmi_frm_scrn_close_active_id,
                NULL,
                NULL);
            mmi_umms_app_if_show_display_confirm_screen();
        }
        else
        {
            memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
            uc_start.msg_id = info->msg_id;
            uc_start.uc_mode = MMA_MODE_FORWARD;
            uc_start.sim_id = MMI_SIM1;
        #ifdef __MMI_MMS_POSTCARD__
            if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
            {
                uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
            }
        #endif /* __MMI_MMS_POSTCARD__ */ 
            uc_start.storage_type = info->msg_info->msg_storage;
            mmi_umms_app_ui_draw_dummy_screen();
            mmi_umms_start_uc(&uc_start);
            mmi_umms_app_sh_delete_option_screen(info->folder_id);
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        }
    }
    else
#endif/*#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
    {
        memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
        uc_start.msg_id = info->msg_id;
        uc_start.uc_mode = MMA_MODE_FORWARD;
        uc_start.sim_id = MMI_SIM1;
    #ifdef __MMI_MMS_POSTCARD__
        if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
        {
            uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
        }
    #endif /* __MMI_MMS_POSTCARD__ */ 
        uc_start.storage_type = info->msg_info->msg_storage;
        mmi_umms_app_ui_draw_dummy_screen();
        mmi_umms_start_uc(&uc_start);
        mmi_umms_app_sh_delete_option_screen(info->folder_id);
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_entry_edit_fwd_mode
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_entry_edit_fwd_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = info->msg_id;
    uc_start.uc_mode = info->uc_mode;
    uc_start.sim_id = MMI_SIM1;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 
    uc_start.storage_type = info->msg_info->msg_storage;
    mmi_umms_app_ui_draw_dummy_screen();
    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(info->folder_id);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
}

#ifdef __MMI_FTE_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_reply_as_sms_for_msg_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_reply_as_sms_for_msg_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();
    mmi_sms_write_msg_para_struct *sendData =
        (mmi_sms_write_msg_para_struct*) srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_sms_write_msg_para_struct));
    U8 from_str_ascii[MMA_MAX_ADDR_LEN] = {0, };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(sendData);
    memset(sendData, 0, sizeof(mmi_sms_write_msg_para_struct));
    sendData->string = NULL;
    sendData->stringlength = 0;
    sendData->dcs = SMSAL_UCS2_DCS;
#if ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_UNIFIED_COMPOSER__))
    switch (sync_info->msg_info.msg_sim_id)
    {
        case MMI_SIM1:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM1;
            break;
        case MMI_SIM2:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM2;
            break;
        case MMI_SIM3:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM3;
            break;
        case MMI_SIM4:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM4;
            break;
    }
#else /* ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_UNIFIED_COMPOSER__)) */ /* defined(__MMI_MMS_DUAL_SIM__) && defined(__MMI_UNIFIED_COMPOSER__) */
    sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY;
#endif /* ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_UNIFIED_COMPOSER__)) */ /* defined(__MMI_MMS_DUAL_SIM__) && defined(__MMI_UNIFIED_COMPOSER__) */
    /* Get the from Address from the Global struct and Convert it in Ascii */
    mmi_ucs2_to_asc((S8*) from_str_ascii, (S8*) sync_info->msg_info.from_address);    /* rec */
    sendData->ascii_addr = (U8*) from_str_ascii;
    MMI_TRACE(MMI_INET_TRC_G6_MMS, TRC_MMI_UMMS_REPLY_AS_SMS, sendData->flag, sync_info->msg_info.msg_sim_id);
    mmi_umms_app_ui_draw_dummy_screen();
    mmi_umms_app_sh_go_to_box_list_screen();
    mmi_sms_write_msg_lanch(0, sendData);
    srv_mms_mem_mgr_app_adm_free(sendData);
    srv_mms_reset_sync_data();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_edit_fwd_mode_for_msg_list_toolbar
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_edit_fwd_mode_for_msg_list_toolbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();
	mma_result_enum result_mma = MMA_RESULT_OK;
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = sync_info->msg_id;
    uc_start.uc_mode = MMA_MODE_FORWARD;
    uc_start.sim_id = MMI_SIM1;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 
    uc_start.storage_type = sync_info->msg_info.msg_storage;
    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    srv_mms_reset_sync_data();
  #else
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    result_mma = srv_mms_container_set_message_id(sync_info->msg_id); 
	if(result_mma == MMA_RESULT_OK)
	{
		mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_FORWARD);
	}
	else
	{
		mmi_umms_app_if_show_error_pop_up(result_mma);
	}

    srv_mms_reset_sync_data();
    #endif

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_edit_for_msg_list_toolbar
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_edit_for_msg_list_toolbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();
	mma_result_enum result_mma = MMA_RESULT_OK;
   #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = sync_info->msg_id;
    uc_start.uc_mode = MMA_MODE_EDIT;
    uc_start.sim_id = MMI_SIM1;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 
    uc_start.storage_type = sync_info->msg_info.msg_storage;
    mmi_umms_start_uc(&uc_start);
   
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    srv_mms_reset_sync_data();
    #else
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    result_mma = srv_mms_container_set_message_id(sync_info->msg_id); 
	if(result_mma == MMA_RESULT_OK)
	{
		mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_EDIT);
	}
	else
	{
		mmi_umms_app_if_show_error_pop_up(result_mma);
	}

    srv_mms_reset_sync_data();
    #endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_send_msg_from_msg_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_send_msg_from_msg_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_start_uc_struct uc_start;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = sync_info->msg_id;
    uc_start.uc_mode = MMA_MODE_SEND;
    uc_start.sim_id = MMI_SIM1;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 
    uc_start.storage_type = sync_info->msg_info.msg_storage;
    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    srv_mms_reset_sync_data();
    #else
    mmi_umms_app_sh_delete_option_screen(sync_info->msg_info.folder);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
    srv_mms_reset_sync_data();
    #endif

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_resend_msg_from_msg_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_resend_msg_from_msg_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_sync_msg_info_struct *sync_info = srv_mms_get_sync_msg_info();
    U8 is_send_and_save;



    srv_mms_send_req_struct req;
    U8 sim_selection_screen = (U8) MMI_SIM1;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&req, 0, sizeof(srv_mms_send_req_struct));

    is_send_and_save = srv_mms_sending_settings_send_and_save();
#if(MMI_MAX_SIM_NUM >= 2)
    if (srv_mms_num_valid_sim() == 1)
    {
        sim_selection_screen = srv_mms_get_sim_valid_flag();
    }
    else
    {
        sim_selection_screen = srv_mms_get_selected_sim_id();
    }
#endif /* (MMI_MAX_SIM_NUM >= 2) */ 
    if (is_send_and_save > 0)
    {

        if (MMI_TRUE == srv_mms_is_sim_valid((mmi_sim_enum)sim_selection_screen))
        {
            req.sim_id = sim_selection_screen;
            req.send_setting = SRV_MMS_SETTING_SAVE_AND_SEND;   /* SRV_MMS_SETTING_SAVE_AND_SEND; */
            req.msg_id = sync_info->msg_id;
            req.is_rr = MMI_FALSE;
            req.storage_type = sync_info->msg_info.msg_storage;
            mmi_umms_app_sh_delete_umms_screens();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            srv_mms_send(&req);
        }
    }
    else
    {
        if (MMI_TRUE == srv_mms_is_sim_valid((mmi_sim_enum)sim_selection_screen))
        {
            req.sim_id = sim_selection_screen;
            req.send_setting = SRV_MMS_SETTING_SAVE_AND_SEND;   /* SRV_MMS_SETTING_SAVE_AND_SEND; */
            req.msg_id = sync_info->msg_id;
            req.is_rr = MMI_FALSE;
            req.storage_type = sync_info->msg_info.msg_storage;
            mmi_umms_app_sh_delete_umms_screens();
            mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
            srv_mms_send(&req);
        }
    }

    srv_mms_reset_sync_data();
}

#endif /* __MMI_FTE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_reply_as_sms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_reply_as_sms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    mmi_sms_write_msg_para_struct *sendData =
        (mmi_sms_write_msg_para_struct*) srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_sms_write_msg_para_struct));
    U8 from_str_ascii[MMA_MAX_ADDR_LEN] = {0, };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(sendData);
    memset(sendData, 0, sizeof(mmi_sms_write_msg_para_struct));
    sendData->string = NULL;
    sendData->stringlength = 0;
    sendData->dcs = SMSAL_UCS2_DCS;
#if ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_UNIFIED_COMPOSER__))
    switch (info->msg_info->msg_sim_id)
    {
        case MMI_SIM1:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM1;
            break;
        case MMI_SIM2:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM2;
            break;
        case MMI_SIM3:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM3;
            break;
        case MMI_SIM4:
            sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY_HIGHLIGHT_SIM4;
            break;
    }
#else /* ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_UNIFIED_COMPOSER__)) */ /* ((defined(__MMI_MMS_DUAL_SIM__) || defined(__GEMINI__) || (GEMINI_PLUS > 2)) && defined(__MMI_UNIFIED_COMPOSER__)) */
    sendData->flag = MMI_SMS_ENTRY_WRITE_REPLY;
#endif /* ((MMI_MAX_SIM_NUM >= 2) && defined(__MMI_UNIFIED_COMPOSER__)) */ /* ((defined(__MMI_MMS_DUAL_SIM__) || defined(__GEMINI__) || (GEMINI_PLUS > 2)) && defined(__MMI_UNIFIED_COMPOSER__)) */
    /* Get the from Address from the Global struct and Convert it in Ascii */
    mmi_ucs2_to_asc((S8*) from_str_ascii, (S8*) info->msg_info->from_address);
    sendData->ascii_addr = (U8*) from_str_ascii;
    MMI_TRACE(MMI_INET_TRC_G6_MMS, TRC_MMI_UMMS_REPLY_AS_SMS, sendData->flag, info->msg_info->msg_sim_id);
    mmi_umms_app_ui_draw_dummy_screen();
    mmi_umms_app_sh_go_to_box_list_screen();
    mmi_sms_write_msg_lanch(0, sendData);
    srv_mms_mem_mgr_app_adm_free(sendData);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_reply
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_reply(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_umms_start_uc_struct uc_start;

   

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&uc_start, 0, sizeof(mmi_umms_start_uc_struct));
    uc_start.msg_id = info->msg_id;
    uc_start.uc_mode = MMA_MODE_REPLY;
    uc_start.sim_id = info->msg_info->msg_sim_id;
#ifdef __MMI_MMS_POSTCARD__
    if (info->msg_info->msg_type == MMA_MSG_TYPE_POSTCARD)
    {
        uc_start.edit_mode = MMI_UC_MMS_EDIT_MODE_POSTCARD_MMS;
    }
#endif /* __MMI_MMS_POSTCARD__ */ 
    uc_start.storage_type = info->msg_info->msg_storage;
    mmi_umms_app_ui_draw_dummy_screen();
    mmi_umms_start_uc(&uc_start);
    mmi_umms_app_sh_delete_option_screen(info->folder_id);
    mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
#else

	 
        mmi_umms_app_ui_plug_in_launch_slim(MMA_MODE_REPLY);   
     

#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_change_in_compose_signature
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U8 mmi_umms_app_ui_plug_in_get_change_in_compose_signature(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_umms_app_dtmgr_get_change_in_compose_signature();
}

/* Amitesh For Send Key Support */

#ifdef __MMI_EMAIL__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_email_as_send_email_viewer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  string      [?]     [?]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_email_as_send_email_viewer(U8 *string)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    U16 scrid = 0;
    mmi_umms_app_dtmgr_option_scr_data_struct *data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (data->is_preview)
    {
        return;
    }
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_LAUNCH_EMAIL);
    mmi_frm_display_dummy_screen();
    if (mmi_ucs2strlen((S8*) string) > MMI_EMAIL_MAX_ADDR_LEN)
    {
        mmi_popup_property_struct arg;

        mmi_popup_property_init(&arg);
        arg.parent_id = mmi_umms_dtmgr_get_group_id();
        arg.user_tag = (void*)(mmi_umms_truncate_send_email_interface_view_callback);
        mmi_popup_display((WCHAR*) ((UI_string_type) GetString(STR_ID_UMMS_TRUNCATE_NUMBER)), MMI_EVENT_INFO, &arg);
    }
    else
    {
        mmi_email_app_send_to((S8*) string);
        /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
        mmi_umms_app_sh_delete_umms_use_details_screens();
        mmi_umms_app_dtmgr_reset_data();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_truncate_send_email_interface_view_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_truncate_send_email_interface_view_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    U8 temp[(MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH];
    U16 scrid = 0;
    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);
    applib_address_node_struct *node = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(viewer_scr);
    node = (applib_address_node_struct*) viewer_scr->current_hilited->item;
    memset(temp, 0, (MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH);
    mmi_ucs2ncpy((S8*) temp, (S8*) node->data, MMI_EMAIL_MAX_ADDR_LEN);
    mmi_email_app_send_to((S8*) temp);
    /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
    mmi_umms_app_sh_delete_umms_use_details_screens();
    mmi_umms_app_dtmgr_reset_data();

}
#endif /* __MMI_EMAIL__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_url_as_browser_launch_viewer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  string      [?]     [?]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_url_as_browser_launch_viewer_ext()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 tempstr[(MMI_UMMS_MAX_URL_LENGTH + 1) * ENCODING_LENGTH];
    mmi_umms_app_dtmgr_option_scr_data_struct *data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);
    S32 len = 0;
    U8 *string = NULL;
    mmi_umms_app_ui_draw_viewer_screen_struct *viewer_scr =
        (mmi_umms_app_ui_draw_viewer_screen_struct*) mmi_umms_app_sh_get_scr_context(SCR_ID_UMMS_MMS_VIEWER);
    applib_address_node_struct *node = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    node = (applib_address_node_struct*) viewer_scr->current_hilited->item;
    if (viewer_scr->mode == WGUI_MV_DISPLAY_MODE_SHOW)
		{
			        if(node->dataType == APPLIB_ADDR_TYPE_URL )
			        {
                        string = (U8*) node->data;
    len = mmi_ucs2strlen((S8*) (string));
    if (data->is_preview)
    {
        return;
    }
    MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_LAUNCH_URL);
    if (len > MMI_UMMS_MAX_URL_LENGTH)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_ID_UMMS_URL_TOO_LONG), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        mmi_umms_app_sh_delete_umms_use_details_screens();
        mmi_umms_app_dtmgr_reset_data();
        return;
    }
    mmi_ucs2cpy((S8*) tempstr, (S8*) (string));
    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_MMS_VIEWER)
    {
        mmi_umms_app_ui_draw_dummy_screen();
    }
#ifdef BROWSER_SUPPORT
    wap_start_browser(WAP_BROWSER_GOTO_URL, (PU8) (tempstr));
#endif 
    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS
        || mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_MMS_OPTIONS_USE_DETAILS_ADDRESS_LIST)
    {
        //ClearExitHandler();
    }

    mmi_umms_app_sh_delete_umms_use_details_screens();
    mmi_umms_app_dtmgr_reset_data();
    srv_mms_mem_mgr_asm_deinit_memory(APPLIB_MEM_AP_ID_UMMS, SRV_MMS_INSTANCE_DEFAULT_INDEX);
		            }
	   	}

}

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_url_as_browser_launch_viewer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  string      [?]     [?]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_url_as_browser_launch_viewer(U8 *string)
{

#ifdef __OP01__
                mmi_umms_app_dtmgr_set_confirm_screen_para(
                        STR_GLOBAL_YES,
                        IMG_GLOBAL_YES,
                        STR_GLOBAL_NO,
                        IMG_GLOBAL_NO,
                        (U16*) GetString(STR_ID_MMS_VIEWER_OPEN_BROWSER_CONFIRM),
                        MMI_EVENT_QUERY,
                        MMI_FALSE,
                        MMI_FALSE,
                        mmi_umms_app_ui_plug_in_use_url_as_browser_launch_viewer_ext,      
                        mmi_frm_scrn_close_active_id,
                        NULL,
                        NULL);
                    mmi_umms_app_if_show_display_confirm_screen();
#else
            mmi_umms_app_ui_plug_in_use_url_as_browser_launch_viewer_ext();
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_number_as_make_call_viewer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  string      [?]     [?]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_number_as_make_call_viewer(U8 *string)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_ucm_make_call_para_struct make_call_para;
    mmi_umms_app_dtmgr_option_scr_data_struct *data =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!data->is_preview && srv_mms_num_valid_sim())
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PLUG_IN_VIEWER_CALL_NUMBER);
        /* mmi_ucm_app_entry_dial_option((U8*) string, NULL, NULL); */
        mmi_ucm_init_call_para(&make_call_para);
        make_call_para.dial_type = SRV_UCM_CALL_TYPE_ALL;
        make_call_para.adv_para.after_make_call_callback = NULL;
        make_call_para.ucs2_num_uri = (U16*) string;
        mmi_ucm_call_launch(0, &make_call_para);
    }
}

/* Amitesh For Send KEy */

#ifdef __MMI_PHB_OPTIONAL_FIELD__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_email_as_save_to_phb
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_email_as_save_to_phb(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /* U8 temp[(MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH]; */
    U16 phb_cui_id_value = 0;
    U8 *data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_frm_group_entry_ex(GRP_ID_ROOT, APP_UMMS_MMS, mmi_umms_save_contacts_proc, NULL, NULL); */
    mmi_frm_group_create_ex(
        mmi_umms_app_dtmgr_get_parent_grp_id(),
        APP_UMMS_MMS,
        mmi_umms_save_contacts_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    phb_cui_id_value = cui_phb_save_contact_create(APP_UMMS_MMS);
    if (phb_cui_id_value != GRP_ID_INVALID)
    {
        mmi_umms_app_dtmgr_set_phone_book_cui_id(phb_cui_id_value);
        cui_phb_save_contact_set_email(phb_cui_id_value, (U16*) data);
        cui_phb_save_contact_run(phb_cui_id_value);
    }
    srv_mms_mem_mgr_app_adm_free(data);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}
#endif /* __MMI_PHB_OPTIONAL_FIELD__ */ 
#ifdef __MMI_EMAIL__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_email_as_send_email
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_email_as_send_email(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U16 scrid = 0;
    U8 *data = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();
    mmi_frm_display_dummy_screen();
    if (mmi_ucs2strlen((S8*) data) > MMI_EMAIL_MAX_ADDR_LEN)
    {
        mmi_popup_property_struct arg;

        mmi_popup_property_init(&arg);
        arg.parent_id = mmi_umms_dtmgr_get_group_id();
        arg.user_tag = (void*)(mmi_umms_truncate_send_email_interface_callback);
        mmi_popup_display((WCHAR*) ((UI_string_type) GetString(STR_ID_UMMS_TRUNCATE_NUMBER)), MMI_EVENT_INFO, &arg);

        srv_mms_mem_mgr_app_adm_free(data);
    }
    else
    {
        mmi_email_app_send_to((S8*) data);
        srv_mms_mem_mgr_app_adm_free(data);
        /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
        mmi_umms_app_sh_delete_umms_use_details_screens();
        mmi_umms_app_dtmgr_reset_data();
    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_truncate_send_email_interface_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_truncate_send_email_interface_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U8 temp[(MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH];
    U16 scrid = 0;
    U8 *data = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();

    memset(temp, 0, (MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH);
    mmi_ucs2ncpy((S8*) temp, (S8*) data, MMI_EMAIL_MAX_ADDR_LEN);
    srv_mms_mem_mgr_app_adm_free(data);
    mmi_email_app_send_to((S8*) temp);
    /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
    mmi_umms_app_sh_delete_umms_use_details_screens();
    mmi_umms_app_dtmgr_reset_data();
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}

#endif /* __MMI_EMAIL__ */ /* mmi_email */
/************common for email and number*************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_common_as_send_mms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_details_common_as_send_mms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /* for number */
    U16 scrid = 0;
    U8 *data = NULL;

    mmi_umms_app_dtmgr_use_details_struct *data_list =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();
    if (APPLIB_ADDR_TYPE_PHONENUMBER == data_list->applib_addr_type)
    {
        if (applib_is_valid_number_unicode((kal_wchar*) data))
        {
            if (mmi_ucs2strlen((S8*) data) > MMI_UC_MAX_PHONE_NUMBER_LEN)
            {
                mmi_popup_property_struct arg;

                mmi_popup_property_init(&arg);
                arg.parent_id = mmi_umms_dtmgr_get_group_id();
                arg.user_tag = (void*)(mmi_umms_truncate_send_mms_interface_to_uc_callback);
                mmi_popup_display(
                    (WCHAR*) ((UI_string_type) GetString(STR_ID_UMMS_TRUNCATE_NUMBER)),
                    MMI_EVENT_INFO,
                    &arg);

            }
            else
            {
                mmi_umms_mms_address_insert_hdlr((U8*) (data));
                /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
                mmi_umms_app_sh_delete_umms_use_details_screens();
                mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
                mmi_umms_app_dtmgr_reset_data();
            }
        }
        else
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_INVALID_NUMBER), MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
        }
    }
    else
    {
        if (mmi_ucs2strlen((S8*) data) > MMI_EMAIL_MAX_ADDR_LEN)
        {
            mmi_popup_property_struct arg;

            mmi_popup_property_init(&arg);
            arg.parent_id = mmi_umms_dtmgr_get_group_id();
            arg.user_tag = (void*)(mmi_umms_truncate_send_mms_interface_to_uc_callback);
            mmi_popup_display(
                (WCHAR*) ((UI_string_type) GetString(STR_ID_UMMS_TRUNCATE_NUMBER)),
                MMI_EVENT_INFO,
                &arg);

        }
        else
        {
            mmi_umms_mms_address_insert_hdlr((U8*) (data));
            /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
            mmi_umms_app_sh_delete_umms_use_details_screens();
            mmi_umms_app_dtmgr_reset_data();
        }
    }
    srv_mms_mem_mgr_app_adm_free(data);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_truncate_send_mms_interface_to_uc_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_truncate_send_mms_interface_to_uc_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U8 temp[(MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH];
    U16 scrid = 0;

    U8 *data = NULL;
    mmi_umms_app_dtmgr_use_details_struct *data_list =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();

    switch (data_list->applib_addr_type)
    {
        case APPLIB_ADDR_TYPE_PHONENUMBER:
            memset(temp, 0, (MMI_UC_MAX_PHONE_NUMBER_LEN + 1) * ENCODING_LENGTH);
            mmi_ucs2ncpy((S8*) temp, (S8*) data, MMI_UC_MAX_PHONE_NUMBER_LEN);
            break;

        case APPLIB_ADDR_TYPE_EMAIL:
            memset(temp, 0, (MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH);
            mmi_ucs2ncpy((S8*) temp, (S8*) data, MMI_EMAIL_MAX_ADDR_LEN);
            break;
    }
    srv_mms_mem_mgr_app_adm_free(data);
    mmi_umms_mms_address_insert_hdlr((U8*) temp);
    /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
    mmi_umms_app_sh_delete_umms_use_details_screens();
    mmi_umms_app_dtmgr_reset_data();
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_number_as_make_call
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_number_as_make_call(void)
{
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_ucm_make_call_para_struct make_call_para;
    U8 *data;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_ucm_app_entry_dial_option((U8*) data, NULL, NULL); */
    if (srv_mms_num_valid_sim())
    {
        data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();
        mmi_ucm_init_call_para(&make_call_para);
        make_call_para.dial_type = SRV_UCM_CALL_TYPE_ALL;
        make_call_para.adv_para.after_make_call_callback = NULL;
        make_call_para.ucs2_num_uri = (U16*) data;
        mmi_ucm_call_launch(0, &make_call_para);
        srv_mms_mem_mgr_app_adm_free(data);
    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_number_as_save_to_phb
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_number_as_save_to_phb(void)
{
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /* U8 temp[(MMI_PHB_NUMBER_LENGTH + 2) * ENCODING_LENGTH]; */
    S16 check_max_value = 0;
    U16 phb_cui_id_value = 0;
    U8 *data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (applib_is_valid_number_unicode((kal_wchar*) data))
    {
        /* mmi_frm_group_entry_ex(GRP_ID_ROOT, APP_UMMS_MMS, mmi_umms_save_contacts_proc, NULL, NULL); */
        mmi_frm_group_create_ex(
            mmi_umms_app_dtmgr_get_parent_grp_id(),
            APP_UMMS_MMS,
            mmi_umms_save_contacts_proc,
            NULL,
            MMI_FRM_NODE_SMART_CLOSE_FLAG);
        phb_cui_id_value = cui_phb_save_contact_create(APP_UMMS_MMS);
        if (phb_cui_id_value != GRP_ID_INVALID)
        {
            mmi_umms_app_dtmgr_set_phone_book_cui_id(phb_cui_id_value);
            cui_phb_save_contact_set_number(phb_cui_id_value, (U16*) data);
            cui_phb_save_contact_run(phb_cui_id_value);
        }

    }
    else
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_INVALID_NUMBER), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
    }
    srv_mms_mem_mgr_app_adm_free(data);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 

}

#if (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined(__MMS_STANDALONE_COMPOSER_SUPPORT__))


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_number_as_send_sms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_number_as_send_sms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U8 check_plus_value = 0;
    U16 scrid = 0;
    U8 *data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (applib_is_valid_number_unicode((kal_wchar*) data))
    {
        if (*(data) == '+')
        {
            check_plus_value = 1;
        }
        if (mmi_ucs2strlen((S8*) data) > (SRV_SMS_MAX_ADDR_LEN - 1 + check_plus_value))
        {
            mmi_popup_property_struct arg;

            mmi_popup_property_init(&arg);
            arg.parent_id = mmi_umms_dtmgr_get_group_id();
            arg.user_tag = (void*)mmi_umms_truncate_send_sms_interface_to_uc_callback;
            mmi_popup_display(
                (WCHAR*) ((UI_string_type) GetString(STR_ID_UMMS_TRUNCATE_NUMBER)),
                MMI_EVENT_INFO,
                &arg);
        }
        else
        {
            mmi_umms_use_details_address_insert_hdlr((U8*) (data));
            /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
            mmi_umms_app_sh_delete_umms_use_details_screens();
            mmi_umms_app_dtmgr_reset_data();
        }
    }
    else
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_INVALID_NUMBER), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
    }
    srv_mms_mem_mgr_app_adm_free(data);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_truncate_send_sms_interface_to_uc_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_truncate_send_sms_interface_to_uc_callback(void)
{
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 temp[(SRV_SMS_MAX_ADDR_LEN) * ENCODING_LENGTH];
    U16 scrid = 0;
    U8 check_plus_value = 0;
    U8 *data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(temp, 0, (SRV_SMS_MAX_ADDR_LEN) * ENCODING_LENGTH);
    if (*(data) == '+')
    {
        check_plus_value = 1;
    }
    mmi_ucs2ncpy((S8*) temp, (S8*) data, (SRV_SMS_MAX_ADDR_LEN - 1 + check_plus_value));
    srv_mms_mem_mgr_app_adm_free(data);
    mmi_umms_use_details_address_insert_hdlr((U8*) temp);
    /* DeleteFromScrUptoScr(SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS, scrid); */
    mmi_umms_app_sh_delete_umms_use_details_screens();
    mmi_umms_app_dtmgr_reset_data();
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}
#endif /* (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined(__MMS_STANDALONE_COMPOSER_SUPPORT__)) */ /* composer_check */


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_url_as_browser_launch
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_url_as_browser_launch_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U16 scrid = 0;
    U8 *data = NULL;
    U8 tempstr[(MMI_UMMS_MAX_URL_LENGTH + 1) * ENCODING_LENGTH];
    S32 len = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();
    len = mmi_ucs2strlen((S8*) (data));
    if (len > MMI_UMMS_MAX_URL_LENGTH)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_ID_UMMS_URL_TOO_LONG), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();

        mmi_frm_group_close(mmi_umms_dtmgr_get_group_id());
        srv_mms_mem_mgr_app_adm_free(data);
        mmi_umms_app_sh_delete_umms_use_details_screens();
        mmi_umms_app_dtmgr_reset_data();
        return;
    }
    mmi_ucs2cpy((S8*) tempstr, (S8*) (data));
    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_MMS_VIEWER ||mmi_frm_scrn_get_active_id() ==  SCR_ID_UMMS_CONFIRM)
    {
        mmi_umms_app_ui_draw_dummy_screen();
    }
#ifdef BROWSER_SUPPORT
    wap_start_browser(WAP_BROWSER_GOTO_URL, (PU8) (tempstr));
#endif 
    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_OPTIONS_USE_DETAILS_ADDRESSES_OPTIONS
        || mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_MMS_OPTIONS_USE_DETAILS_ADDRESS_LIST)
    {
        // ClearExitHandler();
    }

    srv_mms_mem_mgr_app_adm_free(data);
    mmi_umms_app_sh_delete_umms_use_details_screens();
    mmi_umms_app_dtmgr_reset_data();
    srv_mms_mem_mgr_asm_deinit_memory(APPLIB_MEM_AP_ID_UMMS, SRV_MMS_INSTANCE_DEFAULT_INDEX);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_url_as_browser_launch
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_url_as_browser_launch(void)
{
       
#ifdef __OP01__
                mmi_umms_app_dtmgr_set_confirm_screen_para(
                        STR_GLOBAL_YES,
                        IMG_GLOBAL_YES,
                        STR_GLOBAL_NO,
                        IMG_GLOBAL_NO,
                        (U16*) GetString(STR_ID_MMS_VIEWER_OPEN_BROWSER_CONFIRM),
                        MMI_EVENT_QUERY,
                        MMI_FALSE,
                        MMI_FALSE,
                        mmi_umms_app_ui_plug_in_use_url_as_browser_launch_ext,      
                        mmi_frm_scrn_close_active_id,
                        NULL,
                        NULL);
                    mmi_umms_app_if_show_display_confirm_screen();
#else
            mmi_umms_app_ui_plug_in_use_url_as_browser_launch_ext();
#endif
}
#ifdef __MMI_BRW_BKM_INTERFACE_SUPPORT__

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_save_bookmark_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  evt     [?]     
 *  mmi_event_struct(?)
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_umms_save_bookmark_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    cui_bkm_sel_bkm_result_evt_struct *save_bookmark_result;
    U16 curr_phb_cui_id = 0;

    curr_phb_cui_id = mmi_umms_app_dtmgr_get_bookmark_cui_id();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_CUI_BKM_SEL_BKM_RESULT:
            break;

        case EVT_ID_CUI_BKM_ADD_BKM_CLOSE:
            cui_bkm_add_bkm_close(curr_phb_cui_id);
            mmi_umms_app_dtmgr_set_bookmark_cui_id(GRP_ID_INVALID);
            break;

        default:
            break;
    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    return MMI_RET_OK;
}

#endif/* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_url_as_save_to_bookmark
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_url_as_save_to_bookmark(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    U16 scrid = 0;
    S32 len = 0;
    U8 *data = (U8*) mmi_umms_app_dtmgr_get_use_details_string();
    U8 *temp_string = NULL;

    U16 bookmark_cui_id_value = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    len = mmi_ucs2strlen((S8*) (data));
    if (len > MMI_UMMS_MAX_URL_LENGTH)
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_ID_UMMS_URL_TOO_LONG), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
        srv_mms_mem_mgr_app_adm_free(data);
        return;
    }
    temp_string = (S8*) srv_mms_mem_mgr_app_adm_alloc((len + 1) * ENCODING_LENGTH);
    MMI_ASSERT(temp_string);

    mmi_frm_group_create_ex(
        mmi_umms_app_dtmgr_get_parent_grp_id(),
        APP_UMMS_MMS,
        mmi_umms_save_bookmark_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    bookmark_cui_id_value = cui_bkm_add_bkm_create(APP_UMMS_MMS);
    if (bookmark_cui_id_value != GRP_ID_INVALID)
    {
        mmi_chset_ucs2_to_utf8_string((U8*) temp_string, (MMI_UMMS_MAX_URL_LENGTH + 1) * ENCODING_LENGTH, (U8*) data);
        cui_bkm_add_bkm_run(bookmark_cui_id_value, (U8*) temp_string);
        mmi_umms_app_dtmgr_set_bookmark_cui_id(bookmark_cui_id_value);
    }
    srv_mms_mem_mgr_app_adm_free(data);
    srv_mms_mem_mgr_app_adm_free(temp_string);
    temp_string = NULL;
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_list_addresses_options_lsk_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_details_list_addresses_options_lsk_handler(U16 hilite_menu)
{
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_use_details_struct *data =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (hilite_menu)
    {
    #ifdef __MMI_PHB_OPTIONAL_FIELD__
        case MENU_ID_UMMS_USE_DETAILS_ADDRESSES_ADD_TO_CONTACT:
            /* write here for external interfaces */

            mmi_umms_app_ui_plug_in_use_email_as_save_to_phb();

            break;
    #endif /* __MMI_PHB_OPTIONAL_FIELD__ */ 
    #ifdef __MMI_EMAIL__
        case MENU_ID_UMMS_USE_DETAILS_SEND_EMAIL:

            mmi_umms_app_ui_plug_in_use_email_as_send_email();
            /* send email inetrfaces */
            break;
    #endif /* __MMI_EMAIL__ */ 
        case MENU_ID_UMMS_USE_DETAILS_SEND_MMS:
            mmi_umms_app_ui_plug_in_use_details_common_as_send_mms();
            /* send mms interface* common for need applib add type to identify email and number */
            break;

            /* number list */
        case MENU_ID_UMMS_USE_DETAILS_ADDRESSES_CALL:
            mmi_umms_app_ui_plug_in_use_number_as_make_call();
            /* make call inetrface */
            break;

        case MENU_ID_UMMS_USE_DETAILS_ADDRESSES_SAVE_TO_PHBOOK:
            mmi_umms_app_ui_plug_in_use_number_as_save_to_phb();

            /* number save to pHB interface */
            break;

        case MENU_ID_UMMS_USE_DETAILS_SEND_SMS:
            mmi_umms_app_ui_plug_in_use_number_as_send_sms();
            /* send sms inetrface */
            break;

        case MENU_ID_UMMS_USE_DETAILS_ADDRESSES_GO_TO:
            mmi_umms_app_ui_plug_in_use_url_as_browser_launch();
            /* add inetrface to go_to browser */
            break;
#ifdef __MMI_BRW_BKM_INTERFACE_SUPPORT__
        case MENU_ID_UMMS_USE_DETAILS_ADDRESSES_ADD_BOOKMARK:
            mmi_umms_app_ui_plug_in_use_url_as_save_to_bookmark();
            /* inetrface for add to bookmark */
            break;
#endif
        default:
            MMI_ASSERT(0);
            break;

    }
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_use_details_list_addresses_list_hilite_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_use_details_list_addresses_list_hilite_handler(S32 index)
{
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_use_details_struct *data =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    mmi_umms_app_ui_draw_dynamic_screen_struct *dynamic_scr;
    mmi_umms_app_screenDB_struct *scrDB = mmi_frm_scrn_get_user_data(mmi_umms_dtmgr_get_group_id(), mmi_frm_scrn_get_active_id());

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data->hilite_index = index;
    dynamic_scr = (mmi_umms_app_ui_draw_dynamic_screen_struct*) mmi_umms_app_sh_get_scr_context(scrDB->scrn_id);
    ASSERT(dynamic_scr);
    dynamic_scr->hilighted_item = index;
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_mms_address_insert_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  address     [?]     [?]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_mms_address_insert_hdlr(U8 *address)
{
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
#if (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined(__MMS_STANDALONE_COMPOSER_SUPPORT__))
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    U8 temp[(MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH];
    mmi_uc_entry_write_struct data;
    mmi_uc_addr_struct addr;
    mmi_umms_app_dtmgr_use_details_struct *data_list =
        (mmi_umms_app_dtmgr_use_details_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_GET_USE_DETAILS_LIST);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(temp, 0, (MMI_EMAIL_MAX_ADDR_LEN + 1) * ENCODING_LENGTH);
    mmi_ucs2cpy((S8*) temp, (S8*) (address));
    memset(&data, 0x00, sizeof(mmi_uc_entry_write_struct));
    memset(&addr, 0x00, sizeof(mmi_uc_addr_struct));
    data.addr_num = 1;
    addr.addr = (kal_uint8*) temp;

    if (APPLIB_ADDR_TYPE_PHONENUMBER == data_list->applib_addr_type)
    {
        addr.type = MMI_UC_ADDRESS_TYPE_PHONE_NUMBER;
    }
    else
    {
        addr.type = MMI_UC_ADDRESS_TYPE_EMAIL;
    }

    addr.group = MMI_UC_ADDRESS_GROUP_TYPE_TO;
    data.addr = &addr;
    data.msg_type = MMI_UC_MSG_TYPE_MMS_ONLY;
    data.info_type = MMI_UC_INFO_TYPE_MMS;
    mmi_uc_entry_write_msg_with_content(MMI_UC_STATE_WRITE_NEW_MSG, &data);
    return;
#endif /* (defined(__UNIFIED_COMPOSER_SUPPORT__) || defined(__MMS_STANDALONE_COMPOSER_SUPPORT__)) */ 
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_use_details_address_insert_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  address     [?]     [?]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_use_details_address_insert_hdlr(U8 *address)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    mmi_sms_write_msg_para_struct data;
    U8 to_str_ascii[MMA_MAX_ADDR_LEN] = {0, };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&data, 0, sizeof(mmi_sms_write_msg_para_struct));

    data.string = NULL;
    data.stringlength = 0;
    data.dcs = SMSAL_UCS2_DCS;

    data.flag = MMI_SMS_ENTRY_WRITE_REPLY;
    mmi_ucs2_to_asc((S8*) to_str_ascii, (S8*) address);

    data.ascii_addr = (U8*) to_str_ascii;
    mmi_sms_write_msg_lanch(0, &data);
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_reset_settings_common_list_data
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_reset_settings_common_list_data(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_umms_app_ui_callback_reset_settings_common_list(); */
}

/**************** moved from datamager to ui plug_in******************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_viewer_objects
 * DESCRIPTION
 *  
 * PARAMETERS
 *  menu_id     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_save_viewer_objects(U16 menu_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_object_struct *image_info = NULL;
    mma_mms_object_struct *video_info = NULL;
    mma_mms_object_struct *audio_info = NULL;
    mma_mms_object_struct *text_info = NULL;
    mma_mms_object_struct *object_info = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_mms_viewer_get_objects_from_current_slide(&image_info, &video_info, &audio_info, &text_info);

    if (MENU_ID_UMMS_SAVE_OBJECT_OPTIONS_SAVE_TEXT_AS == menu_id)
    {
        if (NULL == text_info)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_EMPTY), MMI_EVENT_FAILURE);
            mmi_umms_app_if_show_display_popup_screen();
            return;
        }
        object_info = text_info;
    }

    else if (MENU_ID_UMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS == menu_id)
    {

        if (NULL == audio_info)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_EMPTY), MMI_EVENT_FAILURE);
            mmi_umms_app_if_show_display_popup_screen();
            return;
        }
        object_info = audio_info;
    }

    else if (MENU_ID_UMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS == menu_id)
    {
        if (NULL == video_info)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_EMPTY), MMI_EVENT_FAILURE);
            mmi_umms_app_if_show_display_popup_screen();
            return;
        }
        object_info = video_info;
    }

    else if (MENU_ID_UMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS == menu_id)
    {
        if (NULL == image_info)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_EMPTY), MMI_EVENT_FAILURE);
            mmi_umms_app_if_show_display_popup_screen();
            return;
        }
        object_info = image_info;
    }

#ifndef __MMI_MMS_WRAP_DRM_FL_CD__
    {
        ASSERT(object_info);
        if (object_info->drm_type == MMA_DRM_FL_CD)
        {
            mmi_umms_app_dtmgr_set_popup_screen_para(
                (U16*) GetString(STR_ID_UMMS_CORRUPT_DRM_MEDIA),
                MMI_EVENT_PROPLEM);
            mmi_umms_app_if_show_display_popup_screen();
            return;
        }

    }
#endif /* __MMI_MMS_WRAP_DRM_FL_CD__ */ 
    if (object_info != NULL)
    {
        mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_PLEASE_WAIT);
        mmi_umms_app_if_show_progress_screen();
        srv_mms_save_object(object_info, NULL);
    }
    else
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_ERROR), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_attachmant_data_in_mms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_save_attachmant_data_in_mms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_attachment_info_struct *attachment_list = NULL;
    mma_mms_object_struct *object_info = NULL;
    mma_mms_attachment_info_struct *temp = NULL;
    U32 num_attachment = 0;
    S32 count = 0;
    S32 attachment_list_hilighted_index = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_mms_viewer_get_attachment_list(&attachment_list, &num_attachment);

    attachment_list_hilighted_index = srv_mms_get_attachment_list_hilighted_item();
    if (attachment_list_hilighted_index > num_attachment)
    {
        return; /* should be a popup */
    }

    if (attachment_list != NULL)
    {
        temp = attachment_list;
        for (count = 0; count < attachment_list_hilighted_index; count++)
        {
            temp = temp->next;
        }
        object_info = temp->object;
    }
    else
    {
        return;
    }
    if (object_info != NULL)
    {
        mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_PLEASE_WAIT);
        mmi_umms_app_if_show_progress_screen();
        srv_mms_save_object(object_info, NULL);
    }
    else
    {
        mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_ERROR), MMI_EVENT_PROPLEM);
        mmi_umms_app_if_show_display_popup_screen();
    }
}

#if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) && !defined(__MMI_MMS_ONLY_MEMORY_CARD_STORAGE_SUPPORT__)


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_pref_storage_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_pref_storage_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
            mmi_usb_app_unavailable_popup(0);   /* pass 0 will show default string */
            return MMI_UMMS_FAIL;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 

    return MMI_UMMS_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_pref_storage_post_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_pref_storage_post_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_UMMS_TRUE;
}

#ifdef __MMI_MMS_MSG_STORAGE_FILTER_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_msg_filter_menu_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 *  scr_id          [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_msg_filter_menu_handling(mmi_event_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    cui_menu_event_struct *menu_evt = (cui_menu_event_struct*) evt;
    U8 flag[2];
    U8 msg_filter = 0x00;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_menu_get_checkbox_state(menu_evt->sender_id, flag);
    if(flag[0])
    {
        msg_filter = msg_filter | E_MSG_FILTER_PHONE;
    }
    if(flag[1])
    {
        msg_filter = msg_filter | E_MSG_FILTER_CARD;
    }

    srv_mms_set_msg_filter(msg_filter);

    return MMI_UMMS_TRUE;

}
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_pref_storage_menu_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  hilite_menu     [IN]        
 *  scr_id          [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_pref_storage_menu_handling(U16 hilite_menu, U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (hilite_menu)
    {
        case MENU_ID_UMMS_MMS_SETTINGS_PREFER_STORAGE_PHONE:
            //mmi_umms_app_dtmgr_set_progress_scrn_data(STR_ID_UMMS_MMS_PREFER_STORAGE, STR_GLOBAL_SAVING);
            //mmi_umms_app_if_show_progress_screen();
            srv_mms_set_prefered_storage((U8) E_PREFER_STORAGE_MODE_PHONE, MMI_FALSE);
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_SAVED), MMI_EVENT_EXPLICITLY_SAVED);
            mmi_umms_app_if_show_display_popup_screen();
            break;
        case MENU_ID_UMMS_MMS_SETTINGS_PREFER_STORAGE_CARD:
            if (FS_GetDevStatus(SRV_FMGR_CARD_DRV, FS_MOUNT_STATE_ENUM) != FS_NO_ERROR)
            {
                mmi_umms_app_dtmgr_set_popup_screen_para(
                    (U16*) GetString(STR_ID_UMMS_MMS_NO_MEM_CARD),
                    MMI_EVENT_FAILURE);
                mmi_umms_app_if_show_display_popup_screen();
                return MMI_UMMS_FALSE;
            }
            //mmi_umms_app_dtmgr_set_progress_scrn_data(STR_ID_UMMS_MMS_PREFER_STORAGE, STR_GLOBAL_SAVING);
            //mmi_umms_app_if_show_progress_screen();
            srv_mms_set_prefered_storage(E_PREFER_STORAGE_MODE_CARD, MMI_FALSE);
            mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(STR_GLOBAL_SAVED), MMI_EVENT_EXPLICITLY_SAVED);
            mmi_umms_app_if_show_display_popup_screen();
            break;
    }
    return MMI_UMMS_TRUE;

}

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_move_done
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_move_done(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_MOVING);
    mmi_umms_app_if_show_progress_screen();
    srv_mms_change_msg_storage(MMA_MMS_STORAGE_ACTION_MOVE_MMS, info->msg_info->msg_storage, info->msg_id);
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_copy_done
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_copy_done(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_set_progress_scrn_data(STR_MMS_MENUENTRY, STR_GLOBAL_COPYING);
    mmi_umms_app_if_show_progress_screen();
    srv_mms_change_msg_storage(MMA_MMS_STORAGE_ACTION_COPY_MMS, info->msg_info->msg_storage, info->msg_id);
}
#endif

#ifdef __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ 
/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_plug_in_download_in_other_memory
 * DESCRIPTION
 *  mmi_umms_app_plug_in_download_in_other_memory.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_plug_in_download_in_other_memory(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 current_secs_since_1970 = 0;
    U8 prefer_storage = 0;
    U32 time = 0;
    U8 changed_mode = 0;
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    prefer_storage = srv_mms_get_mms_prefer_storage();
    if (prefer_storage == MMA_MSG_STORAGE_PHONE)
    {
        changed_mode = E_PREFER_STORAGE_MODE_CARD;
    }
    if (prefer_storage == MMA_MSG_STORAGE_CARD1)
    {
        changed_mode = E_PREFER_STORAGE_MODE_PHONE;
    }
    srv_mms_set_prefered_storage(changed_mode, FALSE);  /* to change the prefer storage */
    current_secs_since_1970 = umms_get_current_utc_time();

    time =
        (info->msg_info->expiry_date - info->header_info->date) - (current_secs_since_1970 - info->header_info->date);

#ifndef __MMI_MMS_CALC_MSG_SIZE_BY_USER_ELEMENTS__
    mmi_umms_app_ui_plug_in_download_req(info->msg_id, time, info->msg_info->msg_size);
#else 
    mmi_umms_app_ui_plug_in_download_req(info->msg_id, time, info->msg_info->user_element_size);
#endif 

}
#endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_template_error_popup_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  result      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_template_error_popup_handling(S32 result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_set_popup_screen_para(
        (U16*) GetString(srv_fmgr_fs_error_get_string(result)),
        MMI_EVENT_PROPLEM);
    mmi_umms_app_if_show_display_popup_screen();
}

#if defined( __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__) && !defined(__MMI_MMS_ONLY_MEMORY_CARD_STORAGE_SUPPORT__)


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_get_prefer_storage_hilighted_index
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U8 mmi_umms_app_ui_plug_in_get_prefer_storage_hilighted_index(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return srv_mms_get_mms_prefer_storage_for_hilight();
}
#endif /* __MMI_MMS_MEMORY_CARD_STORAGE_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_app_ui_plug_in_network_changed_from_immd_to_deffered_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_app_ui_plug_in_network_changed_from_immd_to_deffered_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_sh_network_changed_from_immd_to_deffered_callback();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_and_update_signature_file_info
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_check_and_update_signature_file_info(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    BOOL need_update = FALSE;
	#if defined(__MMI_MMS_UMMS_VIDEO_FEATURE__) || defined(__MMI_MMS_UMMS_IMAGE_FEATURE__) || defined(__MMI_MMS_UMMS_AUDIO_FEATURE__)
    umms_inline_compose_items_struct *compose_settings_inline_items;
    srv_mms_nvram_compose_settings_struct *compose_nvram_srv_settings;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    compose_settings_inline_items =
        (umms_inline_compose_items_struct*) mmi_umms_app_dtmgr_get_current_compose_settings_list();

	compose_nvram_srv_settings = (srv_mms_nvram_compose_settings_struct*) srv_mms_get_nvram_compose_settings();

    #endif

    /* New */
#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        /* in mass storage mode */
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
        #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
            if (!mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_image_file))
            {
                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_image_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
            }
        #endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
        #ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
            if (!mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_video_file))
            {
                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_video_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;
            }
        #endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
        #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
            if (!mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_audio_file))
            {
                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_audio_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
            }
        #endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
            return;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 

    

#ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
    if (mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_image_file))
    {
		FS_HANDLE fh = 0;
        if (mmi_ucs2cmp(
                (S8*) compose_settings_inline_items->auto_signature_image_file,
                (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) != 0)
        {
            fh = FS_Open((U16*) compose_settings_inline_items->auto_signature_image_file, FS_READ_ONLY);
            if (fh < 0)
            {

                MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_IMAGE_NOT);

                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_image_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                memset(
                    compose_nvram_srv_settings->auto_signature_image_file,
                    0,
                    (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
                need_update = TRUE;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
            }
            else
            {
                compose_settings_inline_items->signature_flag |= UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
            }
            FS_Close(fh);
        }
    }
    else
    {
        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_image_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;

    }

#endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 

#ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
    if (mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_video_file))
    {
		FS_HANDLE fh = 0;
        if (mmi_ucs2cmp(
                (S8*) compose_settings_inline_items->auto_signature_video_file,
                (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) != 0)
        {
            fh = FS_Open((U16*) compose_settings_inline_items->auto_signature_video_file, FS_READ_ONLY);
            if (fh < 0)
            {
                MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_VIDEO_NOT);

                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_video_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                memset(
                    compose_nvram_srv_settings->auto_signature_video_file,
                    0,
                    (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
                need_update = TRUE;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;

            }
            else
            {
                compose_settings_inline_items->signature_flag |= UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;
            }
            FS_Close(fh);
        }
    }
    else
    {
        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_video_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;

    }
#endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 

#ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
    if (mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_audio_file))
    {
		FS_HANDLE fh = 0;
        if (mmi_ucs2cmp(
                (S8*) compose_settings_inline_items->auto_signature_audio_file,
                (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) != 0)
        {
            fh = FS_Open((U16*) compose_settings_inline_items->auto_signature_audio_file, FS_READ_ONLY);
            if (fh < 0)
            {
                MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_AUDIO_NOT);

                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_audio_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                memset(
                    compose_nvram_srv_settings->auto_signature_audio_file,
                    0,
                    (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
                need_update = TRUE;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_DAF_ADDED;
            }
            else
            {
                compose_settings_inline_items->signature_flag |= UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
            }
            FS_Close(fh);
        }

    }
    else
    {
        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_audio_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
    }

#endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 

    if (need_update)
    {
        srv_mms_write_nvram_compose_settings();
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        mmi_umms_app_dtmgr_send_set_settings_to_service(NULL);
#endif
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_and_update_signature_file_info_first
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_check_and_update_signature_file_info_first(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    BOOL need_update = FALSE;
	#if defined(__MMI_MMS_SIGNATURE__)
    umms_inline_compose_items_struct *compose_settings_inline_items;
    srv_mms_nvram_compose_settings_struct *compose_nvram_srv_settings;
    #endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	#if defined(__MMI_MMS_SIGNATURE__)
    compose_settings_inline_items =
        (umms_inline_compose_items_struct*) mmi_umms_app_dtmgr_get_compose_settings_inline_item_list(MMI_FALSE);
    #endif
    /* New */
#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        /* in mass storage mode */
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
        #ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
            if (!mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_image_file))
            {
                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_image_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
            }
        #endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
        #ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
            if (!mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_video_file))
            {
                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_video_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;
            }
        #endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
        #ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
            if (!mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_audio_file))
            {
                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_audio_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
            }
        #endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
            return;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 

	#if defined(__MMI_MMS_SIGNATURE__)
    compose_nvram_srv_settings = (srv_mms_nvram_compose_settings_struct*) srv_mms_get_nvram_compose_settings();
    #endif

#ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
    if (mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_image_file))
    {
		FS_HANDLE fh = 0;
        if (mmi_ucs2cmp(
                (S8*) compose_settings_inline_items->auto_signature_image_file,
                (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) != 0)
        {
            fh = FS_Open((U16*) compose_settings_inline_items->auto_signature_image_file, FS_READ_ONLY);
            if (fh < 0)
            {

                MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_IMAGE_NOT);

                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_image_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                memset(
                    compose_nvram_srv_settings->auto_signature_image_file,
                    0,
                    (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
                need_update = TRUE;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
            }
            else
            {
                compose_settings_inline_items->signature_flag |= UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
            }
            FS_Close(fh);
        }
    }
    else
    {
        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_image_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;

    }

#endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 

#ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
    if (mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_video_file))
    {
		FS_HANDLE fh = 0;
        if (mmi_ucs2cmp(
                (S8*) compose_settings_inline_items->auto_signature_video_file,
                (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) != 0)
        {
            fh = FS_Open((U16*) compose_settings_inline_items->auto_signature_video_file, FS_READ_ONLY);
            if (fh < 0)
            {
                MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_VIDEO_NOT);

                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_video_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                memset(
                    compose_nvram_srv_settings->auto_signature_video_file,
                    0,
                    (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
                need_update = TRUE;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;

            }
            else
            {
                compose_settings_inline_items->signature_flag |= UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;
            }
            FS_Close(fh);
        }
    }
    else
    {
        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_video_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;

    }
#endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 

#ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
    if (mmi_ucs2strlen((S8*) compose_settings_inline_items->auto_signature_audio_file))
    {
		FS_HANDLE fh = 0;
        if (mmi_ucs2cmp(
                (S8*) compose_settings_inline_items->auto_signature_audio_file,
                (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) != 0)
        {
            fh = FS_Open((U16*) compose_settings_inline_items->auto_signature_audio_file, FS_READ_ONLY);
            if (fh < 0)
            {
                MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_AUDIO_NOT);

                mmi_ucs2cpy(
                    (S8*) compose_settings_inline_items->auto_signature_audio_file,
                    (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
                memset(
                    compose_nvram_srv_settings->auto_signature_audio_file,
                    0,
                    (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
                need_update = TRUE;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
                compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_DAF_ADDED;
            }
            else
            {
                compose_settings_inline_items->signature_flag |= UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
            }
            FS_Close(fh);
        }

    }
    else
    {
        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_audio_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
    }

#endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
#ifdef __MMI_MMS_SIGNATURE__
    if ((compose_settings_inline_items->auto_signature == E_ON)
        &&
        (mmi_ucs2ncmp
         ((S8*) compose_settings_inline_items->auto_signature_content, "\0",
          UMMS_MAX_AUTO_SIGN_LENGTH * ENCODING_LENGTH) == 0)
#ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
        &&
        (mmi_ucs2cmp((S8*) compose_settings_inline_items->auto_signature_image_file,
                     (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) == 0)
#endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 
#ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
        &&
        (mmi_ucs2cmp((S8*) compose_settings_inline_items->auto_signature_audio_file,
                     (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) == 0)
#endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
#ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
        &&
        (mmi_ucs2cmp((S8*) compose_settings_inline_items->auto_signature_video_file,
                     (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA)) == 0)
#endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 
        )
    {

        compose_nvram_srv_settings->auto_signature = (U8) E_OFF;
        compose_settings_inline_items->auto_signature = (U8) E_OFF;

    }
#endif /* __MMI_MMS_SIGNATURE__ */ 
    if (need_update)
    {
        srv_mms_write_nvram_compose_settings();
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        mmi_umms_app_dtmgr_send_set_settings_to_service(NULL);
#endif
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_lsk_funct_pre_signature_restricted
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_lsk_funct_pre_signature_restricted(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    BOOL need_update = FALSE;
	#if defined(__MMI_MMS_UMMS_VIDEO_FEATURE__) || defined(__MMI_MMS_UMMS_IMAGE_FEATURE__) || defined(__MMI_MMS_UMMS_AUDIO_FEATURE__)
    umms_inline_compose_items_struct *compose_settings_inline_items;
    srv_mms_nvram_compose_settings_struct *compose_nvram_srv_settings;


    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    compose_settings_inline_items =
        (umms_inline_compose_items_struct*) mmi_umms_app_dtmgr_get_current_compose_settings_list();
    compose_nvram_srv_settings = (srv_mms_nvram_compose_settings_struct*) srv_mms_get_nvram_compose_settings();

	#endif

#ifdef __MMI_MMS_UMMS_VIDEO_FEATURE__
    if (compose_settings_inline_items->signature_flag & UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED)
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_VIDEO_NOT);

        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_video_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        memset(
            compose_nvram_srv_settings->auto_signature_video_file,
            0,
            (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
        need_update = TRUE;
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_VIDEO_ADDED;
    }
#endif /* __MMI_MMS_UMMS_VIDEO_FEATURE__ */ 

#ifdef __MMI_MMS_UMMS_IMAGE_FEATURE__
    if (compose_settings_inline_items->signature_flag & UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED)
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_IMAGE_NOT);

        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_image_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        memset(
            compose_nvram_srv_settings->auto_signature_image_file,
            0,
            (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
        need_update = TRUE;
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_IMAGE_ADDED;
    }
#endif /* __MMI_MMS_UMMS_IMAGE_FEATURE__ */ 

#ifdef __MMI_MMS_UMMS_AUDIO_FEATURE__
    if (compose_settings_inline_items->signature_flag & UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED)
    {
        MMI_TRACE(MMI_INET_TRC_G6_MMS, MMI_UMMS_PS_SETTING_AUDIO_NOT);

        mmi_ucs2cpy(
            (S8*) compose_settings_inline_items->auto_signature_audio_file,
            (S8*) GetString(STR_ID_UMMS_SIGNATURE_SELECT_MEDIA));
        memset(
            compose_nvram_srv_settings->auto_signature_audio_file,
            0,
            (MMA_MAX_EXTERNAL_FILE_PATH_LEN + 1) * ENCODING_LENGTH);
        need_update = TRUE;
        compose_settings_inline_items->signature_flag &= ~UMMS_COMPOSE_SIGNATURE_AUDIO_ADDED;
    }
#endif /* __MMI_MMS_UMMS_AUDIO_FEATURE__ */ 
    if (need_update)
    {
        mmi_umms_app_dtmgr_set_change_in_compose_signature(E_ON);
    }
    mmi_umms_app_if_show_compose_signature_settings_menu();
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_CONFIRM);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_rsk_funct_pre_signature_restricted
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_rsk_funct_pre_signature_restricted(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_if_show_compose_signature_settings_menu();
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_CONFIRM);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_lsk_funct_pre_signature_warning
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_lsk_funct_pre_signature_warning(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_if_show_compose_signature_settings_menu();
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_CONFIRM);
}

#if defined(__MMI_OP11_HOMESCREEN__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined(__MMI_OP11_HOMESCREEN__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_hangup_calls
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_hangup_calls(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_ucm_act_request(SRV_UCM_END_ALL_ACT, NULL, NULL, NULL);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_save_object_error_handling
 * DESCRIPTION
 *  
 * PARAMETERS
 *  evt     [?]     
 * RETURNS
 *  
 *****************************************************************************/
MMI_RET mmi_umms_app_ui_plug_in_save_object_error_handling(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_save_object_event_data_struct *data = (srv_mms_save_object_event_data_struct*) evt->user_data;
    U16 error_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    error_id = data->error_id;
    mmi_umms_app_dtmgr_set_popup_screen_para((U16*) GetString(error_id), MMI_EVENT_PROPLEM);
    mmi_umms_app_if_show_display_popup_screen();
    mmi_umms_app_sh_delete_progress_screen();

	return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_show_progress_screen_with_no_history
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_plug_in_show_progress_screen_with_no_history(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_display_progress_screen_with_no_history();
}



/*****************************************************************************
 * FUNCTION
 *  mmi_umms_ui_plug_in_read_report_cancel_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_ui_plug_in_read_report_cancel_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_dtmgr_option_scr_data_struct *info =
        (mmi_umms_app_dtmgr_option_scr_data_struct*)
        mmi_umms_app_dtmgr_get_data(MMI_UMMS_APP_DTMGR_REQ_MSG_AND_HEADER_INFO);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(info);
    info->msg_info->need_read_report = KAL_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_progress_is_active
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_BOOL mmi_umms_app_ui_plug_in_check_progress_is_active(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_get_active_id() == SCR_ID_UMMS_PROGRESS)
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_check_and_delete_progress_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  evt     [?]     
 * RETURNS
 *  
 *****************************************************************************/
MMI_RET mmi_umms_app_ui_plug_in_check_and_delete_progress_screen(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_close(mmi_umms_dtmgr_get_group_id(), SCR_ID_UMMS_PROGRESS);
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_callback_retrieval_settings_item_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  grp_id      [IN]        
 *  flag(?)     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_app_ui_callback_retrieval_settings_item_list(U16 grp_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    umms_inline_retrieval_items_struct *retrieval_settings_inline_items;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    retrieval_settings_inline_items =
        (umms_inline_retrieval_items_struct*) mmi_umms_app_dtmgr_get_retrieval_settings_inline_item_list(0);

#ifdef __MMI_MMS_2_RETRIVAL_MODE_SETTING__

    if (srv_nw_info_is_roaming(MMI_SIM1) == FALSE)
    {
        cui_inline_delete_item(grp_id, E_RETRIEVAL_ROAMING_CAPTION);
        cui_inline_delete_item(grp_id, E_RETRIEVAL_ROAMING);

        cui_inline_set_value(grp_id, E_RETRIEVAL_HOME_NETWORK, (void*)(retrieval_settings_inline_items->home_network));
    }
    else
    {
        cui_inline_set_value(grp_id, E_RETRIEVAL_HOME_NETWORK, (void*)(retrieval_settings_inline_items->home_network));
        cui_inline_set_value(grp_id, E_RETRIEVAL_ROAMING, (void*)(retrieval_settings_inline_items->roaming));
    }
#else /* __MMI_MMS_2_RETRIVAL_MODE_SETTING__ */ 
    cui_inline_set_value(grp_id, E_RETRIEVAL_HOME_NETWORK, (void*)(retrieval_settings_inline_items->home_network));
    cui_inline_set_value(grp_id, E_RETRIEVAL_ROAMING, (void*)(retrieval_settings_inline_items->roaming));
#endif /* __MMI_MMS_2_RETRIVAL_MODE_SETTING__ */ 

    cui_inline_set_value(grp_id, E_RETRIEVAL_READ_REPORT, (void*)(retrieval_settings_inline_items->read_report));
    cui_inline_set_value(
        grp_id,
        E_RETRIEVAL_DELIVERY_REPORT,
        (void*)(retrieval_settings_inline_items->delivery_report));
}

#ifdef __MMI_MMS_REPORT_STATUS_MENU_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_app_ui_plug_in_dr_rr_status_pre_func
 * DESCRIPTION
 *  
 * PARAMETERS
 *  scr_id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
MMI_UMMS_ERROR mmi_umms_app_ui_plug_in_dr_rr_status_pre_func(U16 scr_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_umms_app_ui_draw_property_screen_struct *property_screen;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __USB_IN_NORMAL_MODE__
    if (srv_usb_is_in_mass_storage_mode())
    {
        if (srv_usb_check_path_exported((WCHAR*) L"root"))
        {
            mmi_usb_app_unavailable_popup(0);   /* pass 0 will show default string */
            return MMI_UMMS_FAIL;
        }
    }
#endif /* __USB_IN_NORMAL_MODE__ */ 

    property_screen = (mmi_umms_app_ui_draw_property_screen_struct*) mmi_umms_app_sh_get_scr_context(scr_id);

    if (property_screen == NULL)
    {
        property_screen =
            (mmi_umms_app_ui_draw_property_screen_struct*)
            srv_mms_mem_mgr_app_adm_alloc(sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        ASSERT(property_screen);
        memset(property_screen, 0, sizeof(mmi_umms_app_ui_draw_property_screen_struct));
        property_screen->scrn_id = scr_id;
        property_screen->get_string_buffer = mmi_umms_app_ui_callback_dr_rr_status_get_data;
        property_screen->scrDB = mmi_umms_app_resource_get_screenDB(scr_id);

        mmi_umms_app_sh_set_screen_context(scr_id, (void*)property_screen);

        return MMI_UMMS_TRUE;
    }
    return MMI_UMMS_FALSE;  /* From history  */
}
#endif /* __MMI_MMS_REPORT_STATUS_MENU_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_fmgr_to_mms_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  item_id         [IN]        
 *  filepath        [IN]        
 *  fileinfo        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_fmgr_to_mms_hdlr(mmi_menu_id item_id, const WCHAR *filepath, const srv_fmgr_fileinfo_struct *fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mms_content_insert_hdlr((S8*) filepath);
}

#ifdef __MMI_MMS_POSTCARD__


/*****************************************************************************
 * FUNCTION
 *  mmi_umms_fmgr_to_mms_postcard_hndlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  item_id         [IN]        
 *  filepath        [IN]        
 *  fileinfo        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_umms_fmgr_to_mms_postcard_hndlr(
        mmi_menu_id item_id,
        const WCHAR *filepath,
        const srv_fmgr_fileinfo_struct *fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mms_content_entry_struct data = {0};

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data.file_path = (S8*) OslMalloc((SRV_FMGR_PATH_MAX_LEN + 1) * ENCODING_LENGTH);
    memcpy(data.file_path, filepath, ((SRV_FMGR_PATH_MAX_LEN + 1) * ENCODING_LENGTH));

    data.msg_type = MMS_MSG_TYPE_POSTCARD;
    mms_general_insert_hdlr(&data);
    OslMfree(data.file_path);
}
#endif /* __MMI_MMS_POSTCARD__ */ 

#ifdef __MMI_OP11_MMS_SEND_TO_PHOTO_BLOG__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_OP11_MMS_SEND_TO_PHOTO_BLOG__ */ 

#endif /* __MMI_MMS_2__ */ 

