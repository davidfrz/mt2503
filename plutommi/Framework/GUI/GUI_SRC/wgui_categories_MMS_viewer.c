/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 *  wgui_categories_MMS_viewer.c
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *  MMS Viewer Related Categories 
 *
 *
 * Author: Sukrit K Mehra (PMT0050)
 * -------
 * -------
 * 
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
#include "MMI_features.h"
#ifdef __UI_MMS_VIEWER_CATEGORY__
#include "StdC.h"
#include "mmi_platform.h"
#include "mmi_frm_gprot.h"
#include "MmsXMLDefSrv.h"
#include "WguiCategoryGprot.h"
#include "wgui_categories_mms_viewer_int.h"
#include "Fs_type.h"    /* Drm_def.h needs this */
#include "Fs_func.h"
#include "Fs_errcode.h" /* File Err Code */
#include "Conversions.h"
#include "FileMgr.h"
#include "FileManagerGProt.h"
#include "mmi_rp_app_uiframework_def.h"
/* Audio/Video */
#include "Device.h" 
#include "mdi_datatype.h"
#include "Mdi_video.h"
#include "Mdi_audio.h"

//#include "ProfileGprots.h"
#include "ProfilesSrvGprot.h"
#include "wgui_softkeys.h"

#include "GlobalDefs.h"
#include "Lcd_if.h"
#include "GpioSrvGprot.h"
#include "PhoneSetupGprots.h"

#include "gui_scrollbars.h"

#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__)
#include "mmi_frm_gestures.h"
#endif

#include "MMIDataType.h"
#include "kal_general_types.h"
#include "gdi_const.h"
#include "gui_data_types.h"
#include "gdi_datatype.h"
#include "gui_inputs.h"
#include "wgui_categories_MMS_viewer.h"
#include "wgui_inputs.h"
#include "CustThemesRes.h"
#include "mmi_rp_app_uiframework_def.h"
#include "gdi_include.h"
#include "gui.h"
#include "gui_themes.h"
#include "wgui_draw_manager.h"
#include "wgui.h"
#include "string.h"
#include "FileMgrType.h"
#include "FileMgrGProt.h"
#include "FileMgrType.h"
#include "wgui_categories_multimedia.h"
#include "Unicodexdcl.h"
#include "CustDataRes.h"
#include "PixcomFontEngine.h"
#include "lcd_sw_inc.h"
#include "kal_public_api.h"
#include "gui_typedef.h"
#include "Gui_Setting.h"
#include "gui_switch.h"
#include "GlobalConstants.h"
#include "mmi_frm_input_gprot.h"
#include "wgui_categories_util.h"
#include "wgui_include.h"
#include "GlobalResDef.h"
#include "wgui_touch_screen.h"
#include "ImeGprot.h"
#include "GpioSrvGprot.h"
#include "DebugInitDef_Int.h"
#include "mmi_frm_events_gprot.h"
#include "wgui_categories_enum.h"
#include "mdi_include.h"

#include "gui_inputs_internal.h"

#define MMS_VIEWER_DIFFERENT_FONTS
#define WGUI_MV_MIN_TEXT_WIDTH  35
#define left_image_X            25
#define right_image_Y           30
#define slide_number            10

#ifndef __UI_PAGING_IN_MULTILINE_EDITOR__
#define GUI_PAGE_SIZE 512
#endif

U8 g_pressed = 0;
MMI_BOOL g_wgui_mv_scrolling_start = MMI_FALSE;
MMI_BOOL g_temp=MMI_FALSE;
MMI_BOOL is_slide_switching = MMI_FALSE;
 /*WGUI_MV_USED_BY_ENUM*/ U8  g_wgui_mv_used_by=0;

/* Utility Functions */

static MMI_BOOL wgui_mv_set_drawable_object_region(void);

static void wgui_mv_convert_from_gdi_color_to_color(color *out_color, GDI_COLOR incolor_32);
static void wgui_mv_error_condition(void);
static void wgui_mv_media_stopped_callback(mdi_result result, void *user_data);
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static void wgui_mv_refresh_hilite_list_all(void);
static void wgui_mv_refresh_hilite_list(HILITE_STR *list, S32 max_items, srv_mms_viewer_use_details_list *highlighted_item);
#endif
/* Paging Related Functions */
static void wgui_mv_load_paging_data(U32 start_id, U32 end_id, PU8 buffer_local);

#ifdef __MMI_TOUCH_SCREEN__
#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
extern void wgui_paging_multiline_set_scroll_data_cb(get_data_during_scrolling_cb data_callback);
#endif
static void wgui_mv_get_data_during_scrolling(S32 percentage_val, PU8 buffer_local);
#endif 

extern multi_line_input_box MMI_multiline_inputbox; // __NO__NO__UI_PAGING_IN_MULTILINE_EDITOR__ 

/* Draw Related Functions */
static MMI_BOOL wgui_mv_show_drm_icon(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static MMI_BOOL wgui_mv_show_image(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static MMI_BOOL wgui_mv_show_video(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static void wgui_mv_show_media(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static MMI_BOOL wgui_mv_show_alternative_text(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static void wgui_mv_drawable_media_hide(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static void wgui_mv_drawable_media_play(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static void wgui_mv_drawable_media_show_stopped(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static void wgui_mv_drawable_media_scroll(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);
static void wgui_mv_drawable_media_dummy(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2);

static void wgui_mv_show_drawable_object(
                MMI_BOOL is_draw,
                S32 yoffset,
                S32 height,
                S32 clip_x1,
                S32 clip_y1,
                S32 clip_x2,
                S32 clip_y2);
static void wgui_mv_show_infobar(void);
static void wgui_mv_show_viewarea(void);
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
static void wgui_mv_show_progressbar(void);
#endif
static void wgui_mv_draw_viewer(void);

/* layout Related Functions */
static void wgui_mv_setup_screen_layout(void);
static void wgui_mv_set_multiline_object_viewable_area(void);

/* State Machine Implemenatation Functions */
static void wgui_mv_init_slide(void);
static void wgui_mv_deinit_slide(void);
static void wgui_mv_exit_category(void);

static void wgui_mv_pause_slide(void);
static void wgui_mv_resume_slide(void);

static void wgui_mv_start_show(void);
static void wgui_mv_start_play(void);
static void wgui_mv_prepare_for_show(void);
static void wgui_mv_stop_slide_playing(void);
static void wgui_mv_pause_slide_playing(void);
static void wgui_mv_resume_slide_pausing(void);

static void wgui_mv_play_show_active_slide(void);
static void wgui_mv_play_active_slide(void);

static void wgui_mv_set_next_slide_active(void);
static void wgui_mv_set_previous_slide_active(void);

/* Event Handlers Functions */
static void wgui_mv_smc_event_handler(const wgui_mv_event_enum event);
static void wgui_mv_handle_timer_event(void);
static void wgui_mv_switch_slide_with_time_gap(void);

extern void wgui_multiline_inputbox_hide_text_content(MMI_BOOL hide);
static void wgui_mv_reset_image_data_for_clean_image(wgui_mv_image_decode_status_enum);
static void wgui_mv_start_clean_image_show(void);
/* Globals Variables */
static U16 attachment_state = WGUI_MV_BUTTON_RELEASED_STATE;
static U16 full_state = WGUI_MV_BUTTON_RELEASED_STATE;

static U16 g_wgui_mv_drawable_media_vf[WGUI_MV_VFN_LEN];
static U16 g_wgui_mv_drawable_media_vf_ext[WGUI_MV_VFN_LEN];
static U16 g_wgui_mv_audio_vf[WGUI_MV_VFN_LEN];
static S32 g_wgui_mv_audio_file_handle;
static S32 g_wgui_mv_drawable_media_file_handle;

static wgui_mv_context_struct g_wgui_mv_cat_cntx;       /* memset from showcategory function */
static wgui_mv_layout_struct g_wgui_mv_cat_layout;      /* memset from showcategory function */
static wgui_mv_paging_context g_wgui_mv_paging_cntx;    /* memset from showcategory function */

static wgui_mv_image_point g_wgui_mv_image_point;
static wgui_mv_video_point g_wgui_mv_video_point;


static kal_uint32 g_wgui_mv_last_tick = 0;              /* record last tick for timer calibration */

static srv_prof_volume_level g_wgui_mv_volume;          /* volume for playing audio / video */
static MMI_BOOL g_wgui_mv_suspend_bg_audio;             /* record whether suspend the background audio */
static wgui_mv_audio_state_enum g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_INIT;   /* keep state of current audio is pausable */
static MMI_BOOL g_wgui_mv_is_media_end = MMI_FALSE;     /* check whether media is pleyed to end */
static MMI_BOOL g_wgui_mv_is_media_valid = MMI_TRUE;    /* check whether media is valid or not */
static MMI_BOOL g_wgui_mv_is_media_paused = MMI_FALSE;  /* check whether media is paused */

static MMI_BOOL g_wgui_mv_disable_backlight = MMI_FALSE;/* record whether disable the backlight */

static HILITE_STR g_wgui_mv_hilite_list[WGUI_MV_MAX_HILITE_NUMBER] = {0};                           /* hilite list to multiline inputbox */
static HILITE_STR_FORMAT g_wgui_mv_hilite_format_list[WGUI_MV_MAX_HILITE_NUMBER] = {0};             /* hilite format list to multiline inputbox */
static srv_mms_viewer_use_details_list* g_wgui_mv_hilite_list_idx_map[WGUI_MV_MAX_HILITE_NUMBER] = {0};    /* mapping from index to highlighted item */
static MMI_BOOL g_wgui_mv_hilite_cb_from_goto = MMI_FALSE;                                          /* record whether entering hilite callback from gui_multi_line_input_box_go_to_hilite */

static void wgui_mv_get_msg_size(U16* str);

static UI_filled_area g_wgui_mv_loading_bg_filler = {0};

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ 
static U16 g_wgui_mv_default_image_id = WGUI_DEFAULT_PREVIEW_IMAGE_ID;
#else
static U16 g_wgui_mv_default_image_id = 0;
#endif
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
extern mdi_video_info_struct wgui_video_info;
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) */

#if defined(__MMI_FTE_SUPPORT__)
static wgui_mv_clip_struct g_wgui_mv_bounding_rect = {0};
static gdi_color wgui_mv_convert_from_gdi_color_to_gdi_act_color(GDI_COLOR incolor_32);
#endif
/* This is the state machine for drawable media - image & video, 
 * see wgui_mv_drawable_media_state_enum & wgui_mv_drawable_media_event_enum */
static const wgui_mv_drawable_media_cb
    drawable_media_cb[WGUI_MV_DRAWABLE_MEDIA_EVENT_MAX][WGUI_MV_DRAWABLE_MEDIA_STATE_MAX] = 
{
    /* STATE_HIDDEN, STATE_PLAYING,    STATE_SHOWING, STATE_SROLLING */
    {wgui_mv_drawable_media_dummy, wgui_mv_drawable_media_hide, wgui_mv_drawable_media_hide,
     wgui_mv_drawable_media_hide}, /* HIDE EVENT */
    {wgui_mv_drawable_media_play, wgui_mv_drawable_media_dummy, wgui_mv_drawable_media_play,
     wgui_mv_drawable_media_play}, /* PLAY EVENT */
    {wgui_mv_drawable_media_show_stopped, wgui_mv_drawable_media_show_stopped, wgui_mv_drawable_media_show_stopped,
     wgui_mv_drawable_media_show_stopped}, /* SHOW EVENT */
    {wgui_mv_drawable_media_hide, wgui_mv_drawable_media_scroll, wgui_mv_drawable_media_scroll,
     wgui_mv_drawable_media_scroll}, /* SCROLL EVENT */
    {wgui_mv_drawable_media_dummy, wgui_mv_drawable_media_play, wgui_mv_drawable_media_show_stopped,
    wgui_mv_drawable_media_dummy,} /* REDRAW EVENT */
};

 kal_uint32 g_last_tick = 0; 

//#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_hide_icon_bar
 * DESCRIPTION
 *  hide icon bar
 * PARAMETERS
 *  x1      [IN]
 *  y1      [IN]
 *  x2      [IN]
 *  y2      [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_hide_icon_bar(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = *((g_wgui_mv_cat_cntx.current_msg).current_slide);
    color tc;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (CURRENT_SLIDE->txt.id != 0 && CURRENT_SLIDE->txt.str_id == 0)    
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (CURRENT_SLIDE->txt.bg_color) << 8);
    }
    else
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
    }
    /*framework enhancement*/
    gdi_layer_push_and_set_clip(x1, y1, x2, y2);
    gui_fill_rectangle(x1, y1, x2, y2, tc);
    gdi_layer_pop_clip();
}

//#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_media_position
 * DESCRIPTION
 *  sets media positions
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_set_media_position(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 preview_x = 0, preview_y = 0, preview_width = 0, preview_height = 0;
    S32 img_width, img_height;
    U16 drm_id = 0;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    mma_mms_object_area_struct *area = NULL;
    MMI_BOOL ret = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/   
    preview_width = g_wgui_mv_cat_layout.viewarea.s16Width - current_MMI_theme->scrollbar_size - (CAT630_HMARGIN << 1);
    if ((g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_LEFT) ||
        (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT))
    {
        preview_width -= WGUI_MV_MIN_TEXT_WIDTH;    /* to make sure we can display at least several text per line */
    }
    preview_height = g_wgui_mv_cat_layout.viewarea.s16Height - (CAT630_VMARGIN << 1);

    /* start x position of the maximum preview area */
    if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT)
    {
        preview_x = WGUI_MV_MIN_TEXT_WIDTH;
    }
    preview_x += CAT630_HMARGIN;
    preview_x += (mmi_fe_get_r2l_state()) ? (current_MMI_theme->scrollbar_size) : (0);
    preview_y = CAT630_VMARGIN;

    /* get user-specified media area */
	#ifdef __MMI_MMS_MV_SUPPORT_PARAM_OF_REGION__
    area = (CURRENT_SLIDE->vid.id) ? (CURRENT_SLIDE->vid.region_area) : (area);
    area = (CURRENT_SLIDE->img.id) ? (CURRENT_SLIDE->img.region_area) : (area);
   #endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /* adjust preview area according to user-specified area */
    if (area != NULL)
    {
        S32 user_x = 0, user_y = 0, user_w = 0, user_h = 0;

        user_x = (S32)area->x.value;
        user_y = (S32)area->y.value;
        user_w = (S32)area->w.value;
        user_h = (S32)area->h.value;

        /* boundary check */
        user_w = (user_w <= 0) ? (1) : (user_w);
        user_h = (user_h <= 0) ? (1) : (user_h);
        user_w = (user_w > preview_width) ? (preview_width) : (user_w);
        user_h = (user_h > preview_height) ? (preview_height) : (user_h);

        if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT)
        {
            user_x = (user_x < WGUI_MV_MIN_TEXT_WIDTH) ? (WGUI_MV_MIN_TEXT_WIDTH) : (user_x);
            user_x -= WGUI_MV_MIN_TEXT_WIDTH;
        }

        if ((user_x + user_w) > preview_width)
        {
            user_x = preview_width - user_w;
        }

        /* re-locate preview area for y position */
        if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_BOTTOM)
        {
            /* put the media right under the text, ignoring y position adjustment */
            user_y = 0;
        }
        else
        {
            if (user_y + user_h > preview_height)
            {
                user_y = preview_height - user_h;
            }
        }

        /* reset preview area */
        preview_x += user_x;
        preview_y += user_y;
        preview_width = user_w;
        preview_height = user_h;
    }
    else
  #endif
    {
        /* if area == NULL, the maximum image width is half of the screen width for landscape mode */

        if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT)
        {
            preview_x += preview_width - (MMI_content_width >> 1);
        }

        if ((g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_LEFT) ||
            (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT))
        {
            preview_width = (MMI_content_width >> 1);
        }
    }

    g_wgui_mv_cat_layout.resized_xoffset = 0;
    g_wgui_mv_cat_layout.resized_yoffset = 0;
    g_wgui_mv_cat_layout.resized_width = 0;
    g_wgui_mv_cat_layout.resized_height = 0;

    /* DRM check */
#ifdef __DRM_SUPPORT__
    if (CURRENT_SLIDE->vid.id)
    {
        if (MMI_TRUE == g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->vid))
        {
            drm_id = WGUI_MV_DRM_VIDEO_LOCK_ID;
        }
    }
    else if (CURRENT_SLIDE->img.id)
    {
        if (MMI_TRUE == g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->img))
        {
            drm_id = WGUI_MV_DRM_IMAGE_LOCK_ID;
        }
    }
#endif /* __DRM_SUPPORT__ */

    /* file check */
    if (drm_id != 0)
    {
        if (gdi_image_get_dimension_id(
                    drm_id, &img_width, &img_height) < GDI_SUCCEED)
        {
            ret = MMI_FALSE;
        }
    }
	
    else if (CURRENT_SLIDE->vid.id)
    {
		#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        /* allow video only with audio */
        mdi_video_ply_enable_aud_only_video_clip();

        memset(&wgui_video_info, 0, sizeof(mdi_video_info_struct));
        /* This function doesn't consume any rights */
        if (mdi_video_ply_open_clip_file(0, 
                    (S8*)g_wgui_mv_cat_cntx.drawable_media_file_path,
                    &wgui_video_info) == MDI_RES_VDOPLY_SUCCEED)
        {
            img_height = wgui_video_info.height;
            img_width = wgui_video_info.width;

            /* Check for vdo play successful or not (due to limitation on MDI on different chips) */
            if(img_width && img_height)
            {
                gdi_handle temp_layer = 0;
                S32 tx = 0, ty = 0, tw = img_width, th = img_height;

                if ((preview_width < img_width) || (preview_height < img_height))
                {
                    /* resize image */
                    gdi_image_util_fit_bbox(
                        preview_width,
                        preview_height,
                        img_width,
                        img_height,
                        &tx,
                        &ty,
                        &tw,
                        &th);
                }
                wgui_catvdo_refine_video_coordinate(
                    &tx,
                    &ty,
                    &tw,
                    &th);

                if(tw && th)
                {
                    gdi_layer_create(0, 0, tw, th, &temp_layer);
                }
                
                if(!temp_layer)
                {
                    ret = MMI_FALSE;
                }
                else if(mdi_video_ply_seek_and_get_frame(0, temp_layer) < MDI_RES_VDOPLY_SUCCEED)
                {
                    ret = MMI_FALSE;
                }
                gdi_layer_free(temp_layer);
            }

            if (ret && wgui_video_info.track == MDI_VIDEO_TRACK_A_ONLY)
            {
                g_wgui_mv_default_image_id = WGUI_DEFAULT_PREVIEW_AVIDEO_ID;
                gdi_image_get_dimension_id(g_wgui_mv_default_image_id, &img_width, &img_height);
            }
            mdi_video_ply_close_clip_file();
			
             }
        else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */ 
#endif	 
        {
			  #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            ret = MMI_FALSE;
            #else 
          ret = MMI_TRUE;
             #endif
        }
    }
 
    else if (CURRENT_SLIDE->img.id)
    {
        PS8 err_str_ptr;

        do
        {
/* Hotfix for COSMOS projec build error. Need to remove later when this file is excluded from COSMOS project's lis. */
			if(g_wgui_mv_cat_cntx.is_image_decoded == MMI_FALSE)
			{
#ifndef __COSMOS_MMI__
            if (!mmi_fmgr_util_file_limit_check(FMGR_LIMIT_MMS_CATEGORY, (S8*)g_wgui_mv_cat_cntx.drawable_media_file_path, (PS8*)&err_str_ptr))
            {
                ret = MMI_FALSE;
                break;
            }
#endif
            if (gdi_image_check_image_file_valid((S8*)g_wgui_mv_cat_cntx.drawable_media_file_path) == MMI_FALSE)
            {
                ret = MMI_FALSE;
                break;
            }
			}

            if (gdi_image_get_dimension_file(
                        (S8*)g_wgui_mv_cat_cntx.drawable_media_file_path,
                        &img_width, &img_height) < GDI_SUCCEED)
            {
                ret = MMI_FALSE;
                break;
            }
        } while (0);
    }
    else
    {
        ret = MMI_FALSE;
    }

    if (drm_id != 0 || ret == MMI_FALSE)
    {
        g_wgui_mv_is_media_valid = MMI_FALSE;
    }

    if (ret == MMI_FALSE)
    {
        gdi_image_get_dimension_id(g_wgui_mv_default_image_id, &img_width, &img_height);
    }
	#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
	if(CURRENT_SLIDE->vid.id)
	{
		img_height=MMI_content_width/4;
		img_width=MMI_content_width/4;
	}
	else

      #endif
	{
		img_width = (img_width == 0) ? (1) : (img_width);
		img_height = (img_height == 0) ? (1) : (img_height);
	}
	

    /* drawable region larger than image */
    if ((preview_width > img_width) && (preview_height > img_height))
    {
        /* align image at the center */
        if (area != NULL)
        {
            g_wgui_mv_cat_layout.resized_xoffset = 0;
        }
        else if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_LEFT)
        {
            g_wgui_mv_cat_layout.resized_xoffset = 0;
        }
        else if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT)
        {
            g_wgui_mv_cat_layout.resized_xoffset = preview_width - img_width;
        }
        else
        {
            g_wgui_mv_cat_layout.resized_xoffset = ((preview_width - img_width) >> 1);
        }
        g_wgui_mv_cat_layout.resized_width = img_width;
        g_wgui_mv_cat_layout.resized_height = img_height;
    }
    else
    {
        /* set height */
        if (preview_height > img_height)
        {
            preview_height = img_height;
        }

        /* resize image */
        gdi_image_util_fit_bbox(
            preview_width,
            preview_height,
            img_width,
            img_height,
            &g_wgui_mv_cat_layout.resized_xoffset,
            &g_wgui_mv_cat_layout.resized_yoffset,
            &g_wgui_mv_cat_layout.resized_width,
            &g_wgui_mv_cat_layout.resized_height);

        if (area != NULL)
        {
            g_wgui_mv_cat_layout.resized_xoffset = 0;
        }
        else if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_LEFT)
        {
            g_wgui_mv_cat_layout.resized_xoffset = 0;
        }
        else if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT)
        {
            g_wgui_mv_cat_layout.resized_xoffset = preview_width - g_wgui_mv_cat_layout.resized_width;
        }

        /* check resized width and height */
        if (g_wgui_mv_cat_layout.resized_width == 0)
        {
            g_wgui_mv_cat_layout.resized_width = 1;
        }
        if (g_wgui_mv_cat_layout.resized_height == 0)
        {
            g_wgui_mv_cat_layout.resized_height = 1;
        }
    }

    g_wgui_mv_cat_layout.resized_xoffset += preview_x;
    g_wgui_mv_cat_layout.resized_yoffset = preview_y;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
    /* due to hardware limitation, align xoffset to be even */
    if ((ret == MMI_TRUE) && (CURRENT_SLIDE->vid.id))
    {
        wgui_catvdo_refine_video_coordinate(
            &g_wgui_mv_cat_layout.resized_xoffset,
            &g_wgui_mv_cat_layout.resized_yoffset,
            &g_wgui_mv_cat_layout.resized_width,
            &g_wgui_mv_cat_layout.resized_height);
    }
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) */
#endif/* defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__) */

    return ret;
}

 void wgui_mv_update_info_ext(void)
{
    wgui_mv_show_infobar();
}

/* Utility Functions */


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_drawable_object_region
 * DESCRIPTION
 *  sizes in wgui_mv_show_drawable_object depend on this functions return value
 * PARAMETERS
 *  void
 * RETURNS
 *  true or false
 *****************************************************************************/
static MMI_BOOL wgui_mv_set_drawable_object_region(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#if defined(__MMI_FTE_SUPPORT__)
    gdi_color mms_bg_color; 
#endif
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (wgui_mv_set_media_position() == MMI_TRUE)
    {
		#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        if (CURRENT_SLIDE->vid.id)
        {
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
            gdi_layer_create(0, 0, g_wgui_mv_cat_layout.resized_width, g_wgui_mv_cat_layout.resized_height, &g_wgui_mv_cat_layout.vlayer);
            gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);
#if defined(__MMI_FTE_SUPPORT__)
            mms_bg_color = wgui_mv_convert_from_gdi_color_to_gdi_act_color((g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
            gdi_layer_clear_background(mms_bg_color);
            gdi_layer_set_source_key(FALSE, GDI_COLOR_TRANSPARENT);
            gdi_layer_set_opacity(FALSE, 255);
#else
            gdi_layer_clear_background(GDI_COLOR_TRANSPARENT);
            gdi_layer_set_source_key(TRUE, GDI_COLOR_TRANSPARENT);
#endif
            gdi_layer_pop_and_restore_active();
#endif 
        }

		#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
		return MMI_TRUE;

    }
    else
    {
        return MMI_FALSE;
    }

}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_convert_from_gdi_color_to_gdi_act_color
 * DESCRIPTION
 *  convert from GDI to UI Color
 * PARAMETERS
  *  incolor_32      [IN]        
 * RETURNS
 *  gdi_color
 *****************************************************************************/
static gdi_color wgui_mv_convert_from_gdi_color_to_gdi_act_color(GDI_COLOR incolor_32)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    color out_color;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    out_color.r = (U8) ((0xFF000000 & incolor_32) >> 24);
    out_color.g = (U8) ((0x00FF0000 & incolor_32) >> 16);
    out_color.b = (U8) ((0x0000FF00 & incolor_32) >> 8);
    out_color.alpha = (U8) ((0x000000FF & incolor_32));

    return gdi_act_color_from_rgb(out_color.alpha, out_color.r, out_color.g, out_color.b);
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_convert_from_gdi_color_to_color
 * DESCRIPTION
 *  convert from GDI to UI Color
 * PARAMETERS
 *  out_color       [?]         
 *  incolor_32      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_convert_from_gdi_color_to_color(color *out_color, GDI_COLOR incolor_32)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    out_color->r = (U8) ((0xFF000000 & incolor_32) >> 24);
    out_color->g = (U8) ((0x00FF0000 & incolor_32) >> 16);
    out_color->b = (U8) ((0x0000FF00 & incolor_32) >> 8);
    out_color->alpha = (U8) ((0x000000FF & incolor_32));
}

static gdi_color wgui_mv_convert_from_gdi_color_to_transparent_color()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
     color temp ;
	 gdi_color wgui_mv_transparent_color ;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   wgui_mv_convert_from_gdi_color_to_color(&temp , (g_wgui_mv_cat_cntx.current_msg.background_color) << 8) ;
  if(temp.r ==  0 && temp.g ==  0 &&  temp.b == 255  )
    {
		wgui_mv_transparent_color = gdi_act_color_from_rgb(255,    0, 255,      0);
       // wgui_mv_transparent_color = temp.r << 24  || temp.g << 16  || temp.b << 8  || temp.alpha; 
    }
  else
    {
      wgui_mv_transparent_color = gdi_act_color_from_rgb(255,    0,     0, 255) ;
    }
     return  wgui_mv_transparent_color ;

}
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_error_condition
 * DESCRIPTION
 *  called incase of some error condition
 * PARAMETERS
 *  start_id            [IN]        
 *  end_id              [IN]        
 *  buffer_local        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_error_condition(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //wgui_mv_exit_category();
    g_wgui_mv_cat_cntx.stop_app_cb();
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_ERROR;
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_media_stopped_callback
 * DESCRIPTION
 *  called by media API when media playing is stopped
 * PARAMETERS
 *  result            [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_media_stopped_callback(mdi_result result, void *user_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#if defined(__MMI_FTE_SUPPORT__)
    gdi_color mms_bg_color;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Only work incase of playing or showing states */
    if (!(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING ||
        g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING))
    {
        return;
    }
	if(result == MDI_RES_VDOPLY_SUCCEED || result < 0)
		{
    g_wgui_mv_is_media_end = MMI_TRUE;
		  if (CURRENT_SLIDE->vid.id)
			{
				g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_HIDDEN;
			}
		}
    

    if ((result < 0) &&
        (result != MDI_AUDIO_END_OF_FILE) &&
        (result != MDI_AUDIO_ERROR))
    {
        g_wgui_mv_is_media_valid = MMI_FALSE;
    }
	
    if (CURRENT_SLIDE->vid.id)
    {
		#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        /* clear video area */
        if (g_wgui_mv_cat_layout.vlayer > 0 &&  (result == MDI_RES_VDOPLY_SUCCEED || result < 0 ) )
        {
			mdi_util_hw_layer_switch_to_sw_layer(g_wgui_mv_cat_layout.vlayer); /* Change layer1 back to software layer */
			gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);  /* OK */
			gdi_layer_set_color_format(GDI_COLOR_FORMAT_16); /* Change color format back from UYVY422 */
			gdi_layer_clear(GDI_COLOR_BLACK); /* Because the content of layer was written by HW, suggest to clear the layer first */
			
#if defined(__MMI_FTE_SUPPORT__)
            mms_bg_color = wgui_mv_convert_from_gdi_color_to_gdi_act_color(g_wgui_mv_cat_cntx.current_msg.background_color << 8 );
            gdi_layer_clear(mms_bg_color);
#else
            gdi_layer_clear(GDI_COLOR_TRANSPARENT);
#endif
            gdi_layer_pop_and_restore_active();
            gdi_lcd_repaint_all();
        g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_HIDDEN;
        }
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
#endif
    }

    switch (result)
    {
        case MDI_AUDIO_DRM_TIMEOUT:
        case MDI_AUDIO_DRM_PROHIBIT:
            if (CURRENT_SLIDE->aud.id)
            {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                Category630AudioRightExpiredNotify();
#endif
            }
            return;
        case MDI_RES_VDOPLY_ERR_DRM_DURATION_USED:
        case MDI_RES_VDOPLY_ERR_DRM_PROHIBITED:
            if (CURRENT_SLIDE->vid.id)
            {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                Category630VideoRightExpiredNotify();
#endif
            }
            return;
    }

    if (CURRENT_SLIDE->aud.id)
    {
        if (g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
        {
             if(result == MDI_RES_VDOPLY_SUCCEED || result < 0)           
			 {
            g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
            g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->aud);
			 }
            /* Audio stopped that is why this is called other than DRM case where we have to stop our self */
        }
        g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_FINISH;
    }
    else if (CURRENT_SLIDE->vid.id)
    {
		if(result == MDI_RES_VDOPLY_SUCCEED || result < 0)
		{
        g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->vid);
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
		g_wgui_mv_cat_cntx.is_video_stopped = MMI_FALSE;
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
		}
    }

    /* Force refresh on a slide with zero duration: it won't auto refresh */
    /* Force redraw on a stopped slide? Audio/Video won't be playing in stopped state */
		 if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && (CURRENT_SLIDE->vid.id || CURRENT_SLIDE->aud.id))
		 {
			  g_temp=MMI_TRUE;
			  
		 }
		 else
		 {
			 if(g_wgui_mv_cat_cntx.slide_time==0)
			  {
				  g_wgui_mv_cat_cntx.slide_time++;
			  }
			 g_temp=MMI_FALSE;
		 }
    if (CURRENT_SLIDE->duration == 0 && !g_temp)
    {
        wgui_mv_draw_viewer();
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_load_paging_data
 * DESCRIPTION
 *  loads data for page required
 * PARAMETERS
 *  start_id            [IN]        
 *  end_id              [IN]        
 *  buffer_local        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_load_paging_data(U32 start_id, U32 end_id, PU8 buffer_local)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 len;
    U32 pages = (g_wgui_mv_cat_cntx.ucs2_txt_len == 0) ? (0) : (end_id - start_id + 1);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(buffer_local, 0, pages * GUI_PAGE_SIZE * ENCODING_LENGTH);
    len = mmi_ucs2strlen((PS8) (g_wgui_mv_cat_cntx.ptxtbuffer + (GUI_PAGE_SIZE * start_id * ENCODING_LENGTH)));

    if (len < (GUI_PAGE_SIZE * pages))
    {
        mmi_ucs2ncat(
            (PS8) buffer_local,
            (PS8) (g_wgui_mv_cat_cntx.ptxtbuffer + (GUI_PAGE_SIZE * start_id * ENCODING_LENGTH)),
            GUI_PAGE_SIZE * pages);
    }
    else
    {
        memcpy(
            buffer_local,
            g_wgui_mv_cat_cntx.ptxtbuffer + (GUI_PAGE_SIZE * start_id * ENCODING_LENGTH),
            GUI_PAGE_SIZE * pages * ENCODING_LENGTH);
    }
  
}

#ifdef __MMI_TOUCH_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_get_data_during_scrolling
 * DESCRIPTION
 *  loads data into buffer during scrolling on touch screen
 * PARAMETERS
 *  percentage_val      [IN]        
 *  buffer_local        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_get_data_during_scrolling(S32 percentage_val, PU8 buffer_local)
{
#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 start_id, end_id, jump_offset_from_app;
    U32 last_page_id, total_page_id, current_page_id;
#ifdef MMS_VIEWER_DIFFERENT_FONTS
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Calculate total pages & last page id */
    {
        U32 q, r;

        q = g_wgui_mv_cat_cntx.ucs2_txt_len / GUI_PAGE_SIZE;
        r = g_wgui_mv_cat_cntx.ucs2_txt_len % GUI_PAGE_SIZE;

        if ((q == 0) && (r == 0))
        {
            total_page_id = 0;
            last_page_id = 0;
        }
        else
        {
            total_page_id = last_page_id = q;
            total_page_id += (r) ? (1) : (0);
            last_page_id -= (r) ? (0) : (1);
        }
    }

    /* Calculate current pages id */
    current_page_id = (total_page_id * percentage_val) / 100;
    current_page_id = (current_page_id > last_page_id) ? (last_page_id) : (current_page_id);

    /* Calculate start & end page ids */
    if (total_page_id <= PAGE_MAX)
    {
        start_id = 0;
        end_id = last_page_id;
    }
    else if (current_page_id == 0)
    {
        start_id = current_page_id;
        end_id = current_page_id + PAGE_MAX - 1;
    }
    else
    {
        start_id = current_page_id - 1;
        end_id = start_id + PAGE_MAX - 1;
        end_id = (end_id < last_page_id) ? (end_id) : (last_page_id);
    }

    //jump_offset_from_app = (current_page_id - start_id) * GUI_PAGE_SIZE;
    jump_offset_from_app = (g_wgui_mv_cat_cntx.ucs2_txt_len * percentage_val / 100) - (start_id * GUI_PAGE_SIZE);
    wgui_paging_multiline_set_page(start_id, end_id);

    wgui_mv_load_paging_data(start_id, end_id, buffer_local);
#ifdef MMS_VIEWER_DIFFERENT_FONTS
    wgui_paging_multiline_set_font((U8)CURRENT_SLIDE->txt.text_size, (U8)CURRENT_SLIDE->txt.text_style);
#endif 
    MMI_multiline_inputbox.page_offset = 0;
    MMI_multiline_inputbox.jump_offset_from_app = jump_offset_from_app;
    MMI_multiline_inputbox.search_flag_is_on = 0;
#endif
}
#endif /* __MMI_TOUCH_SCREEN__ */ 


#ifdef __DRM_SUPPORT__
/* Draw Related Functions */
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_drm_icon
 * DESCRIPTION
 *  show drm lock icon
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_show_drm_icon(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 id = 0;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (is_draw == MMI_FALSE)
    {
        return MMI_TRUE;
    }

    id = (CURRENT_SLIDE->vid.id) ? WGUI_MV_DRM_VIDEO_LOCK_ID : id;
    id = (CURRENT_SLIDE->img.id) ? WGUI_MV_DRM_IMAGE_LOCK_ID : id;

    if (id != 0)
    {
        S32 x, y, w, h, img_w, img_h;

        gdi_image_get_dimension_id(id, &img_w, &img_h);

        if ((img_w > (clip_x2 - clip_x1 + 1)) || (img_h > height))
        {
            gdi_image_util_fit_bbox(
                clip_x2 - clip_x1 + 1,
                height,
                img_w,
                img_h,
                &x,
                &y,
                &w,
                &h);
            x += clip_x1;
            y += yoffset;
        }
        else
        {
            w = img_w;
            h = img_h;
            x = (clip_x2 - clip_x1 + 1 - w) >> 1;
            y = yoffset + ((height - h) >> 1);
        }

        gdi_image_draw_resized_id(x, y, w, h, id);
    }
    
    return MMI_TRUE;
}
#endif /* __DRM_SUPPORT__ */

#if defined(__MMI_FTE_SUPPORT__)

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_clip_rect
 * DESCRIPTION
 *  clip the visible rect
 * PARAMETERS           
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]   
 *  clip_rect [OUT]
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL wgui_mv_clip_rect(
                    S32 x1,
                    S32 y1,
                    S32 x2,
                    S32 y2,
                    wgui_mv_clip_struct *clip_rect_p
                    )
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    wgui_mv_clip_struct bounding_rect = {0, };
    MMI_BOOL ret = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    memset(clip_rect_p, 0, sizeof(wgui_mv_clip_struct));

    g_wgui_mv_bounding_rect.x1 = -1;
    g_wgui_mv_bounding_rect.y1 = -1;
    g_wgui_mv_bounding_rect.x2 = -1;
    g_wgui_mv_bounding_rect.y2 = -1; 

    bounding_rect.x1 = g_wgui_mv_cat_layout.viewarea.s16X;
    bounding_rect.y1 = g_wgui_mv_cat_layout.viewarea.s16Y + 1; // Leave one pixel up

    bounding_rect.x2 = bounding_rect.x1 + g_wgui_mv_cat_layout.viewarea.s16Width;
    bounding_rect.y2 = bounding_rect.y1 + g_wgui_mv_cat_layout.viewarea.s16Height - 2; // Leave one pixel at the lower border


    clip_rect_p->x1 = x1;
    clip_rect_p->y1 = y1;
    clip_rect_p->x2 = x2;
    clip_rect_p->y2 = y2;

    if ((y1 < bounding_rect.y2) && (y2 >= bounding_rect.y1) && (x1 < bounding_rect.x2) && (x2 >= bounding_rect.x1))
    {
        if (x1 < bounding_rect.x1)
        {
            clip_rect_p->x1 = bounding_rect.x1;
        }

        if (y1 < bounding_rect.y1)
        {
            clip_rect_p->y1 = bounding_rect.y1;
        }

        if (x2 >= bounding_rect.x2)
        {
            clip_rect_p->x2 = bounding_rect.x2 - 1;
        }

        if (y2 >= bounding_rect.y2)
        {
            clip_rect_p->y2 = bounding_rect.y2 - 1;
        }

        g_wgui_mv_bounding_rect.x1 = clip_rect_p->x1;
        g_wgui_mv_bounding_rect.y1 = clip_rect_p->y1;
        g_wgui_mv_bounding_rect.x2 = clip_rect_p->x2;
        g_wgui_mv_bounding_rect.y2 = clip_rect_p->y2;    

        ret = MMI_TRUE;
    }

    return ret;
}
#endif
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_draw_image
 * DESCRIPTION
 *  draws image part
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/

static MMI_BOOL wgui_mv_draw_image(U16 *file_path , S32 yoffset)
{

	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	MMI_BOOL ret = MMI_TRUE ;


if (g_wgui_mv_cat_cntx.drawable_media_state == WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING)
        {
            if (gdi_anim_draw_file_resized(
                    g_wgui_mv_cat_layout.resized_xoffset,
                    g_wgui_mv_cat_layout.resized_yoffset + yoffset,
                    g_wgui_mv_cat_layout.resized_width,
                    g_wgui_mv_cat_layout.resized_height,
                    file_path,
                    &g_wgui_mv_cat_cntx.image_handle) < GDI_SUCCEED)
            {
                ret = MMI_FALSE;
            }
        }
        else
        {
            if (gdi_image_draw_resized_file(
                    g_wgui_mv_cat_layout.resized_xoffset,
                    g_wgui_mv_cat_layout.resized_yoffset + yoffset,
                    g_wgui_mv_cat_layout.resized_width,
                    g_wgui_mv_cat_layout.resized_height,
                    (S8*)file_path) < GDI_SUCCEED)
            {
                ret = MMI_FALSE;
            }
       }
        return ret ;
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_image
 * DESCRIPTION
 *  show image part
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_show_image(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    MMI_BOOL ret = MMI_TRUE;
    color c = {255,0,0,0};
	const S16 x1=MMI_content_width/2+MMI_content_width/16;
    const S16 y1=MMI_content_width/8+yoffset;
	const S16 x2=MMI_content_width/2-MMI_content_width/16;
	const S16 y2=MMI_content_width/16+yoffset;
	const S16 x3=MMI_content_width/2-MMI_content_width/16;
	const S16 y3=MMI_content_width/5+yoffset;
	gdi_point2D_struct points[3];

	points[0].x=x1;
    points[0].y=y1;
	points[1].x=x2;
	points[1].y=y2;
	points[2].x=x3;
	points[2].y=y3;
    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (CURRENT_SLIDE->img.id)
    {
        /* set frame number */
        if (g_wgui_mv_cat_cntx.image_handle != GDI_NULL_HANDLE)
        {
            gdi_anim_stop(g_wgui_mv_cat_cntx.image_handle);
            g_wgui_mv_cat_cntx.image_handle = GDI_NULL_HANDLE;
        }
       
        #ifdef __MMI_MSG_FTE_ENHANCE__
            g_wgui_mv_image_point.x = g_wgui_mv_cat_layout.resized_xoffset;
            g_wgui_mv_image_point.y = g_wgui_mv_cat_layout.resized_yoffset + yoffset;
            g_wgui_mv_image_point.width = g_wgui_mv_cat_layout.resized_width;
            g_wgui_mv_image_point.height = g_wgui_mv_cat_layout.resized_height;
            if(g_wgui_mv_image_point.y < g_wgui_mv_cat_layout.viewarea.s16Y)
            {
                g_wgui_mv_image_point.height -= (g_wgui_mv_cat_layout.viewarea.s16Y - g_wgui_mv_image_point.y);
                g_wgui_mv_image_point.y = g_wgui_mv_cat_layout.viewarea.s16Y;
            }
        #endif
        

        if (is_draw == MMI_FALSE)
        {
            return MMI_TRUE;
        }

       /*framework enahcement*/
        gui_push_and_set_clip(clip_x1, clip_y1, clip_x2, clip_y2);
		
        #ifdef __MMI_MSG_FTE_ENHANCE__
            if (g_pressed)
            {
                if((g_wgui_mv_cat_layout.resized_yoffset + yoffset) < clip_y1)
                {
                    gui_set_text_clip(clip_x1-1, clip_y1, clip_x2, clip_y2);
                }
                else
                {
                    gui_set_text_clip(clip_x1-1, clip_y1-1, clip_x2, clip_y2);
                }

                /* Top horizontal */
                gdi_draw_line(
                    g_wgui_mv_image_point.x - 1, 
                    g_wgui_mv_image_point.y - 1, 
                    g_wgui_mv_image_point.x - 1 + g_wgui_mv_image_point.width, 
                    g_wgui_mv_image_point.y - 1, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));

                /* Bottom horizontal */
                gdi_draw_line(
                    g_wgui_mv_image_point.x - 1, 
                    g_wgui_mv_image_point.y + g_wgui_mv_image_point.height, 
                    g_wgui_mv_image_point.x - 1 + g_wgui_mv_image_point.width, 
                    g_wgui_mv_image_point.y + g_wgui_mv_image_point.height, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));

                /* Left vertical */
                gdi_draw_line(
                    g_wgui_mv_image_point.x - 1, 
                    g_wgui_mv_image_point.y - 1, 
                    g_wgui_mv_image_point.x - 1, 
                    g_wgui_mv_image_point.y + g_wgui_mv_image_point.height, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));

                /* Right vertical */
                gdi_draw_line(
                    g_wgui_mv_image_point.x + g_wgui_mv_image_point.width, 
                    g_wgui_mv_image_point.y - 1, 
                    g_wgui_mv_image_point.x + g_wgui_mv_image_point.width, 
                    g_wgui_mv_image_point.y + g_wgui_mv_image_point.height, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));
            }
            else
            {
                gui_set_text_clip(clip_x1, clip_y1, clip_x2, clip_y2);
            }
        #endif
       
        if(!g_wgui_mv_cat_cntx.drawable_media_file_path_ext)
        {
            wgui_mv_draw_image(g_wgui_mv_cat_cntx.drawable_media_file_path, yoffset) ; 
        }
        else
        {
          wgui_mv_draw_image(g_wgui_mv_cat_cntx.drawable_media_file_path_ext,yoffset) ;  
        }

        gui_pop_clip();
    }
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
if (CURRENT_SLIDE->vid.id)
{
       if (is_draw == MMI_FALSE)
        {
            return MMI_TRUE;
        }
        /*framework enahcement*/
        gui_push_and_set_clip(clip_x1, clip_y1, clip_x2, clip_y2);
        gdi_draw_solid_circle(MMI_content_width/2,MMI_content_width/8+yoffset, MMI_content_width/8, GDI_COLOR_GRAY);
	gdi_draw_solid_polygon((gdi_point2D_struct *)points,3,GDI_COLOR_WHITE);
        gui_pop_clip();
}
#endif

    return ret;
}

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_video
 * DESCRIPTION
 *  show video part
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_show_video(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    MMI_BOOL ret = MMI_FALSE;
	U32 tics1 = 0, tics2 = 0;
    color c={255,0,0,0};
    

#if defined(__MMI_FTE_SUPPORT__)
    GDI_HANDLE hint_layer = GDI_NULL_HANDLE;
    wgui_mv_clip_struct clip_rect = {0, };
    MMI_BOOL is_video_draw = MMI_FALSE;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (CURRENT_SLIDE->vid.id)
    {
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
        U64 video_frame = 0;
        MDI_RESULT mdi_ret;

        #ifdef __MMI_MSG_FTE_ENHANCE__
	        g_wgui_mv_video_point.x = g_wgui_mv_cat_layout.resized_xoffset;
	        g_wgui_mv_video_point.y = g_wgui_mv_cat_layout.resized_yoffset + yoffset;
	        g_wgui_mv_video_point.width = g_wgui_mv_cat_layout.resized_width;
	        g_wgui_mv_video_point.height = g_wgui_mv_cat_layout.resized_height;
            if(g_wgui_mv_video_point.y < g_wgui_mv_cat_layout.viewarea.s16Y)
            {
                g_wgui_mv_video_point.height -= (g_wgui_mv_cat_layout.viewarea.s16Y - g_wgui_mv_video_point.y);
                g_wgui_mv_video_point.y = g_wgui_mv_cat_layout.viewarea.s16Y;
            }

        #endif

        if (g_wgui_mv_cat_cntx.is_video_open == MMI_FALSE)
        {
            return MMI_FALSE;
        }
        if (g_wgui_mv_is_media_end)
        {
            return MMI_TRUE;
        }

        #ifdef __MMI_MSG_FTE_ENHANCE__
            if (g_pressed)
            {
                if((g_wgui_mv_cat_layout.resized_yoffset + yoffset) < clip_y1)
                {
                    gui_set_text_clip(clip_x1-1, clip_y1, clip_x2, clip_y2);
                }
                else
                {
                    gui_set_text_clip(clip_x1-1, clip_y1-1, clip_x2, clip_y2);
                }

                /* Top horizontal */
                gdi_draw_line(
                    g_wgui_mv_video_point.x - 1, 
                    g_wgui_mv_video_point.y - 1, 
                    g_wgui_mv_video_point.x - 1 + g_wgui_mv_video_point.width, 
                    g_wgui_mv_video_point.y - 1, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));

                /* Bottom horizontal */
                gdi_draw_line(
                    g_wgui_mv_video_point.x - 1, 
                    g_wgui_mv_video_point.y + g_wgui_mv_video_point.height, 
                    g_wgui_mv_video_point.x - 1 + g_wgui_mv_video_point.width, 
                    g_wgui_mv_video_point.y + g_wgui_mv_video_point.height, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));

                /* Left vertical */
                gdi_draw_line(
                    g_wgui_mv_video_point.x - 1, 
                    g_wgui_mv_video_point.y - 1, 
                    g_wgui_mv_video_point.x - 1, 
                    g_wgui_mv_video_point.y + g_wgui_mv_video_point.height, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));

                /* Right vertical */
                gdi_draw_line(
                    g_wgui_mv_video_point.x + g_wgui_mv_video_point.width, 
                    g_wgui_mv_video_point.y - 1, 
                    g_wgui_mv_video_point.x + g_wgui_mv_video_point.width, 
                    g_wgui_mv_video_point.y + g_wgui_mv_video_point.height, 
                gdi_act_color_from_rgb(c.alpha, c.r, c.g, c.b));
            }
        #endif

#if defined(__MMI_FTE_SUPPORT__)
        is_video_draw = wgui_mv_clip_rect(g_wgui_mv_cat_layout.resized_xoffset,
                                      g_wgui_mv_cat_layout.resized_yoffset + yoffset,
                                      g_wgui_mv_cat_layout.resized_xoffset + g_wgui_mv_cat_layout.resized_width - 1,
                                      g_wgui_mv_cat_layout.resized_yoffset + yoffset + g_wgui_mv_cat_layout.resized_height - 1,
                                      &clip_rect);


        if (is_draw == MMI_TRUE && is_video_draw == MMI_TRUE   && g_wgui_mv_default_image_id != WGUI_DEFAULT_PREVIEW_AVIDEO_ID)
        {
            gdi_layer_push_and_set_active(GDI_LAYER_MAIN_BASE_LAYER_HANDLE);
            gdi_layer_set_clip(clip_rect.x1, clip_rect.y1, clip_rect.x2, clip_rect.y2);

            gdi_layer_set_source_key(TRUE, wgui_mv_convert_from_gdi_color_to_transparent_color());
            gdi_draw_solid_rect(clip_rect.x1, clip_rect.y1, clip_rect.x2, clip_rect.y2, wgui_mv_convert_from_gdi_color_to_transparent_color());
            gdi_layer_pop_and_restore_active();
        }
#endif
      #ifdef __MDI_DISPLAY_YUYV422_SUPPORT__
		
		
			gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);
			gdi_layer_set_color_format(GDI_COLOR_FORMAT_UYVY422);
			gdi_layer_pop_and_restore_active();

    #endif
		/* stop video */
if (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
        {
            mdi_video_ply_stop();
            g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
			mdi_util_hw_layer_switch_to_sw_layer(g_wgui_mv_cat_layout.vlayer); /* Change layer1 back to software layer */
			gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);  /* OK */
			//gdi_layer_set_color_format(GDI_COLOR_FORMAT_16); /* Change color format back from UYVY422 */
			//gdi_layer_clear(GDI_COLOR_BLACK); /* Because the content of layer was written by HW, suggest to clear the layer first */
			gdi_layer_pop_and_restore_active();
			g_wgui_mv_cat_cntx.is_video_stopped  = MMI_TRUE;
        } 
        /* move layer */
        gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);
        {
            /* move to a specific position if out of screen */
            S32 x_offset = -256;
            S32 y_offset = -256;

            if (is_draw == MMI_TRUE 
#if defined(__MMI_FTE_SUPPORT__)                
                && is_video_draw == MMI_TRUE
#endif 
                )
            {
                x_offset = g_wgui_mv_cat_layout.resized_xoffset;
                y_offset = g_wgui_mv_cat_layout.resized_yoffset + yoffset;
            }

            gdi_layer_set_position(x_offset, y_offset);

#if defined(__MMI_FTE_SUPPORT__)
            // set clip region for ROI of video to avoid blinking of info bar
            if ((g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_TOP)
					&& (y_offset < g_wgui_mv_cat_layout.viewarea.s16Y + 1))
            {
              /*  gdi_layer_set_clip(
					0,
					g_wgui_mv_cat_layout.viewarea.s16Y - (g_wgui_mv_cat_layout.resized_yoffset + yoffset) + 1,
					g_wgui_mv_cat_layout.resized_width - 1,
					g_wgui_mv_cat_layout.resized_height - 1);*/
			

				gdi_layer_set_blt_rect(0,g_wgui_mv_cat_layout.viewarea.s16Y - (g_wgui_mv_cat_layout.resized_yoffset + yoffset) + 1,g_wgui_mv_cat_layout.resized_width ,g_wgui_mv_cat_layout.resized_height -g_wgui_mv_cat_layout.viewarea.s16Y + (g_wgui_mv_cat_layout.resized_yoffset + yoffset)-1);

            }
			else
			{
				
               gdi_layer_set_blt_rect(0,0,g_wgui_mv_cat_layout.resized_width +1 ,g_wgui_mv_cat_layout.resized_height +1);
            }
#endif

            // set clip region for ROI of video to avoid blinking of progress bar
            if (g_wgui_mv_cat_cntx.current_msg.layout == SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_BOTTOM)
            {
              //  gdi_layer_set_clip(0, 0, g_wgui_mv_cat_layout.resized_width - 1, (clip_y2 - (g_wgui_mv_cat_layout.resized_yoffset + yoffset) + 1));
			gdi_layer_set_blt_rect(0, 0,g_wgui_mv_cat_layout.resized_width , (clip_y2 - (g_wgui_mv_cat_layout.resized_yoffset + yoffset) + 1) +1);

            }
        }
#if !defined(__MMI_FTE_SUPPORT__)
        gdi_layer_clear_background(GDI_COLOR_TRANSPARENT);
#endif
        gdi_layer_pop_and_restore_active();
#if defined(__MMI_FTE_SUPPORT__)
        if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            hint_layer = wgui_icon_bar_get_hint_layer_handle();
        }
        gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.baselayer, hint_layer, 0);
#else
        gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
#endif        
       
        if (g_wgui_mv_cat_cntx.drawable_media_state == WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING)
        {
            if(g_wgui_mv_cat_cntx.is_video_stopped == MMI_TRUE )
			{
				mdi_ret = mdi_video_ply_get_frame(g_wgui_mv_cat_layout.vlayer);
			}
			else
			{
        /* set video configuration */
        mdi_video_ply_enable_partial_display(); 
        mdi_video_ply_get_cur_play_time(&video_frame);
            mdi_ret = mdi_video_ply_seek_and_get_frame((U64)video_frame, g_wgui_mv_cat_layout.vlayer);
			}
			
        }
        else
        {
            /* set video configuration */
			mdi_video_ply_enable_partial_display(); 
            mdi_ret = mdi_video_ply_seek_and_get_frame(0, g_wgui_mv_cat_layout.vlayer);
        }

        if ((g_wgui_mv_default_image_id == WGUI_DEFAULT_PREVIEW_AVIDEO_ID) &&
            (mdi_ret >= 0))
        {
           /* gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);
            gdi_layer_set_color_format(GDI_COLOR_FORMAT_16); 
			gdi_layer_clear(GDI_COLOR_BLACK); 
			gdi_layer_set_source_key(TRUE, GDI_COLOR_TRANSPARENT);
			gdi_layer_clear(GDI_COLOR_TRANSPARENT);
            gdi_layer_push_clip();
            gdi_layer_reset_clip();
            gdi_image_draw_id(0, 0, g_wgui_mv_default_image_id);
            gdi_layer_pop_clip();
            gdi_layer_pop_and_restore_active();*/
			S32 x, y, w, h, img_w, img_h;
			gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.baselayer);
            gui_push_and_set_clip(clip_x1, clip_y1, clip_x2, clip_y2);
            gdi_image_get_dimension_id(g_wgui_mv_default_image_id, &img_w, &img_h);
            if ((img_w > (clip_x2 - clip_x1 + 1)) || (img_h > height))
            {
                gdi_image_util_fit_bbox(
                    clip_x2 - clip_x1 + 1,
                    height,
                    img_w,
                    img_h,
                    &x,
                    &y,
                    &w,
                    &h);
                x += clip_x1;
                y += yoffset;
            }
            else
            {
                w = img_w;
                h = img_h;
                x = clip_x1 + ((clip_x2 - clip_x1 + 1 - w) >> 1);
                y = yoffset + ((height - h) >> 1);
            }

            gdi_image_draw_resized_id(x, y, w, h, g_wgui_mv_default_image_id);
           gui_pop_clip();
            gdi_layer_pop_and_restore_active();
        }
        /* play video */
        if ((g_wgui_mv_cat_cntx.drawable_media_state == WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING) &&
            (mdi_ret >= 0))
        {
            g_wgui_mv_cat_cntx.is_video_start_play = MMI_TRUE;
        }
        else
        {
            g_wgui_mv_is_media_valid = MMI_FALSE;
            g_wgui_mv_cat_cntx.is_video_start_play = MMI_FALSE;
        }
        
        ret = (mdi_ret >= 0) ? (MMI_TRUE) : (MMI_FALSE);
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */ 
    }

    return ret;
}

#endif
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_media
 * DESCRIPTION
 *  show image or video
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_show_media(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret = g_wgui_mv_cat_cntx.is_media_valid;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (ret == MMI_TRUE)
    {
        MMI_BOOL show_drm = MMI_FALSE;

        /* DRM check */
#ifdef __DRM_SUPPORT__
        if (CURRENT_SLIDE->vid.id) 
        {
            show_drm = g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->vid);
        }
        else if (CURRENT_SLIDE->img.id)
        {
            show_drm = g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->img);
        }
        
        if (show_drm == MMI_TRUE)
        {
			#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            ret = wgui_mv_show_drm_icon(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
            #endif
        }
        else
#endif /* __DRM_SUPPORT__ */
        if (CURRENT_SLIDE->vid.id)
        {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            ret = wgui_mv_show_video(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
#else 
 ret = wgui_mv_show_image(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
#endif
            if (ret == MMI_FALSE)
            {
                g_wgui_mv_is_media_valid = MMI_FALSE;
                CURRENT_SLIDE->duration = 0;
                
                memset(&g_wgui_mv_video_point, 0, sizeof(wgui_mv_video_point));
                
            }
        }
        else if (CURRENT_SLIDE->img.id)
        {
            MMI_BOOL ret_val;

            /* we want to consume first and then display: see mmi_audply_entry_detail() */
            ret_val= g_wgui_mv_cat_cntx.start_consume_rights(&CURRENT_SLIDE->img, 
                        g_wgui_mv_cat_cntx.drawable_media_file_path);
            if (MMI_TRUE == ret_val)
            {
                ret = wgui_mv_show_image(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
            }
#ifdef __DRM_SUPPORT__
            else
            {
				#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                ret = wgui_mv_show_drm_icon(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
               #endif
            }
#endif /* __DRM_SUPPORT__ */
        }
    }

    if (ret == MMI_FALSE)
    {
        wgui_mv_show_alternative_text(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_alternative_text
 * DESCRIPTION
 *  show alternative text while the media is not available
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_show_alternative_text(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    UI_string_type str = NULL;
    color tc;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (is_draw != MMI_FALSE)
    {
        if (CURRENT_SLIDE->vid.id)
        {
            str = (UI_string_type)CURRENT_SLIDE->vid.alt;
        }
        else if (CURRENT_SLIDE->img.id)
        {
            str = (UI_string_type)CURRENT_SLIDE->img.alt;
        }

#if defined (__MMI_VIDEO_PLAY_SUPPORT__) && !defined (__MMI_MMS_SIMPLIFIED_UI_SUPPORT__)
        gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.baselayer);
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */

		/*frmaework enhancement*/
        
        gui_push_and_set_clip(clip_x1, clip_y1, clip_x2, clip_y2);

        if (CURRENT_SLIDE->txt.id != 0 &&  g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER )    
        {
            wgui_mv_convert_from_gdi_color_to_color(&tc, ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.bg_color) << 8);
        }
        else
        {
            wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
        }

        gui_fill_rectangle(clip_x1, yoffset, clip_x2, yoffset + height, tc);

        if (str != NULL)
        {
            gui_set_font(&MMI_medium_font);

            if (CURRENT_SLIDE->txt.id != 0  && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)    
            {
                wgui_mv_convert_from_gdi_color_to_color(&tc, ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.fg_color) << 8);
            }
            else
            {
                wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.foreground_color) << 8);
            }
            gui_set_text_color(tc);

            if (!mmi_fe_get_r2l_state())
            {
                gui_print_truncated_text(clip_x1, yoffset, (clip_x2 - clip_x1 + 1), str);
            }
            else
            {
                gui_print_truncated_text(clip_x2, yoffset, (clip_x2 - clip_x1 + 1), str);
            }
        }
        else
        {
			//#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            S32 x, y, w, h, img_w, img_h;

            gdi_image_get_dimension_id(g_wgui_mv_default_image_id, &img_w, &img_h);

            if ((img_w > (clip_x2 - clip_x1 + 1)) || (img_h > height))
            {
                gdi_image_util_fit_bbox(
                    clip_x2 - clip_x1 + 1,
                    height,
                    img_w,
                    img_h,
                    &x,
                    &y,
                    &w,
                    &h);
                x += clip_x1;
                y += yoffset;
            }
            else
            {
                w = img_w;
                h = img_h;
                x = clip_x1 + ((clip_x2 - clip_x1 + 1 - w) >> 1);
                y = yoffset + ((height - h) >> 1);
            }

            gdi_image_draw_resized_id(x, y, w, h, g_wgui_mv_default_image_id);
          // #endif
        }
        
        /*frmework enhancement*/
        gui_pop_clip();

#if defined (__MMI_VIDEO_PLAY_SUPPORT__ ) && !defined (__MMI_MMS_SIMPLIFIED_UI_SUPPORT__)
        gdi_layer_pop_and_restore_active();
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
    }
    
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_drawable_media_hide
 * DESCRIPTION
 *  hide callback fro drawable media
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_drawable_media_hide(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* TODO: Stop playing media and clear the area */
    g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_HIDDEN;

    if (CURRENT_SLIDE->vid.id)
    {
    #ifdef __MMI_VIDEO_PLAY_SUPPORT__
        /* stop video */
        if (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
        {
            g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->vid);
            g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->vid, MMI_FALSE);
            mdi_video_ply_stop();
            g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;

            if (g_wgui_mv_cat_layout.vlayer > 0)
            {
            mdi_util_hw_layer_switch_to_sw_layer(g_wgui_mv_cat_layout.vlayer); /* Change layer1 back to software layer */
			gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);  /* OK */
			gdi_layer_set_color_format(GDI_COLOR_FORMAT_16); /* Change color format back from UYVY422 */
			gdi_layer_clear(GDI_COLOR_BLACK); /* Because the content of layer was written by HW, suggest to clear the layer first */               
            #if defined(__MMI_FTE_SUPPORT__)
                gdi_layer_clear(wgui_mv_convert_from_gdi_color_to_gdi_act_color(g_wgui_mv_cat_cntx.current_msg.background_color << 8 ));
            #else
                gdi_layer_clear(GDI_COLOR_TRANSPARENT);
            #endif

                gdi_layer_pop_and_restore_active();
            }
        }
    #endif /* __MMI_VIDEO_PLAY_SUPPORT__ */ 
    }
    else if (CURRENT_SLIDE->img.id)
    {
        if (g_wgui_mv_cat_cntx.image_handle != GDI_NULL_HANDLE)
        {
            gdi_anim_stop(g_wgui_mv_cat_cntx.image_handle);
            g_wgui_mv_cat_cntx.image_handle = GDI_NULL_HANDLE;
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_drawable_media_play
 * DESCRIPTION
 *  play callback for drawable media
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_drawable_media_play(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* TODO: start to play media (start animation or play video) if playable */
    g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING;

    wgui_mv_show_media(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_drawable_media_show_stopped
 * DESCRIPTION
 *  callback for showing media in stopped state
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_drawable_media_show_stopped(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* TODO: show first frame of video or animation or image */
    g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_SHOWING;

    wgui_mv_show_media(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_drawable_media_scroll
 * DESCRIPTION
 *  callback during scrolling
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_drawable_media_scroll(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* TODO: move layers etc if necessary */
    wgui_mv_show_media(is_draw, yoffset, height, clip_x1, clip_y1, clip_x2, clip_y2);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_drawable_media_dummy
 * DESCRIPTION
 *  dummy function may or may not be used
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_drawable_media_dummy(
                    MMI_BOOL is_draw,
                    S32 yoffset,
                    S32 height,
                    S32 clip_x1,
                    S32 clip_y1,
                    S32 clip_x2,
                    S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* TODO: probably do nothing here */

}

/* 1 This function is called from Multiline input through the header/footer callback */


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_drawable_object
 * DESCRIPTION
 *  main callback from multiline input
 * PARAMETERS
 *  is_draw     [IN]        
 *  yoffset     [IN]        
 *  height      [IN]        
 *  clip_x1     [IN]        
 *  clip_y1     [IN]        
 *  clip_x2     [IN]        
 *  clip_y2     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_show_drawable_object(
                MMI_BOOL is_draw,
                S32 yoffset,
                S32 height,
                S32 clip_x1,
                S32 clip_y1,
                S32 clip_x2,
                S32 clip_y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();
    drawable_media_cb[g_wgui_mv_cat_cntx.drawable_media_event][g_wgui_mv_cat_cntx.drawable_media_state] (is_draw, yoffset, height,
                                                                                               clip_x1, clip_y1,
                                                                                               clip_x2, clip_y2);
    gdi_layer_unlock_frame_buffer();

    /* Unless some event comes next time this function is called due to multiline inputbox being redrawn */
    g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_REDRAW;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_setup_arrow_position
 * DESCRIPTION
 *  Arrow positions on Info Bar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_mv_setup_arrow_position(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 text_width = 0, text_height = 0;
    S32 img_width = 0, img_height = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Arrow positions on Info Bar */
    {
        U16 temp[] = L"0123456789/";
        
        gui_set_font(CAT630_FONT);
#if defined (__MMI_FTE_SUPPORT__) && defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__)
		{
			if(!g_wgui_mv_used_by)
			{
			gui_set_font(&MMI_small_font);
		}
		}
#endif
#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)    
        if (g_wgui_mv_cat_cntx.get_index_func != NULL)
        {
            g_wgui_mv_cat_cntx.get_index_func(&g_wgui_mv_cat_cntx.curr_msg_num, &g_wgui_mv_cat_cntx.total_msg_num);
        }
        if(g_wgui_mv_cat_cntx.total_msg_num > 99)
#else
        if (g_wgui_mv_cat_cntx.current_msg.total_slide_num > 99)
#endif
        {
            mmi_fe_measure_string_by_char_num((U8*)temp, 7/* 555/555 */, &text_width, &text_height);
        }
        else
        {
            mmi_fe_measure_string_by_char_num((U8*)temp, 5/* 55/55 */, &text_width, &text_height);
        }
    }
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    gui_measure_image((PU8) GetImage(WGUI_MV_LEFT_ARROW_ICON_IMAGE_ID), &img_width, &img_height);
#else
    gui_measure_image((PU8) GetImage(LEFT_RED_ARROW), &img_width, &img_height);
#endif

#if !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__)
    /* Draw Slide Navigation Center Aligned */
    g_wgui_mv_cat_layout.larrow.s16X =
        g_wgui_mv_cat_layout.infobar.s16X + (g_wgui_mv_cat_layout.infobar.s16Width -
                                   (text_width + (img_width << 1) + (CAT630_ARROW_GAP << 1))) / 2;
    g_wgui_mv_cat_layout.rarrow.s16X = g_wgui_mv_cat_layout.larrow.s16X + img_width + CAT630_ARROW_GAP + text_width + CAT630_ARROW_GAP ;

#else /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) */ 
    /* Draw Slide Navigation Left Aligned */
    g_wgui_mv_cat_layout.larrow.s16X =
        g_wgui_mv_cat_layout.infobar.s16X + g_wgui_mv_cat_layout.infobar.s16Width - text_width - (img_width << 1) - (CAT630_ARROW_GAP << 1);
    g_wgui_mv_cat_layout.rarrow.s16X = g_wgui_mv_cat_layout.infobar.s16X + g_wgui_mv_cat_layout.infobar.s16Width - img_width;
#endif /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) */ 

#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
    #if defined(__MMI_FTE_SUPPORT__)
        g_wgui_mv_cat_layout.rarrow.s16Y = g_wgui_mv_cat_layout.larrow.s16Y =
            g_wgui_mv_cat_layout.infobar.s16Y + CAT630_ARROW_GAP;
    #else
        g_wgui_mv_cat_layout.rarrow.s16Y = g_wgui_mv_cat_layout.larrow.s16Y =
        g_wgui_mv_cat_layout.infobar.s16Y + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - img_height) >> 1);
    #endif /* defined(__MMI_FTE_SUPPORT__) */

#else /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */

    #if defined(__MMI_FTE_SUPPORT__)
        g_wgui_mv_cat_layout.rarrow.s16Y = g_wgui_mv_cat_layout.larrow.s16Y =
            g_wgui_mv_cat_layout.infobar.s16Y + CAT630_ARROW_GAP;
    #else
        g_wgui_mv_cat_layout.rarrow.s16Y = g_wgui_mv_cat_layout.larrow.s16Y =
            g_wgui_mv_cat_layout.infobar.s16Y + ((g_wgui_mv_cat_layout.infobar.s16Height - img_height) >> 1);
    #endif /* defined(__MMI_FTE_SUPPORT__) */

#endif /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */
    g_wgui_mv_cat_layout.rarrow.s16Width = g_wgui_mv_cat_layout.larrow.s16Width = img_width;
    g_wgui_mv_cat_layout.rarrow.s16Height = g_wgui_mv_cat_layout.larrow.s16Height = img_height;
}
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
void wgui_mv_get_msg_size(U16* str)
{
	S8 temp[10];
	U16 whole = 0, frac = 0;

	ASSERT(str);

    whole = g_wgui_mv_cat_cntx.current_msg.msg_size/1024;

	frac = (g_wgui_mv_cat_cntx.current_msg.msg_size%1024) * 10 / 1024;

	gui_sprintf(str, "%d.%d KB", whole, frac);
    return;
}
#endif

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_infobar
 * DESCRIPTION
 *  display infobar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_show_infobar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 x1 = g_wgui_mv_cat_layout.infobar.s16X;
    U16 x2 = g_wgui_mv_cat_layout.infobar.s16X + g_wgui_mv_cat_layout.infobar.s16Width- 1;
    U16 y1 = g_wgui_mv_cat_layout.infobar.s16Y;
    U16 y2 = g_wgui_mv_cat_layout.infobar.s16Y + g_wgui_mv_cat_layout.infobar.s16Height- 1;
    U16 str[10],str1[10], str_timer[10],str2[20];
    S32 icon_x, icon_y;
    S32 w = 0, h = 0;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
	color tc;
	FLOAT size;
	

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* This function does GetImage four times when a new slide is show */
    /*frmework enhancement*/
    gui_push_and_set_clip(x1, y1, x2, y2);
   

    gui_set_font(CAT630_FONT);
    gui_set_text_color(CAT630_IBAR_FONT_COLOR);
    memset(&str, 0, sizeof(str));
    memset(&str1, 0, sizeof(str1));
    memset(&str_timer, 0, sizeof(str_timer));

    /* display the background of the information bar */
    {
        color bg_color;

        if (CURRENT_SLIDE->txt.id != 0 && CURRENT_SLIDE->txt.str_id == 0 && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER )
        {
            wgui_mv_convert_from_gdi_color_to_color(&bg_color, (CURRENT_SLIDE->txt.bg_color) << 8);
        }
        else
        {
            wgui_mv_convert_from_gdi_color_to_color(&bg_color, (g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
        }
        gui_fill_rectangle(x1, y1, x2, y2, bg_color);
    }

    wgui_mv_setup_arrow_position();
 #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
if(!g_wgui_mv_used_by)
	{
   
    wgui_mv_get_msg_size(str2);

 #if defined(__MMI_FTE_SUPPORT__)
 gui_set_font(&MMI_small_font);
 #endif
 gui_measure_string(str2, &w, &h);
 #if !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__)
    /* Draw Slide Navigation Center Aligned */
 if(mmi_fe_get_r2l_state())
 {
	 gui_move_text_cursor(x2, y1 + ((y2 - y1 - h) / 2)  );
 }
 else
 {
  gui_move_text_cursor(x2-w, y1 + ((y2 - y1 - h) / 2)  );
 }
  

#else /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) */ 
    /* Draw Slide Navigation Left Aligned */
gui_move_text_cursor(x1+1, y1 + ((y2 - y1 - h) / 2)  );
#endif
  
  gui_set_text_border_color(gui_color(0, 0, 0));
    gui_print_bordered_text(str2);

	}
#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
   
    #if defined(__MMI_FTE_SUPPORT__)
        {
            S32 title_x = g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width;
            S32 title_y = g_wgui_mv_cat_layout.larrow.s16Y;
            S32 title_w = g_wgui_mv_cat_layout.rarrow.s16X - title_x;
            S32 title_h = g_wgui_mv_cat_layout.larrow.s16Height;

        #ifdef __MMI_MSG_FTE_ENHANCE__

            if(!g_wgui_mv_cat_cntx.is_fullscreen)
            {
            gdi_image_draw_resized(
                x1 + CAT630_ARROW_GAP,
                title_y,
                x2 - x1 + 1 - (CAT630_ARROW_GAP << 1),
                title_h,
                current_MMI_theme->inputbox_remaining_counter_bg);
            }
            else
            {
            gdi_image_draw_resized(
                x1 + CAT630_ARROW_GAP,
                title_y,
                x2 - x1 + 1 - (CAT630_ARROW_GAP << 1),
                title_h,
                current_MMI_theme->inputbox_remaining_counter_bg);
            }
    #else /* __MMI_MSG_FTE_ENHANCE__ */ 
        {
			if(g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)
            {
				gdi_image_draw_resized(
					x1 + CAT630_ARROW_GAP,
					title_y,
					x2 - x1 + 1 - (CAT630_ARROW_GAP << 1),
					title_h,
					current_MMI_theme->inputbox_remaining_counter_bg);
            }
        }
    #endif /* __MMI_MSG_FTE_ENHANCE__ */ 

    	#if !defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
            #ifdef __MMI_MSG_FTE_ENHANCE__
        /* gdi_image_draw_resized_id(title_x, title_y, title_w, title_h, WGUI_MV_TITLE_ICON_IMAGE_ID); */
            #else
		if(g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)
			{
                gdi_image_draw_resized_id(title_x, title_y, title_w, title_h, WGUI_MV_TITLE_ICON_IMAGE_ID);
		    }
            #endif
    #endif /* !defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) */ 
        }
    #endif /* defined(__MMI_FTE_SUPPORT__) */

		
    #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_MSG_FTE_ENHANCE__)
        if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            if(g_wgui_mv_cat_cntx.get_index_func)
            {
                g_wgui_mv_cat_cntx.get_index_func(&g_wgui_mv_cat_cntx.curr_msg_num, &g_wgui_mv_cat_cntx.total_msg_num);
            }

            if(g_wgui_mv_cat_cntx.curr_msg_num != 0 && g_wgui_mv_cat_cntx.total_msg_num != 0)
            {
                gui_sprintf(str, "%d/%d", g_wgui_mv_cat_cntx.curr_msg_num, g_wgui_mv_cat_cntx.total_msg_num);
                gui_measure_string(str, &w, &h);

               
                if (mmi_fe_get_r2l_state())
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.rarrow.s16X - ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X - g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }
                else
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }

                gui_set_text_border_color(gui_color(0, 0, 0));
                gui_print_bordered_text(str);
            }
        }
        else if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
        {
            U16 display_time = g_wgui_mv_cat_cntx.slide_time;

           /* if(!is_slide_switching)
            {
                display_time = display_time ? (display_time - 1) : 0;
            }*/

            if (display_time > 59)
            {
                gui_sprintf(str_timer, "%02d:%02d", display_time/60, display_time%60);
            }
            else
            {
                gui_sprintf(str_timer, "00:%02d", display_time);
            }
            gui_measure_string(str_timer, &w, &h);
            
            if (mmi_fe_get_r2l_state())
            {
                gui_move_text_cursor(
                    g_wgui_mv_cat_layout.rarrow.s16X - ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X - g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                    y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
            }
            else
            {
                if(!g_wgui_mv_cat_cntx.is_fullscreen)
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }
                else
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }
            }
            gui_set_text_border_color(gui_color(0, 0, 0));
            gui_print_bordered_text(str_timer);
        }
    #elif defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
        if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            if(g_wgui_mv_cat_cntx.get_index_func)
            {
                g_wgui_mv_cat_cntx.get_index_func(&g_wgui_mv_cat_cntx.curr_msg_num, &g_wgui_mv_cat_cntx.total_msg_num);
            }

            if(g_wgui_mv_cat_cntx.curr_msg_num != 0 && g_wgui_mv_cat_cntx.total_msg_num != 0)
            {
                gui_sprintf(str, "%d/%d", g_wgui_mv_cat_cntx.curr_msg_num, g_wgui_mv_cat_cntx.total_msg_num);
                gui_measure_string(str, &w, &h);

               
                if (mmi_fe_get_r2l_state())
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.rarrow.s16X - ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X - g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }
                else
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }

                gui_set_text_border_color(gui_color(0, 0, 0));
                gui_print_bordered_text(str);
            }
        }
    #elif defined(__MMI_MSG_FTE_ENHANCE__)
        if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
        {
            U16 display_time = g_wgui_mv_cat_cntx.slide_time;

            /*if(!is_slide_switching)
            {
                display_time = display_time ? (display_time - 1) : 0;
            }*/
		

            if (display_time > 59)
            {
                gui_sprintf(str_timer, "%02d:%02d", display_time/60, display_time%60);
            }
            else
            {
                gui_sprintf(str_timer, "00:%02d", display_time);
            }
            gui_measure_string(str_timer, &w, &h);
            
            if (mmi_fe_get_r2l_state())
            {
                gui_move_text_cursor(
                    g_wgui_mv_cat_layout.rarrow.s16X - ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X - g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                    y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
            }
            else
            {
                if(!g_wgui_mv_cat_cntx.is_fullscreen)
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }
                else
                {
                    gui_move_text_cursor(
                        g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
                        y1 + ((g_wgui_mv_cat_layout.infobar.s16Height/2 - h) / 2));
                }
            }
            gui_set_text_border_color(gui_color(0, 0, 0));
            gui_print_bordered_text(str_timer);
        }
    #endif 

#ifdef __MMI_MSG_FTE_ENHANCE__
    if((g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        && (g_wgui_mv_cat_cntx.current_msg.show_attachment_icon == WGUI_MV_VIEW_ONLY)
        && (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING))
    {
        if(attachment_state == WGUI_MV_BUTTON_RELEASED_STATE)
        {
            gui_show_image(
                g_wgui_mv_cat_layout.limage.s16X,
                g_wgui_mv_cat_layout.limage.s16Y,
                GetImage(WGUI_DEFAULT_VIEW_ATTACH_ID));
        }
        else if(attachment_state == WGUI_MV_BUTTON_PRESSED_STATE)
        {
            gui_show_image(
                g_wgui_mv_cat_layout.limage.s16X,
                g_wgui_mv_cat_layout.limage.s16Y,
                GetImage(WGUI_DEFAULT_VIEW_ATTACH_HIGHLIGHT_ID));
        }
    }

    if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY
        && (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING))
    {
        if(!g_wgui_mv_cat_cntx.is_fullscreen && (full_state == WGUI_MV_BUTTON_RELEASED_STATE))
        {
            gui_measure_image(GetImage(WGUI_DEFAULT_VIEW_FULL_ID), &w, &h);
            gui_show_image(UI_device_width - w - CAT630_ARROW_GAP, y1 + 1, GetImage(WGUI_DEFAULT_VIEW_FULL_ID));
        }    
        else if(!g_wgui_mv_cat_cntx.is_fullscreen && (full_state == WGUI_MV_BUTTON_PRESSED_STATE))
        {
            gui_measure_image(GetImage(WGUI_DEFAULT_VIEW_FULL_HIGHLIGHT_ID), &w, &h);
            gui_show_image(
                UI_device_width - w - CAT630_ARROW_GAP,
                y1 + CAT630_ARROW_GAP,
                GetImage(WGUI_DEFAULT_VIEW_FULL_HIGHLIGHT_ID));
        }
        else if(g_wgui_mv_cat_cntx.is_fullscreen && (full_state == WGUI_MV_BUTTON_RELEASED_STATE))
        {
            gui_measure_image(GetImage(WGUI_DEFAULT_VIEW_NORMAL_ID), &w, &h);
            gui_show_image(
                UI_device_width - w - CAT630_ARROW_GAP,
                y1 + CAT630_ARROW_GAP,
                GetImage(WGUI_DEFAULT_VIEW_NORMAL_ID));
        }
        else if(g_wgui_mv_cat_cntx.is_fullscreen && (full_state == WGUI_MV_BUTTON_PRESSED_STATE))
        {
            gui_measure_image(GetImage(WGUI_DEFAULT_VIEW_NORMAL_HIGHLIGHT_ID), &w, &h);
            gui_show_image(
                UI_device_width - w - CAT630_ARROW_GAP,
                y1 + CAT630_ARROW_GAP,
                GetImage(WGUI_DEFAULT_VIEW_NORMAL_HIGHLIGHT_ID));
        }
    }
#endif /* __MMI_MSG_FTE_ENHANCE__ */ 

    icon_x = 0;
#if defined(__MMI_FTE_SUPPORT__)
    icon_x += CAT630_ARROW_GAP;
#endif 

#ifndef __MMI_MSG_FTE_ENHANCE__
    /* Follwoing code is necessary for the attachment icon for non-FTE builds. */
    /* attachment icon for this message */
    if(g_wgui_mv_cat_cntx.current_msg.show_attachment_icon != WGUI_MV_VIEW_NONE)
    {
		#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__

        PU8 attach_icon = (PU8) GetImage(WGUI_MV_ATTACHFILE_ICON_IMAGE_ID);

        /* Display Attachment Icon Here */
        gui_measure_image(attach_icon, &w, &h);
        icon_y = y1 + CAT630_ARROW_GAP;
        icon_x += CAT630_ARROW_GAP;
       
        gui_show_image(icon_x, icon_y, attach_icon);
       
        icon_x += w;
    #endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
    }
#endif /* __MMI_MSG_FTE_ENHANCE__ */ 
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
	
    if (CURRENT_SLIDE->aud.id)
    {
        PU8 audio_icon;

        /* There is no way to know if rights expired mid way. */
        /* So, the status may change to rights expired and we */
        /* still maybe showing unblocked image */

#ifdef __DRM_SUPPORT__ 
        if (MMI_TRUE == g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->aud))
        {
            audio_icon = (PU8) GetImage(WGUI_MV_RING_STOP_ICON_IMAGE_ID);
        }
        else
#endif /* __DRM_SUPPORT__ */
        {
            audio_icon = (PU8) GetImage(WGUI_MV_RING_ICON_IMAGE_ID);
        }

        /* Display Audio Icon Here */
        gui_measure_image(audio_icon, &w, &h);
        icon_x += CAT630_ARROW_GAP;
#if defined(__MMI_FTE_SUPPORT__)
        if (icon_x + w >= g_wgui_mv_cat_layout.larrow.s16X)
        {
            icon_x = g_wgui_mv_cat_layout.rarrow.s16X + g_wgui_mv_cat_layout.rarrow.s16Width + CAT630_ARROW_GAP;
        }
#endif /* defined(__MMI_FTE_SUPPORT__) */
        icon_y = y1 + CAT630_ARROW_GAP;
#ifndef __MMI_MSG_FTE_ENHANCE__
        gui_show_image(icon_x, icon_y, audio_icon);
#endif
        icon_x += w;
    }
#endif/*__MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/

    #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
    if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW && g_wgui_mv_cat_cntx.curr_msg_num != 0 &&
        g_wgui_mv_cat_cntx.total_msg_num != 0)
       // {
    #elif defined(__MMI_MSG_FTE_ENHANCE__)
        if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        //{
    #endif
    	{ 
		if((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->prev != NULL)
		{
            if (g_wgui_mv_cat_layout.larrow.Flags == WGUI_MV_BUTTON_PRESSED_STATE)
            {
				
                gui_show_image(
                    g_wgui_mv_cat_layout.larrow.s16X,
                    g_wgui_mv_cat_layout.larrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    (PU8) GetImage(WGUI_MV_LEFT_ARROW_DOWN_ICON_IMAGE_ID));
#else
                    (PU8) GetImage(LEFT_RED_ARROW));
#endif
               

            }
            else
            {
				
                gui_show_image(
                    g_wgui_mv_cat_layout.larrow.s16X,
                    g_wgui_mv_cat_layout.larrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    (PU8) GetImage(WGUI_MV_LEFT_ARROW_ICON_IMAGE_ID));  
#else
                    (PU8) GetImage(LEFT_RED_ARROW));  
#endif
	           
			}
		}
		else
		{
			#if defined(__MMI_FTE_SUPPORT__)
              gui_show_image(
					g_wgui_mv_cat_layout.larrow.s16X,
					g_wgui_mv_cat_layout.larrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
					(PU8) GetImage(WGUI_MV_LEFT_ARROW_DISABLE_ICON_IMAGE_ID));
            #else
					(PU8) GetImage(LEFT_RED_ARROW)); 
#endif
            #else

              gui_show_image(
                    g_wgui_mv_cat_layout.larrow.s16X,
                    g_wgui_mv_cat_layout.larrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    (PU8) GetImage(WGUI_MV_LEFT_ARROW_ICON_IMAGE_ID));  
#else
                    (PU8) GetImage(LEFT_RED_ARROW));  
#endif
            #endif
            }
		if ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->next != NULL)
		 {
            if (g_wgui_mv_cat_layout.rarrow.Flags == WGUI_MV_BUTTON_PRESSED_STATE)
            {
				
                gui_show_image(
                    g_wgui_mv_cat_layout.rarrow.s16X,
                    g_wgui_mv_cat_layout.rarrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    (PU8) GetImage(WGUI_MV_RIGHT_ARROW_DOWN_ICON_IMAGE_ID));
#else
                    (PU8) GetImage(RIGHT_RED_ARROW));
#endif
               
            }
            else
            {
	            
                gui_show_image(
                    g_wgui_mv_cat_layout.rarrow.s16X,
                    g_wgui_mv_cat_layout.rarrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    (PU8) GetImage(WGUI_MV_RIGHT_ARROW_ICON_IMAGE_ID));
#else
                    (PU8) GetImage(RIGHT_RED_ARROW));
#endif
	           

			}
		}
		else
		{
			#if defined(__MMI_FTE_SUPPORT__)
              gui_show_image(
					g_wgui_mv_cat_layout.rarrow.s16X,
					g_wgui_mv_cat_layout.rarrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
					(PU8) GetImage(WGUI_MV_RIGHT_ARROW_DISABLE_ICON_IMAGE_ID));
            #else
					(PU8) GetImage(RIGHT_RED_ARROW));
#endif
            #else

              gui_show_image(
                    g_wgui_mv_cat_layout.rarrow.s16X,
                    g_wgui_mv_cat_layout.rarrow.s16Y,
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                    (PU8) GetImage(WGUI_MV_RIGHT_ARROW_ICON_IMAGE_ID));
#else
                    (PU8) GetImage(RIGHT_RED_ARROW));
#endif
            #endif
              
            }
   // #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) || defined(__MMI_MSG_FTE_ENHANCE__)
        }
    //#endif

    #if defined (__MMI_FTE_SUPPORT__) && defined(__MMI_MMS_SIMPLIFIED_UI_SUPPORT__)
    if(g_wgui_mv_used_by)
		{
			gui_set_font(CAT630_FONT);
		}
    #endif
    gui_sprintf(str1, "%d/%d", CURRENT_SLIDE->slide_num, g_wgui_mv_cat_cntx.current_msg.total_slide_num);
    gui_measure_string(str1, &w, &h);

#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_MSG_FTE_ENHANCE__)
    if (mmi_fe_get_r2l_state())
    {
            gui_move_text_cursor((x2 - CAT630_TIMER_STR_GAP), y1 + (y2 - y1)/2 + CAT630_TIMER_STR_GAP);            
    }
    else
    {
            gui_move_text_cursor((x2 - w - CAT630_TIMER_STR_GAP), y1 + (y2 - y1)/2 + CAT630_TIMER_STR_GAP);
    }
#elif defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
	{
        if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
        {
	        if (mmi_fe_get_r2l_state())
	        {
	            gui_move_text_cursor((x2 - CAT630_TIMER_STR_GAP), y1 + 2 * CAT630_ARROW_GAP);
	        }
	        else
	        {
	            gui_move_text_cursor((x2 - w - CAT630_TIMER_STR_GAP), y1 + 2 * CAT630_ARROW_GAP);
	        }
        }
        else
        {
	        if (mmi_fe_get_r2l_state())
	        {
	            gui_move_text_cursor((x2 - CAT630_TIMER_STR_GAP), y1 + ((y2 - y1) / 2) + 2 * CAT630_ARROW_GAP);
	        }
	        else
	        {
	            gui_move_text_cursor((x2 - w - CAT630_TIMER_STR_GAP), y1 + ((y2 - y1) / 2) + 2 * CAT630_ARROW_GAP);
	        }
        }
	}
#elif defined(__MMI_MSG_FTE_ENHANCE__)
    if (mmi_fe_get_r2l_state())
    {
        if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
        {
            gui_move_text_cursor((x2 - CAT630_TIMER_STR_GAP), y1 + (y2 - y1)/2 + CAT630_TIMER_STR_GAP);            
        }
        else
        {
            gui_move_text_cursor(x1 + (x2 - x1 + w)/2 , y1 + ((y2 - y1 - h) / 2) + CAT630_TIMER_STR_GAP);
        }
    }
    else
    {
        if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
        {
            gui_move_text_cursor((x2 - w - CAT630_TIMER_STR_GAP), y1 + (y2 - y1)/2 + CAT630_TIMER_STR_GAP);
        }
        else
        {
            gui_move_text_cursor(x1 + (x2 - x1 - w)/2, y1 + ((y2 - y1 - h) / 2) + CAT630_TIMER_STR_GAP);
        }
    }
#else 
    if (mmi_fe_get_r2l_state())
    {
        gui_move_text_cursor(
            g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width + w) / 2),
            y1 + ((y2 - y1 - h) / 2));
    }
    else
    {
        gui_move_text_cursor(
            g_wgui_mv_cat_layout.larrow.s16X + ((g_wgui_mv_cat_layout.rarrow.s16X - g_wgui_mv_cat_layout.larrow.s16X + g_wgui_mv_cat_layout.larrow.s16Width - w) / 2),
            y1 + ((y2 - y1 - h) / 2));
    }
#endif 

    gui_set_text_border_color(gui_color(0, 0, 0));
    gui_print_bordered_text(str1);

    /*Frmework enhancement*/
    gui_pop_clip();
    g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NOT_NEEDED;
    gui_BLT_double_buffer(x1, y1, x2, y2);

#ifdef __MMI_MSG_FTE_ENHANCE__

     x1 = g_wgui_mv_cat_layout.infobar.s16X;
     x2 = g_wgui_mv_cat_layout.infobar.s16X + g_wgui_mv_cat_layout.infobar.s16Width - 1;
     y1 = g_wgui_mv_cat_layout.infobar.s16Y;
     y2 = g_wgui_mv_cat_layout.infobar.s16Y + g_wgui_mv_cat_layout.infobar.s16Height - 1;

    /* Drawing of text */
    /* framework enhancement*/
    gui_push_and_set_clip(x1, y1, x2, y2);
#if defined(__MMI_FTE_SUPPORT__)
    gui_set_font(&MMI_small_font);
     if (CURRENT_SLIDE->txt.id != 0 && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)    
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.fg_color) << 8);
    }
    else
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.foreground_color) << 8 );
    }
    gui_set_text_color(tc);
#else /* defined(__MMI_FTE_SUPPORT__) */
    gui_set_font(&MMI_medium_font);
    gui_set_text_color(CAT630_PBAR_FONT_COLOR);
#endif /* defined(__MMI_FTE_SUPPORT__) */

    /*
     * if(normal_play_mode)
     * {
     * if (g_wgui_mv_cat_cntx.slide_time > 59)
     * {
     * gui_sprintf(str, "%02d:%02d", g_wgui_mv_cat_cntx.slide_time / 60, g_wgui_mv_cat_cntx.slide_time % 60);
     * }
     * else
     * {
     * gui_sprintf(str, "00:%02d", g_wgui_mv_cat_cntx.slide_time);
     * }
     * gui_measure_string(str, &w, &h);
     * if (mmi_fe_get_r2l_state())
     * {
     * gui_move_text_cursor(x2 - (x2 - x1 - w) / 2, y1 + 1 + (y2 - y1 - h) / 2);
     * }
     * else
     * {
     * gui_move_text_cursor(x1 + (x2 - x1 - w)/2 , y1 + 1 + (y2 - y1 - h) / 2);
     * }
     * img=(PU8)GetImage(WGUI_MV_ATTACHFILE_ICON_IMAGE_ID);
     * gui_measure_image(img,&width,&height);
     * gui_print_text(str);
     * }
*/

    gui_pop_clip();
#endif /* __MMI_MSG_FTE_ENHANCE__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_viewarea
 * DESCRIPTION
 *  dispaly view area
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_show_viewarea(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    show_multiline_inputbox();
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NOT_NEEDED;
}

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_progressbar
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_show_progressbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 x1 = g_wgui_mv_cat_layout.pbar_area.s16X;
    U16 x2 = g_wgui_mv_cat_layout.pbar_area.s16X + g_wgui_mv_cat_layout.pbar_area.s16Width - 1;
    U16 y1 = g_wgui_mv_cat_layout.pbar_area.s16Y;
    U16 y2 = g_wgui_mv_cat_layout.pbar_area.s16Y + g_wgui_mv_cat_layout.pbar_area.s16Height - 1;

    /* center the pbar image which maybe smaller than pbar area */
    U16 progressbar_x =
        g_wgui_mv_cat_layout.pbar_area.s16X +
        ((g_wgui_mv_cat_layout.pbar_area.s16Width - g_wgui_mv_cat_layout.pbar_img_width) >> 1);
    color tc;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    if(!g_wgui_mv_cat_layout.pbar_img)
	{
      g_wgui_mv_cat_layout.pbar_img = (PU8) GetImage(WGUI_MV_BAR_ICON_IMAGE_ID);
	}

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
        if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            return;
        }
#endif /* defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) */ 

    /* Note: incase WGUI_MV_LAYOUT_TYPE_OVERLAPPING_PROGRESS_BAR wgui_mv_show_active_slide will not redraw progressbar */
    /*frmwrk enhancment*/
    gui_push_and_set_clip(x1, y1, x2, y2);

    /* Start: Draw BG same as multiline inputbox */
    if (CURRENT_SLIDE->txt.id != 0 && CURRENT_SLIDE->txt.str_id == 0 && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)    
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (CURRENT_SLIDE->txt.bg_color) << 8);
    }
    else
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
    }
    
    gui_fill_rectangle(x1, y1, x2, y2, tc);

#if !defined(__MMI_FTE_SUPPORT__)
    if (g_wgui_mv_cat_layout.type == WGUI_MV_LAYOUT_TYPE_OVERLAPPING_PROGRESS_BAR)
    {
        gui_show_image(progressbar_x, y1, g_wgui_mv_cat_layout.pbar_img);
    }
    else
    {
        gui_show_image(progressbar_x, y1, g_wgui_mv_cat_layout.pbar_img);
    }
#endif /* !defined(__MMI_FTE_SUPPORT__) */
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
    {
        S32 w, h;
        U16 str[6];
        S16 pbar_w = (S16)(g_wgui_mv_cat_layout.pbar_img_width - (CAT630_PBAR_HMARGIN << 1));

        /* Draw Progress Indication */
        x1 = progressbar_x + CAT630_PBAR_HMARGIN;
        y1 = y1 + CAT630_PBAR_VMARGIN;
        y2 = y2 - CAT630_PBAR_VMARGIN;
        x2 = x1 + pbar_w - 1;

        if (!g_wgui_mv_cat_cntx.current_msg.is_best_paging)
        {
            if (CURRENT_SLIDE->duration != 0)
            {
                pbar_w = (pbar_w * g_wgui_mv_cat_cntx.slide_time) / (CURRENT_SLIDE->duration);
            }
            else
            {
                pbar_w = (pbar_w * g_wgui_mv_cat_cntx.slide_time);
            }

            if (pbar_w)
            {
                gui_fill_rectangle(x1, y1, x1 + pbar_w, y2, CAT630_PBAR_BG_COLOR);
            }
        }

        /* Draw Remaining Time Text */
        /*framewrk enhancemnt*/
        gui_push_and_set_clip(x1, y1, x2, y2);
#if defined(__MMI_FTE_SUPPORT__)
        gui_set_font(&MMI_small_font);
         if (CURRENT_SLIDE->txt.id != 0 && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)    
        {
            wgui_mv_convert_from_gdi_color_to_color(&tc, ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.fg_color) << 8);
        }
        else
        {
            wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.foreground_color) << 8);
        }
        gui_set_text_color(tc);
#else /* defined(__MMI_FTE_SUPPORT__) */
        gui_set_font(&MMI_medium_font);
        gui_set_text_color(CAT630_PBAR_FONT_COLOR);
#endif /* defined(__MMI_FTE_SUPPORT__) */
        {
            U16 display_time = g_wgui_mv_cat_cntx.slide_time;

            //if(!is_slide_switching)
            //{
                //display_time = display_time ? (display_time - 1) : 0;
            //}

            if (display_time > 59)
            {
                gui_sprintf(str, "%02d:%02d", display_time/60, display_time%60);
            }
            else
            {
                gui_sprintf(str, "00:%02d", display_time);
            }
        }

/*
         * if (g_wgui_mv_cat_cntx.slide_time > 59)
         * {
         * gui_sprintf(str, "%02d:%02d", g_wgui_mv_cat_cntx.slide_time / 60, g_wgui_mv_cat_cntx.slide_time % 60);
         * }
         * else
         * {
         * gui_sprintf(str, "00:%02d", g_wgui_mv_cat_cntx.slide_time);
         * }
*/
        gui_measure_string(str, &w, &h);
        if (mmi_fe_get_r2l_state())
        {
            gui_move_text_cursor(x2 - (x2 - x1 - w) / 2, y1 + 1 + (y2 - y1 - h) / 2);
        }
        else
        {
            gui_move_text_cursor(x1 + (x2 - x1 - w) / 2, y1 + 1 + (y2 - y1 - h) / 2);
        }
        gui_print_text(str);
        gui_pop_clip();
    }

    gui_pop_clip();
    g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NOT_NEEDED;
}

/* 1 This is main redraw function from where all controls are redrawn depending upon need */

#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_resume_media_playing
 * DESCRIPTION
 *  resume playing video or audio
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_resume_media_playing(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    if (g_wgui_mv_cat_cntx.is_video_start_play == MMI_TRUE)
    {
        MMI_BOOL ret_val = MMI_TRUE;
        MMI_BOOL playaudio;

        g_wgui_mv_cat_cntx.is_video_start_play = MMI_FALSE;
        playaudio  = (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE) ? MMI_TRUE : MMI_FALSE;

#ifdef __DRM_SUPPORT__
        if (g_wgui_mv_cat_cntx.is_video_playing == MMI_TRUE)
        {
            /* do not consume right while start playing, that is, during scrolling, etc. */
            mdi_video_ply_drm_disable_consume_count();
        }
        else
#endif /* __DRM_SUPPORT__ */
        {
            ret_val= g_wgui_mv_cat_cntx.start_consume_rights(&CURRENT_SLIDE->vid, 
                        g_wgui_mv_cat_cntx.drawable_media_file_path);
        }
#if defined(__MMI_FTE_SUPPORT__)
        mdi_video_ply_enable_partial_display(); 
#endif
        if (MMI_TRUE == ret_val)
        {
            g_wgui_mv_cat_cntx.is_video_stopped = MMI_FALSE;
            #ifdef __GAIN_TABLE_SUPPORT__
                mdi_audio_set_audio_type(MDI_AUDIO_TYPE_MESSAGE);
            #endif
            if (mdi_video_ply_play(
                        g_wgui_mv_cat_layout.vlayer,
                        GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1 
#if !defined(__MMI_FTE_SUPPORT__)
                        | GDI_LAYER_ENABLE_LAYER_2 | GDI_LAYER_ENABLE_LAYER_3,
                        GDI_LAYER_ENABLE_LAYER_1,
#else
                        ,GDI_LAYER_ENABLE_LAYER_0,
#endif
                        1,
                        TRUE,
                        (BOOL)playaudio,
                        MDI_DEVICE_SPEAKER2,
                        MDI_VIDEO_LCD_ROTATE_0,
                        100,
                        wgui_mv_media_stopped_callback,
                        0) >= 0)
            {
                g_wgui_mv_cat_cntx.is_video_play = MMI_TRUE;
#ifdef __DRM_SUPPORT__
                g_wgui_mv_cat_cntx.is_video_playing = MMI_TRUE;
#endif /* __DRM_SUPPORT__ */
                if (playaudio == TRUE)
                {
                    mdi_audio_set_volume(MDI_VOLUME_MEDIA, g_wgui_mv_volume);
                }
            }
            else
            {
                g_wgui_mv_is_media_valid = MMI_FALSE;
            }
        }
    } else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */

    if (g_wgui_mv_cat_cntx.is_audio_start_play == MMI_TRUE &&
        g_wgui_mv_cat_cntx.is_audio_play == MMI_FALSE)
    {
        MMI_BOOL ret_val;

        ret_val= g_wgui_mv_cat_cntx.start_consume_rights(&CURRENT_SLIDE->aud, 
                    g_wgui_mv_cat_cntx.drawable_media_file_path);
        g_wgui_mv_cat_cntx.is_audio_start_play = MMI_FALSE;
        if (ret_val == MMI_TRUE)
        {
            #ifdef __GAIN_TABLE_SUPPORT__
                mdi_audio_set_audio_type(MDI_AUDIO_TYPE_MESSAGE);
            #endif
            if (mdi_audio_play_file(
                        g_wgui_mv_cat_cntx.audio_file_path, 
                        DEVICE_AUDIO_PLAY_ONCE,
                        NULL,
                        wgui_mv_media_stopped_callback,
                        NULL) == MDI_AUDIO_SUCCESS)
            {
                g_wgui_mv_cat_cntx.is_audio_play = MMI_TRUE;
                mdi_audio_set_volume(MDI_VOLUME_MEDIA, g_wgui_mv_volume);
            }
            else
            {
                g_wgui_mv_is_media_valid = MMI_FALSE;
            }
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_draw_viewer
 * DESCRIPTION
 *  main draw routine that calls other display functions
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_draw_viewer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
	
#if defined(__MMI_FTE_SUPPORT__)    
    GDI_HANDLE hint_layer = GDI_NULL_HANDLE;
#endif


    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    /* setup layer blt sequence */
#if !defined(__MMI_FTE_SUPPORT__)
    if (CURRENT_SLIDE->vid.id != 0)
    {
        gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
    }
    else
    {
        gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, GDI_NULL_HANDLE, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
    }
#else
    if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
    {
        hint_layer = wgui_icon_bar_get_hint_layer_handle();
    }
    gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.baselayer, hint_layer, 0);
#endif
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */

#if !defined(__MMI_FTE_SUPPORT__)
    gdi_layer_restore_base_active();
    gdi_layer_set_source_key(FALSE, GDI_COLOR_TRANSPARENT);
#endif
    gdi_layer_lock_frame_buffer();

    if (g_wgui_mv_cat_layout.infobar.Flags == WGUI_MV_REDRAW_NEEDED)
    {
        wgui_mv_show_infobar();
    }
    if (g_wgui_mv_cat_layout.viewarea.Flags == WGUI_MV_REDRAW_NEEDED)
    {
        wgui_mv_show_viewarea();
		
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_FTE_SUPPORT__)
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        if(CURRENT_SLIDE->vid.id != 0 && g_wgui_mv_is_media_valid == MMI_TRUE  && g_wgui_mv_default_image_id != WGUI_DEFAULT_PREVIEW_AVIDEO_ID)
#else
        if(CURRENT_SLIDE->vid.id != 0 && g_wgui_mv_is_media_valid == MMI_TRUE  && g_wgui_mv_default_image_id != 0)
#endif
        {
            gdi_layer_push_and_set_active(GDI_LAYER_MAIN_BASE_LAYER_HANDLE);
            gdi_layer_set_clip(g_wgui_mv_bounding_rect.x1, g_wgui_mv_bounding_rect.y1, g_wgui_mv_bounding_rect.x2, g_wgui_mv_bounding_rect.y2);

            gdi_layer_set_source_key(TRUE, wgui_mv_convert_from_gdi_color_to_transparent_color());

            gdi_draw_solid_rect(g_wgui_mv_bounding_rect.x1, g_wgui_mv_bounding_rect.y1, g_wgui_mv_bounding_rect.x2, g_wgui_mv_bounding_rect.y2, wgui_mv_convert_from_gdi_color_to_transparent_color());
            gdi_layer_pop_and_restore_active();
        }
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_FTE_SUPPORT__) */
        
    }
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    if (g_wgui_mv_cat_layout.pbar_area.Flags == WGUI_MV_REDRAW_NEEDED)
    {
        #ifdef __MMI_MSG_FTE_ENHANCE__
            wgui_mv_show_infobar();
        #else
            if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
            {
                wgui_mv_show_progressbar();
            }
        #endif
    }
#endif
    gdi_layer_unlock_frame_buffer();
    gui_BLT_double_buffer(0, 0, LCD_WIDTH, LCD_HEIGHT);

if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && (CURRENT_SLIDE->vid.id || CURRENT_SLIDE->aud.id))
	  g_temp=MMI_TRUE;
 else
	 g_temp=MMI_FALSE;
    /* If state is playing then we need to start the timer for another term */
    if ((g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
        && (CURRENT_SLIDE->duration != 0 || g_temp) )
    {
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
		 if ((CURRENT_SLIDE->aud.id != 0) && (!g_wgui_mv_is_media_end))
                {
                    if (MMI_FALSE == g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->aud))
                    {
                        if (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE)
                        {
                            g_wgui_mv_cat_cntx.is_audio_start_play = MMI_TRUE;
                        }
                    }
                }

		 if (CURRENT_SLIDE->img.id)
        {
              //  g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_PLAY;
               // g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
       }
		 kal_get_time(&g_wgui_mv_last_tick);
         //g_wgui_mv_last_tick -= kal_milli_secs_to_ticks(6000); 
 #endif
		  wgui_mv_resume_media_playing();
        gui_start_timer(CAT630_SLIDE_TIME_UNIT, wgui_mv_handle_timer_event);
    }
}

	
/* layout Related */
#if defined(__MMI_MSG_FTE_ENHANCE__)
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_adjust_setup_in_toggle
 * DESCRIPTION
 *  Adjusts the Info bar and View area param when screen toggles
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_mv_adjust_setup_in_toggle(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 iconbar_height = 0;
    S32 gap = 0;
    S32 text_width = 0, text_height = 0;
    S32 img_width = 0, img_height = 0, img_width_attach = 0, img_height_attach = 0;
    PU8 img = NULL;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gap = (g_wgui_mv_cat_cntx.is_fullscreen) ? (CAT630_PBAR_VMARGIN) : (0);
#ifdef __MMI_ICON_BAR_SUPPORT__	
    iconbar_height = (wgui_icon_bar_is_created()) ? (MMI_ICON_BAR_HEIGHT + gap) : (0);
#endif/*__MMI_ICON_BAR_SUPPORT__*/
    /* Infobar */
    g_wgui_mv_cat_layout.infobar.s16X = MMI_content_x;
    g_wgui_mv_cat_layout.infobar.s16Width = MMI_content_width;
#if !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) 
    g_wgui_mv_cat_layout.infobar.s16Y = (g_wgui_mv_cat_cntx.is_fullscreen) ? (0) : (MMI_title_y);
    {
        S32 title_w, title_h;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        gdi_image_get_dimension_id(WGUI_MV_LEFT_ARROW_ICON_IMAGE_ID, &title_w, &title_h);
#else
        gdi_image_get_dimension_id(LEFT_RED_ARROW, &title_w, &title_h);
#endif
        g_wgui_mv_cat_layout.infobar.s16Height = (S16)(title_h + CAT630_ARROW_GAP);
    }
    g_wgui_mv_cat_layout.infobar.s16Height = g_wgui_mv_cat_layout.infobar.s16Height * 2 ;
#else /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) */
    g_wgui_mv_cat_layout.infobar.s16Y = 0;
    g_wgui_mv_cat_layout.infobar.s16Height = MMI_title_height;/*g_wgui_mv_cat_layout.pbar_img_height;*/
#endif /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) */
    g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;

    /* Left image (attachment icon) */
    img=(PU8)GetImage(WGUI_DEFAULT_VIEW_FULL_ID);
    gui_measure_image(img,&img_width,&img_height);
    img=(PU8)GetImage(WGUI_DEFAULT_VIEW_ATTACH_ID);
    gui_measure_image(img,&img_width_attach,&img_height_attach);

    /* for images on info bar */
    /* For left attachment image */
    g_wgui_mv_cat_layout.limage.s16X = g_wgui_mv_cat_layout.infobar.s16X + CAT630_ARROW_GAP;
    g_wgui_mv_cat_layout.limage.s16Y = g_wgui_mv_cat_layout.infobar.s16Y + 1;
    g_wgui_mv_cat_layout.limage.s16Width = img_width_attach;
    g_wgui_mv_cat_layout.limage.s16Height = img_height_attach;

    /* For right Full view image */
    g_wgui_mv_cat_layout.rimage.s16X = UI_device_width - img_width ; 
    g_wgui_mv_cat_layout.rimage.s16Y = g_wgui_mv_cat_layout.infobar.s16Y;
    g_wgui_mv_cat_layout.rimage.s16Width = img_width;
    g_wgui_mv_cat_layout.rimage.s16Height = img_height;                // for dummy image its same when get actual image it should be changed.

    /* Viewer Area */
    g_wgui_mv_cat_layout.viewarea.s16X = MMI_content_x;
    g_wgui_mv_cat_layout.viewarea.s16Y = g_wgui_mv_cat_layout.infobar.s16Y + g_wgui_mv_cat_layout.infobar.s16Height;
    g_wgui_mv_cat_layout.viewarea.s16Width = MMI_content_width;
    g_wgui_mv_cat_layout.viewarea.s16Height = UI_device_height - g_wgui_mv_cat_layout.viewarea.s16Y;
    g_wgui_mv_cat_layout.viewarea.s16Height -= (g_wgui_mv_cat_cntx.is_fullscreen) ? (0) : (MMI_button_bar_height);
    g_wgui_mv_cat_layout.viewarea.s16Height -= iconbar_height;
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;

    /* Multiline Inputbox */
    MMI_multiline_inputbox_x = g_wgui_mv_cat_layout.viewarea.s16X;
    MMI_multiline_inputbox_y = g_wgui_mv_cat_layout.viewarea.s16Y;
    MMI_multiline_inputbox_width = g_wgui_mv_cat_layout.viewarea.s16Width;
    MMI_multiline_inputbox_height = g_wgui_mv_cat_layout.viewarea.s16Height;

    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING && g_wgui_mv_cat_cntx.is_fullscreen == MMI_TRUE)
    {
        MMI_multiline_inputbox_height = UI_device_height - g_wgui_mv_cat_layout.viewarea.s16Y;
    }
    else 
    {
        MMI_multiline_inputbox_height = g_wgui_mv_cat_layout.viewarea.s16Height;
    }

    move_multiline_inputbox(g_wgui_mv_cat_layout.viewarea.s16X, g_wgui_mv_cat_layout.viewarea.s16Y);
    resize_multiline_inputbox(g_wgui_mv_cat_layout.viewarea.s16Width, g_wgui_mv_cat_layout.viewarea.s16Height);
    wgui_paging_multiline_set_percentage(g_wgui_mv_paging_cntx.page_id, (S16)g_wgui_mv_paging_cntx.text_offset);
}
#endif


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_setup_progressbar
 * DESCRIPTION
 *  setup progressbar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_setup_progressbar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /* Progress Bar */
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    S32 result;
    S32 bytesperpx;
    PU8 baselayerptr;
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
    S32 iconbar_height = 0;
    S32 gap = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_FTE_SUPPORT__)
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    gap = (g_wgui_mv_cat_cntx.is_fullscreen) ? (CAT630_PBAR_VMARGIN) : (0);
    #endif
#ifdef __MMI_ICON_BAR_SUPPORT__	
    iconbar_height = (wgui_icon_bar_is_created()) ? (MMI_ICON_BAR_HEIGHT + gap) : (0);
#endif/*__MMI_ICON_BAR_SUPPORT__*/
#endif /* defined(__MMI_FTE_SUPPORT__) */
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    memcpy(&g_wgui_mv_cat_layout.pbar_area, &g_wgui_mv_cat_layout.infobar, sizeof(dm_coordinates));
    if (g_wgui_mv_cat_layout.type == WGUI_MV_LAYOUT_TYPE_INDEPENDENT_PROGRESS_BAR)
    {
#if defined(__MMI_FTE_SUPPORT__)
        S32 fh = 0;

        if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
        {
            fh = Get_CharHeightOfAllLang(SMALL_FONT) + (CAT630_PBAR_VMARGIN);
        }
        g_wgui_mv_cat_layout.pbar_area.s16Y = UI_device_height - fh;
#else /* defined(__MMI_FTE_SUPPORT__) */
        g_wgui_mv_cat_layout.pbar_area.s16Y = UI_device_height - g_wgui_mv_cat_layout.pbar_img_height;
#endif /* defined(__MMI_FTE_SUPPORT__) */
        g_wgui_mv_cat_layout.pbar_area.s16Y -= (g_wgui_mv_cat_cntx.is_fullscreen) ? (0) : (MMI_button_bar_height);
#if defined(__MMI_FTE_SUPPORT__)
        g_wgui_mv_cat_layout.pbar_area.s16Y -= iconbar_height;
        g_wgui_mv_cat_layout.pbar_area.s16Height = fh;
#else /* defined(__MMI_FTE_SUPPORT__) */
        g_wgui_mv_cat_layout.pbar_area.s16Height = g_wgui_mv_cat_layout.pbar_img_height;
#endif /* defined(__MMI_FTE_SUPPORT__) */
    }

    g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NEEDED;

    if (g_wgui_mv_cat_layout.type == WGUI_MV_LAYOUT_TYPE_INDEPENDENT_PROGRESS_BAR)
    {
        #if !defined(__MMI_MSG_FTE_ENHANCE__)
            if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
            {
                g_wgui_mv_cat_layout.viewarea.s16Height -= g_wgui_mv_cat_layout.pbar_area.s16Height;
            }
    #endif /* !defined(__MMI_MSG_FTE_ENHANCE__) */ 
    }
    MMI_multiline_inputbox_height = g_wgui_mv_cat_layout.viewarea.s16Height;
#endif
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    /* Create Necessary Layers */

    /*
     * We use four layers
     * * 0 - for content area (baselayer) 
     * * 1 - for video (this layer maybe empty when no video is playing but we have to create anyway) (vlayer)
     * * 2 - for statusbar and infobar (tlayer)
     * * 3 - for progressbar and buttonbar (blayer)
     */

    result = gdi_layer_get_base_handle(&g_wgui_mv_cat_layout.baselayer);
    ASSERT(result >= 0);

    result = gdi_layer_get_buffer_ptr(&baselayerptr);
    ASSERT(result >= 0);
    bytesperpx = (gdi_layer_get_bit_per_pixel()) >> 3;

    g_wgui_mv_cat_layout.vlayer = g_wgui_mv_cat_layout.tlayer = g_wgui_mv_cat_layout.blayer = GDI_NULL_HANDLE;

    result = gdi_layer_create_cf_using_outside_memory(
                (gdi_color_format)bytesperpx,
                MMI_CONTENT_X,
                0,
                MMI_CONTENT_WIDTH,
                g_wgui_mv_cat_layout.infobar.s16Y + g_wgui_mv_cat_layout.infobar.s16Height,
                &g_wgui_mv_cat_layout.tlayer,
                baselayerptr,
                (g_wgui_mv_cat_layout.infobar.s16Y + g_wgui_mv_cat_layout.infobar.s16Height) * (MMI_CONTENT_WIDTH) * bytesperpx);
    ASSERT(result >= 0);

    baselayerptr =
        baselayerptr + (bytesperpx * (MMI_CONTENT_WIDTH) * (g_wgui_mv_cat_layout.viewarea.s16Y + g_wgui_mv_cat_layout.viewarea.s16Height));
    if (g_wgui_mv_cat_layout.type == WGUI_MV_LAYOUT_TYPE_INDEPENDENT_PROGRESS_BAR)
    {
        result = gdi_layer_create_cf_using_outside_memory(
                    (gdi_color_format)bytesperpx,
                    MMI_CONTENT_X,
                    g_wgui_mv_cat_layout.viewarea.s16Y + g_wgui_mv_cat_layout.viewarea.s16Height,
                    MMI_CONTENT_WIDTH,
                    MMI_BUTTON_BAR_HEIGHT + g_wgui_mv_cat_layout.pbar_area.s16Height + iconbar_height,
                    &g_wgui_mv_cat_layout.blayer,
                    baselayerptr,
                    MMI_CONTENT_WIDTH * (MMI_BUTTON_BAR_HEIGHT + g_wgui_mv_cat_layout.pbar_area.s16Height + iconbar_height) * bytesperpx);
    }
    else
    {
        result = gdi_layer_create_cf_using_outside_memory(
                    (gdi_color_format)bytesperpx,
                    MMI_CONTENT_X,
                    g_wgui_mv_cat_layout.viewarea.s16Y + g_wgui_mv_cat_layout.viewarea.s16Height,
                    MMI_CONTENT_WIDTH,
                    MMI_BUTTON_BAR_HEIGHT + iconbar_height,
                    &g_wgui_mv_cat_layout.blayer,
                    baselayerptr,
                    MMI_CONTENT_WIDTH * (MMI_BUTTON_BAR_HEIGHT + iconbar_height) * bytesperpx);
    }
    ASSERT(result >= 0);
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
}

/* 1 This function calculates the screen layout for once on entering the category */
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_setup_screen_layout
 * DESCRIPTION
 *  setup screen layout and save layout. Is called only once from show category
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_setup_screen_layout(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 text_width, text_height;
    S32 img_width, img_height, img_width_attach, img_height_attach;
    S32 iconbar_height = 0;
    S32 gap = 0;
    PU8 img = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Shifted here for it is the init part. */

    #if defined (__MMI_VIDEO_PLAY_SUPPORT__) 
        if (g_wgui_mv_cat_layout.vlayer != GDI_NULL_HANDLE)
        {
            gdi_layer_free(g_wgui_mv_cat_layout.vlayer);
            g_wgui_mv_cat_layout.vlayer = GDI_NULL_HANDLE;
        }
        if (g_wgui_mv_cat_layout.tlayer != GDI_NULL_HANDLE)
        {
            gdi_layer_free(g_wgui_mv_cat_layout.tlayer);
            g_wgui_mv_cat_layout.tlayer = GDI_NULL_HANDLE;
        }
        if (g_wgui_mv_cat_layout.blayer != GDI_NULL_HANDLE)
        {
            gdi_layer_free(g_wgui_mv_cat_layout.blayer);
            g_wgui_mv_cat_layout.blayer = GDI_NULL_HANDLE;
        }
#endif /* defined (__MMI_VIDEO_PLAY_SUPPORT__) */ 

    memset(&g_wgui_mv_cat_layout, 0, sizeof(wgui_mv_layout_struct));
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    /* WGUI_MV_TITLE_ICON_IMAGE_ID should be 2 px larger in height than WGUI_MV_BAR_ICON_IMAGE_ID */
    /* Now, in themes */
    g_wgui_mv_cat_layout.pbar_img = (PU8) current_MMI_theme->mms_viewer_progress_bar_img;
	if(!g_wgui_mv_cat_layout.pbar_img)
	{
      g_wgui_mv_cat_layout.pbar_img= (PU8) GetImage(WGUI_MV_BAR_ICON_IMAGE_ID);
	}
#if !defined(__MMI_FTE_SUPPORT__)
    ASSERT(g_wgui_mv_cat_layout.pbar_img);
#endif

    gui_measure_image(
        g_wgui_mv_cat_layout.pbar_img,
        &g_wgui_mv_cat_layout.pbar_img_width,
        &g_wgui_mv_cat_layout.pbar_img_height);

#if !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__)
    g_wgui_mv_cat_layout.type = WGUI_MV_LAYOUT_TYPE_INDEPENDENT_PROGRESS_BAR;
#else 
    g_wgui_mv_cat_layout.type = WGUI_MV_LAYOUT_TYPE_OVERLAPPING_PROGRESS_BAR;
#endif 
#endif/* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
    gui_setup_common_layout();

#if defined(__MMI_FTE_SUPPORT__)
	#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    gap = (g_wgui_mv_cat_cntx.is_fullscreen) ? (CAT630_PBAR_VMARGIN) : (0);
    #endif
#ifdef __MMI_ICON_BAR_SUPPORT__	
    iconbar_height = (wgui_icon_bar_is_created()) ? (MMI_ICON_BAR_HEIGHT + gap) : (0);
#endif/*__MMI_ICON_BAR_SUPPORT__*/
#endif /* defined(__MMI_FTE_SUPPORT__) */

    /* Infobar */
    g_wgui_mv_cat_layout.infobar.s16X = MMI_content_x;
    g_wgui_mv_cat_layout.infobar.s16Width = MMI_content_width;
    
#if !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) //&& !defined(__MMI_MAINLCD_320X240__)
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    g_wgui_mv_cat_layout.infobar.s16Y = 0;
#else 
    g_wgui_mv_cat_layout.infobar.s16Y = (g_wgui_mv_cat_cntx.is_fullscreen) ? (0) : (MMI_title_y);
#endif 
//#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    #if defined(__MMI_FTE_SUPPORT__)
        {
            S32 title_w, title_h;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            gdi_image_get_dimension_id(WGUI_MV_LEFT_ARROW_ICON_IMAGE_ID, &title_w, &title_h);
#else
            gdi_image_get_dimension_id(LEFT_RED_ARROW, &title_w, &title_h);
#endif
            g_wgui_mv_cat_layout.infobar.s16Height = (S16)(title_h + CAT630_ARROW_GAP);
        }
    #else /* defined(__MMI_FTE_SUPPORT__) */
        g_wgui_mv_cat_layout.infobar.s16Height = MMI_title_height;/*g_wgui_mv_cat_layout.pbar_img_height;*/
    #endif /* defined(__MMI_FTE_SUPPORT__) */

//#else /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
  //  g_wgui_mv_cat_layout.infobar.s16Height = MMI_title_height;
//#endif /* __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ */ 
	

    #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_MSG_FTE_ENHANCE__)
        g_wgui_mv_cat_layout.infobar.s16Height = g_wgui_mv_cat_layout.infobar.s16Height * 2 ;
    #elif defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) 
        if(g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            g_wgui_mv_cat_layout.infobar.s16Height = g_wgui_mv_cat_layout.infobar.s16Height * 2 ;
        }
    #elif defined(__MMI_MSG_FTE_ENHANCE__)
        if(g_wgui_mv_cat_cntx.display_mode  == WGUI_MV_DISPLAY_MODE_PLAY)
        {
            g_wgui_mv_cat_layout.infobar.s16Height = g_wgui_mv_cat_layout.infobar.s16Height * 2 ;
        }
    #endif

#else /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_320X240__) */
    g_wgui_mv_cat_layout.infobar.s16Y = 0;
	#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    g_wgui_mv_cat_layout.infobar.s16Height = g_wgui_mv_cat_layout.pbar_img_height;
      #else
        g_wgui_mv_cat_layout.infobar.s16Height = MMI_title_height;
#endif /* missed this #endif */
#endif /* !defined(__MMI_MAINLCD_128X128__) && !defined(__MMI_MAINLCD_128X160__) && !defined(__MMI_MAINLCD_320X240__) */

    g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;

#ifdef __MMI_MSG_FTE_ENHANCE__
    img=(PU8)GetImage(WGUI_DEFAULT_VIEW_FULL_ID);
    gui_measure_image(img,&img_width,&img_height);
    img=(PU8)GetImage(WGUI_DEFAULT_VIEW_ATTACH_ID);
    gui_measure_image(img,&img_width_attach,&img_height_attach);

    /* for images on info bar */

    /*for left attachment  image*/
    g_wgui_mv_cat_layout.limage.s16X = g_wgui_mv_cat_layout.infobar.s16X + CAT630_ARROW_GAP;
    g_wgui_mv_cat_layout.limage.s16Y = g_wgui_mv_cat_layout.infobar.s16Y + 1;
    g_wgui_mv_cat_layout.limage.s16Width = img_width_attach;
    g_wgui_mv_cat_layout.limage.s16Height = img_height_attach;

    /*for right Full view image */
    g_wgui_mv_cat_layout.rimage.s16X= UI_device_width - img_width ; //g_wgui_mv_cat_layout.infobar.s16Width/4+g_wgui_mv_cat_layout.infobar.s16Width/2;
    g_wgui_mv_cat_layout.rimage.s16Y=g_wgui_mv_cat_layout.infobar.s16Y;
    g_wgui_mv_cat_layout.rimage.s16Width=img_width;
    g_wgui_mv_cat_layout.rimage.s16Height=img_height;                // for dummy image its same when get actual image it should be changed.
#endif

    /* Viewer Area */
    g_wgui_mv_cat_layout.viewarea.s16X = MMI_content_x;
    /*
    if(!g_wgui_mv_cat_cntx.is_fullscreen)
    {
        g_wgui_mv_cat_layout.viewarea.s16Y = g_wgui_mv_cat_layout.infobar.s16Y +g_wgui_mv_cat_layout.infobar.s16Height+50;
    }
    else*/
    {
        g_wgui_mv_cat_layout.viewarea.s16Y = g_wgui_mv_cat_layout.infobar.s16Y + g_wgui_mv_cat_layout.infobar.s16Height;
    }
    g_wgui_mv_cat_layout.viewarea.s16Width = MMI_content_width;
    g_wgui_mv_cat_layout.viewarea.s16Height = UI_device_height - g_wgui_mv_cat_layout.viewarea.s16Y;
    g_wgui_mv_cat_layout.viewarea.s16Height -= (g_wgui_mv_cat_cntx.is_fullscreen) ? (0) : (MMI_button_bar_height);
    g_wgui_mv_cat_layout.viewarea.s16Height -= iconbar_height;
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;

    /* Multiline Inputbox */
    MMI_multiline_inputbox_x = g_wgui_mv_cat_layout.viewarea.s16X;
    MMI_multiline_inputbox_y = g_wgui_mv_cat_layout.viewarea.s16Y;
    MMI_multiline_inputbox_width = g_wgui_mv_cat_layout.viewarea.s16Width;
    MMI_multiline_inputbox_height = g_wgui_mv_cat_layout.viewarea.s16Height;
	
#ifdef __MMI_MSG_FTE_ENHANCE__
    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING && g_wgui_mv_cat_cntx.is_fullscreen == MMI_TRUE)
    {
        MMI_multiline_inputbox_height = UI_device_height - g_wgui_mv_cat_layout.viewarea.s16Y;
    }
    else 
    {
        MMI_multiline_inputbox_height = g_wgui_mv_cat_layout.viewarea.s16Height;
    }
#endif

}

/* 1 This fn is called everytime a slide is intialised */


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_multiline_object_viewable_area
 * DESCRIPTION
 *  find drawable media height
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_set_multiline_object_viewable_area(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    S32 min_img_w = 0, min_img_h = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* init multiline inputbox */
    MMI_multiline_inputbox.header_height = 0;
    MMI_multiline_inputbox.footer_height = 0;
    MMI_multiline_inputbox.left_width = 0;
    MMI_multiline_inputbox.right_width = 0;
    MMI_multiline_inputbox.left_height = 0;
    MMI_multiline_inputbox.right_height = 0;
    MMI_multiline_inputbox.header_callback = NULL;
    MMI_multiline_inputbox.footer_callback = NULL;
    MMI_multiline_inputbox.left_callback = NULL;
    MMI_multiline_inputbox.right_callback = NULL;


    /* get minimum image width & height */
    if ((CURRENT_SLIDE->vid.id) || (CURRENT_SLIDE->img.id))
    {
        g_wgui_mv_cat_cntx.is_media_valid = wgui_mv_set_drawable_object_region();
        switch (g_wgui_mv_cat_cntx.current_msg.layout)
        {
            case SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_TOP:
	    
                min_img_w = g_wgui_mv_cat_layout.viewarea.s16Width - current_MMI_theme->scrollbar_size - (CAT630_HMARGIN << 1);
                min_img_h = g_wgui_mv_cat_layout.resized_yoffset + g_wgui_mv_cat_layout.resized_height + (CAT630_VMARGIN << 1);;
                MMI_multiline_inputbox.header_height = min_img_h;
                MMI_multiline_inputbox.header_callback = wgui_mv_show_drawable_object;
                break;

            case SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_BOTTOM:
                min_img_w = g_wgui_mv_cat_layout.viewarea.s16Width - current_MMI_theme->scrollbar_size - (CAT630_HMARGIN << 1);
                min_img_h = g_wgui_mv_cat_layout.resized_height + (CAT630_VMARGIN << 1);;
                MMI_multiline_inputbox.footer_height = min_img_h;
                MMI_multiline_inputbox.footer_callback = wgui_mv_show_drawable_object;
                break;

            case SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_LEFT:
                min_img_w = g_wgui_mv_cat_layout.resized_xoffset + g_wgui_mv_cat_layout.resized_width;
                min_img_w -= (mmi_fe_get_r2l_state()) ? (current_MMI_theme->scrollbar_size) : (0);
                min_img_h = g_wgui_mv_cat_layout.viewarea.s16Height - (CAT630_VMARGIN << 1);
                MMI_multiline_inputbox.left_width = min_img_w;
                MMI_multiline_inputbox.left_height = min_img_h;
                MMI_multiline_inputbox.left_callback = wgui_mv_show_drawable_object;
                break;

            case SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT:
                min_img_w = g_wgui_mv_cat_layout.viewarea.s16Width - g_wgui_mv_cat_layout.resized_xoffset;
                min_img_w -= (mmi_fe_get_r2l_state()) ? (0) : (current_MMI_theme->scrollbar_size);
                min_img_h = g_wgui_mv_cat_layout.viewarea.s16Height - (CAT630_VMARGIN << 1);
                MMI_multiline_inputbox.right_width = (S16)min_img_w;
                MMI_multiline_inputbox.right_height = (S16)min_img_h;
                MMI_multiline_inputbox.right_callback = wgui_mv_show_drawable_object;
                break;
        }
    }

    /* cacluate text x_offset and width */
    {
        mma_mms_object_area_struct *area = NULL;
#ifdef __MMI_MMS_MV_SUPPORT_PARAM_OF_REGION__
        area = (CURRENT_SLIDE->txt.id) ? (CURRENT_SLIDE->txt.region_area) : (area);
#endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        if (area != NULL)
        {
            S32 text_x = 0, text_w = 0;
            S32 editor_w = g_wgui_mv_cat_layout.viewarea.s16Width - current_MMI_theme->scrollbar_size - (CAT630_HMARGIN << 1);
            
            text_x = (S32)area->x.value;
            text_w = (S32)area->w.value;

            switch(g_wgui_mv_cat_cntx.current_msg.layout)
            {
                case SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_LEFT:
                    text_x -= min_img_w;
                case SRV_MMS_VIEWER_DRAWABLE_MEDIA_ON_RIGHT:
                    text_x -= (mmi_fe_get_r2l_state()) ? (current_MMI_theme->scrollbar_size) : (0);
                    editor_w -= min_img_w;
                    break;

                default:
                    break;
            }

            /* boundary check */
            text_x = (text_x < CAT630_HMARGIN) ? (CAT630_HMARGIN) : (text_x);
            text_w = (text_w < WGUI_MV_MIN_TEXT_WIDTH) ? (WGUI_MV_MIN_TEXT_WIDTH) : (text_w);
            text_w = (text_w > editor_w) ? (editor_w) : (text_w);
            text_x = (text_x > (editor_w - text_w)) ? (editor_w - text_w) : (text_x);

            MMI_multiline_inputbox.fixed_text_start_x = text_x;
            MMI_multiline_inputbox.fixed_text_width = text_w;
            MMI_multiline_inputbox.ext_flags |= GUI_MULTI_LINE_INPUT_BOX_FIXED_TEXT_AREA;
        }
#endif
    }

    MMI_multiline_inputbox.min_text_height = 0;
    MMI_multiline_inputbox.min_line_height = CAT630_MIN_LINE_HEIGHT;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_display_loading_screen
 * DESCRIPTION
 *  display loading screen for non-blocking callback
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_display_loading_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    UI_string_type str;
#else
	U8 str[4];
#endif
    S32 str_len;
    color tc;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    /* reset softkey */
   // SetKeyHandler(NULL, KEY_ENTER, KEY_EVENT_DOWN);
   //  SetKeyHandler(NULL, KEY_ENTER, KEY_EVENT_UP);
    if (g_wgui_mv_cat_cntx.is_fullscreen)
    {
        SetKeyHandler(NULL, KEY_LSK, KEY_EVENT_UP);
        SetKeyHandler(NULL, KEY_RSK, KEY_EVENT_UP);
        redraw_left_softkey();
        redraw_right_softkey();
    }
    else
    {
        change_left_softkey(STRING_ID_NULL, IMAGE_ID_NULL);
        change_right_softkey(STRING_ID_NULL, IMAGE_ID_NULL);
        SetLeftSoftkeyFunction(MMI_dummy_function, KEY_EVENT_UP);
        SetRightSoftkeyFunction(MMI_dummy_function, KEY_EVENT_UP);
#ifndef __MMI_WGUI_DISABLE_CSK__
        SetCenterSoftkeyFunction(NULL, KEY_EVENT_UP);
        ResetCenterSoftkey();
        redraw_center_softkey();
#endif
        redraw_left_softkey();
        redraw_right_softkey();
    }

    /* reset tool bar */
#ifdef __MMI_ICON_BAR_SUPPORT__	
#if defined(__MMI_FTE_SUPPORT__)
    if (wgui_icon_bar_is_created())
    {
        S32 x, y, h;

        /* if tool bar item is still pressed, clear pen event and reset tool bar */
        mmi_pen_reset();

        wgui_icon_bar_move(-255, -255);
		g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_DISABLE_ENABLE_ACTION);
        wgui_icon_bar_update();

        x = 0;
        y = UI_device_height - MMI_ICON_BAR_HEIGHT;
        y -= (g_wgui_mv_cat_cntx.is_fullscreen) ? (CAT630_PBAR_VMARGIN) : (MMI_softkey_height);
        h = MMI_ICON_BAR_HEIGHT;
        h += (g_wgui_mv_cat_cntx.is_fullscreen) ? (CAT630_PBAR_VMARGIN) : (0);
        wgui_mv_hide_icon_bar(x, y, x + UI_device_width - 1, y + h - 1);
    }
#endif /* defined(__MMI_FTE_SUPPORT__) */
#endif /*__MMI_ICON_BAR_SUPPORT__*/
    /* set base layer with no transparent color */
    gdi_layer_set_source_key(FALSE, GDI_COLOR_TRANSPARENT);

    /* set multi-line input-box */
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    str = (UI_string_type)GetString(STR_GLOBAL_PLEASE_WAIT);
#else
	memset(str, 0, 4);
#endif
    str_len = mmi_ucs2strlen((PS8) str);
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    create_multiline_inputbox_set_buffer(str, str_len, str_len, 0);
#else
	create_multiline_inputbox_set_buffer((UI_string_type)str, 4, str_len, 0);
#endif
    MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW | UI_MULTI_LINE_INPUT_BOX_CENTER_JUSTIFY | UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR | UI_MULTI_LINE_INPUT_BOX_VIEW_MODE;
    MMI_multiline_inputbox.text_font = &MMI_medium_font;

    /* set text & background color */
    if (((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.id != 0) &&
        ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.str_id == 0) && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc,
            ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.fg_color) << 8);
        wgui_mv_convert_from_gdi_color_to_color(&g_wgui_mv_loading_bg_filler.c,
            ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->txt.bg_color) << 8);
    }
    else
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc,
            (g_wgui_mv_cat_cntx.current_msg.foreground_color) << 8);
        wgui_mv_convert_from_gdi_color_to_color(&g_wgui_mv_loading_bg_filler.c,
            (g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
    }
    g_wgui_mv_loading_bg_filler.flags = UI_FILLED_AREA_TYPE_COLOR | UI_FILLED_AREA_TYPE_NO_BORDER;
    MMI_multiline_inputbox.normal_text_color = tc;
    MMI_multiline_inputbox.normal_filler = &g_wgui_mv_loading_bg_filler;
    MMI_multiline_inputbox.boundary_color = tc;
    MMI_multiline_inputbox.vbar.normal_bar_filler = &g_wgui_mv_loading_bg_filler;

	

    /* Disable clipboard */
    wgui_inputs_ml_set_style(0, GUI_MULTI_LINE_INPUT_BOX_DISABLE_CLIPBOARD);

    /* display "please wait" */
    show_multiline_inputbox();

#if defined(__MMI_TOUCH_SCREEN__)
    /* Because hilite list requires addtional handler,
     * we have to reset the default pen event handler */
    wgui_register_general_pen_handler();
#endif /* defined(__MMI_TOUCH_SCREEN__) */

    /* redraw information & progress bar */
    wgui_mv_show_infobar();

    gdi_layer_unlock_frame_buffer();
    gdi_lcd_repaint_all();
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_reset_softkey_on_play
 * DESCRIPTION
 *  set softkey for playing mode
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_reset_softkey_on_play(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

 if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && (CURRENT_SLIDE->vid.id || CURRENT_SLIDE->aud.id))
	  g_temp=MMI_TRUE;
 else
	 g_temp=MMI_FALSE;
#if !defined(__MMI_SLIM_MMS_2__)
    if((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->duration == 0 && (!g_temp))
    {
        SetKeyHandler(UI_dummy_function, KEY_ENTER, KEY_EVENT_DOWN);  
    }
    else
    {
        SetKeyHandler(wgui_mv_pause_slide_playing, KEY_ENTER, KEY_EVENT_DOWN);
    }
#endif

    SetKeyHandler(NULL, KEY_ENTER, KEY_EVENT_UP);
	#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    if (g_wgui_mv_cat_cntx.is_fullscreen)
    {

        #ifdef __MMI_MSG_FTE_ENHANCE__
            SetKeyHandler(UI_dummy_function, KEY_LSK, KEY_EVENT_UP);
            SetKeyHandler(UI_dummy_function, KEY_LSK, KEY_EVENT_DOWN);
            SetKeyHandler(UI_dummy_function, KEY_RSK, KEY_EVENT_DOWN);
            SetKeyHandler(wgui_mv_stop_slide_playing, KEY_RSK, KEY_EVENT_UP);
        #else
            SetKeyHandler(NULL, KEY_LSK, KEY_EVENT_UP);
            SetKeyHandler(wgui_mv_stop_slide_playing, KEY_RSK, KEY_EVENT_UP);
        #endif       
    }
    else
    {
        /* Key display sync */
        gdi_layer_lock_frame_buffer();
        
        #ifdef __MMI_MSG_FTE_ENHANCE__
            if((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->duration == 0 && (!g_temp))
            {
                ChangeLeftSoftkey(STRING_ID_NULL, IMAGE_ID_NULL);
                SetLeftSoftkeyFunction(UI_dummy_function, KEY_EVENT_UP);
            }
            else
            {
                ChangeLeftSoftkey(STR_GLOBAL_PAUSE, IMAGE_ID_NULL);
                SetLeftSoftkeyFunction(wgui_mv_pause_slide_playing, KEY_EVENT_UP);
            }
        #else
            ChangeLeftSoftkey(STRING_ID_NULL, IMAGE_ID_NULL);
            SetLeftSoftkeyFunction(NULL, KEY_EVENT_UP);
        #endif
        ChangeRightSoftkey(STR_GLOBAL_STOP, IMAGE_ID_NULL);
        SetRightSoftkeyFunction(wgui_mv_stop_slide_playing, KEY_EVENT_UP);

#if !defined(__MMI_SLIM_MMS_2__)

        if((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->duration == 0)
        {
#ifndef __MMI_WGUI_DISABLE_CSK__
            ChangeCenterSoftkey(STRING_ID_NULL, WGUI_MV_PAUSE_IMAGE_ID);
            SetCenterSoftkeyFunction(UI_dummy_function, KEY_EVENT_UP);
#endif
        }
        else
        {
#ifndef __MMI_WGUI_DISABLE_CSK__
            ChangeCenterSoftkey(STRING_ID_NULL, WGUI_MV_PAUSE_IMAGE_ID);
            SetCenterSoftkeyFunction(wgui_mv_pause_slide_playing, KEY_EVENT_UP);
#endif
        }

#endif /* defined(__MMI_SLIM_MMS_2__) */

		

        gdi_layer_unlock_frame_buffer();
        redraw_left_softkey();
        redraw_right_softkey();
#if !defined(__MMI_SLIM_MMS_2__)

        redraw_center_softkey();

#endif /* defined(__MMI_SLIM_MMS_2__) */


    }
	#endif
#ifdef  __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
SetGroupKeyHandler(wgui_mv_stop_slide_playing, (PU16) PresentAllKeys, (U8) TOTAL_KEYS, KEY_EVENT_DOWN);
		wgui_mv_register_keys();

#endif


}


#if !defined(__MMI_SLIM_MMS_2__)
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_reset_softkey_on_pause
 * DESCRIPTION
 *  set softkey for pausing mode
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_reset_softkey_on_pause(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(wgui_mv_resume_slide_pausing, KEY_ENTER, KEY_EVENT_DOWN);
    SetKeyHandler(NULL, KEY_ENTER, KEY_EVENT_UP);

    if (g_wgui_mv_cat_cntx.is_fullscreen)
    {
        #ifdef __MMI_MSG_FTE_ENHANCE__
            SetKeyHandler(UI_dummy_function, KEY_LSK, KEY_EVENT_UP);
            SetKeyHandler(UI_dummy_function, KEY_LSK, KEY_EVENT_DOWN);
            SetKeyHandler(UI_dummy_function, KEY_RSK, KEY_EVENT_DOWN);
            SetKeyHandler(wgui_mv_stop_slide_playing, KEY_RSK, KEY_EVENT_UP);
        #else
            SetKeyHandler(NULL, KEY_LSK, KEY_EVENT_UP);
            SetKeyHandler(wgui_mv_stop_slide_playing, KEY_RSK, KEY_EVENT_UP);
        #endif       
    }
    else
    {
        /* Key display sync */
        gdi_layer_lock_frame_buffer();
        
        #ifdef __MMI_MSG_FTE_ENHANCE__
            ChangeLeftSoftkey(STR_GLOBAL_CONTINUE, IMAGE_ID_NULL);
            ChangeRightSoftkey(STR_GLOBAL_STOP, IMAGE_ID_NULL);
            SetLeftSoftkeyFunction(wgui_mv_resume_slide_pausing, KEY_EVENT_UP);
            SetRightSoftkeyFunction(wgui_mv_stop_slide_playing, KEY_EVENT_UP);
        #else
            ChangeLeftSoftkey(STRING_ID_NULL, IMAGE_ID_NULL);
            ChangeRightSoftkey(STR_GLOBAL_STOP, IMAGE_ID_NULL);
            SetLeftSoftkeyFunction(NULL, KEY_EVENT_UP);
            SetRightSoftkeyFunction(wgui_mv_stop_slide_playing, KEY_EVENT_UP);
        #endif

#ifndef __MMI_WGUI_DISABLE_CSK__
        ChangeCenterSoftkey(STRING_ID_NULL, WGUI_MV_RESUME_IMAGE_ID);
        SetCenterSoftkeyFunction(wgui_mv_resume_slide_pausing, KEY_EVENT_UP);
#endif
        gdi_layer_unlock_frame_buffer();

        #ifdef __MMI_MSG_FTE_ENHANCE__
            if(g_wgui_mv_cat_cntx.is_fullscreen == KAL_FALSE)
            {
                redraw_left_softkey();
                redraw_right_softkey();
            }
        #else
            redraw_left_softkey();
            redraw_right_softkey();
        #endif

        
            redraw_center_softkey();
        

    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_reset_softkey_on_show
 * DESCRIPTION
 *  set softkey for stop mode
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_reset_softkey_on_show(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(NULL, KEY_ENTER, KEY_EVENT_UP);
    SetKeyHandler(NULL, KEY_ENTER, KEY_EVENT_DOWN);    

    if (g_wgui_mv_cat_cntx.is_fullscreen)
    {
        SetKeyHandler(g_wgui_mv_cat_cntx.lsk_fn, KEY_LSK, KEY_EVENT_UP);
        SetKeyHandler(g_wgui_mv_cat_cntx.rsk_fn, KEY_RSK, KEY_EVENT_UP);
    }
    else
    {
        /* Key display sync */
        gdi_layer_lock_frame_buffer();

        change_left_softkey(g_wgui_mv_cat_cntx.lsk_str_id, IMAGE_ID_NULL);
        change_right_softkey(STR_GLOBAL_BACK, IMAGE_ID_NULL);
        SetLeftSoftkeyFunction(g_wgui_mv_cat_cntx.lsk_fn, KEY_EVENT_UP);
        SetRightSoftkeyFunction(g_wgui_mv_cat_cntx.rsk_fn, KEY_EVENT_UP);
       if(g_wgui_mv_cat_cntx.csk_func)
	   {
#ifndef __MMI_WGUI_DISABLE_CSK__
        EnableCenterSoftkey(0, g_wgui_mv_cat_cntx.csk_icon);
        SetCenterSoftkeyFunction(g_wgui_mv_cat_cntx.csk_func, KEY_EVENT_UP);
#endif
	   }

        redraw_left_softkey();
        redraw_right_softkey();

        redraw_center_softkey();

        gdi_layer_unlock_frame_buffer();
    }
    

}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_get_paging_view_area
 * DESCRIPTION
 *  get the view area of current multi-line input-box
 * PARAMETERS
 *  start       [OUT]   start address
 *  end         [OUT]   out address
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_get_paging_view_area(S32 *start, S32 *end)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 curr_text_offset, curr_text_offset_y;
    U8 curr_shared_bytes, curr_percentage;
    S32 start_text_offset, end_text_offset;
    U32 curr_page_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* get current editor information */
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    wgui_paging_multiline_get_current_page(
        &curr_page_id, &curr_text_offset, &curr_shared_bytes,
        &curr_percentage, &curr_text_offset_y);
#endif
    /* calculate the range of current displayed text on the screen */
    start_text_offset = GUI_PAGE_SIZE * curr_page_id + curr_text_offset - curr_shared_bytes;
    start_text_offset = (start_text_offset >= 0) ? (start_text_offset) : (0);
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    end_text_offset = start_text_offset + MMI_multiline_inputbox.current_page_count;
#endif
    *start = start_text_offset;
    *end = end_text_offset;
}


#ifdef __MMI_TOUCH_SCREEN__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_hilite_click_cb
 * DESCRIPTION
 *  Callback for tapping on a hilited item in multi-line input-box 
 * PARAMETERS
 *  idx    [IN]    index of the tapped item
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_hilite_click_cb(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_wgui_mv_cat_cntx.current_highlighted_item = g_wgui_mv_hilite_list_idx_map[idx];

    /* Convey the tapped item's data to application */
    if (g_wgui_mv_cat_cntx.highlight_handler != NULL)
    {
        g_wgui_mv_cat_cntx.highlight_click_handler(g_wgui_mv_cat_cntx.current_highlighted_item);
    }

    /* click the highlighted item */
    if (g_wgui_mv_hilite_cb_from_goto == MMI_FALSE)
    {
        g_wgui_mv_cat_cntx.previous_highlighted_item = g_wgui_mv_cat_cntx.current_highlighted_item;
    }
}
#endif

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_hilite_cb
 * DESCRIPTION
 *  callback for multi-line input-box hilite list
 * PARAMETERS
 *  idx    [IN]    index of the hilite list
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_hilite_cb(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_wgui_mv_cat_cntx.current_highlighted_item = g_wgui_mv_hilite_list_idx_map[idx];

    /* inform application which item is highlighted */
    if (g_wgui_mv_cat_cntx.highlight_handler != NULL)
    {
        g_wgui_mv_cat_cntx.highlight_handler((srv_mms_viewer_use_details_list *)g_wgui_mv_cat_cntx.current_highlighted_item);
    }

    /* click the highlighted item */
    if (g_wgui_mv_hilite_cb_from_goto == MMI_FALSE)
    {
        g_wgui_mv_cat_cntx.previous_highlighted_item = g_wgui_mv_cat_cntx.current_highlighted_item;
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_refresh_hilite_list_all
 * DESCRIPTION
 *  refresh hilite list with current setting
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_mv_refresh_hilite_list_all(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_mv_refresh_hilite_list(g_wgui_mv_hilite_list, WGUI_MV_MAX_HILITE_NUMBER, g_wgui_mv_cat_cntx.current_highlighted_item);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_refresh_hilite_list
 * DESCRIPTION
 *  refresh hilite list
 * PARAMETERS
 *  list                [OUT]   hilite list
 *  max_items           [IN]    maximun number of hilite list
 *  highlighted_item    [IN]    current highlighted item
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_refresh_hilite_list(HILITE_STR *list, S32 max_items, srv_mms_viewer_use_details_list *highlighted_item)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i;
    srv_mms_viewer_use_details_list *item = highlighted_item;
    S32 start_text_offset, end_text_offset, real_start_text_offset;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (item != NULL)
    {
        /* reset hilite list */
        memset(g_wgui_mv_hilite_list, 0, sizeof(g_wgui_mv_hilite_list));
        memset(g_wgui_mv_hilite_format_list, 0, sizeof(g_wgui_mv_hilite_format_list));
        memset(g_wgui_mv_hilite_list_idx_map, 0, sizeof(g_wgui_mv_hilite_list_idx_map));

        /* seek to head */
        while (item->prev != NULL)
        {
            item = item->prev;
        }

        /* get real start text offset from the paging content to original full content */
        {
            U32 curr_page_id;
            S32 curr_text_offset, curr_text_offset_y;
            U8 curr_shared_bytes, curr_percentage;
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
            wgui_paging_multiline_get_current_page(
                &curr_page_id, &curr_text_offset, &curr_shared_bytes,
                &curr_percentage, &curr_text_offset_y);
#endif
            real_start_text_offset = GUI_PAGE_SIZE * curr_page_id - curr_shared_bytes;
            real_start_text_offset = (real_start_text_offset >= 0) ? (real_start_text_offset) : (0);
        }

        /* get paging area info */
        wgui_mv_get_paging_view_area(&start_text_offset, &end_text_offset);
        start_text_offset -= MMI_content_width;     /* peek previous uncomplete words */
        start_text_offset = (start_text_offset >= 0) ? (start_text_offset) : (0);
        end_text_offset += MMI_content_width;       /* peek following uncomplete words */

        /* add into hilite list */
        MMI_multiline_inputbox.current_hilite_idx = i = 0;
        while (item != NULL)
        {
            if ((item->offset >= (start_text_offset - item->len)) &&
                (item->offset <= (end_text_offset)))
            {
                S32 offset = (item->offset > real_start_text_offset) ? (item->offset - real_start_text_offset) : (0);
                PS8 str_addr = (PS8)(g_wgui_mv_cat_cntx.pinputboxbuffer + (offset * ENCODING_LENGTH));
                U16 len = item->len;

                if (item->offset < start_text_offset)
                {
                    offset = (start_text_offset > real_start_text_offset) ? (start_text_offset - real_start_text_offset) : (0);
                    str_addr = (PS8)(g_wgui_mv_cat_cntx.pinputboxbuffer + (offset * ENCODING_LENGTH));
                    len -= (start_text_offset - item->offset);
                }

                if ((item->offset + item->len) > end_text_offset)
                {
                    len -= (item->offset + item->len - end_text_offset);
                }

                g_wgui_mv_hilite_list[i].str_addr = str_addr;
                g_wgui_mv_hilite_list[i].length = len;

                g_wgui_mv_hilite_format_list[i].format_flag = GUI_MULTI_LINE_INPUT_HILITE_TEXT_COLOR | GUI_MULTI_LINE_INPUT_HILITE_UNDERLINE_COLOR;;
                g_wgui_mv_hilite_format_list[i].text_color = g_wgui_mv_hilite_format_list[i].underline_color = MMI_multiline_inputbox.normal_text_color;

                g_wgui_mv_hilite_list_idx_map[i] = item;

                i ++;
            }
            if (i >= WGUI_MV_MAX_HILITE_NUMBER) break;
            item = item->next;
        }
        MMI_multiline_inputbox.hilite_list = g_wgui_mv_hilite_list;
        MMI_multiline_inputbox.hilite_format_list = g_wgui_mv_hilite_format_list;
        MMI_multiline_inputbox.hilite_str_number = i;
        MMI_multiline_inputbox.hilite_cb = wgui_mv_hilite_cb;
#ifdef __MMI_TOUCH_SCREEN__
       MMI_multiline_inputbox.hilite_click_cb = wgui_mv_hilite_click_cb;
#endif
        MMI_multiline_inputbox.ext_flags |= GUI_MULTI_LINE_INPUT_BOX_USE_HILITE_FORMAT;

        /* set highlighted item */
        MMI_multiline_inputbox.highlight_start_position = MMI_multiline_inputbox.highlight_end_position = NULL;
        for (i = 0 ; i < MMI_multiline_inputbox.hilite_str_number ; i++)
        {
            if (g_wgui_mv_hilite_list_idx_map[i] == highlighted_item)
            {
                MMI_multiline_inputbox.current_hilite_idx = i;
                
                g_wgui_mv_hilite_cb_from_goto = MMI_TRUE;
                gdi_layer_lock_frame_buffer();
                gui_multi_line_input_box_go_to_hilite(
                    &MMI_multiline_inputbox,
                    (U16)MMI_multiline_inputbox.current_hilite_idx,
                    MMI_FALSE);
                gdi_layer_unlock_frame_buffer();
                g_wgui_mv_hilite_cb_from_goto = MMI_FALSE;

                break;
            }
        }
    }
}

#endif
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_hide_scroll_bar
 * DESCRIPTION
 *  hide scroll bar
 * PARAMETERS
 *  x1  [IN]
 *  y1  [IN]
 *  x2  [IN]
 *  y2  [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_hide_scroll_bar(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /*framework enhancement*/
    gdi_layer_push_and_set_clip(x1, y1, x2, y2);
    gui_draw_filled_area(x1, y1, x2, y2, &g_wgui_mv_cat_cntx.bgfiller);
    gdi_layer_pop_clip();
}


/* State Machine Implemenatation */
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_init_slide
 * DESCRIPTION
 *  Initial Slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_init_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 result;
    color tc;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_INIT_SLIDE;
    g_wgui_mv_cat_cntx.is_pause = MMI_FALSE;

    g_wgui_mv_is_media_end = MMI_FALSE;
    g_wgui_mv_is_media_valid = MMI_TRUE;

    g_wgui_mv_cat_cntx.is_pause = MMI_FALSE;
    g_wgui_mv_is_media_paused = MMI_FALSE;

	/* Reset image bounds on View area */
    memset(&g_wgui_mv_image_point, 0, sizeof(wgui_mv_image_point));
    memset(&g_wgui_mv_video_point, 0, sizeof(wgui_mv_video_point));

    /* Handle Text Object */
    g_wgui_mv_cat_cntx.ucs2_txt_len = 0;
    memset(g_wgui_mv_cat_cntx.pinputboxbuffer, 0, ENCODING_LENGTH);

    /* suspend background audio */
    g_wgui_mv_suspend_bg_audio = MMI_FALSE;
#ifdef __MMI_ICON_BAR_SUPPORT__	
#if defined(__MMI_FTE_SUPPORT__)
    if (wgui_icon_bar_is_created())
    {
        S32 x, y;

        x = 0;
        y = UI_device_height - MMI_ICON_BAR_HEIGHT;
        y -= (g_wgui_mv_cat_cntx.is_fullscreen) ? (0) : (MMI_softkey_height);
        wgui_icon_bar_move(x, y);
		g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_DISABLE_ENABLE_ACTION);
        wgui_icon_bar_update();
    }
#endif /* defined(__MMI_FTE_SUPPORT__) */
#endif /*__MMI_ICON_BAR_SUPPORT__*/
    if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
    {
        if ((CURRENT_SLIDE->aud.id != 0) || (CURRENT_SLIDE->vid.id != 0))
        {
            if (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE)
            {
                mdi_audio_suspend_background_play();
                g_wgui_mv_suspend_bg_audio = MMI_TRUE;
            }
        }
    }

    if (CURRENT_SLIDE->txt.str_id)
    {
        /*STR ID has more precedence than obj id text buffer */
        mmi_ucs2ncpy(
            (PS8) g_wgui_mv_cat_cntx.ptxtbuffer,
            (PS8) GetString(CURRENT_SLIDE->txt.str_id),
            GUI_PAGE_SIZE);
        g_wgui_mv_cat_cntx.ucs2_txt_len = mmi_ucs2strlen((PS8) g_wgui_mv_cat_cntx.ptxtbuffer);

    } 
    else if (CURRENT_SLIDE->txt.id != 0)
    {
        result = g_wgui_mv_cat_cntx.load_paging_txt (g_wgui_mv_cat_cntx.ptxtbuffer,
                    g_wgui_mv_cat_cntx.ptxtbuffersize, &CURRENT_SLIDE->txt);
        if (result == MMI_FALSE)
        {
            wgui_mv_error_condition();
            return;
        }

        g_wgui_mv_cat_cntx.ucs2_txt_len = mmi_ucs2strlen((PS8)g_wgui_mv_cat_cntx.ptxtbuffer);
    }

    /* Handle Audio Object */
    if (CURRENT_SLIDE->aud.id != 0)
    {
        result = g_wgui_mv_cat_cntx.get_filename_by_id(&CURRENT_SLIDE->aud, g_wgui_mv_audio_vf, 
            &g_wgui_mv_cat_cntx.audio_file_path, &g_wgui_mv_audio_file_handle);

        if (result == MMI_FALSE)
        {
            wgui_mv_error_condition();
            return;
        }
        g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->aud, MMI_FALSE);
    }
    g_wgui_mv_cat_cntx.is_audio_start_play = MMI_FALSE;

    /* Handle Drawable Object */
    if (CURRENT_SLIDE->img.id != 0)
    {
        result = g_wgui_mv_cat_cntx.get_filename_by_id(&CURRENT_SLIDE->img, g_wgui_mv_drawable_media_vf, 
            &g_wgui_mv_cat_cntx.drawable_media_file_path, &g_wgui_mv_drawable_media_file_handle);

        if (result == MMI_FALSE)
        {
            wgui_mv_error_condition();
            return;
        }
        g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->img, MMI_FALSE);
    }
    else if (CURRENT_SLIDE->vid.id != 0)
    {

        result = g_wgui_mv_cat_cntx.get_filename_by_id(&CURRENT_SLIDE->vid, g_wgui_mv_drawable_media_vf, 
            &g_wgui_mv_cat_cntx.drawable_media_file_path, &g_wgui_mv_drawable_media_file_handle);

        if (result == MMI_FALSE)
        {
            wgui_mv_error_condition();
            return;
        }
        g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->vid, MMI_FALSE);

    }

    /* Setup Multiline Input Box:: Setup Paging */
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    if (g_wgui_mv_cat_cntx.ucs2_txt_len <= (GUI_PAGE_SIZE * PAGE_MAX))
#else
    if (g_wgui_mv_cat_cntx.ucs2_txt_len <= (GUI_PAGE_SIZE * 4)) // __NO__NO__UI_PAGING_IN_MULTILINE_EDITOR__ 
#endif
    {
        U8 end_page_id = 0;

        if (g_wgui_mv_cat_cntx.ucs2_txt_len != 0)
        {
            mmi_ucs2ncpy((PS8) g_wgui_mv_cat_cntx.pinputboxbuffer, (PS8) g_wgui_mv_cat_cntx.ptxtbuffer, g_wgui_mv_cat_cntx.ucs2_txt_len);
            end_page_id = g_wgui_mv_cat_cntx.ucs2_txt_len / (GUI_PAGE_SIZE);
            end_page_id -= (g_wgui_mv_cat_cntx.ucs2_txt_len % GUI_PAGE_SIZE) ? (0) : (1);
        }
        create_multiline_inputbox_set_buffer(
            (UI_string_type) g_wgui_mv_cat_cntx.pinputboxbuffer,
            g_wgui_mv_cat_cntx.ucs2_txt_len * ENCODING_LENGTH,
            g_wgui_mv_cat_cntx.ucs2_txt_len,
            0);
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        MMI_multiline_inputbox.end_id = end_page_id;
#endif
    }
    else
    {
        memcpy(g_wgui_mv_cat_cntx.pinputboxbuffer,
            g_wgui_mv_cat_cntx.ptxtbuffer + (GUI_PAGE_SIZE * g_wgui_mv_paging_cntx.page_id - g_wgui_mv_paging_cntx.shared_bytes) * ENCODING_LENGTH,
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
            (GUI_PAGE_SIZE * PAGE_MAX + g_wgui_mv_paging_cntx.shared_bytes) * ENCODING_LENGTH);
#else
            (GUI_PAGE_SIZE * 4 + g_wgui_mv_paging_cntx.shared_bytes) * ENCODING_LENGTH);
#endif
        create_multiline_inputbox_set_buffer(
            (UI_string_type) g_wgui_mv_cat_cntx.pinputboxbuffer,
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
            (GUI_PAGE_SIZE * PAGE_MAX + g_wgui_mv_paging_cntx.shared_bytes) * ENCODING_LENGTH,
            GUI_PAGE_SIZE * PAGE_MAX + g_wgui_mv_paging_cntx.shared_bytes,
#else
         (GUI_PAGE_SIZE * 4 + g_wgui_mv_paging_cntx.shared_bytes) * ENCODING_LENGTH,
         GUI_PAGE_SIZE * 4 + g_wgui_mv_paging_cntx.shared_bytes,
#endif
            0);
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        MMI_multiline_inputbox.end_id = g_wgui_mv_paging_cntx.page_id + PAGE_MAX - 1;
        MMI_multiline_inputbox.previous_shared_bytes = g_wgui_mv_paging_cntx.shared_bytes * 2;
#endif
    }
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    gui_vertical_scrollbar_register_hide_callback(&MMI_multiline_inputbox.vbar, wgui_mv_hide_scroll_bar);
#endif

    wgui_mv_set_multiline_object_viewable_area();

    MMI_multiline_inputbox.flags |= (UI_MULTI_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW | UI_MULTI_LINE_INPUT_BOX_VIEW_MODE |
                                     UI_MULTI_LINE_INPUT_BOX_CENTER_JUSTIFY/* | UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR*/);
    MMI_multiline_inputbox.ext_flags |= GUI_MULTI_LINE_INPUT_BOX_VIEW_PAGING_MODE;
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    MMI_multiline_inputbox.scroll_type = WGUI_PAGING_SCROLL_LINE_BY_LINE;
#else
    MMI_multiline_inputbox.scroll_type = 0;// __NO__NO__UI_PAGING_IN_MULTILINE_EDITOR__
#endif
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    MMI_multiline_inputbox.start_id = g_wgui_mv_paging_cntx.page_id;
    MMI_multiline_inputbox.page_offset = g_wgui_mv_paging_cntx.text_offset;
    MMI_multiline_inputbox.jump_offset_from_app = 0;
    MMI_multiline_inputbox.search_flag_is_on = 0;
#endif

    /* Set Multiline Inputbox BG&FG Color */
    memset(&g_wgui_mv_cat_cntx.bgfiller, 0, sizeof(UI_filled_area));
    if (CURRENT_SLIDE->txt.id != 0 && CURRENT_SLIDE->txt.str_id == 0 && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER )
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (CURRENT_SLIDE->txt.fg_color) << 8);
    }
    else
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.foreground_color) << 8);
    }
    
    MMI_multiline_inputbox.normal_text_color = tc;
    if (CURRENT_SLIDE->txt.id != 0 && CURRENT_SLIDE->txt.str_id == 0 && g_wgui_mv_used_by == WGUI_MV_USED_BY_VIEWER)
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (CURRENT_SLIDE->txt.bg_color) << 8 );
    }
    else
    {
        wgui_mv_convert_from_gdi_color_to_color(&tc, (g_wgui_mv_cat_cntx.current_msg.background_color) << 8);
    }
        
    g_wgui_mv_cat_cntx.bgfiller.c = tc;
    g_wgui_mv_cat_cntx.bgfiller.flags = UI_FILLED_AREA_TYPE_COLOR | UI_FILLED_AREA_TYPE_NO_BORDER;
    MMI_multiline_inputbox.normal_filler = &g_wgui_mv_cat_cntx.bgfiller;
    MMI_multiline_inputbox.boundary_color = tc;
    MMI_multiline_inputbox.vbar.normal_bar_filler = &g_wgui_mv_cat_cntx.bgfiller;

    show_multiline_inputbox_no_draw();
    if (MMI_multiline_inputbox.text_height > MMI_multiline_inputbox.edit_height)
    {
        /*MMI_multiline_inputbox.flags &= ~UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR;*/
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        MMI_multiline_inputbox.page_offset = g_wgui_mv_paging_cntx.text_offset;
#endif
        show_multiline_inputbox_no_draw();
    }
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* 0 */
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    wgui_paging_set_scrollbar_range(g_wgui_mv_cat_cntx.ucs2_txt_len);
#endif
    show_multiline_inputbox_no_draw();
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    wgui_paging_multiline_set_get_page_callback(wgui_mv_load_paging_data);
    wgui_paging_reset_show_percentage_flag();
    wgui_paging_multiline_clear_last_percentage();
#endif
#ifdef MMS_VIEWER_DIFFERENT_FONTS
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    wgui_paging_multiline_set_font((U8)CURRENT_SLIDE->txt.text_size, (U8)CURRENT_SLIDE->txt.text_style);
#endif 
#endif 

#ifdef __MMI_TOUCH_SCREEN__
	#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
    wgui_paging_multiline_set_scroll_data_cb(wgui_mv_get_data_during_scrolling);
#endif
#endif


    if (MMI_multiline_inputbox.text_offset_y != g_wgui_mv_paging_cntx.last_text_offset_y)
    {
        MMI_multiline_inputbox.text_offset_y = g_wgui_mv_paging_cntx.last_text_offset_y;
    }
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
    wgui_paging_multiline_set_percentage(g_wgui_mv_paging_cntx.page_id, (S16)g_wgui_mv_paging_cntx.text_offset);
#endif

    g_wgui_mv_cat_cntx.slide_time = 0;        

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__  
    /* get highlighted item */
    g_wgui_mv_cat_cntx.previous_highlighted_item = NULL;
    g_wgui_mv_cat_cntx.current_highlighted_item = NULL;

    /* application will know which item should be highlighted, even after interrupt */
 if (CURRENT_SLIDE->txt.id != 0)
 {
    if (g_wgui_mv_cat_cntx.get_highlighted_items != NULL)
    {
        g_wgui_mv_cat_cntx.get_highlighted_items((srv_mms_viewer_use_details_list **)&g_wgui_mv_cat_cntx.current_highlighted_item);
    }
 }
#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)    
    if (g_wgui_mv_cat_cntx.get_index_func != NULL)
    {
        g_wgui_mv_cat_cntx.get_index_func(&g_wgui_mv_cat_cntx.curr_msg_num, &g_wgui_mv_cat_cntx.total_msg_num);
    }
#endif
    /* set hilite list */
    show_multiline_inputbox_no_draw();
    if (g_wgui_mv_cat_cntx.current_highlighted_item != NULL)
    {
        /* set hilite attributes */
        MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_WORD_HIGHLIGHT;

        /* set hilite list */
        wgui_mv_refresh_hilite_list_all();

#ifdef __MMI_TOUCH_SCREEN__
        register_multiline_inputbox_hilite_pen_event_handler();
		#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
        wgui_paging_set_async_pen_callback(wgui_mv_refresh_hilite_list_all);
#endif 
#endif 
    }
    else
    {   
#if defined(__MMI_TOUCH_SCREEN__)
        /* Because hilite list requires addtional handler,
         * we have to reset the default pen event handler */
        wgui_register_general_pen_handler();
		#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
        wgui_paging_set_async_pen_callback(NULL);
#endif
#endif /* defined(__MMI_TOUCH_SCREEN__) */
    }
#endif
    g_wgui_mv_cat_cntx.image_handle = GDI_NULL_HANDLE;
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
	
    g_wgui_mv_cat_cntx.is_video_open = MMI_FALSE;
    g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
#ifdef __DRM_SUPPORT__
    g_wgui_mv_cat_cntx.is_video_playing = MMI_FALSE;
#endif /* __DRM_SUPPORT__ */
    g_wgui_mv_cat_cntx.is_video_start_play = MMI_FALSE;

    if (g_wgui_mv_cat_cntx.is_media_valid == MMI_TRUE)
    {
        if (CURRENT_SLIDE->vid.id != 0)
        {
            memset(&wgui_video_info, 0, sizeof(mdi_video_info_struct));

            /* allow video only with audio */
            mdi_video_ply_enable_aud_only_video_clip();

            if (mdi_video_ply_open_clip_file(0, (S8*)g_wgui_mv_cat_cntx.drawable_media_file_path, &wgui_video_info) == MDI_RES_VDOPLY_SUCCEED)
            {
                if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play())
                {
                    g_wgui_mv_cat_cntx.do_best_page_duration(
                                        (U64)wgui_video_info.total_time_duration,
                                        &CURRENT_SLIDE->duration,
                                        &CURRENT_SLIDE->vid.begin,
                                        &CURRENT_SLIDE->vid.end);
                }
                g_wgui_mv_cat_cntx.is_video_open = MMI_TRUE;
            }
        }
    }

#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */

    if ((CURRENT_SLIDE->vid.id == 0) &&
        (CURRENT_SLIDE->aud.id != 0))
    {
        U32 audio_duration;

        if (g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->aud))
        {
            g_wgui_mv_is_media_valid = MMI_FALSE;
        }
        if (mdi_audio_get_duration(g_wgui_mv_cat_cntx.audio_file_path, &audio_duration) != MDI_AUDIO_SUCCESS)
        {
            g_wgui_mv_is_media_valid = MMI_FALSE;
        }

        if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play())
        {
            g_wgui_mv_cat_cntx.do_best_page_duration((U64)audio_duration,
                                &CURRENT_SLIDE->duration,
                                &CURRENT_SLIDE->aud.begin,
                                &CURRENT_SLIDE->aud.end);
        }
    }
    g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
    g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_INIT;
    /* apply context only once */
    memset(&g_wgui_mv_paging_cntx, 0, sizeof(wgui_mv_paging_context));

    /* reset button flag */
    //g_wgui_mv_cat_layout.larrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
    //g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
    g_wgui_mv_cat_layout.cat_pen_event = WGUI_MV_CAT_PEN_IGNORE_EVENT;
    full_state = WGUI_MV_BUTTON_RELEASED_STATE;

    /* init timer */
    kal_get_time(&g_wgui_mv_last_tick);
    g_wgui_mv_last_tick -= kal_milli_secs_to_ticks(1000);       /* force to draw first time */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_deinit_slide
 * DESCRIPTION
 *  correct place for any cleanup actions after the slide has been played
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_deinit_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#if defined(__MMI_FTE_SUPPORT__)
    GDI_HANDLE hint_layer = GDI_NULL_HANDLE;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_cancel_timer(wgui_mv_handle_timer_event);
    gui_cancel_timer(wgui_mv_switch_slide_with_time_gap);
    is_slide_switching = MMI_FALSE;
    g_temp=MMI_FALSE;
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_DEINIT_SLIDE;
    g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_HIDE;
    g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_HIDDEN;
    g_wgui_mv_cat_cntx.drawable_media_file_path = NULL;
    wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
#if defined(__MMI_TOUCH_SCREEN__)
	#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
    wgui_paging_clear_pen_timer_handler();
#endif
#endif /* defined(__MMI_TOUCH_SCREEN__) */

#if defined(__MMI_CLIPBOARD__)
    /* reset clipboard state after leaving slide with enabled clipboard */
    if (mmi_imc_is_clipboard_state())
    {
        mmi_imc_reset_ime_state();
    }
#endif /* defined(__MMI_CLIPBOARD__) */

    /* Txt File handle is not kept open  */

    if (CURRENT_SLIDE->aud.id)
    {
        if (g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
        {
            g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
            g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->aud);
            mdi_audio_stop_file();
        }

        /* Destory Virtual Files */
        if (g_wgui_mv_audio_file_handle != 0)
        {
            FS_Close(g_wgui_mv_audio_file_handle);
            g_wgui_mv_audio_file_handle = 0;
        }
        memset((PS8) & g_wgui_mv_audio_vf, 0, WGUI_MV_VFN_LEN);
    }
    if (CURRENT_SLIDE->img.id)
    {
        g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->img);
        if ((g_wgui_mv_cat_cntx.image_handle != GDI_NULL_HANDLE) 
            && (g_wgui_mv_cat_cntx.image_handle != GDI_ERROR_HANDLE))
        {
            gdi_anim_stop(g_wgui_mv_cat_cntx.image_handle);
        }
        g_wgui_mv_cat_cntx.image_handle = GDI_NULL_HANDLE;  
        /* Destory Virtual Files */
        if (g_wgui_mv_drawable_media_file_handle != 0)
        {
            FS_Close(g_wgui_mv_drawable_media_file_handle);
            g_wgui_mv_drawable_media_file_handle = 0;
        }
        memset((PS8) & g_wgui_mv_drawable_media_vf, 0, WGUI_MV_VFN_LEN); 
		g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_STOP_IMAGE_DECODE_ACTION);
    }
    else if (CURRENT_SLIDE->vid.id)
    {

        g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->vid);
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        if (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
        {
            mdi_video_ply_stop();
            g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
        }
#ifdef __DRM_SUPPORT__
        g_wgui_mv_cat_cntx.is_video_playing = MMI_FALSE;
#endif /* __DRM_SUPPORT__ */
        if (g_wgui_mv_cat_cntx.is_video_open == MMI_TRUE)
        {
            mdi_video_ply_close_clip_file();
            g_wgui_mv_cat_cntx.is_video_open = MMI_FALSE;
        }
        /* This layer is alloc through init slide so free in deinit */
        if (g_wgui_mv_cat_layout.vlayer != GDI_NULL_HANDLE)
        {
            gdi_layer_free(g_wgui_mv_cat_layout.vlayer);
            g_wgui_mv_cat_layout.vlayer = GDI_NULL_HANDLE;
            
            // reset layer setting 
#if !defined(__MMI_FTE_SUPPORT__)            
            gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
#else
            if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
            {
            hint_layer = wgui_icon_bar_get_hint_layer_handle();
            }
            gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.baselayer, hint_layer, 0);
#endif
        }
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */ 


        /* Destory Virtual Files */
        if (g_wgui_mv_drawable_media_file_handle != 0)
        {
            FS_Close(g_wgui_mv_drawable_media_file_handle);
            g_wgui_mv_drawable_media_file_handle = 0;
        }
        memset((PS8) & g_wgui_mv_drawable_media_vf, 0, WGUI_MV_VFN_LEN);
    }

    /* resume background audio */
    if (g_wgui_mv_suspend_bg_audio == MMI_TRUE)
    {
        mdi_audio_resume_background_play();
        g_wgui_mv_suspend_bg_audio = MMI_FALSE;
    }
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__ 
    g_wgui_mv_default_image_id = WGUI_DEFAULT_PREVIEW_IMAGE_ID;
#else
    g_wgui_mv_default_image_id = 0;
#endif
    gui_vertical_scrollbar_reset_hide_callback(&MMI_multiline_inputbox.vbar);

    /* close multiline inputbox to stop SSP */
    //wgui_inputs_ml_close();
#ifdef __MMI_EDITOR_SSP_SUPPORT__
    {
        mmi_pen_point_struct point = {0, 0};
        gui_input_box_ssp_pen_translate(point, MMI_PEN_EVENT_ABORT);
    }
    mmi_pen_config_sampling_period(MMI_PEN_SAMPLING_PERIOD_1, MMI_PEN_SAMPLING_PERIOD_2);
#endif
}

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_start_show
 * DESCRIPTION
 *  start to show
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_start_show(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Set first slide active */
    wgui_mv_init_slide();

    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_ERROR)
    {
        return;
    }
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_SHOWING;
    wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_start_play
 * DESCRIPTION
 *  start to play
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_start_play(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Set first slide active */
    wgui_mv_init_slide();
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_ERROR)
    {
      return;
    }
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_PLAYING;
    wgui_multiline_inputbox_hide_text_content(MMI_TRUE);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_prepare_for_show
 * DESCRIPTION
 *  prepare for show after playing
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_prepare_for_show(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_wgui_mv_cat_cntx.display_mode = WGUI_MV_DISPLAY_MODE_SHOW;
    wgui_mv_reset_softkey_on_show();

    /* resume background audio */
    if (g_wgui_mv_suspend_bg_audio == MMI_TRUE)
    {
        mdi_audio_resume_background_play();
        g_wgui_mv_suspend_bg_audio = MMI_FALSE;
    }

    dm_redraw_category_screen();

    if (g_wgui_mv_disable_backlight == MMI_TRUE)
    {
        /* enable backlight turn-off & screen saver */
        srv_backlight_turn_off();
        mmi_phnset_enable_partial_ss();
        g_wgui_mv_disable_backlight = MMI_FALSE;
    }
}
#endif/*__MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/

#if !defined(__MMI_SLIM_MMS_2__)
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_pause_slide_playing
 * DESCRIPTION
 *  pause playing
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_pause_slide_playing(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_mv_smc_event_handler(WGUI_MV_EVENT_PAUSE_EVENT);
}
#endif /* (__MMI_SLIM_MMS_2__) */

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_resume_slide_pausing
 * DESCRIPTION
 *  resume playing
 * PARAMETERS
 *  void
 * RETURNS
  *  void
 *****************************************************************************/
static void wgui_mv_resume_slide_pausing(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_mv_smc_event_handler(WGUI_MV_EVENT_RESUME_FROM_PAUSE);
}

#if !defined(__MMI_SLIM_MMS_2__)
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_pause_slide
 * DESCRIPTION
 *  Pause Slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_pause_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    kal_uint32 curr_tick = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (g_wgui_mv_cat_cntx.is_pause == MMI_TRUE)
    {
        U16 x1 = g_wgui_mv_cat_layout.pbar_area.s16X;
        U16 x2 = g_wgui_mv_cat_layout.pbar_area.s16X + g_wgui_mv_cat_layout.pbar_area.s16Width - 1;
        U16 y1 = g_wgui_mv_cat_layout.pbar_area.s16Y;
        U16 y2 = g_wgui_mv_cat_layout.pbar_area.s16Y + g_wgui_mv_cat_layout.pbar_area.s16Height - 1;
        gdi_layer_lock_frame_buffer();
        wgui_mv_show_infobar();                    // changes to info bar 
        gdi_layer_unlock_frame_buffer();
        gui_BLT_double_buffer(x1, y1, x2, y2);
        return;
    }
    g_wgui_mv_cat_cntx.is_pause = MMI_TRUE;

    gui_cancel_timer(wgui_mv_handle_timer_event);
    gui_cancel_timer(wgui_mv_switch_slide_with_time_gap);

    kal_get_time(&curr_tick);
    /* keep playing time tick to be used when resume*/
    g_wgui_mv_last_tick = curr_tick - g_wgui_mv_last_tick;

    if (CURRENT_SLIDE->vid.id)
    {
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
        /* stop video */
        if (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
        {
            if (mdi_video_ply_stop() != MDI_RES_VDOPLY_SUCCEED)
            {
                wgui_mv_media_stopped_callback(MDI_RES_VDOPLY_SUCCEED, NULL);
            }
            else
            {
                g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
                g_wgui_mv_is_media_paused = MMI_TRUE;
            }
        }

#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */ 
    }

    if (CURRENT_SLIDE->aud.id)
    {
        if (g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
        {
            mdi_result ret = mdi_audio_pause(wgui_mv_media_stopped_callback, NULL);

            if (ret == MDI_AUDIO_SUCCESS)
            {
                g_wgui_mv_is_media_paused = MMI_TRUE;
                g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_PAUSE;
            }
            else
            {
                g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_PAUSE_FAIL;
#if defined(AAC_DECODE)
                if (mdi_audio_is_aac_file_seekable(g_wgui_mv_cat_cntx.audio_file_path) == MMI_FALSE)
                {
                    mdi_audio_stop_file();
                    g_wgui_mv_is_media_paused = MMI_TRUE;
                    g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
                    /* reset slide_time when best_paging and audio can not pause */
                    if (g_wgui_mv_cat_cntx.current_msg.is_best_paging)
                    {
                        g_wgui_mv_cat_cntx.slide_time = 0;
                        #ifdef __MMI_MSG_FTE_ENHANCE__
                            wgui_mv_show_infobar(); 
                        #else
                            wgui_mv_show_progressbar(); 
                        #endif
                        
                    }
                }
                else
#endif
                if (ret == MDI_AUDIO_END_OF_FILE)
                {
                    wgui_mv_media_stopped_callback(MDI_AUDIO_SUCCESS, NULL);
                }
            }
        }
    }

    gui_BLT_double_buffer(0, 0, LCD_WIDTH, LCD_HEIGHT);
}

#endif /* defined(__MMI_SLIM_MMS_2__) */

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_resume_slide
 * DESCRIPTION
 *  Resume Slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_resume_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    kal_uint32 curr_tick = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_cntx.is_pause == MMI_FALSE)
    {
       return;
    }
 if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && (CURRENT_SLIDE->vid.id || CURRENT_SLIDE->aud.id))
	  g_temp=MMI_TRUE;
 else
	 g_temp=MMI_FALSE;
    g_wgui_mv_cat_cntx.is_pause = MMI_FALSE;
    kal_get_time(&curr_tick);
    g_wgui_mv_last_tick = curr_tick - g_wgui_mv_last_tick;

#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    if (CURRENT_SLIDE->vid.id && !g_wgui_mv_cat_cntx.is_video_play)
    {
        MMI_BOOL playaudio;
         wgui_mv_show_viewarea();  
        if (g_wgui_mv_cat_cntx.is_video_open == MMI_FALSE)
        {
            return;
        }
        wgui_mv_resume_media_playing();
        
    } else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */

    if (CURRENT_SLIDE->aud.id)
    {
        if (g_wgui_mv_audio_state == WGUI_MV_AUDIO_STATE_PAUSE_FAIL
#if defined(AAC_DECODE)
            && mdi_audio_is_aac_file_seekable(g_wgui_mv_cat_cntx.audio_file_path) == MMI_FALSE
#endif
           )
        {
#ifdef __DRM_SUPPORT__
            /* do not consume right while resume */
            mdi_audio_drm_disable_consume_count();
#endif /* __DRM_SUPPORT__ */

            #ifdef __GAIN_TABLE_SUPPORT__
                mdi_audio_set_audio_type(MDI_AUDIO_TYPE_MESSAGE);
            #endif
            if (mdi_audio_play_file(
                        g_wgui_mv_cat_cntx.audio_file_path, 
                        DEVICE_AUDIO_PLAY_ONCE,
                        NULL,
                        wgui_mv_media_stopped_callback,
                        NULL) == MDI_AUDIO_SUCCESS)
            {
                g_wgui_mv_cat_cntx.is_audio_play = MMI_TRUE;
                mdi_audio_set_volume(MDI_VOLUME_MEDIA, g_wgui_mv_volume);
                g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_PLAY;                
            }
        }
        else if (g_wgui_mv_audio_state == WGUI_MV_AUDIO_STATE_PAUSE)
        {
            mdi_audio_resume(wgui_mv_media_stopped_callback, NULL);
            g_wgui_mv_audio_state = WGUI_MV_AUDIO_STATE_PLAY;
        }
    }

    g_wgui_mv_is_media_paused = MMI_FALSE;
	if (CURRENT_SLIDE->duration != 0 || g_temp)
    {
		
        wgui_mv_handle_timer_event();
    }

#ifdef __MMI_MSG_FTE_ENHANCE__
    if(g_wgui_mv_cat_cntx.is_fullscreen == MMI_FALSE)
    {
        wgui_mv_reset_softkey_on_play();
    }
#endif
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_stop_slide_playing
 * DESCRIPTION
 *  stop playing
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_stop_slide_playing(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_cancel_timer(wgui_mv_handle_timer_event);
    gui_cancel_timer(wgui_mv_switch_slide_with_time_gap);
    wgui_mv_smc_event_handler(WGUI_MV_EVENT_STOP_PLAY_START_SHOW);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_show_active_slide
 * DESCRIPTION
 *  show the currently active slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_play_show_active_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_ERROR)
    {
       return;
    }
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_SHOWING;
    g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
    g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NEEDED;
    if (CURRENT_SLIDE->aud.id)
    {
        if (g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
        {
            g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
            g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->aud);
            g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->aud, MMI_FALSE);
            mdi_audio_stop_file();
        }
    }
	if(g_wgui_mv_cat_cntx.display_mode==WGUI_MV_DISPLAY_MODE_PLAY)
    {
	#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
	    wgui_multiline_inputbox_hide_text_content(MMI_TRUE);
	#else
		wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
        #endif
        g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_PLAYING;
        #ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_PLAY;
	    if (CURRENT_SLIDE->duration != 0)
		wgui_mv_draw_viewer();
        #endif
		wgui_mv_reset_softkey_on_play();
		wgui_mv_handle_timer_event();
       
     	}
	else
	{
          wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
          g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_SHOWING;
          g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_SHOW_STOPPED;
          wgui_mv_reset_softkey_on_show();
		  wgui_mv_draw_viewer();
    }
 gui_BLT_double_buffer(0, 0, LCD_WIDTH, LCD_HEIGHT);
}

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_play_active_slide
 * DESCRIPTION
 *  play the currently active slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_play_active_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_ERROR)
    {
      return;
    }
    g_wgui_mv_cat_cntx.current_state = WGUI_MV_STATE_PLAYING;
    g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
    g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NEEDED;
    wgui_multiline_inputbox_hide_text_content(MMI_TRUE);
    wgui_mv_handle_timer_event();
    gdi_layer_lock_frame_buffer();
    wgui_mv_reset_softkey_on_play();
    gdi_layer_unlock_frame_buffer();
    gui_BLT_double_buffer(0, 0, LCD_WIDTH, LCD_HEIGHT);
}
#endif

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_next_slide_active
 * DESCRIPTION
 *  set next slide as active slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_set_next_slide_active(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* We have already Deinit the last slide so there has to be a next slide */
    ASSERT(CURRENT_SLIDE->next != NULL);
    (*(g_wgui_mv_cat_cntx.current_msg.current_slide)) = CURRENT_SLIDE->next;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_previous_slide_active
 * DESCRIPTION
 *  set previous slide as the active slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_set_previous_slide_active(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* We have already Deinit the last slide so there has to be a previous slide */
    ASSERT(CURRENT_SLIDE->prev != NULL);
    (*(g_wgui_mv_cat_cntx.current_msg.current_slide)) = CURRENT_SLIDE->prev;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_previous_slide_active
 * DESCRIPTION
 *  set previous slide as the active slide
 * PARAMETERS
 *  display_mode    [IN]    Play or Show
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_prepare_for_following_slide()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_cntx.mid_slides_cb != NULL)
    {
        /* For Non-UE */
      //  #if !defined(__MMI_MSG_FTE_ENHANCE__)
            //if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_PLAY)
            {
                wgui_mv_setup_screen_layout();
            }
            #ifdef __MMI_VIDEO_PLAY_SUPPORT__
                gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, GDI_NULL_HANDLE, GDI_NULL_HANDLE, GDI_NULL_HANDLE);
            #endif
      //  #endif
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        wgui_mv_display_loading_screen();
        wgui_mv_setup_progressbar();
#endif
        g_wgui_mv_cat_cntx.mid_slides_cb();
    }
    else
    {
      wgui_mv_setup_screen_layout();
	  #ifdef __MMI_VIDEO_PLAY_SUPPORT__
	  gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, GDI_NULL_HANDLE, GDI_NULL_HANDLE, GDI_NULL_HANDLE);
	  #endif
	  wgui_mv_display_loading_screen();
 	   wgui_mv_setup_progressbar();
	   if((g_wgui_mv_cat_cntx.decode_image_for_clear_image) && (g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_IMAGE_TYPE_ACTION)))
	   {
	    	wgui_mv_start_clean_image_show();
	   }
	   else
	   {
       wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
	}
	}
    

}


/* Event Handler */

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_smc_event_handler
 * DESCRIPTION
 *  We have two state machines in viewer cat
 *  One is the slide state machine which controls a slide's lifetime etc
 *  Another state machine which controls the event's within a slide's lifetime
 *  Following is the event handler for a slide's lifetime related events
 * PARAMETERS
 *  event       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_smc_event_handler(const wgui_mv_event_enum event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (event)
    {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case WGUI_MV_EVENT_SHOW_START:
            /* InitialiseViewerCategory functionality is in ShowCategory630Screen */
            wgui_mv_start_show();
            break;
        
#endif
        case WGUI_MV_EVENT_PLAY_SHOW_PREVIOUS_SLIDE:
            wgui_mv_deinit_slide();
            wgui_mv_set_previous_slide_active();
            wgui_mv_prepare_for_following_slide();
            break;
        case WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE:
            wgui_mv_init_slide();
            wgui_mv_play_show_active_slide();
            break;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case WGUI_MV_EVENT_PLAY_START:
            /* InitialiseViewerCategory functionality is in ShowCategory630Screen */
            wgui_mv_start_play();
            break;
#endif

        case WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE:
            wgui_mv_deinit_slide();
            wgui_mv_set_next_slide_active();
            wgui_mv_prepare_for_following_slide();
            break;
       #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        case WGUI_MV_EVENT_STOP_EVENT:
            wgui_mv_deinit_slide();
            /* deinitialiseViewerCategory functionality is in wgui_mv_exit_category */
            break;
      #endif
        case WGUI_MV_EVENT_STOP_PLAY_START_SHOW:
            if (g_wgui_mv_cat_cntx.finish_playing)
            {
                g_wgui_mv_cat_cntx.finish_playing();
                break;
            }
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
            else
            {
                /* Slide is already initialised */
                wgui_mv_prepare_for_show(); /* Stop Audio, Copy Image/Video first frame etc */
                wgui_mv_play_show_active_slide();
            }
            break;
#if !defined(__MMI_SLIM_MMS_2__)
        case WGUI_MV_EVENT_PAUSE_EVENT:
            wgui_mv_reset_softkey_on_pause();
            wgui_mv_pause_slide();
            break;
#endif
        case WGUI_MV_EVENT_RESUME_FROM_PAUSE:
            wgui_mv_reset_softkey_on_play();
            wgui_mv_resume_slide();
            break;
#endif

        default:
            ASSERT(0);
            break;
    }
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_switch_slide_with_time_gap
 * DESCRIPTION
 *  goto next slide because of timed event
 *  made to wait for last step of progressbar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_switch_slide_with_time_gap(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Current Slide has played itself out */
    g_wgui_mv_cat_cntx.slide_time = 0;

    if (CURRENT_SLIDE->slide_num < g_wgui_mv_cat_cntx.current_msg.total_slide_num)
    {
        wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE);
    }
    else
    {
        wgui_mv_smc_event_handler(WGUI_MV_EVENT_STOP_PLAY_START_SHOW);
    }
}


/* 1 We generate timed events here */


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_handle_timer_event
 * DESCRIPTION
 *  handle timer event for Timed events like hide media etc.
 *  these events take place within one slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_handle_timer_event(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
    kal_uint32 curr_tick = 0;
    MMI_BOOL is_play_end = MMI_FALSE;
    MMI_BOOL is_media_time = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(CURRENT_SLIDE);

    gui_cancel_timer(wgui_mv_handle_timer_event);
    gui_cancel_timer(wgui_mv_switch_slide_with_time_gap);
 if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && (CURRENT_SLIDE->vid.id || CURRENT_SLIDE->aud.id))
	  g_temp=MMI_TRUE;
 else
	 g_temp=MMI_FALSE;

    if (CURRENT_SLIDE->duration == 0 && !g_temp)
    {
        /* Current Slide is still playing */
        g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;
        g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
        g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NEEDED;
        g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_PLAY;
        
        if (CURRENT_SLIDE->aud.id && CURRENT_SLIDE->vid.id == 0)
        {
            /* Start Audio Playing */
            if (CURRENT_SLIDE->aud.id != 0 )
            {
                if (MMI_FALSE == g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->aud))
                {
                    if (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE)
                    {
                        g_wgui_mv_cat_cntx.is_audio_start_play = MMI_TRUE;
                    }
                }
            }
        }

        wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
        gdi_layer_lock_frame_buffer();
        wgui_mv_draw_viewer();
        gdi_layer_unlock_frame_buffer();
        gui_BLT_double_buffer(0, 0, LCD_WIDTH, LCD_HEIGHT);
        return;
    }

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
    if ( ( (CURRENT_SLIDE->vid.id) 
           && (g_wgui_mv_cat_cntx.is_video_play) 
           && !( (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_FALSE) 
                 && (g_wgui_mv_default_image_id == WGUI_DEFAULT_PREVIEW_AVIDEO_ID)
               )
         ) 
         ||((CURRENT_SLIDE->aud.id) && (g_wgui_mv_cat_cntx.is_audio_play))
       )
#else
    if((CURRENT_SLIDE->aud.id) && (g_wgui_mv_cat_cntx.is_audio_play))
#endif
    {
        // while playing media, use media time directly
        U16 next_time = g_wgui_mv_cat_cntx.slide_time;

#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
        if ( (CURRENT_SLIDE->vid.id) 
             && (g_wgui_mv_cat_cntx.is_video_play || g_wgui_mv_is_media_paused) 
             && !((g_wgui_mv_cat_cntx.allow_audio_play() == MMI_FALSE) && (g_wgui_mv_default_image_id == WGUI_DEFAULT_PREVIEW_AVIDEO_ID))
           )
        {
            U64 vdo_time = (U64)(g_wgui_mv_cat_cntx.slide_time * 1000);
            mdi_video_ply_get_cur_play_time(&vdo_time);
            next_time = (U16)(CURRENT_SLIDE->vid.begin + (vdo_time / 1000));
        }
        else
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) */
        if ((CURRENT_SLIDE->aud.id) && (g_wgui_mv_cat_cntx.is_audio_play || g_wgui_mv_is_media_paused))
        {
            U32 ado_time = (U32)(g_wgui_mv_cat_cntx.slide_time * 1000);

            if (mdi_audio_get_progress_time(&ado_time) == MDI_AUDIO_SUCCESS)
            {
                next_time = CURRENT_SLIDE->aud.begin + (ado_time / 1000);
            }
        }

        if (next_time != g_wgui_mv_cat_cntx.slide_time)
        {
            g_wgui_mv_cat_cntx.slide_time = next_time;
            is_media_time = MMI_TRUE;
        }
        else
        {
            gui_start_timer(CAT630_SLIDE_TIME_UNIT, wgui_mv_handle_timer_event);
            return;
        }
    }
    else
    {
        kal_get_time(&curr_tick);
        MMI_ASSERT(curr_tick >= g_wgui_mv_last_tick);
        if (kal_ticks_to_milli_secs(curr_tick - g_wgui_mv_last_tick) < 1000)
        {
            gui_start_timer(CAT630_SLIDE_TIME_UNIT, wgui_mv_handle_timer_event);
            return;
        }
        //g_wgui_mv_last_tick += kal_milli_secs_to_ticks(1000);   /* timer calibration */
        g_wgui_mv_last_tick = curr_tick;
    }


    if (!g_wgui_mv_cat_cntx.current_msg.is_best_paging)
    {
        if (g_wgui_mv_cat_cntx.slide_time >= CURRENT_SLIDE->duration)
        {
            is_play_end = MMI_TRUE;
        }
    }
    else
    {   /* if best page, ignore slide time if there is audio or video */
        if (CURRENT_SLIDE->aud.id && g_wgui_mv_is_media_valid && (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE))
        {
            if (g_wgui_mv_is_media_end)
            {
                is_play_end = MMI_TRUE;
            }
        }
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
        else if (CURRENT_SLIDE->vid.id && g_wgui_mv_is_media_valid &&
                    !((g_wgui_mv_cat_cntx.allow_audio_play() == MMI_FALSE) && (g_wgui_mv_default_image_id == WGUI_DEFAULT_PREVIEW_AVIDEO_ID)))
        {
            if (g_wgui_mv_is_media_end)
            {
                is_play_end = MMI_TRUE;
            }
        }
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) */
        else
        {
            if (g_wgui_mv_cat_cntx.slide_time >= CURRENT_SLIDE->duration)
            {
                is_play_end = MMI_TRUE;
            }
			
        }
    }

    if (is_play_end == MMI_TRUE)
    {
        U16 x1 = g_wgui_mv_cat_layout.pbar_area.s16X;
        U16 x2 = g_wgui_mv_cat_layout.pbar_area.s16X + g_wgui_mv_cat_layout.pbar_area.s16Width - 1;
        U16 y1 = g_wgui_mv_cat_layout.pbar_area.s16Y;
        U16 y2 = g_wgui_mv_cat_layout.pbar_area.s16Y + g_wgui_mv_cat_layout.pbar_area.s16Height - 1;

        if (g_wgui_mv_cat_cntx.current_msg.is_best_paging)
        {
            // Update final time
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
            if (CURRENT_SLIDE->vid.id && g_wgui_mv_is_media_valid &&
                    !((g_wgui_mv_cat_cntx.allow_audio_play() == MMI_FALSE) && (g_wgui_mv_default_image_id == WGUI_DEFAULT_PREVIEW_AVIDEO_ID)))
            {
                U64 latest_time = (U64)(g_wgui_mv_cat_cntx.slide_time * 1000);
                mdi_video_ply_get_cur_play_time(&latest_time);
                g_wgui_mv_cat_cntx.slide_time = (U32)(CURRENT_SLIDE->vid.begin + (latest_time / 1000));
            }
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) */
        }

        gdi_layer_lock_frame_buffer();
        is_slide_switching = MMI_TRUE;
        #ifdef __MMI_MSG_FTE_ENHANCE__
            wgui_mv_show_infobar();       
        #else
            wgui_mv_show_progressbar();
        #endif
        gdi_layer_unlock_frame_buffer();
        gui_BLT_double_buffer(x1, y1, x2, y2);

        gui_start_timer(CAT630_SLIDE_SWITCH_GAP_TIME, wgui_mv_switch_slide_with_time_gap);
    }
    else
    {
        /* Current Slide is still playing */
        /* Some other control may have turned on redraw for a particular control */
        //g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NOT_NEEDED;
        //g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NOT_NEEDED;

        /* we NEED to redraw progressbar definitely */
        g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NEEDED;

        if (CURRENT_SLIDE->aud.id)
        {
            if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->aud.end)
            {
                if (!g_wgui_mv_cat_cntx.current_msg.is_best_paging)
                {
                    /* Stop Audio Playing */
                    if (g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
                    {
                        g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
                        g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->aud);
                        g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->aud, MMI_FALSE);
                        mdi_audio_stop_file();
                    }
                }
            }
            else if ((g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->aud.begin)
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
                     && (g_wgui_mv_cat_cntx.is_video_play == MMI_FALSE)
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
                     )
            {
                /* Start Audio Playing */
                if ((CURRENT_SLIDE->aud.id != 0) && (!g_wgui_mv_is_media_end))
                {
                    if (MMI_FALSE == g_wgui_mv_cat_cntx.is_drm_locked(&CURRENT_SLIDE->aud))
                    {
                        if (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE)
                        {
                            g_wgui_mv_cat_cntx.is_audio_start_play = MMI_TRUE;
                        }
                    }
                }
            }
        }

        if (CURRENT_SLIDE->img.id)
        {
            if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->img.end)
            {
                /* Image maybe scrolled out but may still be consuming rights? */
                g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->img);
                g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->img, MMI_FALSE);
                g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_HIDE;
                g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
            }
            else if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->img.begin)
            {
                g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_PLAY;
                g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
            }
        }
        else if (CURRENT_SLIDE->vid.id)
        {
            if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->vid.end)
            {
                if (!g_wgui_mv_cat_cntx.current_msg.is_best_paging)
                {
                    g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_HIDE;
                    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
                }
            }
            else if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->vid.begin)
            {
                g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_PLAY;
                g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
            }
        }
        if (CURRENT_SLIDE->txt.id && CURRENT_SLIDE->txt.str_id == 0)
        {
            if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->txt.end)
            {
                /* Stop text Showing */
                wgui_multiline_inputbox_hide_text_content(MMI_TRUE);
                g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
            }
            else if (g_wgui_mv_cat_cntx.slide_time == CURRENT_SLIDE->txt.begin)
            {
                /* Start text Showing */
                wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
                g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
            }
        }
        else if (g_wgui_mv_cat_cntx.slide_time == 0)
        {
            wgui_multiline_inputbox_hide_text_content(MMI_FALSE);
            g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
        }

        if (g_wgui_mv_cat_cntx.slide_time == 0)
        {
            g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;
            g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
        }

        wgui_mv_draw_viewer();
        if (!is_media_time)
        {
            if (CURRENT_SLIDE->aud.id && g_wgui_mv_cat_cntx.is_audio_play)
            {
                /* while audio is playing, do not update timer */
            }
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
            else if (CURRENT_SLIDE->vid.id &&
                     g_wgui_mv_cat_cntx.is_video_open &&
                     g_wgui_mv_is_media_valid &&
                     !((g_wgui_mv_cat_cntx.allow_audio_play() == MMI_FALSE) && (g_wgui_mv_default_image_id == WGUI_DEFAULT_PREVIEW_AVIDEO_ID)) &&
                     (g_wgui_mv_cat_cntx.slide_time >= CURRENT_SLIDE->vid.begin) &&
                     !g_wgui_mv_is_media_end &&
					  g_wgui_mv_cat_cntx.slide_time < CURRENT_SLIDE->vid.end)
            {
                /* while video is not playing during scrolling, do not update timer */
            }
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) */
            else
            {
                ++g_wgui_mv_cat_cntx.slide_time;
                #ifdef __MMI_MSG_FTE_ENHANCE__
			
                   // wgui_mv_show_infobar();       
                #else
                    //wgui_mv_show_progressbar();
                #endif

            }
        }
    }
#endif
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
      kal_get_time(&curr_tick);
      MMI_ASSERT(curr_tick >= g_wgui_mv_last_tick);
       if (kal_ticks_to_milli_secs(curr_tick - g_wgui_mv_last_tick) <= (1000*(CURRENT_SLIDE->duration)))
        {
            if(kal_ticks_to_milli_secs(curr_tick - g_last_tick)>=1000)
       	     {
               g_wgui_mv_cat_cntx.slide_time++;
               g_last_tick=curr_tick;
	       gui_start_timer(100, wgui_mv_handle_timer_event);
		return;
	      }
	   else
	    {
	    gui_start_timer(100, wgui_mv_handle_timer_event);
            return;
	     }
        }
      else
	{
	is_play_end=MMI_TRUE;
        }
    if (is_play_end == MMI_TRUE)
    {
             gui_start_timer(CAT630_SLIDE_SWITCH_GAP_TIME, wgui_mv_switch_slide_with_time_gap);
    }
#endif/*__MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
}

/* Category related functions Exit handlers, category draw function, key handlers */

#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_start_viewing
 * DESCRIPTION
 *  start viewing
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_start_viewing(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ( g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING 
        && g_wgui_mv_cat_layout.type == WGUI_MV_LAYOUT_TYPE_OVERLAPPING_PROGRESS_BAR)
    {
        g_wgui_mv_cat_layout.pbar_area.Flags = WGUI_MV_REDRAW_NOT_NEEDED;
    }

    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
    {
        wgui_mv_handle_timer_event();
    }
    else if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {
        g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_SHOWING;
        g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_SHOW_STOPPED;
        wgui_mv_draw_viewer();
    }
}

#endif
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_draw_category_controlled_area
 * DESCRIPTION
 *  draw category function
 * PARAMETERS
 *  coordinate      [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_draw_category_controlled_area(dm_coordinates *coordinate)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
   S32 x, y;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_ICON_BAR_SUPPORT__	
#if defined(__MMI_FTE_SUPPORT__)
    if(g_wgui_mv_cat_cntx.is_fullscreen && wgui_icon_bar_is_created())
    {
	    x = 0;
        y = UI_device_height - MMI_ICON_BAR_HEIGHT;
		#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        y -= CAT630_PBAR_VMARGIN ;
		#endif
        wgui_icon_bar_move(x,y);
        wgui_icon_bar_resize(UI_device_width, MMI_ICON_BAR_HEIGHT);
		g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_DISABLE_ENABLE_ACTION);
        wgui_icon_bar_show();
    }
#endif /* defined(__MMI_FTE_SUPPORT__) */
#endif/*__MMI_ICON_BAR_SUPPORT__*/
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_exit_category
 * DESCRIPTION
 *  exit category function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_exit_category(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 last_percentage;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    /* can't flatten the layer if the video is being already playing */
    if (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
    {
        mdi_video_ply_stop();
        g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
		g_wgui_mv_cat_cntx.is_video_stopped = MMI_FALSE;
    }
#if defined(__MMI_FTE_SUPPORT__)

    gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.baselayer, 0, 0);  

    gdi_layer_flatten_to_base(
        g_wgui_mv_cat_layout.vlayer, 
        g_wgui_mv_cat_layout.baselayer, 
        0,
        0);

#else /* __MMI_FTE_SUPPORT__ */

    gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
    gdi_layer_flatten_to_base(
        g_wgui_mv_cat_layout.baselayer, 
        g_wgui_mv_cat_layout.vlayer, 
        g_wgui_mv_cat_layout.tlayer, 
        g_wgui_mv_cat_layout.blayer);

#endif /* __MMI_FTE_SUPPORT__ */

#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */


#ifdef __MMI_CLIPBOARD__
    mmi_imc_disconnect();
#endif /* __MMI_CLIPBOARD__ */

    gui_cancel_timer(wgui_mv_handle_timer_event);
    gui_cancel_timer(wgui_mv_switch_slide_with_time_gap);
#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__)
    mmi_frm_gesture_stop_listen_event();
#endif

    if ((g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING) ||
        (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING))
    {
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        wgui_paging_multiline_get_current_page(
            &g_wgui_mv_paging_cntx.page_id,
            &g_wgui_mv_paging_cntx.text_offset,
            &g_wgui_mv_paging_cntx.shared_bytes,
            &last_percentage,
            &g_wgui_mv_paging_cntx.last_text_offset_y);
#endif
    }

    /* reset multiline */
    MMI_multiline_inputbox_x = MMI_MULTILINE_INPUTBOX_X;
    MMI_multiline_inputbox_y = MMI_MULTILINE_INPUTBOX_Y;
    MMI_multiline_inputbox_width = MMI_MULTILINE_INPUTBOX_WIDTH;
    MMI_multiline_inputbox_height = MMI_MULTILINE_INPUTBOX_HEIGHT;

    wgui_mv_deinit_slide();/* Close any open file handles etc */

#if defined(__MMI_TOUCH_SCREEN__)
	#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
    wgui_paging_set_async_pen_callback(NULL);
#endif
#endif /* defined(__MMI_TOUCH_SCREEN__) */

#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    if (g_wgui_mv_cat_layout.vlayer != GDI_NULL_HANDLE)
    {
        gdi_layer_free(g_wgui_mv_cat_layout.vlayer);
        g_wgui_mv_cat_layout.vlayer = GDI_NULL_HANDLE;
    }
    if (g_wgui_mv_cat_layout.tlayer != GDI_NULL_HANDLE)
    {
        gdi_layer_free(g_wgui_mv_cat_layout.tlayer);
        g_wgui_mv_cat_layout.tlayer = GDI_NULL_HANDLE;
    }
    if (g_wgui_mv_cat_layout.blayer != GDI_NULL_HANDLE)
    {
        gdi_layer_free(g_wgui_mv_cat_layout.blayer);
        g_wgui_mv_cat_layout.blayer = GDI_NULL_HANDLE;

    }
	gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, NULL,NULL, NULL);
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */ 

    if (g_wgui_mv_disable_backlight == MMI_TRUE)
    {
        /* enable backlight turn-off & screen saver */
        srv_backlight_turn_off();
        mmi_phnset_enable_partial_ss();
        g_wgui_mv_disable_backlight = MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_vol_up_key_handler
 * DESCRIPTION
 *  volume key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_vol_up_key_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        || (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
        )
    {
      g_wgui_mv_volume=mdi_audio_incr_volume(g_wgui_mv_volume);
      mdi_audio_set_volume(MDI_VOLUME_MEDIA, g_wgui_mv_volume);
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_vol_down_key_handler
 * DESCRIPTION
 *  volume key down handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_vol_down_key_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        || (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
        )
    {
        g_wgui_mv_volume= mdi_audio_decr_volume(g_wgui_mv_volume);
        mdi_audio_set_volume(MDI_VOLUME_MEDIA, g_wgui_mv_volume);
    }
}
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_set_current_highlighted_item
 * DESCRIPTION
 *  whether there is available highlighted item
 * PARAMETERS
 *  highlighted_item    [IN]    current highlighted item
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static MMI_BOOL wgui_mv_set_current_highlighted_item(srv_mms_viewer_use_details_list *highlighted_item)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((highlighted_item != NULL) &&
        (highlighted_item != g_wgui_mv_cat_cntx.previous_highlighted_item))
    {
        S32 text_offset;
        S8 text_length;
        S32 start_text_offset, end_text_offset;
        MMI_BOOL is_update = MMI_FALSE;

        /* get information of the highlighted item */
        text_offset = (S32)highlighted_item->offset;
        text_length = (S8)highlighted_item->len;

        /* get paging area info */
        wgui_mv_get_paging_view_area(&start_text_offset, &end_text_offset);

        /* whether the highlighted item can be displayed */
        if ((text_offset >= start_text_offset) && (text_offset < end_text_offset))
        {
            is_update = MMI_TRUE;
        }
        else
        {
            if (g_wgui_mv_cat_cntx.current_highlighted_item)
            {
                S32 prev_offset = g_wgui_mv_cat_cntx.current_highlighted_item->offset;
                S8 prev_length = g_wgui_mv_cat_cntx.current_highlighted_item->len;
    
                if (((text_offset < start_text_offset) && (prev_offset < start_text_offset) && (text_offset > prev_offset)) ||
                    ((text_offset > end_text_offset) && (prev_offset > end_text_offset) && (text_offset < prev_offset)))
                {
                    is_update = MMI_TRUE;
                }
            }
        }

        if (is_update)
        {
            /* set hilite list */
            wgui_mv_refresh_hilite_list(g_wgui_mv_hilite_list, WGUI_MV_MAX_HILITE_NUMBER, highlighted_item);

            /* do not set the same item twice */
            g_wgui_mv_cat_cntx.previous_highlighted_item = highlighted_item;

            return MMI_TRUE;
        }
    }

    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_browse_highlighted_item
 * DESCRIPTION
 *  traverse highlighted items
 * PARAMETERS
 *  event    [IN]    next or previous
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static MMI_BOOL wgui_mv_browse_highlighted_item(wgui_mv_highlighted_item_event_enum event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    srv_mms_viewer_use_details_list *highlighted_item = g_wgui_mv_cat_cntx.current_highlighted_item;
    MMI_BOOL ret;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (highlighted_item != NULL)
    {
        switch(event)
        {
            case WGUI_MV_HIGHLIGHTED_ITEM_EVENT_NEXT:
                highlighted_item = highlighted_item->next;
                break;

            case WGUI_MV_HIGHLIGHTED_ITEM_EVENT_PREVIOUS:
                highlighted_item = highlighted_item->prev;
                break;
            
            default:
                MMI_ASSERT(0);
        }
    }

    /* while going the the previous item from the first one,
       or the next item from the last one */
    if (highlighted_item == NULL)
    {
        return MMI_FALSE;
    }

    /* try to set the highlighted item */
    ret = wgui_mv_set_current_highlighted_item(highlighted_item);
    if (ret == MMI_TRUE)
    {
        g_wgui_mv_cat_cntx.current_highlighted_item = highlighted_item;
    }

    return ret;
}

#endif/*__MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_up_key_handler
 * DESCRIPTION
 *  key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_up_key_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
    {
        g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_SCROLL;
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        if(wgui_inputs_ml_paging_check_to_start()) /* check whether we are at the beginning of the slide */
#else
        if(MMI_multiline_inputbox.text_offset_y == 0)
#endif
        {
        #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
            mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

            if (CURRENT_SLIDE->prev != NULL)
            {
                wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_PREVIOUS_SLIDE);
                return;
            }                    
        #endif
        }
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        if (wgui_mv_browse_highlighted_item(WGUI_MV_HIGHLIGHTED_ITEM_EVENT_PREVIOUS) == MMI_TRUE)
        {
            show_multiline_inputbox();
        }
        else
#endif /*__MMI_MMS_SIMPLIFIED_UI_SUPPORT__*/
        {
            /* check whether we are at the beginning of the slide */
        #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
            if(wgui_inputs_ml_paging_check_to_start()) 
#else
            if(MMI_multiline_inputbox.text_offset_y == 0)
#endif
            {
                mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

                if (CURRENT_SLIDE->prev != NULL)
                {
                    wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_PREVIOUS_SLIDE);
                    return;
                }                    
            }
        #endif

            if (MMI_multiline_inputbox.text_offset_y < 0)
            {
                gdi_layer_lock_frame_buffer();
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
                wgui_paging_multiline_inputbox_previous_line_in_paging();
#else
                wgui_inputs_ml_previous_line();// __NO__NO__UI_PAGING_IN_MULTILINE_EDITOR__       
#endif
                gdi_layer_unlock_frame_buffer();
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                wgui_mv_refresh_hilite_list_all();
     #endif
                show_multiline_inputbox();
            }
        }
 if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id
	     || (*(g_wgui_mv_cat_cntx.current_msg.current_slide))->aud.id))
	  g_temp=MMI_TRUE;
 else
	 g_temp=MMI_FALSE;
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        if ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id)
        {
            /* we need to redraw the screen for video playing while the duration is 0 */
            if (((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->duration == 0 && g_temp ) &&
                (g_wgui_mv_cat_cntx.drawable_media_state == WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING))
            {
                gui_start_timer(1, wgui_mv_resume_media_playing);
            }
        }
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_down_key_handler
 * DESCRIPTION
 *  key down handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_down_key_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
    {
        g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_SCROLL;

        /* press down key at the end of slide move to the next slide */
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        if(wgui_inputs_ml_paging_check_to_end()) 
#else
        if(-MMI_multiline_inputbox.text_offset_y + MMI_multiline_inputbox.edit_height >= 
                             MMI_multiline_inputbox.text_height)
#endif
        {
        #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
            mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));    
        
            if (CURRENT_SLIDE->next != NULL)
            {
                wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE);
                return;
            }                    
        #endif
        }
        #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        
        if (wgui_mv_browse_highlighted_item(WGUI_MV_HIGHLIGHTED_ITEM_EVENT_NEXT) == MMI_TRUE)
        {
            show_multiline_inputbox();
        }
        else
#endif
        {
            /* press down key at the end of slide move to the next slide */
             
            {             
                /* check whether we are at the end of the slide */
        #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__)
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
                if(wgui_inputs_ml_paging_check_to_end()) 
#else
                if(-MMI_multiline_inputbox.text_offset_y + MMI_multiline_inputbox.edit_height >= 
                             MMI_multiline_inputbox.text_height)    
#endif
                {
                    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));    
                
                    if (CURRENT_SLIDE->next != NULL)
                    {
                        wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE);
                        return;
                    }                    
                }   
        #endif
            }
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
            if (!wgui_inputs_ml_paging_check_to_end())
#else
            if(!(-MMI_multiline_inputbox.text_offset_y + MMI_multiline_inputbox.edit_height >= 
                             MMI_multiline_inputbox.text_height))
#endif
            {
                gdi_layer_lock_frame_buffer();
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
                wgui_paging_multiline_inputbox_next_line_in_paging_scroll();
#else
                wgui_inputs_ml_next_line();// __NO__NO__UI_PAGING_IN_MULTILINE_EDITOR__ 
#endif
                gdi_layer_unlock_frame_buffer();
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
                wgui_mv_refresh_hilite_list_all();
     #endif
                show_multiline_inputbox();
            }
        }
if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id
	  || (*(g_wgui_mv_cat_cntx.current_msg.current_slide))->aud.id))
	  g_temp=MMI_TRUE;
 else
	 g_temp=MMI_FALSE;

#ifdef __MMI_VIDEO_PLAY_SUPPORT__
        if ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id)
        {
            /* we need to redraw the screen for video playing while the duration is 0 */
            if (((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->duration == 0 && g_temp) &&
                (g_wgui_mv_cat_cntx.drawable_media_state == WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING))
            {
                gui_start_timer(1, wgui_mv_resume_media_playing);
            }
        }
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_left_key_down_handler
 * DESCRIPTION
 *  left key down handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_left_key_down_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(CURRENT_SLIDE);
#ifdef __MMI_FTE_ITERATOR_VIEWER_SUPPORT__
    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {       
        if(g_wgui_mv_cat_cntx.curr_msg_num > 1)
        {
            g_wgui_mv_cat_layout.larrow.Flags = WGUI_MV_BUTTON_PRESSED_STATE;
            wgui_mv_show_infobar();
        } 
    }
#else /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */
    if (CURRENT_SLIDE->prev != NULL)
    {
        g_wgui_mv_cat_layout.larrow.Flags = WGUI_MV_BUTTON_PRESSED_STATE;
        wgui_mv_show_infobar();
    }
#endif /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_right_key_down_handler
 * DESCRIPTION
 *  right key down handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_right_key_down_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(CURRENT_SLIDE);
#ifdef __MMI_FTE_ITERATOR_VIEWER_SUPPORT__
    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {   
        if(g_wgui_mv_cat_cntx.curr_msg_num < g_wgui_mv_cat_cntx.total_msg_num)
        {
            g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_PRESSED_STATE;
            wgui_mv_show_infobar();
        }
    }
#else
    if (CURRENT_SLIDE->next != NULL)
    {
        g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_PRESSED_STATE;
        wgui_mv_show_infobar();
    }
#endif
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_left_key_up_handler
 * DESCRIPTION
 *  left key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_left_key_up_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(CURRENT_SLIDE);

#ifdef __MMI_FTE_ITERATOR_VIEWER_SUPPORT__
    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {        
        if (g_wgui_mv_cat_layout.larrow.Flags != WGUI_MV_BUTTON_PRESSED_STATE)
        {
            return;
        }
        g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;

    wgui_mv_show_infobar();
        if(g_wgui_mv_cat_cntx.left_iterate_func)
        {
            g_wgui_mv_cat_cntx.left_iterate_func();
        }
    }
    else if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
    {
        wgui_mv_show_infobar();
        if (CURRENT_SLIDE->prev != NULL)
        {
             wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_PREVIOUS_SLIDE);
        }
    }

#else
    if (g_wgui_mv_cat_layout.larrow.Flags != WGUI_MV_BUTTON_PRESSED_STATE)
    {
        return;
    }

    g_wgui_mv_cat_layout.larrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
    wgui_mv_show_infobar();

    if (CURRENT_SLIDE->prev != NULL)
    {
         wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_PREVIOUS_SLIDE);
    }
#endif /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */
}

#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__)
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_left_key_up_gesture_handler
 * DESCRIPTION
 *  left key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_left_key_up_gesture_handler(mmi_frm_gesture_event_enum gesture_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {   
    wgui_mv_show_infobar();
        if(g_wgui_mv_cat_cntx.right_iterate_func)
        {
            g_wgui_mv_cat_cntx.right_iterate_func();
        }
    }
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_right_key_up_gesture_handler
 * DESCRIPTION
 *  right key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_right_key_up_gesture_handler(mmi_frm_gesture_event_enum gesture_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    { 

        wgui_mv_show_infobar();
        if(g_wgui_mv_cat_cntx.left_iterate_func)
        {
            g_wgui_mv_cat_cntx.left_iterate_func();
        }
    }
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_up_key_gesture_handler
 * DESCRIPTION
 *  left key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_up_key_gesture_handler(mmi_frm_gesture_event_enum gesture_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {   
        /* check whether we are at the end of the slide */
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        if(wgui_inputs_ml_paging_check_to_end()) 
#else
        if(-MMI_multiline_inputbox.text_offset_y + MMI_multiline_inputbox.edit_height >= 
                             MMI_multiline_inputbox.text_height)    
#endif
        {      
            if (CURRENT_SLIDE->next != NULL)
            {
                wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE);
                return;
            }                    
        } 
    }
}

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_down_key_gesture_handler
 * DESCRIPTION
 *  left key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_down_key_gesture_handler(mmi_frm_gesture_event_enum gesture_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {   
        /* check whether we are at the end of the slide */
#ifdef __UI_PAGING_IN_MULTILINE_EDITOR__
        if(wgui_inputs_ml_paging_check_to_start()) 
#else
        if(MMI_multiline_inputbox.text_offset_y == 0)    
#endif
        {        
            if (CURRENT_SLIDE->prev != NULL)
            {
                wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_PREVIOUS_SLIDE);
                return;
            }                    
        } 
    }
}

#endif /* #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__) */

/*****************************************************************************
 * FUNCTION
 *  wgui_mv_right_key_up_handler
 * DESCRIPTION
 *  right key up handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void wgui_mv_right_key_up_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(CURRENT_SLIDE);
    
#ifdef __MMI_FTE_ITERATOR_VIEWER_SUPPORT__
    if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {   
        
        if (g_wgui_mv_cat_layout.rarrow.Flags != WGUI_MV_BUTTON_PRESSED_STATE)
        {
            return;
        }
        g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;

    wgui_mv_show_infobar();
    if(g_wgui_mv_cat_cntx.right_iterate_func)
        {
            g_wgui_mv_cat_cntx.right_iterate_func();
        }
        //TODO, goto the next msg if any
        //TODO, call the callback function of MMS app if any
    }
    else if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING)
    {
        wgui_mv_show_infobar();
        if (CURRENT_SLIDE->next != NULL)
        {
            wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE);
        }
    }

#else /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */

    if (g_wgui_mv_cat_layout.rarrow.Flags != WGUI_MV_BUTTON_PRESSED_STATE)
    {
        return;
    }

    g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
    wgui_mv_show_infobar();

    if (CURRENT_SLIDE->next != NULL)
    {
        wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_NEXT_SLIDE);
    }
#endif /* __MMI_FTE_ITERATOR_VIEWER_SUPPORT__ */
}



#if defined(__MMI_MSG_FTE_ENHANCE__)
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_toggle_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void    
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_mv_toggle_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 dm_cat_data_flags = 0;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#if defined(__MMI_FTE_SUPPORT__)    
    GDI_HANDLE hint_layer = GDI_NULL_HANDLE;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_wgui_mv_cat_cntx.is_fullscreen)
    {
        g_wgui_mv_cat_cntx.is_fullscreen = MMI_FALSE;
        dm_get_dm_data_flag(&dm_cat_data_flags);
        dm_cat_data_flags &= ~(DM_NO_STATUS_BAR | DM_NO_SOFTKEY); 
        dm_set_dm_data_flag(dm_cat_data_flags);
        show_status_icon_bar(WGUI_STATUS_ICON_BAR_H_BAR);
    }
    else
    {
        g_wgui_mv_cat_cntx.is_fullscreen = MMI_TRUE;
        dm_get_dm_data_flag(&dm_cat_data_flags);
        dm_cat_data_flags |= (DM_NO_STATUS_BAR | DM_NO_SOFTKEY); 
        dm_set_dm_data_flag(dm_cat_data_flags);
        hide_status_icon_bar(WGUI_STATUS_ICON_BAR_H_BAR);
    }


#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    /* setup layer blt sequence */
#if !defined(__MMI_FTE_SUPPORT__)
    if (CURRENT_SLIDE->vid.id != 0)
    {
        gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
    }
    else
    {
        gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.baselayer, GDI_NULL_HANDLE, g_wgui_mv_cat_layout.tlayer, g_wgui_mv_cat_layout.blayer);
    }
#else
    if (g_wgui_mv_cat_cntx.display_mode == WGUI_MV_DISPLAY_MODE_SHOW)
    {
        hint_layer = wgui_icon_bar_get_hint_layer_handle();
    }
    gdi_layer_set_blt_layer(g_wgui_mv_cat_layout.vlayer, g_wgui_mv_cat_layout.baselayer, hint_layer, 0);
#endif
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */

    wgui_mv_adjust_setup_in_toggle();
	if(g_wgui_mv_cat_cntx.is_fullscreen)
	{

		ChangeLeftSoftkey(STRING_ID_NULL, IMAGE_ID_NULL);
        ChangeRightSoftkey(STRING_ID_NULL, IMAGE_ID_NULL);
#ifndef __MMI_WGUI_DISABLE_CSK__
        ChangeCenterSoftkey(STRING_ID_NULL, IMAGE_ID_NULL);
#endif
        SetLeftSoftkeyFunction(NULL, KEY_EVENT_UP);
        SetRightSoftkeyFunction(NULL, KEY_EVENT_UP);
#ifndef __MMI_WGUI_DISABLE_CSK__      
        SetCenterSoftkeyFunction(NULL, KEY_EVENT_UP);
#endif
	}
    dm_redraw_category_screen(); 



#if !defined(__MMI_FTE_SUPPORT__)
    gdi_layer_restore_base_active();
    gdi_layer_set_source_key(FALSE, GDI_COLOR_TRANSPARENT);
#endif
    gdi_layer_lock_frame_buffer();

    /* reset softkey */
    if(g_wgui_mv_cat_cntx.is_pause)
    {
        wgui_mv_reset_softkey_on_pause();
    }
    else
    {
        wgui_mv_reset_softkey_on_play();
    }

    if (g_wgui_mv_cat_layout.infobar.Flags == WGUI_MV_REDRAW_NEEDED)
    {
        wgui_mv_show_infobar();
    }
    if (g_wgui_mv_cat_layout.viewarea.Flags == WGUI_MV_REDRAW_NEEDED)
    {
        wgui_mv_show_viewarea();
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_FTE_SUPPORT__)
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        if(CURRENT_SLIDE->vid.id != 0 && g_wgui_mv_is_media_valid == MMI_TRUE  && g_wgui_mv_default_image_id != WGUI_DEFAULT_PREVIEW_AVIDEO_ID)
#else
        if(CURRENT_SLIDE->vid.id != 0 && g_wgui_mv_is_media_valid == MMI_TRUE  && g_wgui_mv_default_image_id != 0)
#endif
        {
            gdi_layer_push_and_set_active(GDI_LAYER_MAIN_BASE_LAYER_HANDLE);
            gdi_layer_set_clip(g_wgui_mv_bounding_rect.x1, g_wgui_mv_bounding_rect.y1, g_wgui_mv_bounding_rect.x2, g_wgui_mv_bounding_rect.y2);

            gdi_layer_set_source_key(TRUE, wgui_mv_convert_from_gdi_color_to_transparent_color());

            gdi_draw_solid_rect(g_wgui_mv_bounding_rect.x1, g_wgui_mv_bounding_rect.y1, g_wgui_mv_bounding_rect.x2, g_wgui_mv_bounding_rect.y2, wgui_mv_convert_from_gdi_color_to_transparent_color());
            gdi_layer_pop_and_restore_active();
        }
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_FTE_SUPPORT__) */
    }

    gdi_layer_unlock_frame_buffer();
    gdi_lcd_repaint_all();
    gui_BLT_double_buffer(0, 0, LCD_WIDTH, LCD_HEIGHT);
}
#endif

  #ifdef __MMI_TOUCH_SCREEN__


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_translate_viewarea_pen_event
 * DESCRIPTION
 *  translate pen event and take ownership of event if owned
 * PARAMETERS
 *  pos         [IN]        
 *  event       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_translate_viewarea_pen_event(mmi_pen_point_struct pos, mmi_pen_event_type_enum event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    #ifdef __MMI_MSG_FTE_ENHANCE__
        if(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
        {
            if (PEN_CHECK_BOUND(
                        pos.x,
                        pos.y,
                        g_wgui_mv_image_point.x,
                        g_wgui_mv_image_point.y,
                        g_wgui_mv_image_point.width,
                        g_wgui_mv_image_point.height ))

            {
                switch (event)
                {
                    case MMI_PEN_EVENT_MOVE:
                    case MMI_PEN_EVENT_DOWN:
                    case MMI_PEN_EVENT_REPEAT:
                        g_pressed = 1;
                        wgui_mv_show_viewarea();
                        ret = MMI_TRUE;
                        break;

                    case MMI_PEN_EVENT_UP:
                        if (g_pressed)
                        {
                            /* Vibrate only when the image/video is opened by MMS viewer. */
						    gui_touch_feedback_play(GUI_TOUCH_FEEDBACK_HOLD);
                            g_wgui_mv_cat_cntx.app_fte_common_cb(WGUI_MV_TOUCH_AREA_IMG_HLITE);
                        }
                        g_pressed = 0;
                        ret = MMI_TRUE;
                        break;

                    default:
                        ret = MMI_FALSE;
                }
           }
            else if (PEN_CHECK_BOUND(
                        pos.x,
                        pos.y,
                        g_wgui_mv_video_point.x,
                        g_wgui_mv_video_point.y,
                        g_wgui_mv_video_point.width,
                        g_wgui_mv_video_point.height ))

            {
                switch (event)
                {
                    case MMI_PEN_EVENT_MOVE:
                    case MMI_PEN_EVENT_DOWN:
                    case MMI_PEN_EVENT_REPEAT:
                        g_pressed = 1;
                        wgui_mv_show_viewarea();
                        ret = MMI_TRUE;
                        break;

                    case MMI_PEN_EVENT_UP:
                        if (g_pressed)
                        {
                            /* Vibrate only when the image/video is opened by MMS viewer. */
						    gui_touch_feedback_play(GUI_TOUCH_FEEDBACK_HOLD);
                            g_wgui_mv_cat_cntx.app_fte_common_cb(WGUI_MV_TOUCH_AREA_VDO_HLITE);
                        }
                        g_pressed = 0;
                        ret = MMI_TRUE;
                        break;

                    default:
                        ret = MMI_FALSE;
                }
            }
        }
    #endif
    if (ret == MMI_FALSE)
    {
        /* The focus is out of the image/video draw the line again. */
        if(g_pressed == 1)
        {
            g_pressed = 0;
            wgui_mv_show_viewarea();
        }
#ifdef __MMI_VIDEO_PLAY_SUPPORT__
		#ifdef __MDI_DISPLAY_YUYV422_SUPPORT__
		
		    if(g_wgui_mv_cat_layout.vlayer > 0)
			{
			  gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);
			  gdi_layer_set_color_format(GDI_COLOR_FORMAT_UYVY422);
			  gdi_layer_pop_and_restore_active();
			}

    #endif
#endif

        if ((g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING) ||
            (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING))
        {
            gdi_layer_lock_frame_buffer();
            switch (event)
            {
                case MMI_PEN_EVENT_DOWN:
					#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
                    if (wgui_paging_pen_down_hdlr(pos) == MMI_TRUE)
                    {
                        ret = MMI_TRUE;
                    }
					#endif
					g_wgui_mv_scrolling_start = MMI_FALSE;
                    break;
                case MMI_PEN_EVENT_MOVE:
					#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
                    if (wgui_paging_pen_move_hdlr(pos) == MMI_TRUE)
                    {
                        ret = MMI_TRUE;
                    }
					#endif
					g_wgui_mv_scrolling_start = MMI_TRUE;
                    break;
                case MMI_PEN_EVENT_UP:
					#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
                    if (wgui_paging_pen_up_hdlr(pos) == MMI_TRUE)
                    {
                        ret = MMI_TRUE;
                    }
					#endif
                    break;
                case MMI_PEN_EVENT_REPEAT:
					#if defined(__UI_PAGING_IN_MULTILINE_EDITOR__)
                    if (wgui_paging_pen_repeat_hdlr(pos) == MMI_TRUE)
                    {
                        ret = MMI_TRUE;
                    }
					#endif
                    break;
                default:
                    ret = MMI_FALSE;
                    break;
            }
            gdi_layer_unlock_frame_buffer();
            
            if (ret == MMI_TRUE)
            {
                gdi_lcd_repaint_all();

#ifdef __MMI_VIDEO_PLAY_SUPPORT__
	 if (g_wgui_mv_cat_cntx.current_msg.is_best_paging && g_wgui_mv_is_media_valid && g_wgui_mv_cat_cntx.allow_audio_play() && ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id
		  || (*(g_wgui_mv_cat_cntx.current_msg.current_slide))->aud.id))
						  g_temp=MMI_TRUE;
					 else
						 g_temp=MMI_FALSE;
                if ((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id)
                {
                    /* we need to redraw the screen for video playing while the duration is 0 */
                    if (((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->duration == 0) && g_temp &&
                        (g_wgui_mv_cat_cntx.drawable_media_state == WGUI_MV_DRAWABLE_MEDIA_STATE_PLAYING))
                    {
                        gui_start_timer(1, wgui_mv_resume_media_playing);
                    }
                }
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
            }
        }
    }
    return ret;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_translate_infobar_pen_event
 * DESCRIPTION
 *  see if infobar event
 * PARAMETERS
 *  pos         [IN]        
 *  event       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_translate_infobar_pen_event(mmi_pen_point_struct pos, mmi_pen_event_type_enum event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (PEN_CHECK_BOUND(
            pos.x,
            pos.y,
            g_wgui_mv_cat_layout.larrow.s16X,
            g_wgui_mv_cat_layout.larrow.s16Y,
            g_wgui_mv_cat_layout.larrow.s16Width,
            g_wgui_mv_cat_layout.larrow.s16Height))
    {
	    #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) || defined(__MMI_MSG_FTE_ENHANCE__)
			if(g_wgui_mv_cat_cntx.current_state != WGUI_MV_STATE_SHOWING)
	        {
	            return MMI_FALSE;
	        }
        #endif

        switch (event)
        {
            case MMI_PEN_EVENT_MOVE:
            case MMI_PEN_EVENT_DOWN:
                wgui_mv_left_key_down_handler();
                return MMI_TRUE;
            case MMI_PEN_EVENT_UP:
                wgui_mv_left_key_up_handler();
                return MMI_TRUE;
            default:
                return MMI_FALSE;
        }

    }
    else if (PEN_CHECK_BOUND(
                pos.x,
                pos.y,
                g_wgui_mv_cat_layout.rarrow.s16X,
                g_wgui_mv_cat_layout.rarrow.s16Y,
                g_wgui_mv_cat_layout.rarrow.s16Width,
                g_wgui_mv_cat_layout.rarrow.s16Height))
    {
	    #if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) || defined(__MMI_MSG_FTE_ENHANCE__)
			if(g_wgui_mv_cat_cntx.current_state != WGUI_MV_STATE_SHOWING)
	        {
	            return MMI_FALSE;
	        }
        #endif
        switch (event)
        {
            case MMI_PEN_EVENT_MOVE:
            case MMI_PEN_EVENT_DOWN:
                wgui_mv_right_key_down_handler();
                return MMI_TRUE;
            case MMI_PEN_EVENT_UP:
                wgui_mv_right_key_up_handler();
                return MMI_TRUE;
            default:
                return MMI_FALSE;
        }
    }
    #ifdef __MMI_MSG_FTE_ENHANCE__
        if (PEN_CHECK_BOUND(
                    pos.x,
                    pos.y,
                    g_wgui_mv_cat_layout.limage.s16X,
                    g_wgui_mv_cat_layout.limage.s16Y,
                    g_wgui_mv_cat_layout.limage.s16Width,
                    g_wgui_mv_cat_layout.limage.s16Height))

        {
            if (g_wgui_mv_cat_cntx.current_state != WGUI_MV_STATE_SHOWING)
            {
                return MMI_FALSE;
            }

             switch (event)
            {
                case MMI_PEN_EVENT_MOVE:
                case MMI_PEN_EVENT_DOWN:
                    if(attachment_state == WGUI_MV_BUTTON_RELEASED_STATE)
                    {
                        attachment_state = WGUI_MV_BUTTON_PRESSED_STATE;
                    }
                    wgui_mv_show_infobar();
                    return MMI_TRUE;

                case MMI_PEN_EVENT_UP:
                    if(attachment_state == WGUI_MV_BUTTON_PRESSED_STATE)
                    {
                        attachment_state = WGUI_MV_BUTTON_RELEASED_STATE;
                    }
                    wgui_mv_show_infobar();

                    if(g_wgui_mv_cat_cntx.current_msg.show_attachment_icon == WGUI_MV_VIEW_ONLY)
                    {
                        g_wgui_mv_cat_cntx.app_fte_common_cb(WGUI_MV_TOUCH_AREA_ATTACHMENT);
                    }
                    return MMI_TRUE;
                default:
                    return MMI_FALSE;
            }


        } /* For Full Screen Icon */
         else if (PEN_CHECK_BOUND(
                    pos.x,
                    pos.y,
                    g_wgui_mv_cat_layout.rimage.s16X,
                    g_wgui_mv_cat_layout.rimage.s16Y,
                    g_wgui_mv_cat_layout.rimage.s16Width,
                    g_wgui_mv_cat_layout.rimage.s16Height))

        {
            if(g_wgui_mv_cat_cntx.current_state != WGUI_MV_STATE_PLAYING)
            {
                return MMI_FALSE;
            }

            switch (event)
            {
                case MMI_PEN_EVENT_MOVE:
                case MMI_PEN_EVENT_DOWN:
                    if(full_state == WGUI_MV_BUTTON_RELEASED_STATE)
                    {   
                        full_state = WGUI_MV_BUTTON_PRESSED_STATE;
                    }
                    wgui_mv_show_infobar();
                    return MMI_TRUE;
                case MMI_PEN_EVENT_UP:
                    if(full_state == WGUI_MV_BUTTON_PRESSED_STATE)
                    {   
                        full_state = WGUI_MV_BUTTON_RELEASED_STATE;
                    }

                    wgui_mv_show_infobar();
					/* Pause the video before toggling the screen. */
                    #if defined(__MMI_VIDEO_PLAY_SUPPORT__)
                        if(((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id) 
                            && (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE) 
                            && (g_wgui_mv_cat_cntx.is_pause == MMI_FALSE))
                        {
                            wgui_mv_pause_slide();
                            g_wgui_mv_cat_cntx.is_pause = MMI_FALSE;
                        }
                    #endif

                    {
                        MMI_BOOL ret_urn = g_wgui_mv_cat_cntx.app_fte_common_cb(WGUI_MV_TOUCH_AREA_TOGGLE_SCRN);
                        if(ret_urn)
                        {
                            wgui_mv_toggle_screen();
                        }
                        else
                        {
                            wgui_mv_stop_slide_playing();
                        }
                    }
					/* Resume the video after toggling the screen. */
                    #if defined(__MMI_VIDEO_PLAY_SUPPORT__)
                        if(((*(g_wgui_mv_cat_cntx.current_msg.current_slide))->vid.id) 
                            && (g_wgui_mv_cat_cntx.is_pause == MMI_FALSE))
                        {
                            if(is_slide_switching)
                            {
                                wgui_mv_switch_slide_with_time_gap();
                            }
                            else
                            {
                                g_wgui_mv_cat_cntx.is_pause = MMI_TRUE;
                                wgui_mv_resume_slide();
                            }
                        }
                    #endif

                    return MMI_TRUE;
                default:
                    return MMI_FALSE;
            }
        }
    #endif
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_translate_category_pen_event
 * DESCRIPTION
 *  see if category has control
 * PARAMETERS
 *  pos     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_translate_category_pen_event(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (PEN_CHECK_BOUND(
            pos.x,
            pos.y,
            g_wgui_mv_cat_layout.infobar.s16X,
            g_wgui_mv_cat_layout.infobar.s16Y,
            g_wgui_mv_cat_layout.infobar.s16Width + g_wgui_mv_cat_layout.viewarea.s16Width,
            g_wgui_mv_cat_layout.infobar.s16Height + g_wgui_mv_cat_layout.viewarea.s16Height))
    {
        return MMI_TRUE;
    }

    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_pen_down_hldr
 * DESCRIPTION
 *  pen down handler
 * PARAMETERS
 *  pos     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_pen_down_hldr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined(__MMI_CLIPBOARD__) && defined(__MMI_VIDEO_PLAY_SUPPORT__)    
    gdi_handle src_layer_handle;
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#endif /* defined(__MMI_CLIPBOARD__) && defined(__MMI_VIDEO_PLAY_SUPPORT__) */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (wgui_mv_translate_infobar_pen_event(pos, MMI_PEN_EVENT_DOWN) == MMI_TRUE)
    {
        /* Only Infobar Buttons to get further events */
        g_wgui_mv_cat_layout.cat_pen_event = WGUI_MV_CAT_PEN_INFOBAR_EVENT;
	//	gui_touch_feedback_play(GUI_TOUCH_FEEDBACK_HOLD);
        return MMI_TRUE;
    }
#if defined(__MMI_CLIPBOARD__)
    else if (mmi_imc_is_clipboard_state()) 
    {
        if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
        {
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_CLIPBOARD_FLOATING_MENU__)
            if (CURRENT_SLIDE->vid.id != 0)
            {
                gdi_get_alpha_blending_source_layer(&src_layer_handle);
                gdi_set_alpha_blending_source_layer(g_wgui_mv_cat_layout.vlayer);
                mmi_imc_clipboard_pen_event_down_handler(pos);
                gdi_set_alpha_blending_source_layer(src_layer_handle);
            }
            else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
            {
                mmi_imc_clipboard_pen_event_down_handler(pos);
            }
        }
        return MMI_TRUE;
    }
#endif
    else if (wgui_mv_translate_viewarea_pen_event(pos, MMI_PEN_EVENT_DOWN) == MMI_TRUE)
    {
        /* Only View Area to get further events */
        g_wgui_mv_cat_layout.cat_pen_event = WGUI_MV_CAT_PEN_VIEW_EVENT;
#if defined(__MMI_CLIPBOARD__) 
        if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING && !g_pressed)
        {
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_CLIPBOARD_FLOATING_MENU__)
            if (CURRENT_SLIDE->vid.id != 0)
            {
                gdi_get_alpha_blending_source_layer(&src_layer_handle);
                gdi_set_alpha_blending_source_layer(g_wgui_mv_cat_layout.vlayer);
                mmi_imc_clipboard_pen_event_down_handler(pos);
                gdi_set_alpha_blending_source_layer(src_layer_handle);
            }
            else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
            {
                mmi_imc_clipboard_pen_event_down_handler(pos);
            }
        }
#endif /* defined(__MMI_CLIPBOARD__) */
        return MMI_TRUE;
    }
    else if (wgui_mv_translate_category_pen_event(pos) == MMI_TRUE)
    {
        /* Category will get and ignore further events */
        g_wgui_mv_cat_layout.cat_pen_event = WGUI_MV_CAT_PEN_IGNORE_EVENT;
        return MMI_TRUE;
    }

    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_pen_move_hldr
 * DESCRIPTION
 *  pen move handler
 * PARAMETERS
 *  pos     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_pen_move_hldr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined(__MMI_CLIPBOARD__) && defined(__MMI_VIDEO_PLAY_SUPPORT__)
     gdi_handle src_layer_handle;
     mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_layout.cat_pen_event == WGUI_MV_CAT_PEN_INFOBAR_EVENT)
    {
        if (wgui_mv_translate_infobar_pen_event(pos, MMI_PEN_EVENT_MOVE) == MMI_TRUE)
        {
            return MMI_TRUE;
        }
        else if (g_wgui_mv_cat_layout.larrow.Flags == WGUI_MV_BUTTON_PRESSED_STATE
                 || g_wgui_mv_cat_layout.rarrow.Flags == WGUI_MV_BUTTON_PRESSED_STATE
                 || full_state == WGUI_MV_BUTTON_PRESSED_STATE
                 || attachment_state == WGUI_MV_BUTTON_PRESSED_STATE)
        {
            /* Stuck Button Syndrome */
            g_wgui_mv_cat_layout.larrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
            g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
            full_state = WGUI_MV_BUTTON_RELEASED_STATE;
            attachment_state = WGUI_MV_BUTTON_RELEASED_STATE;
            wgui_mv_show_infobar();
        }

    }
    else if((g_wgui_mv_cat_layout.cat_pen_event == WGUI_MV_CAT_PEN_VIEW_EVENT)
#if defined(__MMI_CLIPBOARD__)
                && (mmi_imc_is_clipboard_state() == MMI_FALSE)
#endif
    )
    {
		 #ifdef __MMI_CLIPBOARD__
            if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING  && !g_pressed)
            {
                mmi_imc_cancel_timer();

            }
        #endif
        if (wgui_mv_translate_viewarea_pen_event(pos, MMI_PEN_EVENT_MOVE) == MMI_TRUE)
        {
            return MMI_TRUE;
        }
    }
#if defined(__MMI_CLIPBOARD__)
    else if (mmi_imc_is_clipboard_state() && (!g_pressed)) 
    {
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_CLIPBOARD_FLOATING_MENU__)
        if (CURRENT_SLIDE->vid.id != 0)
        {
            gdi_get_alpha_blending_source_layer(&src_layer_handle);
            gdi_set_alpha_blending_source_layer(g_wgui_mv_cat_layout.vlayer);
            mmi_imc_clipboard_pen_event_move_handler(pos);
            gdi_set_alpha_blending_source_layer(src_layer_handle);
        }
        else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
        {
            mmi_imc_clipboard_pen_event_move_handler(pos);
        }    
        return MMI_TRUE;
    }
#endif
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_pen_repeat_hldr
 * DESCRIPTION
 *  pen repeat handler
 * PARAMETERS
 *  pos     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_pen_repeat_hldr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined(__MMI_CLIPBOARD__) && defined(__MMI_VIDEO_PLAY_SUPPORT__)
     gdi_handle src_layer_handle;
     mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_wgui_mv_cat_layout.cat_pen_event == WGUI_MV_CAT_PEN_INFOBAR_EVENT)
    {
        /* Check for the situation where the pen moves out of infobar region and reaches to view area. */
        return MMI_TRUE;
    }
    else if((g_wgui_mv_cat_layout.cat_pen_event == WGUI_MV_CAT_PEN_VIEW_EVENT)
#if defined(__MMI_CLIPBOARD__)
                && (mmi_imc_is_clipboard_state() == MMI_FALSE)
#endif
    )
    {
        /* Only View Area to get further events */
        if(wgui_mv_translate_viewarea_pen_event(pos, MMI_PEN_EVENT_REPEAT) == MMI_TRUE)
        {
            #ifdef __MMI_CLIPBOARD__
            if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING  && !g_pressed)
            {
                #if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_CLIPBOARD_FLOATING_MENU__)
                    if (CURRENT_SLIDE->vid.id != 0)
                    {
                        gdi_get_alpha_blending_source_layer(&src_layer_handle);
                        gdi_set_alpha_blending_source_layer(g_wgui_mv_cat_layout.vlayer);
                        mmi_imc_cancel_timer() ;
                        gdi_set_alpha_blending_source_layer(src_layer_handle);
                    }
                    else
                #endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
                    {
                        mmi_imc_cancel_timer() ;

                    }    
            }
            #endif
            return MMI_TRUE;
        }
    }
#if defined(__MMI_CLIPBOARD__)
    else if (mmi_imc_is_clipboard_state()&& (!g_pressed))
    {
        #if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_CLIPBOARD_FLOATING_MENU__)
            if (CURRENT_SLIDE->vid.id != 0)
            {
                gdi_get_alpha_blending_source_layer(&src_layer_handle);
                gdi_set_alpha_blending_source_layer(g_wgui_mv_cat_layout.vlayer);
                mmi_imc_clipboard_pen_event_repeat_handler(pos);
                gdi_set_alpha_blending_source_layer(src_layer_handle);
            }
            else
        #endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
            {
                mmi_imc_clipboard_pen_event_repeat_handler(pos);
            }    
        return MMI_TRUE;
    }
#endif
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_pen_up_hldr
 * DESCRIPTION
 *  pen up handler
 * PARAMETERS
 *  pos     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_pen_up_hldr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret = MMI_FALSE;
#if defined(__MMI_CLIPBOARD__) && defined(__MMI_VIDEO_PLAY_SUPPORT__)
     gdi_handle src_layer_handle;
     mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_wgui_mv_cat_layout.cat_pen_event == WGUI_MV_CAT_PEN_INFOBAR_EVENT)
    {
        if (wgui_mv_translate_infobar_pen_event(pos, MMI_PEN_EVENT_UP) == MMI_TRUE)
        {
		//	gui_touch_feedback_play(GUI_TOUCH_FEEDBACK_HOLD);
            ret = MMI_TRUE;
        }
		 else if (g_wgui_mv_cat_layout.larrow.Flags == WGUI_MV_BUTTON_PRESSED_STATE
                 || g_wgui_mv_cat_layout.rarrow.Flags == WGUI_MV_BUTTON_PRESSED_STATE
                 || full_state == WGUI_MV_BUTTON_PRESSED_STATE
                 || attachment_state == WGUI_MV_BUTTON_PRESSED_STATE)
        {
            /* Stuck Button Syndrome */
            g_wgui_mv_cat_layout.larrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
            g_wgui_mv_cat_layout.rarrow.Flags = WGUI_MV_BUTTON_RELEASED_STATE;
            full_state = WGUI_MV_BUTTON_RELEASED_STATE;
            attachment_state = WGUI_MV_BUTTON_RELEASED_STATE;
            wgui_mv_show_infobar();
        }
    }
    else if((g_wgui_mv_cat_layout.cat_pen_event == WGUI_MV_CAT_PEN_VIEW_EVENT)
#if defined(__MMI_CLIPBOARD__)
                && (mmi_imc_is_clipboard_state() == MMI_FALSE)
#endif
    )
    {
        // click on highlight list
        if (MMI_multiline_inputbox.hilite_click_cb)
        {
            U16 idx = 0;
            MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_DISABLE_DRAW;
            gui_show_multi_line_input_box_ext(&MMI_multiline_inputbox, pos.x, pos.y);
            MMI_multiline_inputbox.flags &= ~UI_MULTI_LINE_INPUT_BOX_DISABLE_DRAW;
            if (gui_multi_line_input_box_is_pos_inside_hilite_ext(&MMI_multiline_inputbox, MMI_multiline_inputbox.cursor_p, &idx))
            {
                if (idx == MMI_multiline_inputbox.current_hilite_idx && !g_wgui_mv_scrolling_start)
                {
                    MMI_multiline_inputbox.hilite_click_cb(MMI_multiline_inputbox.current_hilite_idx);
                }
            }
        }

        if (wgui_mv_translate_viewarea_pen_event(pos, MMI_PEN_EVENT_UP) == MMI_TRUE)
        {
            ret = MMI_TRUE;
        }
    }

#if defined(__MMI_CLIPBOARD__)
    /* If pen move out of editor area, still should popup clipboard menu if text is selected */
    if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING  && !g_pressed)
    {
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MMI_CLIPBOARD_FLOATING_MENU__)
        if (CURRENT_SLIDE->vid.id != 0)
        {
            gdi_get_alpha_blending_source_layer(&src_layer_handle);
            gdi_set_alpha_blending_source_layer(g_wgui_mv_cat_layout.vlayer);
            gui_vertical_scrollbar_set_alpha_blend_layer(&MMI_multiline_inputbox.vbar, src_layer_handle);
            mmi_imc_clipboard_pen_event_up_handler(pos);
            gdi_set_alpha_blending_source_layer(src_layer_handle);
        }
        else
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
        {
            mmi_imc_clipboard_pen_event_up_handler(pos);
        }
    }
#endif /* __MMI_CLIPBOARD__ */ 

    return ret;
}
#endif /* __MMI_TOUCH_SCREEN__ */


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_check_rights_by_id_dummy
 * DESCRIPTION
 *  
 * PARAMETERS
 *   
 *  
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_check_rights_by_id_dummy(mma_mms_slide_object_struct *media)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return MMI_FALSE; /* We always have rights */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_start_consume_rights_dummy
 * DESCRIPTION
 *  
 * PARAMETERS
 *   
 *  
 * RETURNS
 *  
 *****************************************************************************/
static MMI_BOOL wgui_mv_start_consume_rights_dummy(mma_mms_slide_object_struct *media, PU16 file_path)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* DUMMY CALLBACK */
    return MMI_TRUE; /* We always have Rights! */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_stop_consume_rights_dummy
 * DESCRIPTION
 *  
 * PARAMETERS
 *   
 *  
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_stop_consume_rights_dummy(mma_mms_slide_object_struct *media)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* DUMMY CALLBACK */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_update_rights_by_id_dummy
 * DESCRIPTION
 *  
 * PARAMETERS
 *   
 *  
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_update_rights_by_id_dummy(mma_mms_slide_object_struct *media, MMI_BOOL rights_expired)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* DUMMY CALLBACK */
}


/*****************************************************************************
 * FUNCTION
 *  wgui_mv_best_page_duration_dummy
 * DESCRIPTION
 *  
 * PARAMETERS
 *   
 *  
 * RETURNS
 *  
 *****************************************************************************/
static void wgui_mv_best_page_duration_dummy (U64 playing_time, PU16 slide_duration, PU16 obj_start_time, PU16 obj_end_time)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* DUMMY CALLBACK */
}


/* External Interfaces Category */
/*****************************************************************************
 * FUNCTION
 *  Category630Initialize
 * DESCRIPTION
 *  
 * PARAMETERS
 *   
 *  
 * RETURNS
 *  
 *****************************************************************************/
void Category630Initialize(wgui_mv_initialize_struct *init)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	memset(&g_wgui_mv_cat_cntx, 0, sizeof(wgui_mv_context_struct));

    /* Data Members */
   	memset(&g_wgui_mv_cat_cntx, 0, sizeof(wgui_mv_context_struct));

    /* Data Members */
    g_wgui_mv_cat_cntx.current_msg.slide_head =         init->current_msg.slide_head;
	g_wgui_mv_cat_cntx.current_msg.background_color=    init->current_msg.background_color;
	g_wgui_mv_cat_cntx.current_msg.current_slide=	    init->current_msg.current_slide;
	g_wgui_mv_cat_cntx.current_msg.current_slide_num=	init->current_msg.current_slide_num;
	g_wgui_mv_cat_cntx.current_msg.foreground_color=	init->current_msg.foreground_color;
	g_wgui_mv_cat_cntx.current_msg.is_best_paging=	    init->current_msg.is_best_paging;
	g_wgui_mv_cat_cntx.current_msg.layout=             	init->current_msg.layout;
	#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
	g_wgui_mv_cat_cntx.current_msg.msg_size=	         init->current_msg.msg_size;
	g_wgui_mv_cat_cntx.drawable_media_file_path_ext =        g_wgui_mv_drawable_media_vf_ext ;
    #endif 
	g_wgui_mv_cat_cntx.current_msg.show_attachment_icon	=				   init->current_msg.show_attachment_icon;
	  
	g_wgui_mv_cat_cntx.current_msg.slide_timing=						init->current_msg.slide_timing;
	g_wgui_mv_cat_cntx.current_msg.total_slide_num	=					init->current_msg.total_slide_num;

    g_wgui_mv_cat_cntx.ptxtbuffer = init->ptxtbuffer;
    g_wgui_mv_cat_cntx.ptxtbuffersize = init->ptxtbuffersize;
    g_wgui_mv_cat_cntx.pinputboxbuffer = init->pinputboxbuffer;

//    ASSERT(g_wgui_mv_cat_cntx.current_msg);
    ASSERT(g_wgui_mv_cat_cntx.ptxtbuffer);
    ASSERT(g_wgui_mv_cat_cntx.ptxtbuffersize);
    ASSERT(g_wgui_mv_cat_cntx.pinputboxbuffer);

    /* Callbacks to APP */
	
	g_wgui_mv_cat_cntx.app_common_action_callback = init->app_common_action_callback;
    
    g_wgui_mv_cat_cntx.get_filename_by_id = init->get_filename_by_id_cb;
    g_wgui_mv_cat_cntx.load_paging_txt = init->load_slide_txt_cb;
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    g_wgui_mv_cat_cntx.is_drm_locked = init->check_rights_cb;
    g_wgui_mv_cat_cntx.start_consume_rights = init->consume_rights_cb;
    g_wgui_mv_cat_cntx.stop_consume_rights = init->stop_consume_rights_cb;
    g_wgui_mv_cat_cntx.update_rights = init->update_rights_cb;
    #else
    g_wgui_mv_cat_cntx.is_drm_locked = wgui_mv_check_rights_by_id_dummy;// init->check_rights_cb;
    g_wgui_mv_cat_cntx.start_consume_rights = wgui_mv_start_consume_rights_dummy;//init->consume_rights_cb;
    g_wgui_mv_cat_cntx.stop_consume_rights = wgui_mv_stop_consume_rights_dummy;//init->stop_consume_rights_cb;
    g_wgui_mv_cat_cntx.update_rights = wgui_mv_update_rights_by_id_dummy;//init->update_rights_cb;
   #endif
	g_wgui_mv_cat_cntx.stop_app_cb = init->stop_app_cb;
    g_wgui_mv_cat_cntx.allow_audio_play = init->allow_audio_cb;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    g_wgui_mv_cat_cntx.do_best_page_duration = init->best_page_duration_cb;
#endif
    g_wgui_mv_cat_cntx.mid_slides_cb = init->mid_slides_cb;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    g_wgui_mv_cat_cntx.get_highlighted_items = init->get_highlighted_items;
    g_wgui_mv_cat_cntx.highlight_handler = init->highlight_handler;
#endif
#ifdef __MMI_TOUCH_SCREEN__
    g_wgui_mv_cat_cntx.highlight_click_handler = init->highlight_click_handler;
#endif
    g_wgui_mv_cat_cntx.finish_playing = init->finish_playing;

	#ifdef __MMI_FTE_ITERATOR_VIEWER_SUPPORT__
	    g_wgui_mv_cat_cntx.left_iterate_func = init->left_iterate_func;
	    g_wgui_mv_cat_cntx.right_iterate_func = init->right_iterate_func;
	    g_wgui_mv_cat_cntx.get_index_func = init->get_index_func;
	#endif

	#ifdef __MMI_FTE_SUPPORT__
		#ifdef __MMI_MSG_FTE_ENHANCE__
		    g_wgui_mv_cat_cntx.app_fte_common_cb = init->app_fte_common_cb;
		#endif
	#endif

    g_wgui_mv_cat_cntx.decode_image_for_clear_image = init->decode_image_for_clear_image ;

    g_wgui_mv_cat_cntx.csk_icon = init->csk_icon;
    g_wgui_mv_cat_cntx.csk_func = init->csk_func;

    /* Image/Video/Audio/Text all depend upon following CB */
    ASSERT(g_wgui_mv_cat_cntx.get_filename_by_id);
    /* Loading Txt into Buffer is APP's responsibility */
    ASSERT(g_wgui_mv_cat_cntx.load_paging_txt);
    /* Stop APP incase of Error */
    ASSERT(g_wgui_mv_cat_cntx.stop_app_cb);
    /* Allow audio playing */
    ASSERT(g_wgui_mv_cat_cntx.allow_audio_play);
    #ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    if (!g_wgui_mv_cat_cntx.is_drm_locked)
    {
        g_wgui_mv_cat_cntx.is_drm_locked = wgui_mv_check_rights_by_id_dummy;
    }

    if (!g_wgui_mv_cat_cntx.start_consume_rights)
    {
        g_wgui_mv_cat_cntx.start_consume_rights = wgui_mv_start_consume_rights_dummy;
    }

    if (!g_wgui_mv_cat_cntx.stop_consume_rights)
    {
        g_wgui_mv_cat_cntx.stop_consume_rights = wgui_mv_stop_consume_rights_dummy;
    }

    if (!g_wgui_mv_cat_cntx.update_rights)
    {
        g_wgui_mv_cat_cntx.update_rights = wgui_mv_update_rights_by_id_dummy;
    }

    if (!g_wgui_mv_cat_cntx.do_best_page_duration)
    {
        g_wgui_mv_cat_cntx.do_best_page_duration = wgui_mv_best_page_duration_dummy;
    }
#endif
}
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
/* For detail description, please refer to wgui_categories_MMS_viewer.h */
void Category630ImageRightExpiredNotify(void)
{
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    if (!(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING
        || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING))
    {
        /*Viewer is Not playing or Showing let's not mess with states */
        return;
    }

    g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_HIDDEN;

    g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->img);
    /* Current slide image have expired either */
    /* Set redraw flag if playing with non zero duration */
    /* Else force redraw */
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
    g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_REDRAW;

    /* Force refresh on a slide with zero duration: it won't auto refresh */
    /* Force redraw on a stopped slide? Audio/Video won't be playing in stopped state */
    if (CURRENT_SLIDE->duration == 0 || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {
        wgui_mv_draw_viewer();
    }
}

/* For detail description, please refer to wgui_categories_MMS_viewer.h */
void Category630AudioRightExpiredNotify (void)
{
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    if (!(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING
        || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING))
    {
        /*Viewer is Not playing or Showing let's not mess with states */
        return;
    }

    /* Current slide Audio have expired */
    if (g_wgui_mv_cat_cntx.is_audio_play == MMI_TRUE)
    {
        g_wgui_mv_cat_cntx.is_audio_play = MMI_FALSE;
        g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->aud);
        g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->aud, MMI_FALSE);
        mdi_audio_stop_file();
    }
    
    g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->aud, MMI_TRUE);

    g_wgui_mv_cat_layout.infobar.Flags = WGUI_MV_REDRAW_NEEDED;

    /* Force refresh on a slide with zero duration: it won't auto refresh */
    /* Force redraw on a stopped slide? Audio/Video won't be playing in stopped state */
    if (CURRENT_SLIDE->duration == 0 || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {
        wgui_mv_draw_viewer();
    }
}

/* For detail description, please refer to wgui_categories_MMS_viewer.h */
void Category630VideoRightExpiredNotify (void)
{
    mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));

    if (!(g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_PLAYING
        || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING))
    {
        /*Viewer is Not playing or Showing let's not mess with states */
        return;
    }

    g_wgui_mv_cat_cntx.drawable_media_state = WGUI_MV_DRAWABLE_MEDIA_STATE_HIDDEN;

    /* Current slide image have expired either */
    g_wgui_mv_cat_cntx.stop_consume_rights (&CURRENT_SLIDE->vid);

#ifdef __MMI_VIDEO_PLAY_SUPPORT__
    if (g_wgui_mv_cat_cntx.is_video_play == MMI_TRUE)
    {
        mdi_video_ply_stop();
        g_wgui_mv_cat_cntx.update_rights(&CURRENT_SLIDE->vid, MMI_FALSE);
        g_wgui_mv_cat_cntx.is_video_play = MMI_FALSE;
		g_wgui_mv_cat_cntx.is_video_stopped = MMI_FALSE;
    }

    /* clear video area */
    if (g_wgui_mv_cat_layout.vlayer > 0)
    {
        mdi_util_hw_layer_switch_to_sw_layer(g_wgui_mv_cat_layout.vlayer); /* Change layer1 back to software layer */
		gdi_layer_push_and_set_active(g_wgui_mv_cat_layout.vlayer);  /* OK */
		gdi_layer_set_color_format(GDI_COLOR_FORMAT_16); /* Change color format back from UYVY422 */
		gdi_layer_clear(GDI_COLOR_BLACK); /* Because the content of layer was written by HW, suggest to clear the layer first */
        gdi_layer_clear(GDI_COLOR_TRANSPARENT);
        gdi_layer_pop_and_restore_active();
    }
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
    g_wgui_mv_cat_layout.viewarea.Flags = WGUI_MV_REDRAW_NEEDED;
    g_wgui_mv_cat_cntx.drawable_media_event = WGUI_MV_DRAWABLE_MEDIA_EVENT_REDRAW;

    /* Force refresh on a slide with zero duration: it won't auto refresh */
    /* Force redraw on a stopped slide? Audio/Video won't be playing in stopped state */
    if (CURRENT_SLIDE->duration == 0 || g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_SHOWING)
    {
        wgui_mv_draw_viewer();
    }
}


#endif
/*****************************************************************************
 * FUNCTION
 *  wgui_mv_start_clean_image_show
 * DESCRIPTION
 *  to show high quality image on viewer screen
 * PARAMETERS
 *  void 
 *  
 * RETURNS
 *  
 *****************************************************************************/

static void wgui_mv_start_clean_image_show()
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
       mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
	   S32 result  ;
	   wgui_mv_image_decode_status_enum decode_status ;
	   S32 img_width, img_height;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (CURRENT_SLIDE->img.id != 0)
		{
			result = g_wgui_mv_cat_cntx.get_filename_by_id(&CURRENT_SLIDE->img, g_wgui_mv_drawable_media_vf, 
				&g_wgui_mv_cat_cntx.drawable_media_file_path, &g_wgui_mv_drawable_media_file_handle);

			if (!result)
			{
				wgui_mv_error_condition();
				return;
			}
			if( wgui_mv_set_media_position())
			{
					if (gdi_image_get_dimension_file(
								(S8*)g_wgui_mv_cat_cntx.drawable_media_file_path,
								&img_width, &img_height) < GDI_SUCCEED)
					{
						g_wgui_mv_cat_cntx.is_image_decoded = MMI_TRUE;
						wgui_mv_reset_image_data_for_clean_image(WGUI_MV_IMAGE_DECODED_FAILED);
						wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
						return ;
					}
				  decode_status = g_wgui_mv_cat_cntx.decode_image_for_clear_image(g_wgui_mv_cat_cntx.drawable_media_file_path ,(U32)img_width,(U32)img_height,(U32)g_wgui_mv_cat_layout.resized_width,(U32)g_wgui_mv_cat_layout.resized_height, (U16)CURRENT_SLIDE->slide_num) ;
				  if(decode_status == WGUI_MV_IMAGE_DECODED_FAILED)
				  {
				    g_wgui_mv_cat_cntx.is_image_decoded = MMI_TRUE;
					wgui_mv_reset_image_data_for_clean_image(WGUI_MV_IMAGE_DECODED_FAILED);
					wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
				  }
				  else if(decode_status == WGUI_MV_IMAGE_ALREADY_DECODED)
				  {
					  g_wgui_mv_cat_cntx.is_image_decoded = MMI_TRUE;
					  wgui_mv_reset_image_data_for_clean_image(WGUI_MV_IMAGE_ALREADY_DECODED);
                   wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
				  }

			}
			else
			{
			    wgui_mv_reset_image_data_for_clean_image(WGUI_MV_IMAGE_DECODED_FAILED);
                wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
			}
		 
		 }
   else
	 {
       wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
	 }

}

void static wgui_mv_reset_image_data_for_clean_image(wgui_mv_image_decode_status_enum result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
       
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(result == WGUI_MV_IMAGE_DECODED_FAILED) 
	{
		memset((PS8)  g_wgui_mv_drawable_media_vf_ext, 0, WGUI_MV_VFN_LEN);
		g_wgui_mv_cat_cntx.drawable_media_file_path_ext = NULL ;
		
	}
    if (g_wgui_mv_drawable_media_file_handle != 0)
        {
            FS_Close(g_wgui_mv_drawable_media_file_handle);
            g_wgui_mv_drawable_media_file_handle = 0;
        }
	memset((PS8)  g_wgui_mv_drawable_media_vf, 0, WGUI_MV_VFN_LEN);


}

void Category630ImageDecodeDoneNotify(wgui_mv_image_decode_status_enum result ,U16 *file_path)
{
   /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
       
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   wgui_mv_reset_image_data_for_clean_image(result);
   g_wgui_mv_cat_cntx.is_image_decoded = MMI_TRUE;
   if(result == WGUI_MV_IMAGE_DECODED_SUCCESS)
   {
       mmi_ucs2ncpy((PS8)g_wgui_mv_drawable_media_vf_ext,(PS8) file_path, WGUI_MV_VFN_LEN); 
	   g_wgui_mv_cat_cntx.drawable_media_file_path_ext = g_wgui_mv_drawable_media_vf_ext ;
	
   }
   else
   {
    g_wgui_mv_cat_cntx.drawable_media_file_path_ext = NULL ;
   }
   wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
}

/* For detail description, please refer to wgui_categories_MMS_viewer.h */
void Category630MidSlidesCBDoneNotify (void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if((g_wgui_mv_cat_cntx.decode_image_for_clear_image) && (g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_IMAGE_TYPE_ACTION)))
	{
		wgui_mv_start_clean_image_show();
	}
	else
	{
	 g_wgui_mv_cat_cntx.drawable_media_file_path_ext = NULL ;
    wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
}
}


void wgui_mv_register_keys(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(wgui_mv_up_key_handler, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(wgui_mv_up_key_handler, KEY_UP_ARROW, KEY_EVENT_REPEAT);
    SetKeyHandler(wgui_mv_up_key_handler, KEY_UP_ARROW, KEY_EVENT_LONG_PRESS);
    SetKeyHandler(wgui_mv_down_key_handler, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(wgui_mv_down_key_handler, KEY_DOWN_ARROW, KEY_EVENT_REPEAT);
    SetKeyHandler(wgui_mv_down_key_handler, KEY_DOWN_ARROW, KEY_EVENT_LONG_PRESS);
    SetKeyHandler(wgui_mv_left_key_down_handler, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(wgui_mv_right_key_down_handler, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(wgui_mv_left_key_up_handler, KEY_LEFT_ARROW, KEY_EVENT_UP);
    SetKeyHandler(wgui_mv_right_key_up_handler, KEY_RIGHT_ARROW, KEY_EVENT_UP);

    /* if no repated, FW will auto change to done, but we cannot done repeatedly */
    SetKeyHandler(MMI_dummy_function, KEY_LEFT_ARROW, KEY_EVENT_REPEAT);
    SetKeyHandler(MMI_dummy_function, KEY_RIGHT_ARROW, KEY_EVENT_REPEAT);
}


/* For detail description, please refer to wgui_categories_MMS_viewer.h */
#include "App_mem_med.h"
void ShowCategory630Screen (BOOL toggle, U16 mode, softkey_fn lsk_function, U16 lsk_str_id, softkey_fn rsk_function, MMI_BOOL is_fullscreen, PU8 guibuffer,WGUI_MV_USED_BY_ENUM used_by)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    dm_data_struct dm_data;
#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__)
    mmi_frm_gesture_rect_struct mv_gesture_rect;
#endif    

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
    {   /* tricky: force to free scr_bg layer,
           otherwise multi-line will set it as alpha source layer */
        GDI_HANDLE dummy_layer;
#ifdef __GDI_MEMORY_PROFILE_2__
        if (gdi_layer_create(0, 0, UI_device_width, UI_device_height, &dummy_layer) >= 0)
        {
            gdi_layer_free(dummy_layer);
        }
#else
		S32 buf_size;
		PU8 buf_ptr = NULL;

		buf_size = (UI_device_height * UI_device_width * GDI_MAINLCD_BIT_PER_PIXEL) >>3 /*(10 * 10 * GDI_MAINLCD_BIT_PER_PIXEL) >>3*/;

		buf_ptr = (PU8) applib_asm_alloc_anonymous_nc(buf_size);

		MMI_ASSERT(buf_ptr);

		if(gdi_layer_create_using_outside_memory(0, 0, UI_device_width, UI_device_height, &dummy_layer, (PU8) buf_ptr, (S32) buf_size) >= 0) /*(gdi_layer_create(0, 0, UI_device_width, UI_device_height, &dummy_layer) >= 0)*/
        {
            gdi_layer_free(dummy_layer);

			applib_asm_free_anonymous(buf_ptr);
        }
#endif
    }

    if (mode == WGUI_MV_DISPLAY_MODE_PLAY)
    {
        /* disable backlight turn-off & screen saver */
        srv_backlight_turn_on(SRV_BACKLIGHT_PERMANENT);
        mmi_phnset_disable_partial_ss();
        g_wgui_mv_disable_backlight = MMI_TRUE;
    }

    g_wgui_mv_cat_cntx.is_fullscreen = is_fullscreen;
    g_wgui_mv_used_by=used_by;

    g_wgui_mv_cat_cntx.lsk_fn = lsk_function;
    g_wgui_mv_cat_cntx.lsk_str_id = lsk_str_id;
    g_wgui_mv_cat_cntx.rsk_fn = rsk_function;

    if (NULL == guibuffer)
    {
        memset(&g_wgui_mv_paging_cntx, 0, sizeof(wgui_mv_paging_context));
    }
    
    g_wgui_mv_cat_cntx.display_mode = (wgui_mv_display_mode_enum)mode;

    wgui_mv_setup_screen_layout();

    register_default_hide_softkeys();
    /* clear_category_screen_key_handlers(); */

    /* set volume */
	{
    	U8 vol ;
	    srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_RING_VOL_LEVEL,(void*)&vol);
    	g_wgui_mv_volume = vol;
	}
    
    if (g_wgui_mv_cat_cntx.allow_audio_play() == MMI_TRUE)
    {
        SetKeyHandler(wgui_mv_vol_up_key_handler, KEY_VOL_UP, KEY_EVENT_DOWN);
        SetKeyHandler(wgui_mv_vol_down_key_handler, KEY_VOL_DOWN, KEY_EVENT_DOWN);
    }

    wgui_mv_register_keys();

#ifdef __MMI_CLIPBOARD__
		/* the view mode flag must be set before connect ime clipboard, or the ime indicator will be shown */
    MMI_multiline_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_VIEW_MODE;
    mmi_imc_clipboard_connect(INPUTBOX_MULTILINE_MMS_VIEWER);    
#endif /* __MMI_CLIPBOARD__ */
#ifdef __MMI_ICON_BAR_SUPPORT__
#if defined(__MMI_FTE_SUPPORT__)
    if(wgui_icon_bar_is_created())
    {
        wgui_icon_bar_register_hide_function(wgui_mv_hide_icon_bar);
    }
#endif /* defined(__MMI_FTE_SUPPORT__) */
#endif /*__MMI_ICON_BAR_SUPPORT__*/

    /* Setup standard category handler */
    ExitCategoryFunction = wgui_mv_exit_category;
    dm_setup_category_functions(dm_redraw_category_screen, dm_get_category_history, dm_get_category_history_size);
    dm_data.s32ScrId = (S32) GetActiveScreenId();
    dm_data.s32CatId = MMI_CATEGORY630_ID;
    dm_data.s32flags = DM_NO_BLT;
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    dm_data.s32flags |= (is_fullscreen) ? (DM_NO_STATUS_BAR | DM_NO_SOFTKEY) : (0);
#else
dm_data.s32flags |= (is_fullscreen) ? (DM_NO_STATUS_BAR | DM_NO_SOFTKEY) : (DM_NO_STATUS_BAR);
#endif
    dm_setup_data(&dm_data);
    dm_register_category_controlled_callback(wgui_mv_draw_category_controlled_area);
	
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_category_screen_control_area_pen_handlers(wgui_mv_pen_down_hldr, MMI_PEN_EVENT_DOWN);
    wgui_register_category_screen_control_area_pen_handlers(wgui_mv_pen_move_hldr, MMI_PEN_EVENT_MOVE);
    wgui_register_category_screen_control_area_pen_handlers(wgui_mv_pen_repeat_hldr, MMI_PEN_EVENT_REPEAT);
    wgui_register_category_screen_control_area_pen_handlers(wgui_mv_pen_up_hldr, MMI_PEN_EVENT_UP);
#if defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__)
    mv_gesture_rect.x1 = g_wgui_mv_cat_layout.infobar.s16X;
    mv_gesture_rect.y1 = g_wgui_mv_cat_layout.infobar.s16Y;
    mv_gesture_rect.x2 = g_wgui_mv_cat_layout.viewarea.s16X + g_wgui_mv_cat_layout.viewarea.s16Width-current_MMI_theme->scrollbar_size;
    mv_gesture_rect.y2 = g_wgui_mv_cat_layout.viewarea.s16Y + g_wgui_mv_cat_layout.viewarea.s16Height-current_MMI_theme->scrollbar_size;

    //mmi_frm_gesture_listen_event_ex(MMI_FRM_GESTURE_RIGHT, wgui_mv_right_key_up_gesture_handler, &mv_gesture_rect);
    //mmi_frm_gesture_listen_event_ex(MMI_FRM_GESTURE_LEFT, wgui_mv_left_key_up_gesture_handler, &mv_gesture_rect);
    mmi_frm_gesture_listen_event_ex(MMI_FRM_GESTURE_RIGHT, wgui_mv_right_key_up_gesture_handler, &mv_gesture_rect);
    mmi_frm_gesture_listen_event_ex(MMI_FRM_GESTURE_LEFT, wgui_mv_left_key_up_gesture_handler, &mv_gesture_rect);
    mmi_frm_gesture_listen_event_ex(MMI_FRM_GESTURE_UP, wgui_mv_up_key_gesture_handler, &mv_gesture_rect);
    mmi_frm_gesture_listen_event_ex(MMI_FRM_GESTURE_DOWN, wgui_mv_down_key_gesture_handler, &mv_gesture_rect);
#endif /* defined(__MMI_FTE_ITERATOR_VIEWER_SUPPORT__) && defined(__MMI_GESTURES_FRAMEWORK__) */


#endif /* __MMI_TOUCH_SCREEN__ */ 

    dm_redraw_category_screen();    /* This will redraw status bar and buttonbar */

    if (g_wgui_mv_cat_cntx.mid_slides_cb != NULL)
    {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        wgui_mv_display_loading_screen();
        wgui_mv_setup_progressbar();
#endif
        g_wgui_mv_cat_cntx.mid_slides_cb();
    }
    else
    {
#ifndef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
        if (mode == WGUI_MV_DISPLAY_MODE_SHOW)
        {
            wgui_mv_reset_softkey_on_show();
            wgui_mv_smc_event_handler(WGUI_MV_EVENT_SHOW_START);
        }
        else
        {
            wgui_mv_reset_softkey_on_play();
            wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_START);
        }
        if (g_wgui_mv_cat_cntx.current_state == WGUI_MV_STATE_ERROR)
        {
            return;
        }

        wgui_mv_start_viewing();
#endif
#ifdef __MMI_MMS_SIMPLIFIED_UI_SUPPORT__
    wgui_mv_display_loading_screen();
	 wgui_mv_setup_progressbar();
	 if((g_wgui_mv_cat_cntx.decode_image_for_clear_image) && (g_wgui_mv_cat_cntx.app_common_action_callback(WGUI_MV_IMAGE_TYPE_ACTION)))
	{
		wgui_mv_start_clean_image_show();
	}
	 else
	 {
		 g_wgui_mv_cat_cntx.drawable_media_file_path_ext = NULL ;
     wgui_mv_smc_event_handler(WGUI_MV_EVENT_PLAY_SHOW_ACTIVE_SLIDE);
	 }
#endif
    }
}


/* For detail description, please refer to wgui_categories_MMS_viewer.h */
void wgui_cat630_get_viewer_area_info (S32 *x, S32 *y, S32 *w, S32 *h, MMI_BOOL is_fullscreen)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 img_w = 0, img_h = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_measure_image((PU8)current_MMI_theme->mms_viewer_progress_bar_img, &img_w, &img_h);
    
    *x = MMI_COMMON_CONTENT_X;
    *x += (mmi_fe_get_r2l_state()) ? (current_MMI_theme->scrollbar_size) : (CAT630_HMARGIN);
#if defined(__MMI_MAINLCD_128X128__) || defined(__MMI_MAINLCD_128X160__) || defined(__MMI_MAINLCD_320X240__)
    *y = img_h + CAT630_VMARGIN;
#else /* defined(__MMI_MAINLCD_128X128__) || defined(__MMI_MAINLCD_128X160__) || defined(__MMI_MAINLCD_320X240__) */
    *y = MMI_COMMON_TITLE_HEIGHT + CAT630_VMARGIN;
    *y += (is_fullscreen) ? (0) : (MMI_COMMON_TITLE_Y);
#endif /* defined(__MMI_MAINLCD_128X128__) || defined(__MMI_MAINLCD_128X160__) || defined(__MMI_MAINLCD_320X240__) */
    *w = MMI_COMMON_CONTENT_WIDTH - current_MMI_theme->scrollbar_size - (CAT630_HMARGIN << 1) - 4/* editor gap */;
    *h = UI_device_height - *y - (CAT630_VMARGIN << 1);
    *h -= (is_fullscreen) ? (0) : (MMI_BUTTON_BAR_HEIGHT);
#if !(defined(__MMI_MAINLCD_128X128__) || defined(__MMI_MAINLCD_128X160__))
    *h -= img_h;
#endif /* !(defined(__MMI_MAINLCD_128X128__) || defined(__MMI_MAINLCD_128X160__)) */
}


/* For detail description, please refer to wgui_categories_MMS_viewer.h */
gdi_handle wgui_mv_get_video_layer(void)
{
#if defined(__MMI_VIDEO_PLAY_SUPPORT__)
    if (g_dm_data.s32CatId == MMI_CATEGORY630_ID)
    {
        mma_mms_slide_struct *CURRENT_SLIDE = (*(g_wgui_mv_cat_cntx.current_msg.current_slide));
        if (CURRENT_SLIDE->vid.id != 0)
        {
            return g_wgui_mv_cat_layout.vlayer;
        }
        else
        {
            return 0;
        }
    }
    else
    {
        return 0;
    }
#else
    return 0;
#endif /* __MMI_VIDEO_PLAY_SUPPORT__ */
}

#else /* defined(__UI_MMS_VIEWER_CATEGORY__) */ 

/* here a dummy function just for removing compile warning */
void wgui_viewer_screen_dummy(void)
{
}

#endif /* __UI_MMS_VIEWER_CATEGORY__ */ 


