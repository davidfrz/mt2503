/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 *  SmsAppTemplates.c
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *  SMS Application templates 
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 *****************************************************************************/

#include "MMI_features.h"
#ifdef __MMI_TELEPHONY_SUPPORT__
#ifdef __MMI_MESSAGES_TEMPLATE__

/* Include: MMI header file */
/**************************************************************
* Header Files Include
**************************************************************/
#include "MMIDataType.h"
#include "GlobalResDef.h"
#include "GlobalConstants.h"
#include "nvram_common_defs.h"
#include "kal_general_types.h"
#include "FontRes.h"
#include "gui_data_types.h"
#include "CustDataRes.h"
#include "string.h"
#include "Unicodexdcl.h"
#include "kal_public_api.h"
#include "mmi_frm_nvram_gprot.h"
#include "MMI_common_app_trc.h"
#include "mmi_frm_mem_gprot.h"
#include "mmi_frm_events_gprot.h"
#include "mmi_frm_scenario_gprot.h"
#include "MMI_common_app_trc.h"
#include "DebugInitDef_Int.h"
#include "kal_trace.h"
#include "ems.h"
#include "ImeGprot.h"
#include "gui_typedef.h"
#include "wgui_categories_util.h"
#include "wgui_categories_list.h"
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
#ifdef _MUTILANG_TEMPLATE_
#include "PixcomFontEngine.h"
#include "SSCStringTable.h"
#endif /* _MUTILANG_TEMPLATE_ */ 
#endif
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
#include "wgui_categories_inputs.h"
#include "Gsm7BitNationalLang.h"
#include "ps_public_enum.h"
#endif
#if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__)
#include "wgui_touch_screen.h"
#endif /* #if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__) */
#include "mmi_rp_app_sms_def.h"

#include "FontDcl.h"
#include "CommonScreens.h"
#include "SmsAppProt.h"
#include "SmsAppGprot.h"
#include "SmsAppGprot.h"
#if (defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__))
#include "SSCStringHandle.h"
#endif /* (defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__)) */

#include "SmsCuiGprot.h"
#include "FSEditorCuiGprot.h"
#include "MenuCuiGprot.h"
#include "GeneralSettingSrvGprot.h"
#include "Lang_interface.h"
/**************************************************************
* MARCO
**************************************************************/
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
#define NUM_TEMPLATES                   10
#define MAX_TEMPLATE_LENGTH             40

#ifndef NVRAM_SMS_TEMPL_RECORD_SIZE
#define NVRAM_SMS_TEMPL_RECORD_SIZE     84
#endif
#ifndef NVRAM_SMS_RECORD_TOTAL
#define NVRAM_SMS_RECORD_TOTAL          31
#endif
#ifdef _MUTILANG_TEMPLATE_
#define TOTAL_TEMPLATE_LANGUAGE         3
#endif
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
#ifndef NVRAM_SMS_UD_TEMPL_RECORD_SIZE
#define NVRAM_SMS_UD_TEMPL_RECORD_SIZE  324
#endif 
#define NUM_UD_TEMPLATES                10
#define MAX_UD_TEMPLATE_LENGTH          160
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 


#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
#define MAX_TEMPL_RECORD_BUFF_SIZE      (NVRAM_SMS_UD_TEMPL_RECORD_SIZE + ENCODING_LENGTH)   
#else /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */
#define MAX_TEMPL_RECORD_BUFF_SIZE      (NVRAM_SMS_TEMPL_RECORD_SIZE + ENCODING_LENGTH)
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */


/**************************************************************
* Structure Declaration
**************************************************************/
typedef enum
{
    MMI_SMS_TEMPLATE_NONE = 0,
    MMI_SMS_TEMPLATE_USER_DEFINED,
    MMI_SMS_TEMPLATE_DEFAULT,
    MMI_SMS_TEMPLATE_TOTAL
}mmi_sms_template_type_enum;

typedef enum
{
    MSG_TEMPLATE_LANG_ENGLISH,
    MSG_TEMPLATE_LANG_SIMCHINESE,
    MSG_TEMPLATE_LANG_TRACHINESE
} mmi_sms_template_lang_enum;

typedef struct
{
    S32 curr_index;
    CHAR record_buff[MAX_TEMPL_RECORD_BUFF_SIZE];

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    CHAR *predef_list[NUM_TEMPLATES];
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    CHAR *userdef_list[NUM_UD_TEMPLATES];
    U16 userdef_num;
    U8  edit_type;         /* 0: new template, 1: edit template*/
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

#if (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__))
    mmi_sms_template_type_enum template_type;
    mmi_sms_template_type_enum pre_select_type;
#endif /* (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)) */

    MMI_BOOL is_load;
    U16 list_lsk_str_id;
    U16 list_lsk_icon_id;
    U16 list_csk_str_id;
    U16 list_csk_icon_id;
    MMI_BOOL is_set_csk;
    mmi_sms_tmpl_list_template_type_enum list_templ_type;
    mmi_sms_get_template_hdlr_func_t list_callback;
}mmi_sms_template_struct;


/**************************************************************
* Global Variables Declaration
**************************************************************/
extern EMSData *GetEMSDataForView(EMSData **p, U8 force);

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
#ifdef _MUTILANG_TEMPLATE_
extern pBOOL IsTrChineseSet(void);
extern pBOOL IsSmChineseSet(void);
#endif /* _MUTILANG_TEMPLATE_ */ 

#if (defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__))
extern sLanguageDetails *gLanguageArray;
extern U16 gCurrLangIndex;
#endif /* (defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__)) */
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 


/**************************************************************
* Global Function Declaration
**************************************************************/


/**************************************************************
* Static Variables Defination
**************************************************************/
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
static const U16 template_str[] = 
{
    STR_ID_SMS_TEMPLATE_1,
    STR_ID_SMS_TEMPLATE_2,
    STR_ID_SMS_TEMPLATE_3,
    STR_ID_SMS_TEMPLATE_4,
    STR_ID_SMS_TEMPLATE_5,
    STR_ID_SMS_TEMPLATE_6,
    STR_ID_SMS_TEMPLATE_7,
    STR_ID_SMS_TEMPLATE_8,
    STR_ID_SMS_TEMPLATE_9,
    STR_ID_SMS_TEMPLATE_10
};

#if defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__)
static U8 curr_lang[SSC_SIZE];
#endif /* _MUTILANG_TEMPLATE_, __MMI_MESSAGES_SIMCHINESE_TEMPLATE__ */
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

static mmi_sms_template_struct template_data;
static MMI_ID mmi_sms_template_gid = GRP_ID_INVALID;
MMI_ID mmi_sms_template_cui_gid = GRP_ID_INVALID;
static MMI_ID mmi_sms_template_edit_child_gid = GRP_ID_INVALID;
static U16 nstr_item_list[2];

/**************************************************************
* Static Function Declaration
**************************************************************/
#if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
static void mmi_sms_entry_userdefined_templates(void);
static void mmi_sms_entry_default_templates(void);
static void mmi_sms_select_template_type_pre_entry_hdlr(void);
static void mmi_sms_select_template_type_select_hdlr(cui_menu_event_struct *menu_evt);
#endif /* defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__) */

#if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__)
static void mmi_sms_read_template_from_nvram(U16 index);
static MMI_BOOL mmi_sms_write_template_to_nvram(U16 index);
static MMI_BOOL mmi_sms_write_default_template_to_nvram(void);
static void mmi_sms_get_templates_to_edit(CHAR *buffer, U16 index);
static MMI_BOOL mmi_sms_delete_predefined_template(U16 index);
static MMI_BOOL mmi_sms_store_predefined_template(U16 index);
static U16 mmi_sms_cal_template_base(void);
#if defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__)
static void mmi_sms_set_template_language(U8 langtype);
static void mmi_sms_unset_template_language(void);
#endif /* defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__) */ 
#endif /* defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
static void mmi_sms_read_ud_template_from_nvram(U16 index);
static MMI_BOOL mmi_sms_write_ud_template_to_nvram(U16 index);
static MMI_BOOL mmi_sms_write_ud_default_template_to_nvram(void);
static void mmi_sms_get_ud_templates_to_edit(CHAR *buffer, U16 index);
static MMI_BOOL mmi_sms_delete_ud_template(U16 index);
static MMI_BOOL mmi_sms_store_ud_template(U16 index);
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

static void mmi_sms_load_templates_in_displaylist(void);
static mmi_sms_template_type_enum mmi_sms_get_template_type(void);
static MMI_BOOL mmi_sms_save_template(void);
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
static MMI_BOOL mmi_sms_save_new_template(void);
static void mmi_sms_template_entry_new(void);
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
static void mmi_sms_pre_new_template(void);
static void mmi_sms_delete_template(void);
static void mmi_sms_pre_delete_template(void);
static void mmi_sms_erase_template(void);
static void mmi_sms_pre_erase_template(void);
static void mmi_sms_template_entry_edit(void);
static void mmi_sms_pre_entry_template_edit(void);
static void mmi_sms_entry_template_write_msg(void);
static void mmi_sms_pre_entry_template_write_msg(void);
static void mmi_sms_get_template_index(S32 nIndex);
#ifndef __MMI_SMS_SLIM__
static pBOOL mmi_sms_template_list_get_item(
                S32 item_index,
                UI_string_type str_buff,
                PU8 *img_buff_p,
                U8 str_img_mask);
#endif 
static void mmi_sms_entry_template(mmi_sms_template_type_enum type);
static void mmi_sms_template_option_pre_entry_hdlr(void);
static void mmi_sms_template_option_entry_hdlr(MMI_ID menu_gid);
static void mmi_sms_template_option_select_hdlr(cui_menu_event_struct *menu_evt);
static mmi_ret mmi_sms_template_group_proc(mmi_event_struct *evt);
static void mmi_sms_create_template_gid(MMI_ID parent_gid);
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
static MMI_BOOL mmi_sms_template_has_ucs2_char(U16 *buf, U16 charNum);
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */

/**************************************************************
* Function Defination
**************************************************************/
#if (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__))
/*****************************************************************************
 * FUNCTION
 *  mmi_sms_entry_userdefined_templates
 * DESCRIPTION
 *  entry userdefined template function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_entry_userdefined_templates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_entry_template(MMI_SMS_TEMPLATE_USER_DEFINED);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_entry_default_templates
 * DESCRIPTION
 *  entry default template function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_entry_default_templates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_entry_template(MMI_SMS_TEMPLATE_DEFAULT);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_select_template_type_pre_entry_hdlr
 * DESCRIPTION
 *  Entry template type list to select
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_select_template_type_pre_entry_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    template_data.template_type = MMI_SMS_TEMPLATE_NONE;
    template_data.pre_select_type = MMI_SMS_TEMPLATE_NONE;

    mmi_sms_entry_menu_cui_appsub_generic(
        mmi_sms_template_gid,
        MENU_ID_SMS_TEMPLATES_SELECT_MENUID,
        STR_ID_SMS_SMS_TEMPLATES_MENUENTRY);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_select_template_type_select_hdlr
 * DESCRIPTION
 *  Delete all template screens
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_select_template_type_select_hdlr(cui_menu_event_struct *menu_evt)
{
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/
     mmi_menu_id menu_item_id = menu_evt->highlighted_menu_id;
     
     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
     switch (menu_item_id)
     {
         case MENU_ID_SMS_TEMPLATES_SELECT_USERDEFINED_MENUID:
             mmi_sms_entry_userdefined_templates();
             break;

         case MENU_ID_SMS_TEMPLATES_SELECT_DEFAULT_MENUID:
            mmi_sms_entry_default_templates();
             break;

         default:
             MMI_ASSERT(0);
             break;
     }
}
#endif /* (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)) */


#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
/*****************************************************************************
 * FUNCTION
 *  mmi_sms_read_template_from_nvram
 * DESCRIPTION
 *  Read template from NVRAM
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_read_template_from_nvram(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_READ_TEMPLATE_FROM_NVRAM, index);

    if (index < NVRAM_SMS_RECORD_TOTAL)
    {
        /*  1. The first record index of the LID is 1;
         *  2. And the first record is used to as a mark to 
         *     indicate the intialization status;
         *  So, the record index of the first template is 2;
         */
        if (ReadRecord(NVRAM_EF_SMS_LID, (U16)(index + 2), template_data.record_buff,
                NVRAM_SMS_TEMPL_RECORD_SIZE, &error) < 0)
        {
            template_data.record_buff[0] = '\0';
            template_data.record_buff[1] = '\0';
        }
    }
    else
    {
        template_data.record_buff[0] = '\0';
        template_data.record_buff[1] = '\0';
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_write_template_to_nvram
 * DESCRIPTION
 *  Write template to NVRAM
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        Index
 * RETURNS
 *  MMI_TRUE: write success, FALSE: write fail
 *****************************************************************************/
static MMI_BOOL mmi_sms_write_template_to_nvram(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    MMI_BOOL result = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index < NVRAM_SMS_RECORD_TOTAL)
    {
        /*  1. The first record index of the LID is 1;
         *  2. And the first record is used to as a mark to 
         *     indicate the intialization status;
         *  So, the record index of the first template is 2;
         */
        if (WriteRecord(NVRAM_EF_SMS_LID, (U16)(index + 2), template_data.record_buff,
                NVRAM_SMS_TEMPL_RECORD_SIZE, &error) != NVRAM_SMS_TEMPL_RECORD_SIZE)
        {
            result = MMI_FALSE;
        }
    }
    else
    {
        result = MMI_FALSE;
    }

    return result;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_write_default_template_to_nvram
 * DESCRIPTION
 *  Write default template to NVRAM
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL mmi_sms_write_default_template_to_nvram(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 i = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = 0; i < NUM_TEMPLATES; i++)
    {
        U16 templateindex = i + mmi_sms_cal_template_base();
        CHAR *tmpl_str;

        tmpl_str = GetString(template_str[i]);

        if (tmpl_str != NULL)
        {
            memcpy(template_data.record_buff, tmpl_str, (mmi_ucs2strlen(tmpl_str) + 1) * ENCODING_LENGTH);
        }
        else
        {
            memset(template_data.record_buff, 0, MAX_TEMPL_RECORD_BUFF_SIZE);
        }

        if (mmi_sms_write_template_to_nvram(templateindex) == MMI_FALSE)
        {
            return MMI_FALSE;
        }
    }

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_get_templates_to_edit
 * DESCRIPTION
 *  Get templates to edit.
 * PARAMETERS
 *  buffer      [IN/OUT]        Address of string
 *  index       [IN]            Current highlight index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_get_templates_to_edit(CHAR *buffer, U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (template_data.predef_list[index])
    {
        mmi_ucs2cpy(buffer, template_data.predef_list[index]);
    }
    else
    {
        buffer[0] = buffer[1] = '\0';
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_delete_predefined_template
 * DESCRIPTION
 *  Delete template
 * PARAMETERS
 *  index       [IN]        Index
 * RETURNS
 *  MMI_TRUE: delete success, FALSE: delete fail
 *****************************************************************************/
static MMI_BOOL mmi_sms_delete_predefined_template(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 templateindex = index + mmi_sms_cal_template_base();
    MMI_BOOL result;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(template_data.record_buff, 0, MAX_TEMPL_RECORD_BUFF_SIZE);

    result = mmi_sms_write_template_to_nvram(templateindex);

    return result;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_store_predefined_template
 * DESCRIPTION
 *  Store templates
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        Index
 *  b(?)        [IN]        Address of string
 * RETURNS
 *  MMI_TRUE: store success, FALSE: store fail
 *****************************************************************************/
static MMI_BOOL mmi_sms_store_predefined_template(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 templateindex = index + mmi_sms_cal_template_base();
    MMI_BOOL result;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    result = mmi_sms_write_template_to_nvram(templateindex);

    return result;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_cal_template_base
 * DESCRIPTION
 *  Calculate template base
 * PARAMETERS
 *  void
 * RETURNS
 *  template base
 *****************************************************************************/
static U16 mmi_sms_cal_template_base(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef _MUTILANG_TEMPLATE_
    U8 lang_offset = 0;
    U16 temp_base = 0;
#endif /* _MUTILANG_TEMPLATE_ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef _MUTILANG_TEMPLATE_
    if (IsTrChineseSet())
    {
        lang_offset = (U8)MSG_TEMPLATE_LANG_TRACHINESE;
    }
    else if (IsSmChineseSet())
    {
        lang_offset = (U8)MSG_TEMPLATE_LANG_SIMCHINESE;
    }
    else
    {
        lang_offset = (U8)MSG_TEMPLATE_LANG_ENGLISH;
    }

    temp_base = lang_offset * NUM_TEMPLATES;

    return temp_base;
#else /* _MUTILANG_TEMPLATE_ */ 
    return 0;
#endif /* _MUTILANG_TEMPLATE_ */ 
}


#if defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__)
/*****************************************************************************
 * FUNCTION
 *  mmi_sms_set_template_language
 * DESCRIPTION
 *  Set template language
 * PARAMETERS
 *  langtype        [IN]        
 *  a(?)            [IN]        Language type
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_set_template_language(U8 langtype)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 i = 0;
    S16 temp =0;
    CHAR tempLang[SSC_SIZE];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(tempLang, 0, SSC_SIZE);
    switch (langtype)
    {
        case MSG_TEMPLATE_LANG_ENGLISH:
            memcpy(tempLang, SSC_ENGLISH, SSC_SIZE);
            break;
        case MSG_TEMPLATE_LANG_SIMCHINESE:
            memcpy(tempLang, SSC_SCHINESE, SSC_SIZE);
            break;
        case MSG_TEMPLATE_LANG_TRACHINESE:
            memcpy(tempLang, SSC_TCHINESE, SSC_SIZE);
            break;
    }
	
#ifdef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__
				srv_setting_set_language_ext((U8*)tempLang);
#else
			 i = mmi_lang_support((U8 *)tempLang);
				if (i >= 0)
            {
					srv_setting_set_language_ext((U8)i);
            }
#endif        
              
    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_unset_template_language
 * DESCRIPTION
 *  Unset template language
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_unset_template_language(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = 0;
    S16 temp =0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	

#ifdef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__ 
			srv_setting_set_language_ext((U8*)curr_lang);
#else
	    temp = mmi_lang_support((U8 *) curr_lang);
	    if(temp >= 0)
		{
				srv_setting_set_language_ext(temp);
		}
#endif
				//SetCurrentLanguage(i);
                /* WriteValue(NVRAM_SETTING_LANG, &i, DS_BYTE, &error); */
             
   
   
   
}
#endif /* defined(_MUTILANG_TEMPLATE_) || defined(__MMI_MESSAGES_SIMCHINESE_TEMPLATE__) */ 

#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 


#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
/*****************************************************************************
 * FUNCTION
 *  mmi_sms_read_ud_template_from_nvram
 * DESCRIPTION
 *  Read user defined template from NVRAM
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_read_ud_template_from_nvram(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_READ_TEMPLATE_FROM_NVRAM, index);

    if (index < NVRAM_SMS_UD_RECORD_TOTAL)
    {
        /*  1. The first record index of the LID is 1;
         *  2. And the first record is used to as a mark to 
         *     indicate the intialization status;
         *  So, the record index of the first template is 2;
         */
        if (ReadRecord(NVRAM_EF_SMS_UD_TMEP_LID, (U16)(index + 2), template_data.record_buff,
                NVRAM_SMS_UD_TEMPL_RECORD_SIZE, &error) < 0)
        {
            template_data.record_buff[0] = '\0';
            template_data.record_buff[1] = '\0';
        }
    }
    else
    {
        template_data.record_buff[0] = '\0';
        template_data.record_buff[1] = '\0';
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_write_ud_template_to_nvram
 * DESCRIPTION
 *  Write user defined template to NVRAM
 * PARAMETERS
 *  index       [IN]        Index
 * RETURNS
 *  MMI_TRUE: write success, FALSE: write fail
 *****************************************************************************/
static MMI_BOOL mmi_sms_write_ud_template_to_nvram(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    MMI_BOOL result = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index < NVRAM_SMS_UD_RECORD_TOTAL)
    {
        /*  1. The first record index of the LID is 1;
         *  2. And the first record is used to as a mark to 
         *     indicate the intialization status;
         *  So, the record index of the first template is 2;
         */
        if (WriteRecord(NVRAM_EF_SMS_UD_TMEP_LID, (U16)(index + 2), template_data.record_buff,
                NVRAM_SMS_UD_TEMPL_RECORD_SIZE, &error) != NVRAM_SMS_UD_TEMPL_RECORD_SIZE)
        {
            result = MMI_FALSE;
        }
    }
    else
    {
        result = MMI_FALSE;
    }

    return result;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_write_ud_default_template_to_nvram
 * DESCRIPTION
 *  Write user defined default template to NVRAM
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL mmi_sms_write_ud_default_template_to_nvram(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 i = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(template_data.record_buff, 0, MAX_TEMPL_RECORD_BUFF_SIZE);

    for (i = 0; i < NUM_UD_TEMPLATES; i++)
    {
        if (mmi_sms_write_ud_template_to_nvram(i) == MMI_FALSE)
        {
            return MMI_FALSE;
        }
    }

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_get_ud_templates_to_edit
 * DESCRIPTION
 *  Get user defined templates to edit.
 * PARAMETERS
 *  buffer      [?]             
 *  index       [IN]            
 *  a(?)        [IN/OUT]        Address of string
 *  b(?)        [IN]            Current highlight index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_get_ud_templates_to_edit(CHAR *buffer, U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (template_data.userdef_list[index])
    {
        mmi_ucs2cpy(buffer, template_data.userdef_list[index]);
    }
    else
    {
        buffer[0] = buffer[1] = '\0';
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_delete_ud_template
 * DESCRIPTION
 *  Delete user defined template
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        Index
 * RETURNS
 *  MMI_TRUE: delete success, FALSE: delete fail
 *****************************************************************************/
static MMI_BOOL mmi_sms_delete_ud_template(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 i;
    U8 result;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = index + 1; i < template_data.userdef_num; i++)
    {
        mmi_sms_read_ud_template_from_nvram(i);

        result = mmi_sms_write_ud_template_to_nvram(i - 1);

        if (result == MMI_FALSE)
        {
            return MMI_FALSE;
        }
    }

    template_data.userdef_num--;

    memset(template_data.record_buff, 0, MAX_TEMPL_RECORD_BUFF_SIZE);

    result = mmi_sms_write_ud_template_to_nvram(template_data.userdef_num);

    return (MMI_BOOL)result;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_store_ud_template
 * DESCRIPTION
 *  Store user defined templates
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        Index
 *  b(?)        [IN]        Address of string
 * RETURNS
 *  MMI_TRUE: store success, FALSE: store fail
 *****************************************************************************/
static MMI_BOOL mmi_sms_store_ud_template(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 result;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    result = mmi_sms_write_ud_template_to_nvram(index);

    return (MMI_BOOL)result;
}
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_init_templates
 * DESCRIPTION
 *  Init templates
 * PARAMETERS
 *  void
 * RETURNS
 *  MMI_TRUE: init success, FALSE: init fail
 *****************************************************************************/
U8 mmi_sms_init_templates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    static int initDone = 0;
    S16 error;

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    CHAR *templateSignature;
    CHAR buffer[NVRAM_SMS_TEMPL_RECORD_SIZE];

#ifdef _MUTILANG_TEMPLATE_
    int i;
#endif 
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    CHAR *udTemplateSignature;
    CHAR udBuffer[NVRAM_SMS_UD_TEMPL_RECORD_SIZE];
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (initDone)
    {
        return MMI_TRUE;
    }

    initDone = 1;
	template_data.is_load = MMI_FALSE;
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    for (i = 0; i < NUM_TEMPLATES; i++)
    {
        template_data.predef_list[i] = NULL;
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    for (i = 0; i < NUM_UD_TEMPLATES; i++)
    {
        template_data.userdef_list[i] = NULL;
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (ReadRecord(NVRAM_EF_SMS_LID, 1, buffer, NVRAM_SMS_TEMPL_RECORD_SIZE, &error) < 0)
    {
        buffer[0] = '\0';
    }

    if (buffer[0] == 'A')
    {
        return MMI_TRUE;
    }

#if defined (_MUTILANG_TEMPLATE_) || defined (__MMI_MESSAGES_SIMCHINESE_TEMPLATE__)
    memset(curr_lang, 0, SSC_SIZE);
    memcpy(curr_lang, (CHAR *) gLanguageArray[gCurrLangIndex].aLangSSC, SSC_SIZE);

#ifdef _MUTILANG_TEMPLATE_
    for (i = 0; i < TOTAL_TEMPLATE_LANGUAGE; i++)
    {
        mmi_sms_set_template_language((U8) i);
        if (mmi_sms_write_default_template_to_nvram() == MMI_FALSE)
        {
            return MMI_FALSE;
        }
    }
#else /* _MUTILANG_TEMPLATE_ */ 
    mmi_sms_set_template_language(MSG_TEMPLATE_LANG_SIMCHINESE);
    if (mmi_sms_write_default_template_to_nvram() == MMI_FALSE)
    {
        return MMI_FALSE;
    }
#endif /* _MUTILANG_TEMPLATE_ */ 

    mmi_sms_unset_template_language();
#else /* defined (_MUTILANG_TEMPLATE_) || defined (__MMI_MESSAGES_SIMCHINESE_TEMPLATE__) */ 
    if (mmi_sms_write_default_template_to_nvram() == MMI_FALSE)
    {
        return MMI_FALSE;
    }
#endif /* defined (_MUTILANG_TEMPLATE_) || defined (__MMI_MESSAGES_SIMCHINESE_TEMPLATE__) */ 

    templateSignature = OslMalloc(NVRAM_SMS_TEMPL_RECORD_SIZE);

    strcpy(templateSignature, "AAA");

    if (WriteRecord(NVRAM_EF_SMS_LID, 1, templateSignature,
            NVRAM_SMS_TEMPL_RECORD_SIZE, &error) < NVRAM_SMS_TEMPL_RECORD_SIZE)
    {
        return MMI_FALSE;
    }

    OslMfree(templateSignature);
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (ReadRecord(NVRAM_EF_SMS_UD_TMEP_LID, 1, udBuffer, NVRAM_SMS_UD_TEMPL_RECORD_SIZE, &error) < 0)
    {
        udBuffer[0] = '\0';
    }

    if (udBuffer[0] == 'B')
    {
        return MMI_TRUE;
    }

    if (mmi_sms_write_ud_default_template_to_nvram() == MMI_FALSE)
    {
        return MMI_FALSE;
    }

    udTemplateSignature = OslMalloc(NVRAM_SMS_UD_TEMPL_RECORD_SIZE);

    strcpy(udTemplateSignature, "BBB");

    if (WriteRecord(NVRAM_EF_SMS_UD_TMEP_LID, 1, udTemplateSignature, NVRAM_SMS_UD_TEMPL_RECORD_SIZE, &error) <
        NVRAM_SMS_UD_TEMPL_RECORD_SIZE)
    {
        return MMI_FALSE;
    }

    OslMfree(udTemplateSignature);
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_deInit_templates
 * DESCRIPTION
 *  Deinit templates
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_deInit_templates(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    int i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    for (i = 0; i < NUM_TEMPLATES; i++)
    {
        if (template_data.predef_list[i])
        {
            OslMfree(template_data.predef_list[i]);
            template_data.predef_list[i] = NULL;
        }
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    for (i = 0; i < NUM_UD_TEMPLATES; i++)
    {
        if (template_data.userdef_list[i])
        {
            OslMfree(template_data.userdef_list[i]);
            template_data.userdef_list[i] = NULL;
        }
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */
   template_data.is_load = MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_load_templates_in_displaylist
 * DESCRIPTION
 *  Load templates to display list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_load_templates_in_displaylist(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (template_data.is_load == MMI_TRUE)
    {
        return;
    }    

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    for (i = 0; i < NUM_TEMPLATES; i++)
    {
        U16 templateindex = i + mmi_sms_cal_template_base();

        mmi_sms_read_template_from_nvram(templateindex);

        template_data.predef_list[i] = OslMalloc((mmi_ucs2strlen(template_data.record_buff) + 1) * ENCODING_LENGTH);

        mmi_ucs2cpy(template_data.predef_list[i], template_data.record_buff);
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    for (i = 0; i < NUM_UD_TEMPLATES; i++)
    {
        mmi_sms_read_ud_template_from_nvram(i);

        if (mmi_ucs2strlen(template_data.record_buff))
        {
            template_data.userdef_list[i] = OslMalloc((mmi_ucs2strlen(template_data.record_buff) + 1) * ENCODING_LENGTH);
            mmi_ucs2cpy(template_data.userdef_list[i], template_data.record_buff);
        }
        else
        {
            break;
        }
    }

    template_data.userdef_num = i;
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */
    template_data.is_load = MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_get_template_type
 * DESCRIPTION
 *  Get current screen template type
 * PARAMETERS
 *  void
 * RETURNS
 *  void template type
 *****************************************************************************/
static mmi_sms_template_type_enum mmi_sms_get_template_type(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_sms_template_type_enum template_type = MMI_SMS_TEMPLATE_NONE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__))
    template_type = template_data.template_type;
#endif /* (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)) */

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (template_type == MMI_SMS_TEMPLATE_NONE)
    {
        template_type = MMI_SMS_TEMPLATE_DEFAULT;
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (template_type == MMI_SMS_TEMPLATE_NONE)
    {
        template_type = MMI_SMS_TEMPLATE_USER_DEFINED;
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

    return template_type;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_save_template
 * DESCRIPTION
 *  Save template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL mmi_sms_save_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (template_data.template_type == MMI_SMS_TEMPLATE_DEFAULT)
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */
    {
        if (mmi_sms_store_predefined_template((U16)template_data.curr_index) == MMI_TRUE)
        {
            OslMfree(template_data.predef_list[template_data.curr_index]);
            template_data.predef_list[template_data.curr_index] = OslMalloc((mmi_ucs2strlen(template_data.record_buff) + 1) * ENCODING_LENGTH);

            mmi_ucs2cpy(template_data.predef_list[template_data.curr_index], template_data.record_buff);

            mmi_sms_display_popup_ext(
                STR_GLOBAL_SAVED,
                MMI_EVENT_EXPLICITLY_SAVED);
        }
        else
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_UNFINISHED,
                MMI_EVENT_FAILURE);
        }
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (template_data.template_type == MMI_SMS_TEMPLATE_USER_DEFINED)
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */
    {
        if (mmi_ucs2strlen((CHAR*) template_data.record_buff) == 0)
        {
            mmi_sms_display_popup_ext(
                STR_SMS_FAILURE_DATA_EMPTY,
                MMI_EVENT_FAILURE);

            return MMI_FALSE;
        }
        else if (mmi_sms_store_ud_template((U16)template_data.curr_index) == MMI_TRUE)
        {
            if (template_data.userdef_list[template_data.curr_index])
            {
                OslMfree(template_data.userdef_list[template_data.curr_index]);
            }
            template_data.userdef_list[template_data.curr_index] = OslMalloc((mmi_ucs2strlen(template_data.record_buff) + 1) * ENCODING_LENGTH);
            mmi_ucs2cpy(template_data.userdef_list[template_data.curr_index], template_data.record_buff);

            mmi_sms_display_popup_ext(
                STR_GLOBAL_SAVED,
                MMI_EVENT_EXPLICITLY_SAVED);
        }
        else
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_UNFINISHED,
                MMI_EVENT_FAILURE);
        }
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

    return MMI_TRUE;
}


#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
/*****************************************************************************
 * FUNCTION
 *  mmi_sms_save_new_template
 * DESCRIPTION
 *  Save new template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_BOOL mmi_sms_save_new_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_ucs2strlen((CHAR*) template_data.record_buff) == 0)
    {
        mmi_sms_display_popup_ext(
            STR_SMS_FAILURE_DATA_EMPTY,
            MMI_EVENT_FAILURE);

        return MMI_FALSE;
    }
    else if (mmi_sms_store_ud_template(template_data.userdef_num) == MMI_TRUE)
    {
        mmi_sms_display_popup_ext(
            STR_GLOBAL_SAVED,
            MMI_EVENT_EXPLICITLY_SAVED);

        template_data.userdef_list[template_data.userdef_num] = OslMalloc((mmi_ucs2strlen(template_data.record_buff) + 1) * ENCODING_LENGTH);
        mmi_ucs2cpy(template_data.userdef_list[template_data.userdef_num], template_data.record_buff);
        template_data.userdef_num++;
    }
    else
    {
        mmi_sms_display_popup_ext(
            STR_GLOBAL_UNFINISHED,
            MMI_EVENT_FAILURE);
    }

    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_entry_new
 * DESCRIPTION
 *  Entry template new screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_template_entry_new(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_template_edit_child_gid = cui_fseditor_create(mmi_sms_template_gid);

    if (mmi_sms_template_edit_child_gid != GRP_ID_INVALID)
    {
        U16 num_items = 0;
        U32 input_type = IMM_INPUT_TYPE_SENTENCE | INPUT_TYPE_USE_ENCODING_BASED_LENGTH;
    #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
        template_data.edit_type = 0;
    #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */

        cui_fseditor_set_title(
            mmi_sms_template_edit_child_gid,
            STR_ID_SMS_SCRN_T4_NEW_TEMPLATE_CAPTION,
            IMG_SMS_ENTRY_SCRN_CAPTION);
        
        cui_fseditor_set_text(
            mmi_sms_template_edit_child_gid,
            (WCHAR*) template_data.record_buff,
            (MAX_UD_TEMPLATE_LENGTH + 1) * ENCODING_LENGTH,
            MAX_UD_TEMPLATE_LENGTH);

        cui_fseditor_set_input_method(
            mmi_sms_template_edit_child_gid,
            input_type,
            NULL,
            0);

        nstr_item_list[0] = MENU_ID_SMS_ED_TEMPL_OPT_DONE_MENU;
        num_items = 1;

        cui_fseditor_set_custom_options_menu(
            mmi_sms_template_edit_child_gid,
            MMI_TRUE,
            nstr_item_list,
            (U8)num_items);

        cui_fseditor_set_softkey_text(
            mmi_sms_template_edit_child_gid,
            MMI_CENTER_SOFTKEY,
            0);
        cui_fseditor_set_softkey_icon(
            mmi_sms_template_edit_child_gid,
            MMI_CENTER_SOFTKEY,
            IMG_GLOBAL_SAVE_CSK);

        cui_fseditor_run(mmi_sms_template_edit_child_gid);
    }
}
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_pre_new_template
 * DESCRIPTION
 *  new template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_pre_new_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(template_data.record_buff, 0,MAX_TEMPL_RECORD_BUFF_SIZE);
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (template_data.userdef_num >= NUM_UD_TEMPLATES)
    {
        mmi_sms_display_popup_ext(
            STR_ID_SMS_TEMPLATE_FULL,
            MMI_EVENT_FAILURE);
        return;
    }
    else
    {
        mmi_sms_template_entry_new();
    }
#else /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
    mmi_sms_display_popup_ext(
        STR_GLOBAL_UNFINISHED,
        MMI_EVENT_FAILURE);
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_delete_template
 * DESCRIPTION
 *  Delete template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_delete_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    MMI_ASSERT(template_data.userdef_num <= NUM_UD_TEMPLATES);

    if ((template_data.curr_index < 0) ||
        (template_data.curr_index >= template_data.userdef_num))
    {
        mmi_sms_display_popup_ext(
            STR_GLOBAL_UNFINISHED,
            MMI_EVENT_FAILURE);
        return;
    }
    else
    {
        if (mmi_sms_delete_ud_template((U16)template_data.curr_index) == MMI_TRUE)
        {
            U16 i;

            mmi_sms_display_popup_ext(
                STR_GLOBAL_DELETED,
                MMI_EVENT_EXPLICITLY_DELETED);

            OslMfree(template_data.userdef_list[template_data.curr_index]);

            for (i = template_data.curr_index; i < template_data.userdef_num; i++)
            {
                template_data.userdef_list[i] = template_data.userdef_list[i + 1];
            }

            template_data.userdef_list[template_data.userdef_num] = NULL;
        }
        else
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_UNFINISHED,
                MMI_EVENT_FAILURE);
        }
    }
#else /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
    mmi_sms_display_popup_ext(
        STR_GLOBAL_UNFINISHED,
        MMI_EVENT_FAILURE);
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_pre_delete_template
 * DESCRIPTION
 *  Pre delete template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_pre_delete_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_entry_confirm(
        mmi_sms_template_gid,
        STR_GLOBAL_DELETE_ASK,
        mmi_sms_delete_template,
        mmi_frm_scrn_close_active_id,
        MMI_TRUE);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_erase_template
 * DESCRIPTION
 *  Erase template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_erase_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (mmi_sms_delete_predefined_template((U16)template_data.curr_index) == MMI_TRUE)
    {
        memset(template_data.predef_list[template_data.curr_index],
               0,
               ENCODING_LENGTH);
        
        mmi_sms_display_popup_ext(
            STR_GLOBAL_REMOVED,
            MMI_EVENT_SUCCESS);
    }
    else
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 
    {
        mmi_sms_display_popup_ext(
            STR_GLOBAL_UNFINISHED,
            MMI_EVENT_FAILURE);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_pre_erase_template
 * DESCRIPTION
 *  Before erase template, check if it is empty
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_pre_erase_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (!mmi_ucs2strlen(template_data.predef_list[template_data.curr_index]))
    {
        mmi_sms_display_popup_ext(
            STR_GLOBAL_EMPTY,
            MMI_EVENT_FAILURE);
    }
    else
    {
        mmi_sms_entry_confirm(
            mmi_sms_template_gid,
            STR_MESSAGES_ERACE_Q_ID,
            mmi_sms_erase_template,
            mmi_frm_scrn_close_active_id,
            MMI_TRUE);
    }
#else /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 
    mmi_sms_display_popup_ext(
        STR_GLOBAL_UNFINISHED,
        MMI_EVENT_FAILURE);
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_entry_edit
 * DESCRIPTION
 *  Entry template edit screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_template_entry_edit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_template_edit_child_gid = cui_fseditor_create(mmi_sms_template_gid);

    if (mmi_sms_template_edit_child_gid != GRP_ID_INVALID)
    {
        U8 *buffer = NULL;
        S32 length = 0;
        U32 inputType = IMM_INPUT_TYPE_SENTENCE;
        U16 num_items = 0;
        mmi_sms_template_type_enum type = mmi_sms_get_template_type();

    #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
        if (type == MMI_SMS_TEMPLATE_USER_DEFINED)
        {
            mmi_sms_get_ud_templates_to_edit(
                template_data.record_buff,
                (U16)template_data.curr_index);
        }
    #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
    #ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
        if (type == MMI_SMS_TEMPLATE_DEFAULT)
        {
            mmi_sms_get_templates_to_edit(
                template_data.record_buff,
                (U16)template_data.curr_index);
        }
    #endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

    #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
        template_data.edit_type = 1;
        if (type == MMI_SMS_TEMPLATE_USER_DEFINED)
        {
            buffer = (U8*) template_data.record_buff;
            length = MAX_UD_TEMPLATE_LENGTH + 1;
            inputType = IMM_INPUT_TYPE_SENTENCE | INPUT_TYPE_USE_ENCODING_BASED_LENGTH;
        }
    #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
    #ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
        if (type == MMI_SMS_TEMPLATE_DEFAULT)
        {
            buffer = (U8*) template_data.record_buff;
            length = MAX_TEMPLATE_LENGTH + 1;
        }
    #endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

        cui_fseditor_set_title(
            mmi_sms_template_edit_child_gid,
            STR_ID_SMS_SCRN_T4_EDIT_TEMPLATE_CAPTION,
            IMG_SMS_ENTRY_SCRN_CAPTION);
        
        cui_fseditor_set_text(mmi_sms_template_edit_child_gid, (WCHAR *)buffer, length * ENCODING_LENGTH, length - 1);

        cui_fseditor_set_input_method(mmi_sms_template_edit_child_gid, inputType, NULL, 0);

        nstr_item_list[0] = MENU_ID_SMS_ED_TEMPL_OPT_DONE_MENU;
        num_items = 1;

    #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
        if (type == MMI_SMS_TEMPLATE_USER_DEFINED &&
            template_data.edit_type == 1 && 
            template_data.userdef_num < NUM_UD_TEMPLATES)
        {
            nstr_item_list[1] = MENU_ID_SMS_ED_TEMPL_OPT_SAVEAS_NEW_TEMPL_MENU;
            num_items = 2;
        }
    #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */

        cui_fseditor_set_custom_options_menu(
            mmi_sms_template_edit_child_gid,
            MMI_TRUE,
            nstr_item_list,
            (U8)num_items);

        cui_fseditor_set_softkey_text(
            mmi_sms_template_edit_child_gid,
            MMI_CENTER_SOFTKEY,
            0);
        cui_fseditor_set_softkey_icon(
            mmi_sms_template_edit_child_gid,
            MMI_CENTER_SOFTKEY,
            IMG_GLOBAL_SAVE_CSK);

        /*need handle end key ?????????*/

        cui_fseditor_run(mmi_sms_template_edit_child_gid);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_pre_entry_template_edit
 * DESCRIPTION
 *  Pre entry template edit screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_pre_entry_template_edit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_template_entry_edit();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_entry_template_write_msg
 * DESCRIPTION
 *  entry write msg with the template content
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_entry_template_write_msg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR *templ = NULL;
    mmi_sms_template_type_enum type = mmi_sms_get_template_type();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_ENTRY_TEMPLATE_WRITE_MSG);

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (type == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        templ = template_data.userdef_list[template_data.curr_index];
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (type == MMI_SMS_TEMPLATE_DEFAULT)
    {
        templ = template_data.predef_list[template_data.curr_index];
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

    mmi_sms_entry_write_sms(g_sms_parent_gid, NULL, 0, templ);

    mmi_sms_deInit_templates();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_pre_entry_template_write_msg
 * DESCRIPTION
 *  pre entry write msg with the template content
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_pre_entry_template_write_msg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_entry_template_write_msg();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_get_template_index
 * DESCRIPTION
 *  Get current highlight index in template list
 * PARAMETERS
 *  nIndex      [IN]        
 *  a(?)        [IN]        Current highlight index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_get_template_index(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_GET_TEMPLATE_INDEX, nIndex);
    template_data.curr_index = nIndex;
}


#ifdef __MMI_SMS_SLIM__
static S32 mmi_sms_template_list_get_1032_async_items(S32 start_index, gui_iconlist_menu_item *menuData, S32 num_item)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 curItemIndex;
    S32 item_index;
    mmi_sms_template_type_enum multiTmplate = MMI_SMS_TEMPLATE_NONE;
    U16 max_num = 0;
    CHAR* str_buff = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    if (template_data.template_type == MMI_SMS_TEMPLATE_NONE)
    {
        multiTmplate = MMI_SMS_TEMPLATE_NONE;
        max_num = NUM_TEMPLATES + template_data.userdef_num;
    }
    else if (template_data.template_type == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        multiTmplate = MMI_SMS_TEMPLATE_USER_DEFINED;
        max_num = template_data.userdef_num == 0 ? 1 : template_data.userdef_num;
    }
    else
    {
        multiTmplate = MMI_SMS_TEMPLATE_DEFAULT;
        max_num = NUM_TEMPLATES;
    }
#elif defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__)
    multiTmplate = MMI_SMS_TEMPLATE_DEFAULT;
    max_num = NUM_TEMPLATES;
#elif defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    multiTmplate = MMI_SMS_TEMPLATE_USER_DEFINED;
    max_num = template_data.userdef_num == 0 ? 1 : template_data.userdef_num;
#endif 

    for (item_index = 0; item_index < num_item; item_index++)
    {
        curItemIndex = start_index + item_index;

        if ((item_index < 0) || (item_index >= max_num))
        {
            return MMI_FALSE;
        }

    #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
        if (multiTmplate != MMI_SMS_TEMPLATE_DEFAULT && curItemIndex < template_data.userdef_num)
        {
            str_buff = template_data.userdef_list[curItemIndex];
        }
        else if (template_data.userdef_num == 0 && curItemIndex == 0 && multiTmplate == MMI_SMS_TEMPLATE_USER_DEFINED)
        {
            str_buff = GetString(STR_GLOBAL_EMPTY_LIST);
        }

        if (multiTmplate == MMI_SMS_TEMPLATE_NONE)
        {
            curItemIndex = curItemIndex - template_data.userdef_num;
        }
    #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

    #ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
        if (multiTmplate != MMI_SMS_TEMPLATE_USER_DEFINED && curItemIndex >= 0)
        {
            if (mmi_ucs2strlen(template_data.predef_list[curItemIndex]) == 0)
            {
                str_buff = GetString(STR_GLOBAL_EMPTY_LIST);
            }
            else
            {
                str_buff = template_data.predef_list[curItemIndex];
            }
        }
    #endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 
        MMI_ASSERT(str_buff != NULL);
        mmi_ucs2ncpy((CHAR*) menuData[item_index].item_list[0], str_buff, MAX_SUBMENU_CHARACTERS);
        menuData[item_index].image_list[0] = get_image(gIndexIconsImageList[curItemIndex]);
    }

    return num_item;
}

#else

/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_get_item
 * DESCRIPTION
 *  Get template list item
 * PARAMETERS
 *  item_index                [IN]            Item index
 *  str_buff                  [IN/OUT]        String buffer
 *  img_buff_p                [IN/OUT]        Image buffer
 *  str_img_mask              [IN/OUT]        String image mask
 * RETURNS
 * MMI_TRUE
 *****************************************************************************/
static pBOOL mmi_sms_template_list_get_item(S32 item_index, UI_string_type str_buff, PU8 *img_buff_p, U8 str_img_mask)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 max_num = 0;
    S32 defaultItemIndex = item_index;
    mmi_sms_template_type_enum multiTmplate = MMI_SMS_TEMPLATE_NONE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    if (template_data.template_type == MMI_SMS_TEMPLATE_NONE)
    {
        multiTmplate = MMI_SMS_TEMPLATE_NONE;
        max_num = NUM_TEMPLATES + template_data.userdef_num;
    }
    else if (template_data.template_type == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        multiTmplate = MMI_SMS_TEMPLATE_USER_DEFINED;
        max_num = template_data.userdef_num == 0 ? 1 : template_data.userdef_num;
    }
    else
    {
        multiTmplate = MMI_SMS_TEMPLATE_DEFAULT;
        max_num = NUM_TEMPLATES;
    }
#elif defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__)
    multiTmplate = MMI_SMS_TEMPLATE_DEFAULT;
    max_num = NUM_TEMPLATES;
#elif defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    multiTmplate = MMI_SMS_TEMPLATE_USER_DEFINED;
    max_num = template_data.userdef_num == 0 ? 1 : template_data.userdef_num;
#endif 

    if ((item_index < 0) || (item_index >= max_num))
    {
        return MMI_FALSE;
    }

#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (multiTmplate != MMI_SMS_TEMPLATE_DEFAULT && item_index < template_data.userdef_num)
    {
        mmi_ucs2ncpy((CHAR*) str_buff, (CHAR*) template_data.userdef_list[item_index], MAX_SUBMENU_CHARACTERS);
    }
    else if (template_data.userdef_num == 0 && item_index == 0 && multiTmplate == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        mmi_ucs2cpy((CHAR*) str_buff, (CHAR*) GetString(STR_GLOBAL_EMPTY_LIST));
    }

    if (multiTmplate == MMI_SMS_TEMPLATE_NONE)
    {
        defaultItemIndex = item_index - template_data.userdef_num;
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 

#ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
    if (multiTmplate != MMI_SMS_TEMPLATE_USER_DEFINED && defaultItemIndex >= 0)
    {
        if (mmi_ucs2strlen(template_data.predef_list[defaultItemIndex]) == 0)
        {
            mmi_ucs2cpy((CHAR*) str_buff, (CHAR*) GetString(STR_GLOBAL_EMPTY_LIST));
        }
        else
        {
            mmi_ucs2cpy((CHAR*) str_buff, (CHAR*) template_data.predef_list[defaultItemIndex]);
        }
    }
#endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 

    *img_buff_p = get_image(gIndexIconsImageList[item_index]);
    return MMI_TRUE;
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_sms_entry_template_list
 * DESCRIPTION
 *  Entry template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_entry_template_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_ENTRY_TEMPLATE_LIST);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_entry_template
 * DESCRIPTION
 *  Entry template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_entry_template(mmi_sms_template_type_enum type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID cui_template_gid = GRP_ID_INVALID;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_template_gid = cui_sms_template_list_create(mmi_sms_template_gid, MMI_TRUE, (cui_sms_template_type_enum)type, MMI_TRUE);

    if (cui_template_gid != GRP_ID_INVALID)
    {
        cui_sms_template_list_set_left_softkey(cui_template_gid, STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);
        cui_sms_template_list_set_csk_softkey(cui_template_gid, 0, IMG_GLOBAL_COMMON_CSK);
        cui_sms_template_list_run(cui_template_gid);
    }
    else if (!mmi_frm_scrn_get_count(mmi_sms_template_gid))
    {
        mmi_frm_group_close(mmi_sms_template_gid);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_option_pre_entry_hdlr
 * DESCRIPTION
 *  Pre Entry template option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_template_option_pre_entry_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_entry_menu_cui_options_generic(
        mmi_sms_template_gid,
        MENU_ID_SMS_TEMPLATES_OPTIONS_MENUENTRY,
        STR_GLOBAL_OPTIONS);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_option_entry_hdlr
 * DESCRIPTION
 *  Pre Entry template option
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_template_option_entry_hdlr(MMI_ID menu_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 templateType = mmi_sms_get_template_type();
    MMI_ID menu_cui_gid = menu_gid;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
    if (templateType == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        if (template_data.userdef_num == 0)
        {
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_NEW_MENUENTRY, MMI_FALSE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_DELETE_MENUENTRY, MMI_TRUE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_ERASE_MENUENTRY, MMI_TRUE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_EDIT_MENUENTRY, MMI_TRUE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_WRITE_MESSAGE_MENUENTRY, MMI_TRUE);
        }
        else
        {
            if (template_data.userdef_num >= NUM_UD_TEMPLATES)
            {
                cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_NEW_MENUENTRY, MMI_TRUE);
            }
            else
            {
                cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_NEW_MENUENTRY, MMI_FALSE);
            }
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_DELETE_MENUENTRY, MMI_FALSE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_ERASE_MENUENTRY, MMI_TRUE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_EDIT_MENUENTRY, MMI_FALSE);
            cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_WRITE_MESSAGE_MENUENTRY, MMI_FALSE);
        }
    }
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
    if (templateType == MMI_SMS_TEMPLATE_DEFAULT)
    {
        cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_NEW_MENUENTRY, MMI_TRUE);
        cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_DELETE_MENUENTRY, MMI_TRUE);
        cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_ERASE_MENUENTRY, MMI_FALSE);
        cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_EDIT_MENUENTRY, MMI_FALSE);
        cui_menu_set_item_hidden(menu_cui_gid, MENU_ID_SMS_TEMPLATES_OPTIONS_WRITE_MESSAGE_MENUENTRY, MMI_FALSE);
    }
}


 /*****************************************************************************
  * FUNCTION
  *  mmi_sms_template_option_select_hdlr
  * DESCRIPTION
  *  Delete all template screens
  * PARAMETERS
  *  void
  * RETURNS
  *  void
  *****************************************************************************/
static void mmi_sms_template_option_select_hdlr(cui_menu_event_struct *menu_evt)
{
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/
     mmi_menu_id menu_item_id = menu_evt->highlighted_menu_id;

     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
     switch (menu_item_id)
     {
         case MENU_ID_SMS_TEMPLATES_OPTIONS_NEW_MENUENTRY:
             mmi_sms_pre_new_template();
             break;
         
         case MENU_ID_SMS_TEMPLATES_OPTIONS_DELETE_MENUENTRY:
            mmi_sms_pre_delete_template();
             break;
     
         case MENU_ID_SMS_TEMPLATES_OPTIONS_ERASE_MENUENTRY:
             mmi_sms_pre_erase_template();
             break;
     
         case MENU_ID_SMS_TEMPLATES_OPTIONS_EDIT_MENUENTRY:
             mmi_sms_pre_entry_template_edit();
             break;


         case MENU_ID_SMS_TEMPLATES_OPTIONS_WRITE_MESSAGE_MENUENTRY:
             mmi_sms_pre_entry_template_write_msg();
             break;
     
         default:
             MMI_ASSERT(0);
             break;
     }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_group_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  evt        [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static mmi_ret mmi_sms_template_group_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_DEINIT:
            mmi_sms_template_edit_child_gid = GRP_ID_INVALID;
            mmi_sms_template_gid = GRP_ID_INVALID;
            g_sms_parent_gid = GRP_ID_ROOT;
            break;

        case EVT_ID_GROUP_ACTIVE:
        case EVT_ID_GROUP_INACTIVE:
            break;

        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            break;

        case EVT_ID_CUI_SMS_TEMPLATE_LIST:
            {
                cui_sms_template_evt_struct *temp_evt = (cui_sms_template_evt_struct*)evt;

                switch (temp_evt->key_pressed)
                {
                    case MMI_LEFT_SOFTKEY:
                        mmi_sms_template_option_pre_entry_hdlr();
                        break;

                    case MMI_RIGHT_SOFTKEY:
                        cui_sms_template_close(mmi_sms_template_cui_gid);
                        break;

                    case MMI_CENTER_SOFTKEY:
                        {
                            U16 templateType = mmi_sms_get_template_type();
                            
                        #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
                            if (templateType == MMI_SMS_TEMPLATE_USER_DEFINED)
                            {
                                if (template_data.userdef_num == 0)
                                {
                                    mmi_sms_pre_new_template();
                                }
                                else
                                {
                                    mmi_sms_pre_entry_template_write_msg();
                                }
                            }
                        #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
                            if (templateType == MMI_SMS_TEMPLATE_DEFAULT)
                            {
                                mmi_sms_pre_entry_template_write_msg();
                            }
                        }
                        break;

                    default:
                        break;
                }
            }
            break;

        case EVT_ID_CUI_MENU_ITEM_HILITE:
            break;

        case EVT_ID_CUI_MENU_LIST_ENTRY:
            {
                cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;

                switch (menu_evt->parent_menu_id)
                {
                    case MENU_ID_SMS_TEMPLATES_OPTIONS_MENUENTRY:
                        mmi_sms_template_option_entry_hdlr(menu_evt->sender_id);
                        break;

                #if (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__))
                    case MENU_ID_SMS_TEMPLATES_SELECT_MENUID:
                        cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);
                        break;
                #endif /* (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)) */

                    default:
                        break;
                }
            }
            break;

        case EVT_ID_CUI_MENU_ITEM_SELECT:
            {
                cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
                
                switch (menu_evt->parent_menu_id)
                {
                    case MENU_ID_SMS_TEMPLATES_OPTIONS_MENUENTRY:
                        mmi_sms_template_option_select_hdlr(menu_evt);
                        break;

                #if (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__))
                    case MENU_ID_SMS_TEMPLATES_SELECT_MENUID:
                        mmi_sms_select_template_type_select_hdlr(menu_evt);
                        break;
                #endif /* (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)) */

                    default:
                        break;
                }
            }
            break;

        case EVT_ID_CUI_MENU_CLOSE_REQUEST:
            {
                cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
                cui_menu_close(menu_evt->sender_id);
            }
            break;

        case EVT_ID_CUI_FSEDITOR_ABORT:
            cui_fseditor_close(mmi_sms_template_edit_child_gid);
            break;
    
        case EVT_ID_CUI_FSEDITOR_CSK_PRESSED:
            {
                mmi_sms_template_type_enum type = mmi_sms_get_template_type();
                S32 length = 0;
    
                cui_fseditor_get_text(
                    mmi_sms_template_edit_child_gid,
                    (WCHAR*)template_data.record_buff,
                    length * ENCODING_LENGTH);
    
            #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
                if (type == MMI_SMS_TEMPLATE_USER_DEFINED)
                {
                    length = MAX_UD_TEMPLATE_LENGTH + 1;
                }
            #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
            #ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
                if (type == MMI_SMS_TEMPLATE_DEFAULT)
                {
                    length = MAX_TEMPLATE_LENGTH + 1;
                }
            #endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 
    
            #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
                if (template_data.edit_type == 0)
                {
                    if (mmi_sms_save_new_template())
                    {
                        cui_fseditor_close(mmi_sms_template_edit_child_gid);
                    }
                }
                else
            #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
                {
                    if (mmi_sms_save_template())
                    {
                        cui_fseditor_close(mmi_sms_template_edit_child_gid);
                    }
                }
            }
            break;
    
        case EVT_ID_CUI_FSEDITOR_CUSTOM_MENU_SELECTED:
            {
                cui_fseditor_custom_menu_select_evt_struct *event = (cui_fseditor_custom_menu_select_evt_struct*)evt;
                mmi_sms_template_type_enum type = mmi_sms_get_template_type();
                S32 length = 0;
    
            #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
                if (type == MMI_SMS_TEMPLATE_USER_DEFINED)
                {
                    length = MAX_UD_TEMPLATE_LENGTH + 1;
                }
            #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
            #ifdef __MMI_MESSAGES_PREDEFINED_TEMPLATE__
                if (type == MMI_SMS_TEMPLATE_DEFAULT)
                {
                    length = MAX_TEMPLATE_LENGTH + 1;
                }
            #endif /* __MMI_MESSAGES_PREDEFINED_TEMPLATE__ */ 
    
                cui_fseditor_get_text(
                    mmi_sms_template_edit_child_gid,
                    (WCHAR*)template_data.record_buff,
                    length * ENCODING_LENGTH);
    
                if (event->menu_id == MENU_ID_SMS_ED_TEMPL_OPT_DONE_MENU)
                {
                #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
                    if (template_data.edit_type == 0)
                    {
                        if (mmi_sms_save_new_template())
                        {
                            cui_fseditor_close(mmi_sms_template_edit_child_gid);
                        }
                    }
                    else
                #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */ 
                    {
                        if (mmi_sms_save_template())
                        {
                            cui_fseditor_close(mmi_sms_template_edit_child_gid);
                        }
                    }
                }
           #ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
                else if (event->menu_id == MENU_ID_SMS_ED_TEMPL_OPT_SAVEAS_NEW_TEMPL_MENU)
                {
                    if (mmi_sms_save_new_template())
                    {
                        cui_fseditor_close(mmi_sms_template_edit_child_gid);
                    }
                }
            #endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */
            }
            break;

        default:
            break;
    }

    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_sms_create_template_gid
 * DESCRIPTION
 *  Entry message settings menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_sms_create_template_gid(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_sms_template_gid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(mmi_sms_template_gid);
    }

    g_sms_parent_gid = parent_gid;

    mmi_sms_template_gid = mmi_frm_group_create_ex(
                            parent_gid,
                            GRP_ID_AUTO_GEN,
                            mmi_sms_template_group_proc,
                            NULL, 
                            MMI_FRM_NODE_SMART_CLOSE_FLAG);

    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_TEMPLATE_GROUP_ENTRY, mmi_sms_template_gid);
}


#ifdef __MMI_MESSAGES_USERDEFINED_TEMPLATE__
/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_has_ucs2_char
 * DESCRIPTION
 *  
 * PARAMETERS
 *  
 * RETURNS
 *  msg_get_template_return_value_enum
 *****************************************************************************/
static MMI_BOOL mmi_sms_template_has_ucs2_char(U16 *buf, U16 charNum)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 i;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = 0; i < charNum; i++)
    {
        if ((buf[i] != 0) && !mmi_7bit_check_gsm_default(buf[i]) && 
            !mmi_7bit_check_gsm_ext_character_default(buf[i]))
        {
            return MMI_TRUE;
        }
    }
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_save_view_content_as_template
 * DESCRIPTION
 *  Save View Content As Template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_save_view_content_as_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSData *pEMS;
    U16 text_length;
    CHAR *text_buffer;
    MMI_BOOL hasUCS2Char;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_sms_load_templates_in_displaylist();

    GetEMSDataForView(&pEMS, 0);

    text_buffer = OslMalloc((MAX_UD_TEMPLATE_LENGTH + 1) * ENCODING_LENGTH * 2);

    memset(text_buffer, 0, (MAX_UD_TEMPLATE_LENGTH + 1) * ENCODING_LENGTH * 2);

    srv_sms_remove_escape_char(
        text_buffer, 
        (CHAR*)pEMS->textBuffer,
        (MAX_UD_TEMPLATE_LENGTH * 2) > pEMS->textLength ? pEMS->textLength : (MAX_UD_TEMPLATE_LENGTH * 2));

    text_length = mmi_ucs2strlen(text_buffer);

    hasUCS2Char = mmi_sms_template_has_ucs2_char((U16*)text_buffer, text_length);

    if ((text_length > MAX_UD_TEMPLATE_LENGTH &&
         pEMS->dcs == SMSAL_DEFAULT_DCS &&
         hasUCS2Char == MMI_FALSE ) ||
         (text_length > MAX_UD_TEMPLATE_LENGTH / 2 &&
          (pEMS->dcs == SMSAL_UCS2_DCS ||
          (pEMS->dcs == SMSAL_DEFAULT_DCS && hasUCS2Char == MMI_TRUE))))
    {
        if (hasUCS2Char)
        {
            text_buffer[(MAX_UD_TEMPLATE_LENGTH / 2) * ENCODING_LENGTH] = '\0';
            text_buffer[(MAX_UD_TEMPLATE_LENGTH / 2) * ENCODING_LENGTH + 1] = '\0';
        }
        else
        {
            text_buffer[(MAX_UD_TEMPLATE_LENGTH) * ENCODING_LENGTH] = '\0';
            text_buffer[(MAX_UD_TEMPLATE_LENGTH) * ENCODING_LENGTH + 1] = '\0';
        }
    }

    if (template_data.userdef_num < NUM_UD_TEMPLATES)
    {
        mmi_ucs2cpy(template_data.record_buff, (CHAR*)text_buffer);
        
        if (mmi_sms_store_ud_template(template_data.userdef_num))
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_SAVED,
                MMI_EVENT_EXPLICITLY_SAVED);
        }
        else
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_UNFINISHED,
                MMI_EVENT_FAILURE);
        }
    }
    else
    {
        mmi_sms_display_popup_ext(
            STR_ID_SMS_TEMPLATE_FULL,
            MMI_EVENT_FAILURE);
    }

    mmi_sms_deInit_templates();

    OslMfree(text_buffer);
}
#endif /* __MMI_MESSAGES_USERDEFINED_TEMPLATE__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_get_curr_template
 * DESCRIPTION
 *  Get Current Highlihgt Template Content
 * PARAMETERS
 *  void
 * RETURNS
 *  CHAR*
 *****************************************************************************/
CHAR* mmi_sms_get_curr_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR *templ = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return templ;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_get_sms_template
 * DESCRIPTION
 *  Call sms to show tempalte list and get the user select one
 * PARAMETERS
 *  U16 left_softkey: LSK string value.
 *  U8 tempate_type: value in mmi_msg_list_template_type_enum, indicate which type of template caller want to list.
 *  mmi_msg_get_template_hdlr_func_t callback: call back function
 * RETURNS
 *  msg_get_template_return_value_enum
 *****************************************************************************/
U8 mmi_sms_get_sms_template(U16 left_softkey, U16 left_softkey_icon, U8 template_type, mmi_sms_get_template_hdlr_func_t callback)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 result = SMS_GET_TEMPLATE_NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return result;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_abort_get_sms_template
 * DESCRIPTION
 *  Call sms to delete template list screen and free resources related
 * PARAMETERS
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_abort_get_sms_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_um_entry_template
 * DESCRIPTION
 *  entry function for sms template
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_um_entry_template(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_left_softkey_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  U8
 *****************************************************************************/
static void mmi_sms_template_list_left_softkey_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_sms_template_evt_struct evt;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    evt.evt_id = EVT_ID_CUI_SMS_TEMPLATE_LIST;
    evt.sender_id = mmi_sms_template_cui_gid;
    evt.key_pressed = MMI_LEFT_SOFTKEY;

    mmi_frm_group_send_to_parent(mmi_sms_template_cui_gid, (mmi_group_event_struct*)&evt);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_right_softkey_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  U8
 *****************************************************************************/
static void mmi_sms_template_list_right_softkey_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_sms_template_evt_struct evt;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    evt.evt_id = EVT_ID_CUI_SMS_TEMPLATE_LIST;
    evt.sender_id = mmi_sms_template_cui_gid;
    evt.key_pressed = MMI_RIGHT_SOFTKEY;

    mmi_frm_group_send_to_parent(mmi_sms_template_cui_gid, (mmi_group_event_struct*)&evt);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_csk_softkey_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  U8
 *****************************************************************************/
static void mmi_sms_template_list_csk_softkey_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_sms_template_evt_struct evt;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    evt.evt_id = EVT_ID_CUI_SMS_TEMPLATE_LIST;
    evt.sender_id = mmi_sms_template_cui_gid;
    evt.key_pressed = MMI_CENTER_SOFTKEY;

    mmi_frm_group_send_to_parent(mmi_sms_template_cui_gid, (mmi_group_event_struct*)&evt);
}


/*****************************************************************************
 * FUNCTION
 *  cui_sms_template_proc
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
static mmi_ret mmi_sms_template_list_proc(mmi_event_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                                                         */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                                                               */
    /*----------------------------------------------------------------*/
    
    switch (evt->evt_id)
    {
        case EVT_ID_GROUP_DEINIT:
            mmi_sms_template_cui_gid = GRP_ID_INVALID;
            mmi_sms_deInit_templates();
            break;

        case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
            break;

    }

    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_create
 * DESCRIPTION
 *  
 * PARAMETERS
 * RETURNS
 *  void
 *****************************************************************************/
MMI_ID mmi_sms_template_list_create(MMI_ID parent_gid, MMI_BOOL allow_empty_list, cui_sms_template_type_enum templ_type, MMI_BOOL is_popup)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 maxItem = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_sms_init_templates() == MMI_FALSE)
    {
        if (is_popup)
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_NOT_SUPPORTED,
                MMI_EVENT_FAILURE);
        }
        return GRP_ID_INVALID;
    }

    mmi_sms_load_templates_in_displaylist();

#if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    template_data.template_type = (mmi_sms_template_type_enum)templ_type;

    if (template_data.template_type == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        maxItem = template_data.userdef_num;
    }
    else if (template_data.template_type == MMI_SMS_TEMPLATE_DEFAULT)
    {
        maxItem = NUM_TEMPLATES;
    }
    else
    {
        template_data.template_type = MMI_SMS_TEMPLATE_NONE;
        maxItem = template_data.userdef_num + NUM_TEMPLATES;
    }
#elif defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    maxItem = template_data.userdef_num;
#elif defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__)
    maxItem = NUM_TEMPLATES;
#endif 
    
    if (maxItem == 0 && !allow_empty_list)
    {
        if (is_popup)
        {
            mmi_sms_display_popup_ext(
                STR_GLOBAL_EMPTY,
                MMI_EVENT_FAILURE);
        }

        return GRP_ID_INVALID;
    }

    if (mmi_sms_template_cui_gid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(mmi_sms_template_cui_gid);

        if (mmi_sms_template_gid != GRP_ID_INVALID)
        {
            mmi_frm_group_close(mmi_sms_template_gid);
        }
    }
    else
    {
        //mmi_sms_deInit_templates();
    }

    template_data.list_lsk_str_id = STR_GLOBAL_OK;
    template_data.list_lsk_icon_id = IMG_GLOBAL_OK;
    template_data.list_csk_str_id = 0;
    template_data.list_csk_icon_id = IMG_GLOBAL_COMMON_CSK;
    template_data.is_set_csk = MMI_FALSE;

    mmi_sms_template_cui_gid = mmi_frm_group_create(parent_gid, GRP_ID_AUTO_GEN, mmi_sms_template_list_proc, NULL);

    return mmi_sms_template_cui_gid;
}


/*****************************************************************************
 * FUNCTION
 *  cui_sms_template_list_runs
 * DESCRIPTION
 *  
 * PARAMETERS
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_template_list_run(MMI_ID template_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (template_gid != GRP_ID_INVALID)
    {
        mmi_frm_group_enter(mmi_sms_template_cui_gid, MMI_FRM_NODE_SMART_CLOSE_FLAG);
        mmi_sms_template_list_entry();
    }
}


/*****************************************************************************
 * FUNCTION
 *  cui_sms_template_close
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
void mmi_sms_template_list_close(MMI_ID template_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_close(template_gid);
}


/*****************************************************************************
 * FUNCTION
 *  cui_sms_template_list_set_left_softkey
 * DESCRIPTION
 *  
 * PARAMETERS
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_template_list_set_left_softkey(MMI_ID template_gid, U16 left_string_id, U16 left_icon_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (template_gid != GRP_ID_INVALID)
    {
        template_data.list_lsk_str_id = left_string_id;
        template_data.list_lsk_icon_id = left_icon_id;
    }
}


/*****************************************************************************
 * FUNCTION
 *  cui_sms_template_list_set_csk_softkey
 * DESCRIPTION
 *  
 * PARAMETERS
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_template_list_set_csk_softkey(MMI_ID template_gid, U16 csk_string_id, U16 csk_icon_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (template_gid != GRP_ID_INVALID)
    {
        template_data.list_csk_str_id = csk_string_id;
        template_data.list_csk_icon_id = csk_icon_id;
        template_data.is_set_csk = MMI_TRUE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_get_select_content
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
WCHAR* mmi_sms_template_list_get_select_content(MMI_ID template_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *templ = NULL;
    S32 defaultItemIndex = template_data.curr_index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    if (template_data.template_type == MMI_SMS_TEMPLATE_USER_DEFINED)
    {
        templ = (WCHAR*)template_data.userdef_list[defaultItemIndex];
    }
    else if (template_data.template_type == MMI_SMS_TEMPLATE_DEFAULT)
    {
        templ = (WCHAR*)template_data.predef_list[defaultItemIndex];
    }
    else
    {
        if (template_data.curr_index < template_data.userdef_num)
        {
            templ = (WCHAR*)template_data.userdef_list[defaultItemIndex];
        }
        else
        {
            defaultItemIndex = template_data.curr_index - template_data.userdef_num;
            if (defaultItemIndex >= 0)
            {
                templ = (WCHAR*)template_data.predef_list[defaultItemIndex];
            }
        }
    }
#elif defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
    templ = (WCHAR*)template_data.userdef_list[defaultItemIndex];
#elif defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__)
    templ = (WCHAR*)template_data.predef_list[defaultItemIndex];
#endif 

    return templ;  
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_list_entry
 * DESCRIPTION
 *  Entry template list items
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_template_list_entry(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    S32 hiliteitem = 0;
    S32 maxItem = 0;
#ifdef __MMI_SMS_SLIM__
    S32 error;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter(
            mmi_sms_template_cui_gid,
            SCR_ID_SMS_TEMPLATE_LIST,
            NULL,
            mmi_sms_template_list_entry,
            MMI_FRM_FULL_SCRN))
    {
        mmi_sms_load_templates_in_displaylist();

    #if defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
        if (template_data.template_type == MMI_SMS_TEMPLATE_USER_DEFINED)
        {
            maxItem = template_data.userdef_num;
        }
        else if (template_data.template_type == MMI_SMS_TEMPLATE_DEFAULT)
        {
            maxItem = NUM_TEMPLATES;
        }
        else
        {
            maxItem = template_data.userdef_num + NUM_TEMPLATES;
        }
    #elif defined(__MMI_MESSAGES_USERDEFINED_TEMPLATE__)
        maxItem = template_data.userdef_num;
    #elif defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__)
        maxItem = NUM_TEMPLATES;
    #endif 
        guiBuffer = mmi_frm_scrn_get_gui_buf(mmi_sms_template_cui_gid, SCR_ID_SMS_TEMPLATE_LIST);

        if (guiBuffer != NULL)
        {
            hiliteitem = (template_data.curr_index < maxItem) ? template_data.curr_index : 0;
        }

        RegisterHighlightHandler(mmi_sms_get_template_index);

        EnableCenterSoftkey(template_data.list_csk_str_id, template_data.list_csk_icon_id);

    #ifdef __MMI_SMS_SLIM__
        wgui_cat1032_show(
            (WCHAR*)GetString(STR_ID_SMS_SMS_TEMPLATES_MENUENTRY),
            NULL,
            (WCHAR*)GetString(template_data.list_lsk_str_id),
            NULL,
            (WCHAR*)GetString(STR_GLOBAL_BACK),
            NULL,
            maxItem == 0 ? 1 : maxItem,
            mmi_sms_template_list_get_1032_async_items,
            NULL,
            hiliteitem,
            0,    
            IMG_GLOBAL_L1,
            0,
            guiBuffer,
            &error);
    #else
        ShowCategory184Screen(
            STR_ID_SMS_SMS_TEMPLATES_MENUENTRY,
            IMG_SMS_ENTRY_SCRN_CAPTION,
            template_data.list_lsk_str_id,
            template_data.list_lsk_icon_id,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            maxItem == 0 ? 1 : maxItem,
            mmi_sms_template_list_get_item,
            NULL,
            hiliteitem,
            guiBuffer);
    #endif

        SetLeftSoftkeyFunction(mmi_sms_template_list_left_softkey_hdlr, KEY_EVENT_UP);
        SetRightSoftkeyFunction(mmi_sms_template_list_right_softkey_hdlr, KEY_EVENT_UP);

        if (template_data.is_set_csk)
        {
            SetCenterSoftkeyFunction(mmi_sms_template_list_csk_softkey_hdlr, KEY_EVENT_UP);
        }
        else
        {
            SetCenterSoftkeyFunction(mmi_sms_template_list_left_softkey_hdlr, KEY_EVENT_UP);
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_sms_template_group_close
 * DESCRIPTION
 *  Entry message settings menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_sms_template_group_close(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (GRP_ID_INVALID != mmi_sms_template_gid)
    {
        mmi_frm_group_close(mmi_sms_template_gid);
    }
}


/*****************************************************************************
 * FUNCTION
 *  cui_sms_templates_launch
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_ID cui_sms_templates_launch(MMI_ID parent_grp_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_MESSAGES_TEMPLATE__
    if (mmi_sms_template_gid != GRP_ID_INVALID)
    {
        mmi_frm_group_close(mmi_sms_template_gid);
    }

    MMI_TRACE(MMI_COMMON_TRC_G6_MSG, TRC_MMI_SMS_TEMPLATE_LAUNCH, parent_grp_id);

    if (parent_grp_id == GRP_ID_INVALID)
    {
        parent_grp_id = GRP_ID_ROOT;
    }

    mmi_sms_create_template_gid(parent_grp_id);
#if (defined(__MMI_MESSAGES_PREDEFINED_TEMPLATE__) && defined (__MMI_MESSAGES_USERDEFINED_TEMPLATE__))
    mmi_sms_select_template_type_pre_entry_hdlr();
#else
    mmi_sms_entry_template(MMI_SMS_TEMPLATE_NONE);
#endif
    return mmi_sms_template_gid;
#else
    return GRP_ID_INVALID;
#endif /* __MMI_MESSAGES_TEMPLATE__ */
}

#endif /* __MMI_MESSAGES_TEMPLATE__ */

#endif /* __MMI_TELEPHONY_SUPPORT__ */ 

